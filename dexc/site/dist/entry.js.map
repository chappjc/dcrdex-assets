{"version":3,"file":"entry.js","mappings":"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","sources":["webpack://dexclient/./src/js/locales.js","webpack://dexclient/./src/js/doc.js","webpack://dexclient/./src/js/state.js","webpack://dexclient/./src/js/forms.js","webpack://dexclient/./src/js/basepage.js","webpack://dexclient/./src/js/http.js","webpack://dexclient/./src/js/constants.js","webpack://dexclient/./src/js/register.js","webpack://dexclient/./src/js/login.js","webpack://dexclient/./src/js/notifications.js","webpack://dexclient/./src/js/wallets.js","webpack://dexclient/./src/js/settings.js","webpack://dexclient/./src/js/orderbook.js","webpack://dexclient/./src/js/charts.js","webpack://dexclient/./src/js/orderutil.js","webpack://dexclient/./src/js/ws.js","webpack://dexclient/./src/js/markets.js","webpack://dexclient/./src/js/orders.js","webpack://dexclient/./src/js/order.js","webpack://dexclient/./src/js/app.js","webpack://dexclient/./src/index.js"],"sourcesContent":["export const ID_NO_PASS_ERROR_MSG = 'ID_NO_PASS_ERROR_MSG'\nexport const ID_NO_APP_PASS_ERROR_MSG = 'ID_NO_APP_PASS_ERROR_MSG'\nexport const ID_SET_BUTTON_BUY = 'ID_SET_BUTTON_BUY'\nexport const ID_SET_BUTTON_SELL = 'ID_SET_BUTTON_SELL'\nexport const ID_OFF = 'ID_OFF'\nexport const ID_READY = 'ID_READY'\nexport const ID_LOCKED = 'ID_LOCKED'\nexport const ID_NOWALLET = 'ID_NOWALLET'\nexport const ID_WALLET_SYNC_PROGRESS = 'ID_WALLET_SYNC_PROGRESS'\nexport const ID_HIDE_ADDITIONAL_SETTINGS = 'ID_HIDE_ADDITIONAL_SETTINGS'\nexport const ID_SHOW_ADDITIONAL_SETTINGS = 'ID_SHOW_ADDITIONAL_SETTINGS'\nexport const ID_BUY = 'ID_BUY'\nexport const ID_SELL = 'ID_SELL'\nexport const ID_NOT_SUPPORTED = 'ID_NOT_SUPPORTED'\nexport const ID_CONNECTION_FAILED = 'ID_CONNECTION_FAILED'\nexport const ID_ORDER_PREVIEW = 'ID_ORDER_PREVIEW'\nexport const ID_CALCULATING = 'ID_CALCULATING'\nexport const ID_ESTIMATE_UNAVAILABLE = 'ID_ESTIMATE_UNAVAILABLE'\nexport const ID_NO_ZERO_RATE = 'ID_NO_ZERO_RATE'\nexport const ID_NO_ZERO_QUANTITY = 'ID_NO_ZERO_QUANTITY'\nexport const ID_TRADE = 'ID_TRADE'\nexport const ID_NO_ASSET_WALLET = 'ID_NO_ASSET_WALLET'\nexport const ID_EXECUTED = 'ID_EXECUTED'\nexport const ID_BOOKED = 'ID_BOOKED'\nexport const ID_CANCELING = 'ID_CANCELING'\nexport const ID_PASSWORD_NOT_MATCH = 'ID_PASSWORD_NOT_MATCH'\nexport const ID_ACCT_UNDEFINED = 'ID_ACCT_UNDEFINED'\nexport const ID_KEEP_WALLET_PASS = 'ID_KEEP_WALLET_PASS'\nexport const ID_NEW_WALLET_PASS = 'ID_NEW_WALLET_PASS'\nexport const ID_LOT = 'ID_LOT'\nexport const ID_LOTS = 'ID_LOTS'\nexport const ID_UNKNOWN = 'ID_UNKNOWN'\nexport const ID_EPOCH = 'ID_EPOCH'\nexport const ID_SETTLING = 'ID_SETTLING'\nexport const ID_NO_MATCH = 'ID_NO_MATCH'\nexport const ID_CANCELED = 'ID_CANCELED'\nexport const ID_REVOKED = 'ID_REVOKED'\nexport const ID_WAITING_FOR_CONFS = 'ID_WAITING_FOR_CONFS'\nexport const ID_NONE_SELECTED = 'ID_NONE_SELECTED' // unused?\nexport const ID_REGISTRATION_FEE_SUCCESS = 'ID_REGISTRATION_FEE_SUCCESS'\nexport const ID_API_ERROR = 'ID_API_ERROR'\nexport const ID_CHOOSE_WALLET = 'ID_CHOOSE_WALLET'\nexport const ID_SETUP_WALLET = 'ID_SETUP_WALLET'\nexport const ID_WALLET_READY = 'ID_WALLET_READY'\n\nexport const enUS = {\n  [ID_NO_PASS_ERROR_MSG]: 'password cannot be empty',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'app password cannot be empty',\n  [ID_PASSWORD_NOT_MATCH]: 'passwords do not match',\n  [ID_SET_BUTTON_BUY]: 'Place order to buy  {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Place order to sell {{ asset }}',\n  [ID_OFF]: 'off',\n  [ID_READY]: 'ready',\n  [ID_LOCKED]: 'locked',\n  [ID_NOWALLET]: 'no wallet',\n  [ID_WALLET_SYNC_PROGRESS]: 'wallet is {{ syncProgress }}% synced',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'hide additional settings',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'show additional settings',\n  [ID_BUY]: 'Buy',\n  [ID_SELL]: 'Sell',\n  [ID_NOT_SUPPORTED]: '{{ asset }} is not supported',\n  [ID_CONNECTION_FAILED]: 'Connection to dex server failed. You can close dexc and try again later or wait for it to reconnect.',\n  [ID_ORDER_PREVIEW]: 'Total: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'calculating...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'estimate unavailable',\n  [ID_NO_ZERO_RATE]: 'zero rate not allowed',\n  [ID_NO_ZERO_QUANTITY]: 'zero quantity not allowed',\n  [ID_TRADE]: 'trade',\n  [ID_NO_ASSET_WALLET]: 'No {{ asset }} wallet',\n  [ID_EXECUTED]: 'executed',\n  [ID_BOOKED]: 'booked',\n  [ID_CANCELING]: 'canceling',\n  [ID_ACCT_UNDEFINED]: 'Account undefined.',\n  [ID_KEEP_WALLET_PASS]: 'keep current wallet password',\n  [ID_NEW_WALLET_PASS]: 'set a new wallet password',\n  [ID_LOT]: 'lot',\n  [ID_LOTS]: 'lots',\n  [ID_UNKNOWN]: 'unknown',\n  [ID_EPOCH]: 'epoch',\n  [ID_SETTLING]: 'settling',\n  [ID_NO_MATCH]: 'no match',\n  [ID_CANCELED]: 'canceled',\n  [ID_REVOKED]: 'revoked',\n  [ID_WAITING_FOR_CONFS]: 'Waiting for confirmations...',\n  [ID_NONE_SELECTED]: 'none selected',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Registration fee payment successful!',\n  [ID_API_ERROR]: 'API error',\n  [ID_WALLET_READY]: 'Ready',\n  [ID_SETUP_WALLET]: 'Setup'\n}\n\nexport const ptBR = {\n  [ID_NO_PASS_ERROR_MSG]: 'senha não pode ser vazia',\n  [ID_NO_APP_PASS_ERROR_MSG]: 'senha do app não pode ser vazia',\n  [ID_PASSWORD_NOT_MATCH]: 'senhas diferentes',\n  [ID_SET_BUTTON_BUY]: 'Ordem de compra de {{ asset }}',\n  [ID_SET_BUTTON_SELL]: 'Ordem de venda de {{ asset }}',\n  [ID_OFF]: 'desligar',\n  [ID_READY]: 'pronto',\n  [ID_LOCKED]: 'trancado',\n  [ID_NOWALLET]: 'sem carteira',\n  [ID_WALLET_SYNC_PROGRESS]: 'carteira está {{ syncProgress }}% sincronizada',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: 'esconder configurações adicionais',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: 'mostrar configurações adicionais',\n  [ID_BUY]: 'Comprar',\n  [ID_SELL]: 'Vender',\n  [ID_NOT_SUPPORTED]: '{{ asset }} não tem suporte',\n  [ID_CONNECTION_FAILED]: 'Conexão ao server dex falhou. Pode fechar dexc e tentar novamente depois ou esperar para tentar se reconectar.',\n  [ID_ORDER_PREVIEW]: 'Total: {{ total }} {{ asset }}',\n  [ID_CALCULATING]: 'calculando...',\n  [ID_ESTIMATE_UNAVAILABLE]: 'estimativa indisponível',\n  [ID_NO_ZERO_RATE]: 'taxa não pode ser zero',\n  [ID_NO_ZERO_QUANTITY]: 'quantidade não pode ser zero',\n  [ID_TRADE]: 'troca',\n  [ID_NO_ASSET_WALLET]: 'Sem carteira {{ asset }}',\n  [ID_EXECUTED]: 'executado',\n  [ID_BOOKED]: 'reservado',\n  [ID_CANCELING]: 'cancelando',\n  [ID_ACCT_UNDEFINED]: 'conta não definida.',\n  [ID_KEEP_WALLET_PASS]: 'manter senha da carteira',\n  [ID_NEW_WALLET_PASS]: 'definir nova senha para carteira',\n  [ID_LOT]: 'lote',\n  [ID_LOTS]: 'lotes',\n  [ID_UNKNOWN]: 'desconhecido',\n  [ID_EPOCH]: 'epoque',\n  [ID_SETTLING]: 'assentando',\n  [ID_NO_MATCH]: 'sem combinações',\n  [ID_CANCELED]: 'cancelado',\n  [ID_REVOKED]: 'revocado',\n  [ID_WAITING_FOR_CONFS]: 'Esperando confirmações...',\n  [ID_NONE_SELECTED]: 'nenhuma selecionado',\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Sucesso no pagamento da taxa de registro!',\n  [ID_API_ERROR]: 'Erro de API',\n  [ID_WALLET_READY]: 'Escolher',\n  [ID_SETUP_WALLET]: 'Configurar'\n}\n\nexport const zhCN = {\n  [ID_NO_PASS_ERROR_MSG]: '密码不能为空',\n  [ID_NO_APP_PASS_ERROR_MSG]: '应用密码不能为空',\n  [ID_PASSWORD_NOT_MATCH]: '密码不相同',\n  [ID_SET_BUTTON_BUY]: '来自{{ asset }}的买入订单',\n  [ID_SET_BUTTON_SELL]: '来自{{ asset }}的卖出订单',\n  [ID_OFF]: '关闭',\n  [ID_READY]: '准备就绪', //  alt. 准备好\n  [ID_LOCKED]: '锁定',\n  [ID_NOWALLET]: '未连接钱包', // alt. 没有钱包\n  [ID_WALLET_SYNC_PROGRESS]: '钱包同步进度{{ syncProgress }}%',\n  [ID_HIDE_ADDITIONAL_SETTINGS]: '隐藏其它设置',\n  [ID_SHOW_ADDITIONAL_SETTINGS]: '显示其它设置',\n  [ID_BUY]: '买',\n  [ID_SELL]: '卖',\n  [ID_NOT_SUPPORTED]: '{{ asset }}不受支持',\n  [ID_CONNECTION_FAILED]: '连接到服务器 dex 失败。您可以关闭 dexc 并稍后重试或等待尝试重新连接。',\n  [ID_ORDER_PREVIEW]: '总计： {{ total }} {{ asset }}',\n  [ID_CALCULATING]: '计算中...',\n  [ID_ESTIMATE_UNAVAILABLE]: '估计不可用',\n  [ID_NO_ZERO_RATE]: '汇率不能为零',\n  [ID_NO_ZERO_QUANTITY]: '数量不能为零',\n  [ID_TRADE]: '交易',\n  [ID_NO_ASSET_WALLET]: '没有钱包 {{ asset }}',\n  [ID_EXECUTED]: '执行',\n  [ID_BOOKED]: '保留',\n  [ID_CANCELING]: '取消',\n  [ID_ACCT_UNDEFINED]: '帐户未定义。',\n  [ID_KEEP_WALLET_PASS]: '保留钱包密码',\n  [ID_NEW_WALLET_PASS]: '设置新的钱包密码',\n  [ID_LOT]: '批处理',\n  [ID_LOTS]: '批', // alt. 很多\n  [ID_UNKNOWN]: 'unknown', // TODO\n  [ID_EPOCH]: '时间',\n  [ID_SETTLING]: 'settling', // TODO - \"settling\" shows in the Your Orders table when the order is doing an atomic swap with another trade\n  [ID_NO_MATCH]: 'no match', // TODO - \"no match\" shows in the Your Orders table when the order did not match with another trade and is done\n  [ID_CANCELED]: 'canceled', // TODO - \"canceled\" shows in the Your Orders table when the order has been canceled\n  [ID_REVOKED]: 'revoked', // TODO - \"revoked\" shows in the Your Orders table when the order has failed during swap\n  [ID_WAITING_FOR_CONFS]: 'Waiting for confirmations...', // TODO - shows when the registration fee transaction is waiting to be mined (needs confirmations)\n  [ID_NONE_SELECTED]: 'none selected', // TODO - looks unused, but this indicates nothing is selected in some list\n  [ID_REGISTRATION_FEE_SUCCESS]: 'Registration fee payment successful!', // TODO - When the registration fee transaction reaches the required number of confirmations, this is shown\n  [ID_API_ERROR]: '接口错误',\n  [ID_WALLET_READY]: 'Choose Wallet', // xxx translate\n  [ID_SETUP_WALLET]: 'Setup' // xxx translate\n}\n\nconst localesMap = {\n  'en-us': enUS,\n  'pt-br': ptBR,\n  'zh-cn': zhCN\n}\n\n/* locale will hold the locale loaded via setLocale. */\nlet locale\n\n/*\n * setLocale read the language tag from the current document's html element lang\n * attribute and sets the locale. setLocale should be called once by the\n * application before prep is used.\n*/\nexport function setLocale () { locale = localesMap[document.documentElement.lang.toLowerCase()] }\n\n/* prep will format the message to the current locale. */\nexport function prep (k, args = undefined) {\n  return stringTemplateParser(locale[k], args)\n}\n\n/*\n * stringTemplateParser is a template string matcher, where expression is any\n * text. It switches what is inside double brackets (e.g. 'buy {{ asset }}')\n * for the value described into valueObj. valueObj is an object with keys\n * equal to the placeholder keys. (e.g. {\"asset\": \"dcr\"}).\n * So that will be switched for: 'asset dcr'.\n */\nfunction stringTemplateParser (expression, valueObj) {\n  // templateMatcher matches any text which:\n  // is some {{ text }} between two brackets, and a space between them.\n  // It is global, therefore it will change all occurrences found.\n  // text can be anything, but brackets '{}' and space '\\s'\n  const templateMatcher = /{{\\s?([^{}\\s]*)\\s?}}/g\n  return expression.replace(templateMatcher, (_, value) => valueObj[value])\n}\n","import * as intl from './locales'\n\nconst parser = new window.DOMParser()\n\nconst FPS = 30\n\nconst BipIDs = {\n  0: 'btc',\n  42: 'dcr',\n  2: 'ltc',\n  22: 'mona',\n  28: 'vtc',\n  3: 'doge',\n  145: 'bch',\n  60: 'eth'\n}\n\nconst BipSymbols = Object.values(BipIDs)\n\nconst intFormatter = new Intl.NumberFormat(navigator.languages)\n\nconst decimalFormatter = new Intl.NumberFormat(navigator.languages, {\n  minimumFractionDigits: 2,\n  maximumFractionDigits: 8\n})\n\n// Helpers for working with the DOM.\nexport default class Doc {\n  /*\n   * idel is the element with the specified id that is the descendent of the\n   * specified node.\n   */\n  static idel (el, id) {\n    return el.querySelector(`#${id}`)\n  }\n\n  /* bind binds the function to the event for the element. */\n  static bind (el, ev, f) {\n    el.addEventListener(ev, f)\n  }\n\n  /* unbind removes the handler for the event from the element. */\n  static unbind (el, ev, f) {\n    el.removeEventListener(ev, f)\n  }\n\n  /* noderize creates a Document object from a string of HTML. */\n  static noderize (html) {\n    return parser.parseFromString(html, 'text/html')\n  }\n\n  /*\n   * mouseInElement returns true if the position of mouse event, e, is within\n   * the bounds of the specified element.\n   */\n  static mouseInElement (e, el) {\n    const rect = el.getBoundingClientRect()\n    return e.pageX >= rect.left && e.pageX <= rect.right &&\n      e.pageY >= rect.top && e.pageY <= rect.bottom\n  }\n\n  /*\n   * layoutMetrics gets information about the elements position on the page.\n   */\n  static layoutMetrics (el) {\n    const box = el.getBoundingClientRect()\n    const docEl = document.documentElement\n    const top = box.top + docEl.scrollTop\n    const left = box.left + docEl.scrollLeft\n    const w = el.offsetWidth\n    const h = el.offsetHeight\n    return {\n      bodyTop: top,\n      bodyLeft: left,\n      width: w,\n      height: h,\n      centerX: left + w / 2,\n      centerY: top + h / 2\n    }\n  }\n\n  /* empty removes all child nodes from the specified element. */\n  static empty (el) {\n    while (el.firstChild) el.removeChild(el.firstChild)\n  }\n\n  /*\n   * hide hides the specified elements. This is accomplished by adding the\n   * bootstrap d-hide class to the element. Use Doc.show to undo.\n   */\n  static hide (...els) {\n    for (const el of els) el.classList.add('d-hide')\n  }\n\n  /*\n   * show shows the specified elements. This is accomplished by removing the\n   * bootstrap d-hide class as added with Doc.hide.\n   */\n  static show (...els) {\n    for (const el of els) el.classList.remove('d-hide')\n  }\n\n  /* isHidden returns true if the specified element is hidden */\n  static isHidden (el) {\n    return el.classList.contains('d-hide')\n  }\n\n  /* isDisplayed returns true if the specified element is not hidden */\n  static isDisplayed (el) {\n    return !el.classList.contains('d-hide')\n  }\n\n  /*\n   * animate runs the supplied function, which should be a \"progress\" function\n   * accepting one argument. The progress function will be called repeatedly\n   * with the argument varying from 0.0 to 1.0. The exact path that animate\n   * takes from 0.0 to 1.0 will vary depending on the choice of easing\n   * algorithm. See the Easing object for the available easing algo choices. The\n   * default easing algorithm is linear.\n   */\n  static async animate (duration, f, easingAlgo) {\n    const easer = easingAlgo ? Easing[easingAlgo] : Easing.linear\n    const start = new Date().getTime()\n    const end = start + duration\n    const range = end - start\n    const frameDuration = 1000 / FPS\n    let now = start\n    while (now < end) {\n      f(easer((now - start) / range))\n      await sleep(frameDuration)\n      now = new Date().getTime()\n    }\n    f(1)\n  }\n\n  /*\n   * parsePage constructs a page object from the supplied list of id strings.\n   * The properties of the returned object have names matching the supplied\n   * id strings, with the corresponding value being the Element object. It is\n   * not an error if an element does not exist for an id in the list.\n   */\n  static parsePage (main, ids) {\n    const get = s => Doc.idel(main, s)\n    const page = {}\n    ids.forEach(id => { page[id] = get(id) })\n    return page\n  }\n\n  static formatCoinValue (v) {\n    if (Number.isInteger(v)) return intFormatter.format(v)\n    return decimalFormatter.format(v)\n  }\n\n  /*\n   * logoPath creates a path to a png logo for the specified ticker symbol. If\n   * the symbol is not a supported asset, the generic letter logo will be\n   * requested instead.\n   */\n  static logoPath (symbol) {\n    if (BipSymbols.indexOf(symbol) === -1) symbol = symbol.substring(0, 1)\n    return `/img/coins/${symbol}.png`\n  }\n\n  /*\n  * tmplElement is a helper function for grabbing sub-elements of the market list\n  * template.\n  */\n  static tmplElement (ancestor, s) {\n    return ancestor.querySelector(`[data-tmpl=\"${s}\"]`)\n  }\n\n  /*\n   * timeSince returns a string representation of the duration since the specified\n   * unix timestamp.\n   */\n  static timeSince (t) {\n    let seconds = Math.floor(((new Date().getTime()) - t))\n    let result = ''\n    let count = 0\n    const add = (n, s) => {\n      if (n > 0 || count > 0) count++\n      if (n > 0) result += `${n} ${s} `\n      return count >= 2\n    }\n    let y, mo, d, h, m, s\n    [y, seconds] = timeMod(seconds, aYear)\n    if (add(y, 'y')) { return result }\n    [mo, seconds] = timeMod(seconds, aMonth)\n    if (add(mo, 'mo')) { return result }\n    [d, seconds] = timeMod(seconds, aDay)\n    if (add(d, 'd')) { return result }\n    [h, seconds] = timeMod(seconds, anHour)\n    if (add(h, 'h')) { return result }\n    [m, seconds] = timeMod(seconds, aMinute)\n    if (add(m, 'm')) { return result }\n    [s, seconds] = timeMod(seconds, 1000)\n    add(s, 's')\n    return result || '0 s'\n  }\n\n  /*\n   * disableMouseWheel can be used to disable the mouse wheel for any\n   * input. It is very easy to unknowingly scroll up on a number input\n   * and then submit an unexpected value. This function prevents the\n   * scroll increment/decrement behavior for a wheel action on a\n   * number input.\n   */\n  static disableMouseWheel (...inputFields) {\n    for (const inputField of inputFields) {\n      inputField.addEventListener('wheel', (ev) => {\n        ev.preventDefault()\n      })\n    }\n  }\n}\n\n/* Easing algorithms for animations. */\nconst Easing = {\n  linear: t => t,\n  easeIn: t => t * t,\n  easeOut: t => t * (2 - t),\n  easeInHard: t => t * t * t,\n  easeOutHard: t => (--t) * t * t + 1\n}\n\n/* WalletIcons are used for controlling wallets in various places. */\nexport class WalletIcons {\n  constructor (box) {\n    const stateElement = (name) => box.querySelector(`[data-state=${name}]`)\n    this.icons = {}\n    this.icons.sleeping = stateElement('sleeping')\n    this.icons.locked = stateElement('locked')\n    this.icons.unlocked = stateElement('unlocked')\n    this.icons.nowallet = stateElement('nowallet')\n    this.icons.syncing = stateElement('syncing')\n    this.status = stateElement('status')\n  }\n\n  /* sleeping sets the icons to indicate that the wallet is not connected. */\n  sleeping () {\n    const i = this.icons\n    Doc.hide(i.locked, i.unlocked, i.nowallet, i.syncing)\n    Doc.show(i.sleeping)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_OFF)\n  }\n\n  /*\n   * locked sets the icons to indicate that the wallet is connected, but locked.\n   */\n  locked () {\n    const i = this.icons\n    Doc.hide(i.unlocked, i.nowallet, i.sleeping)\n    Doc.show(i.locked)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_LOCKED)\n  }\n\n  /*\n   * unlocked sets the icons to indicate that the wallet is connected and\n   * unlocked.\n   */\n  unlocked () {\n    const i = this.icons\n    Doc.hide(i.locked, i.nowallet, i.sleeping)\n    Doc.show(i.unlocked)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_READY)\n  }\n\n  /* sleeping sets the icons to indicate that no wallet exists. */\n  nowallet () {\n    const i = this.icons\n    Doc.hide(i.locked, i.unlocked, i.sleeping, i.syncing)\n    Doc.show(i.nowallet)\n    if (this.status) this.status.textContent = intl.prep(intl.ID_NOWALLET)\n  }\n\n  setSyncing (wallet) {\n    const icon = this.icons.syncing\n    if (!wallet || !wallet.running) {\n      Doc.hide(icon)\n      return\n    }\n    if (!wallet.synced) {\n      Doc.show(icon)\n      icon.dataset.tooltip = intl.prep(intl.ID_WALLET_SYNC_PROGRESS, { syncProgress: (wallet.syncProgress * 100).toFixed(1) })\n    } else Doc.hide(icon)\n  }\n\n  /* reads the core.Wallet state and sets the icon visibility. */\n  readWallet (wallet) {\n    this.setSyncing(wallet)\n    switch (true) {\n      case (!wallet):\n        this.nowallet()\n        break\n      case (!wallet.running):\n        this.sleeping()\n        break\n      case (!wallet.open):\n        this.locked()\n        break\n      case (wallet.open):\n        this.unlocked()\n        break\n      default:\n        console.error('wallet in unknown state', wallet)\n    }\n  }\n}\n\n/* sleep can be used by async functions to pause for a specified period. */\nfunction sleep (ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nconst aYear = 31536000000\nconst aMonth = 2592000000\nconst aDay = 86400000\nconst anHour = 3600000\nconst aMinute = 60000\n\n/* timeMod returns the quotient and remainder of t / dur. */\nfunction timeMod (t, dur) {\n  const n = Math.floor(t / dur)\n  return [n, t - n * dur]\n}\n","const darkModeCK = 'darkMode'\nconst authCK = 'dexauth'\nconst popupsCK = 'popups'\nconst pwKeyCK = 'sessionkey'\n\n// State is a set of static methods for working with the user state. It has\n// utilities for setting and retrieving cookies and storing user configuration\n// to localStorage.\nexport default class State {\n  static setCookie (cname, cvalue) {\n    const d = new Date()\n    // Set cookie to expire in ten years.\n    d.setTime(d.getTime() + (86400 * 365 * 10 * 1000))\n    const expires = 'expires=' + d.toUTCString()\n    document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/'\n  }\n\n  /*\n   * getCookie returns the value at the specified cookie name, otherwise null.\n   */\n  static getCookie (cname) {\n    for (const cstr of document.cookie.split(';')) {\n      const [k, v] = cstr.split('=')\n      if (k.trim() === cname) return v\n    }\n    return null\n  }\n\n  /* dark sets the dark-mode cookie. */\n  static dark (dark) {\n    this.setCookie(darkModeCK, dark ? '1' : '0')\n    if (dark) {\n      document.body.classList.add('dark')\n    } else {\n      document.body.classList.remove('dark')\n    }\n  }\n\n  /*\n   * isDark returns true if the dark-mode cookie is currently set to '1' = true.\n   */\n  static isDark () {\n    return document.cookie.split(';').filter((item) => item.includes(`${darkModeCK}=1`)).length\n  }\n\n  /* passwordIsCached returns whether or not there is a cached password in the cookies. */\n  static passwordIsCached () {\n    return !!this.getCookie(pwKeyCK)\n  }\n\n  /* store puts the key-value pair into Window.localStorage. */\n  static store (k, v) {\n    window.localStorage.setItem(k, JSON.stringify(v))\n  }\n\n  /* clearAllStore remove all the key-value pair in Window.localStorage. */\n  static clearAllStore () {\n    window.localStorage.clear()\n  }\n\n  static removeAuthCK () {\n    document.cookie = `${authCK}=;expires=Thu, 01 Jan 1970 00:00:01 GMT;`\n  }\n\n  /*\n  * fetch fetches the value associated with the key in Window.localStorage, or\n  * null if the no value exists for the key.\n  */\n  static fetch (k) {\n    const v = window.localStorage.getItem(k)\n    if (v !== null) {\n      return JSON.parse(v)\n    }\n    return null\n  }\n}\n\n// If the dark-mode cookie is not set, set it to dark mode on.\nif (State.getCookie(darkModeCK) === null) State.setCookie(darkModeCK, '1')\nif (State.getCookie(popupsCK) === null) State.setCookie(popupsCK, '1')\n","import Doc from './doc'\nimport { postJSON } from './http'\nimport State from './state'\nimport { feeSendErr } from './constants'\nimport * as intl from './locales'\n\nlet app\n\n/*\n * NewWalletForm should be used with the \"newWalletForm\" template. The enclosing\n * <form> element should be the second argument of the constructor.\n */\nexport class NewWalletForm {\n  constructor (application, form, success, pwCache, closerFn) {\n    this.form = form\n    this.currentAsset = null\n    this.pwCache = pwCache\n    const fields = this.fields = Doc.parsePage(form, [\n      'nwAssetLogo', 'nwAssetName', 'newWalletPass', 'nwAppPass',\n      'walletSettings', 'selectCfgFile', 'cfgFile', 'submitAdd', 'newWalletErr',\n      'newWalletAppPWBox'\n    ])\n    this.refresh()\n\n    if (closerFn) {\n      form.querySelectorAll('.form-closer').forEach(el => {\n        Doc.show(el)\n        Doc.bind(el, 'click', closerFn)\n      })\n    }\n\n    // WalletConfigForm will set the global app variable.\n    this.subform = new WalletConfigForm(application, fields.walletSettings, true)\n\n    bind(form, fields.submitAdd, async () => {\n      const pw = fields.nwAppPass.value || (this.pwCache ? this.pwCache.pw : '')\n      if (!pw && !State.passwordIsCached()) {\n        fields.newWalletErr.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n        Doc.show(fields.newWalletErr)\n        return\n      }\n      Doc.hide(fields.newWalletErr)\n\n      const createForm = {\n        assetID: parseInt(this.currentAsset.id),\n        pass: fields.newWalletPass.value || '',\n        config: this.subform.map(),\n        appPass: pw\n      }\n      fields.nwAppPass.value = ''\n      const loaded = app.loading(form)\n      const res = await postJSON('/api/newwallet', createForm)\n      loaded()\n      if (!app.checkResponse(res)) {\n        this.setError(res.msg)\n        return\n      }\n      if (this.pwCache) this.pwCache.pw = pw\n      fields.newWalletPass.value = ''\n      success()\n    })\n  }\n\n  refresh () {\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(this.fields.newWalletAppPWBox)\n    else Doc.show(this.fields.newWalletAppPWBox)\n  }\n\n  async setAsset (assetID) {\n    const fields = this.fields\n    const asset = app.assets[assetID]\n    if (this.currentAsset && this.currentAsset.id === asset.id) return\n    this.currentAsset = asset\n    fields.nwAssetLogo.src = Doc.logoPath(asset.symbol)\n    fields.nwAssetName.textContent = asset.info.name\n    fields.newWalletPass.value = ''\n    this.subform.update(asset.info)\n    Doc.hide(fields.newWalletErr)\n    this.refresh()\n  }\n\n  /* setError sets and shows the in-form error message. */\n  async setError (errMsg) {\n    this.fields.newWalletErr.textContent = errMsg\n    Doc.show(this.fields.newWalletErr)\n  }\n\n  /*\n   * loadDefaults attempts to load the ExchangeWallet configuration from the\n   * default wallet config path on the server and will auto-fill the fields on\n   * the subform if settings are found.\n   */\n  async loadDefaults () {\n    const loaded = app.loading(this.form)\n    const res = await postJSON('/api/defaultwalletcfg', { assetID: this.currentAsset.id })\n    loaded()\n    if (!app.checkResponse(res)) {\n      this.setError(res.msg)\n      return\n    }\n    this.subform.setLoadedConfig(res.config)\n  }\n}\n\n/*\n * WalletConfigForm is a dynamically generated sub-form for setting\n * asset-specific wallet configuration options.\n*/\nexport class WalletConfigForm {\n  constructor (application, form, sectionize) {\n    app = application\n    this.form = form\n    // A configElement is a div containing an input and its label.\n    this.configElements = {}\n    // configOpts is the wallet options provided by core.\n    this.configOpts = []\n    this.sectionize = sectionize\n\n    // Get template elements\n    this.allSettings = Doc.tmplElement(form, 'allSettings')\n    this.dynamicOpts = Doc.tmplElement(form, 'dynamicOpts')\n    this.textInputTmpl = Doc.tmplElement(form, 'textInput')\n    this.textInputTmpl.remove()\n    this.checkboxTmpl = Doc.tmplElement(form, 'checkbox')\n    this.checkboxTmpl.remove()\n    this.fileSelector = Doc.tmplElement(form, 'fileSelector')\n    this.fileInput = Doc.tmplElement(form, 'fileInput')\n    this.errMsg = Doc.tmplElement(form, 'errMsg')\n    this.showOther = Doc.tmplElement(form, 'showOther')\n    this.showIcon = Doc.tmplElement(form, 'showIcon')\n    this.hideIcon = Doc.tmplElement(form, 'hideIcon')\n    this.showHideMsg = Doc.tmplElement(form, 'showHideMsg')\n    this.otherSettings = Doc.tmplElement(form, 'otherSettings')\n    this.loadedSettingsMsg = Doc.tmplElement(form, 'loadedSettingsMsg')\n    this.loadedSettings = Doc.tmplElement(form, 'loadedSettings')\n    this.defaultSettingsMsg = Doc.tmplElement(form, 'defaultSettingsMsg')\n    this.defaultSettings = Doc.tmplElement(form, 'defaultSettings')\n\n    if (!sectionize) Doc.hide(this.showOther)\n\n    Doc.bind(this.fileSelector, 'click', () => this.fileInput.click())\n\n    // config file upload\n    Doc.bind(this.fileInput, 'change', async () => this.fileInputChanged())\n\n    Doc.bind(this.showOther, 'click', () => {\n      this.setOtherSettingsViz(this.hideIcon.classList.contains('d-hide'))\n    })\n  }\n\n  /*\n   * fileInputChanged will read the selected file and attempt to load the\n   * configuration settings. All loaded settings will be made visible for\n   * inspection by the user.\n   */\n  async fileInputChanged () {\n    Doc.hide(this.errMsg)\n    if (!this.fileInput.value) return\n    const loaded = app.loading(this.form)\n    const config = await this.fileInput.files[0].text()\n    if (!config) return\n    const res = await postJSON('/api/parseconfig', {\n      configtext: config\n    })\n    loaded()\n    if (!app.checkResponse(res)) {\n      this.errMsg.textContent = res.msg\n      Doc.show(this.errMsg)\n      return\n    }\n    if (Object.keys(res.map).length === 0) return\n    this.dynamicOpts.append(...this.setConfig(res.map))\n    this.reorder(this.dynamicOpts)\n    const [loadedOpts, defaultOpts] = [this.loadedSettings.children.length, this.defaultSettings.children.length]\n    if (loadedOpts === 0) Doc.hide(this.loadedSettings, this.loadedSettingsMsg)\n    if (defaultOpts === 0) Doc.hide(this.defaultSettings, this.defaultSettingsMsg)\n    if (loadedOpts + defaultOpts === 0) Doc.hide(this.showOther, this.otherSettings)\n  }\n\n  /*\n   * update creates the dynamic form.\n   */\n  update (walletInfo) {\n    this.configElements = {}\n    this.configOpts = walletInfo.configopts\n    Doc.empty(this.dynamicOpts, this.otherSettings)\n    this.setOtherSettingsViz(false)\n    Doc.hide(\n      this.loadedSettingsMsg, this.loadedSettings,\n      this.defaultSettingsMsg, this.defaultSettings,\n      this.errMsg\n    )\n    const defaultedOpts = []\n    const addOpt = (box, opt) => {\n      const elID = 'wcfg-' + opt.key\n      const el = opt.isboolean ? this.checkboxTmpl.cloneNode(true) : this.textInputTmpl.cloneNode(true)\n      this.configElements[opt.key] = el\n      const input = el.querySelector('input')\n      input.id = elID\n      input.configOpt = opt\n      const label = el.querySelector('label')\n      label.htmlFor = elID // 'for' attribute, but 'for' is a keyword\n      label.prepend(opt.displayname)\n      box.appendChild(el)\n      if (opt.noecho) input.type = 'password'\n      if (opt.description) label.dataset.tooltip = opt.description\n      if (opt.isboolean) input.checked = opt.default\n      else input.value = opt.default !== null ? opt.default : ''\n    }\n    for (const opt of this.configOpts) {\n      if (this.sectionize && opt.default !== null) defaultedOpts.push(opt)\n      else addOpt(this.dynamicOpts, opt)\n    }\n    if (defaultedOpts.length) {\n      for (const opt of defaultedOpts) addOpt(this.defaultSettings, opt)\n      Doc.show(this.showOther, this.defaultSettingsMsg, this.defaultSettings)\n    } else {\n      Doc.hide(this.showOther)\n    }\n    app.bindTooltips(this.allSettings)\n  }\n\n  /*\n   * setOtherSettingsViz sets the visibility of the additional settings section.\n   */\n  setOtherSettingsViz (visible) {\n    if (visible) {\n      Doc.hide(this.showIcon)\n      Doc.show(this.hideIcon, this.otherSettings)\n      this.showHideMsg.textContent = intl.prep(intl.ID_HIDE_ADDITIONAL_SETTINGS)\n      return\n    }\n    Doc.hide(this.hideIcon, this.otherSettings)\n    Doc.show(this.showIcon)\n    this.showHideMsg.textContent = intl.prep(intl.ID_SHOW_ADDITIONAL_SETTINGS)\n  }\n\n  /*\n   * setConfig looks for inputs with configOpt keys matching the cfg object, and\n   * sets the inputs value to the corresponding cfg value. A list of matching\n   * configElements is returned.\n   */\n  setConfig (cfg) {\n    const finds = []\n    this.allSettings.querySelectorAll('input').forEach(input => {\n      const k = input.configOpt.key\n      const v = cfg[k]\n      if (typeof v === 'undefined') return\n      finds.push(this.configElements[k])\n      if (input.configOpt.isboolean) input.checked = isTruthyString(v)\n      else input.value = v\n    })\n    return finds\n  }\n\n  /*\n   * setLoadedConfig sets the input values for the entries in cfg, and moves\n   * them to the loadedSettings box.\n   */\n  setLoadedConfig (cfg) {\n    const finds = this.setConfig(cfg)\n    if (!this.sectionize || finds.length === 0) return\n    this.loadedSettings.append(...finds)\n    this.reorder(this.loadedSettings)\n    Doc.show(this.loadedSettings, this.loadedSettingsMsg)\n    if (this.defaultSettings.children.length === 0) Doc.hide(this.defaultSettings, this.defaultSettingsMsg)\n  }\n\n  /*\n   * map reads all inputs and constructs an object from the configOpt keys and\n   * values.\n   */\n  map () {\n    const config = {}\n    this.allSettings.querySelectorAll('input').forEach(input => {\n      if (input.configOpt.isboolean && input.configOpt.key) config[input.configOpt.key] = input.checked ? '1' : '0'\n      else if (input.value) config[input.configOpt.key] = input.value\n    })\n\n    return config\n  }\n\n  /*\n   * reorder sorts the configElements in the box by the order of the\n   * server-provided configOpts array.\n   */\n  reorder (box) {\n    const els = {}\n    box.querySelectorAll('input').forEach(el => {\n      const k = el.configOpt.key\n      els[k] = this.configElements[k]\n    })\n    for (const opt of this.configOpts) {\n      const el = els[opt.key]\n      if (el) box.append(el)\n    }\n  }\n}\n\n/*\n * ConfirmRegistrationForm should be used with the \"confirmRegistrationForm\" template.\n */\nexport class ConfirmRegistrationForm {\n  constructor (application, form, { getDexAddr, getCertFile }, success, insufficientFundsFail, setupWalletFn) {\n    this.fields = Doc.parsePage(form, [\n      'marketRowTemplate', 'marketsTableRows', 'appPass', 'appPassBox',\n      'appPassSpan', 'submitConfirm', 'regErr', 'feeRowTemplate',\n      'feeTableRows', 'setupWallet'\n    ])\n    app = application\n    this.getDexAddr = getDexAddr\n    this.getCertFile = getCertFile\n    this.success = success\n    this.insufficientFundsFail = insufficientFundsFail\n    this.form = form\n    this.setupWalletFn = setupWalletFn\n    this.feeAssetID = null\n    bind(form, this.fields.submitConfirm, () => this.submitForm())\n  }\n\n  /*\n   * setExchange populates the form with the details of an exchange.\n   */\n  setExchange (xc) {\n    // store xc in case we need to refresh the data, like after setting up\n    // a new wallet.\n    this.xc = xc\n    const fields = this.fields\n    this.fees = xc.regFees\n    Doc.empty(fields.marketsTableRows)\n    Doc.empty(fields.feeTableRows)\n\n    for (const [symbol, fee] of Object.entries(xc.regFees)) {\n      // if asset fee is not supported by the client we can skip it.\n      if (app.user.assets[fee.id] === undefined) continue\n      const haveWallet = app.user.assets[fee.id].wallet\n      const tr = fields.feeRowTemplate.cloneNode(true)\n      Doc.bind(tr, 'click', () => {\n        this.feeAssetID = fee.id\n        // remove selected class from all others row.\n        const rows = Array.from(fields.feeTableRows.querySelectorAll('tr.selected'))\n        rows.forEach(row => row.classList.remove('selected'))\n        tr.classList.add('selected')\n        // if wallet is configured, we can active the register button.\n        // Otherwise we do not allow it.\n        if (haveWallet) {\n          this.fields.submitConfirm.classList.add('selected')\n        } else {\n          this.fields.submitConfirm.classList.remove('selected')\n        }\n      })\n      Doc.tmplElement(tr, 'asseticon').src = Doc.logoPath(symbol)\n      Doc.tmplElement(tr, 'asset').innerText = symbol.toUpperCase()\n      Doc.tmplElement(tr, 'confs').innerText = fee.confs\n      Doc.tmplElement(tr, 'fee').innerText = fee.amount / 1e8\n\n      const setupWallet = Doc.tmplElement(tr, 'setupWallet')\n      const walletReady = Doc.tmplElement(tr, 'walletReady')\n      if (haveWallet) {\n        walletReady.innerText = intl.prep(intl.ID_WALLET_READY)\n        Doc.show(walletReady)\n        Doc.hide(setupWallet)\n      } else {\n        setupWallet.innerText = intl.prep(intl.ID_SETUP_WALLET)\n        Doc.bind(setupWallet, 'click', () => this.setupWalletFn(fee.id))\n        Doc.hide(walletReady)\n        Doc.show(setupWallet)\n      }\n      fields.feeTableRows.appendChild(tr)\n      if (State.passwordIsCached()) {\n        Doc.hide(fields.appPassBox)\n        Doc.hide(fields.appPassSpan)\n      } else {\n        Doc.show(fields.appPassBox)\n        Doc.show(fields.appPassSpan)\n      }\n    }\n    const markets = Object.values(xc.markets)\n    markets.sort((m1, m2) => {\n      const compareBase = m1.basesymbol.localeCompare(m2.basesymbol)\n      const compareQuote = m1.quotesymbol.localeCompare(m2.quotesymbol)\n      return compareBase === 0 ? compareQuote : compareBase\n    })\n    markets.forEach((market) => {\n      const tr = fields.marketRowTemplate.cloneNode(true)\n      Doc.tmplElement(tr, 'baseicon').src = Doc.logoPath(market.basesymbol)\n      Doc.tmplElement(tr, 'quoteicon').src = Doc.logoPath(market.quotesymbol)\n      Doc.tmplElement(tr, 'base').innerText = market.basesymbol.toUpperCase()\n      Doc.tmplElement(tr, 'quote').innerText = market.quotesymbol.toUpperCase()\n      Doc.tmplElement(tr, 'lotsize').innerText = `${market.lotsize / 1e8} ${market.basesymbol.toUpperCase()}`\n      fields.marketsTableRows.appendChild(tr)\n      if (State.passwordIsCached()) {\n        Doc.hide(fields.appPassBox)\n        Doc.hide(fields.appPassSpan)\n      } else {\n        Doc.show(fields.appPassBox)\n        Doc.show(fields.appPassSpan)\n      }\n    })\n  }\n\n  /*\n   * submitForm is called when the form is submitted.\n   */\n  async submitForm () {\n    const fields = this.fields\n    // if button is selected it can be clickable.\n    if (!fields.submitConfirm.classList.contains('selected')) {\n      return\n    }\n    if (this.feeAssetID === null) {\n      fields.regErr.innerText = 'You must select a valid wallet for the fee payment'\n      Doc.show(fields.regErr)\n      return\n    }\n    const symbol = app.user.assets[this.feeAssetID].wallet.symbol\n    Doc.hide(fields.regErr)\n    const feeAsset = this.fees[symbol]\n    const cert = await this.getCertFile()\n    const dexAddr = this.getDexAddr()\n    const registration = {\n      addr: dexAddr,\n      pass: fields.appPass.value,\n      fee: feeAsset.amount,\n      asset: feeAsset.id,\n      cert: cert\n    }\n    fields.appPass.value = ''\n    const loaded = app.loading(this.form)\n    const res = await postJSON('/api/register', registration)\n    if (!app.checkResponse(res)) {\n      // This form is used both in the register workflow and the\n      // settings page. The register workflow handles a failure\n      // where the user does not have enough funds to pay for the\n      // registration fee in a different way.\n      if (res.code === feeSendErr && this.insufficientFundsFail) {\n        loaded()\n        this.insufficientFundsFail(res.msg)\n        return\n      }\n      fields.regErr.textContent = res.msg\n      Doc.show(fields.regErr)\n      loaded()\n      return\n    }\n    loaded()\n    this.success()\n  }\n\n  refresh () {\n    this.setExchange(this.xc)\n  }\n}\n\nexport class UnlockWalletForm {\n  constructor (application, form, success, pwCache) {\n    this.fields = Doc.parsePage(form, [\n      'uwAssetLogo', 'uwAssetName', 'uwAppPassBox', 'uwAppPass', 'submitUnlock',\n      'unlockErr', 'submitUnlockDiv'\n    ])\n    app = application\n    this.form = form\n    this.pwCache = pwCache\n    this.currentAsset = null\n    this.success = success\n    bind(form, this.fields.submitUnlock, () => this.submit())\n  }\n\n  setAsset (asset) {\n    const fields = this.fields\n    this.currentAsset = asset\n    fields.uwAssetLogo.src = Doc.logoPath(asset.symbol)\n    fields.uwAssetName.textContent = asset.info.name\n    fields.uwAppPass.value = ''\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(fields.uwAppPassBox)\n    else Doc.show(fields.uwAppPassBox)\n  }\n\n  /*\n   * setError displays an error on the form.\n   */\n  setError (msg) {\n    this.fields.unlockErr.textContent = msg\n    Doc.show(this.fields.unlockErr)\n  }\n\n  /*\n   * showErrorOnly displays only an error on the form. Hides the\n   * app pass field and the submit button.\n   */\n  showErrorOnly (msg) {\n    this.setError(msg)\n    Doc.hide(this.fields.uwAppPassBox)\n    Doc.hide(this.fields.submitUnlockDiv)\n  }\n\n  async submit () {\n    const fields = this.fields\n    const pw = fields.uwAppPass.value || (this.pwCache ? this.pwCache.pw : '')\n    if (!pw && !State.passwordIsCached()) {\n      fields.unlockErr.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(fields.unlockErr)\n      return\n    }\n    Doc.hide(this.fields.unlockErr)\n    const open = {\n      assetID: parseInt(this.currentAsset.id),\n      pass: pw\n    }\n    fields.uwAppPass.value = ''\n    const loaded = app.loading(this.form)\n    const res = await postJSON('/api/openwallet', open)\n    loaded()\n    if (!app.checkResponse(res)) {\n      this.setError(res.msg)\n      return\n    }\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success()\n  }\n}\n\nexport class DEXAddressForm {\n  constructor (application, form, success, pwCache) {\n    app = application\n    this.form = form\n    this.success = success\n    this.pwCache = pwCache\n    this.defaultTLSText = 'none selected'\n\n    const page = this.page = Doc.parsePage(form, [\n      'dexAddr', 'dexShowMore', 'dexCertBox', 'dexNeedCert', 'certFile',\n      'removeCert', 'addCert', 'selectedCert', 'dexAddrAppPWBox', 'dexAddrAppPW',\n      'submitDEXAddr', 'dexAddrErr'\n    ])\n\n    page.selectedCert.textContent = this.defaultTLSText\n    Doc.bind(page.certFile, 'change', () => this.onCertFileChange())\n    Doc.bind(page.removeCert, 'click', () => this.clearCertFile())\n    Doc.bind(page.addCert, 'click', () => page.certFile.click())\n    Doc.bind(page.dexShowMore, 'click', () => {\n      Doc.hide(page.dexShowMore)\n      Doc.show(page.dexCertBox)\n    })\n\n    bind(form, page.submitDEXAddr, () => this.checkDEX())\n    this.refresh()\n  }\n\n  refresh () {\n    const hidePWBox = State.passwordIsCached() || (this.pwCache && this.pwCache.pw)\n    if (hidePWBox) Doc.hide(this.page.dexAddrAppPWBox)\n    else Doc.show(this.page.dexAddrAppPWBox)\n  }\n\n  async checkDEX () {\n    const page = this.page\n    Doc.hide(page.dexAddrErr)\n    const addr = page.dexAddr.value\n    if (addr === '') {\n      page.dexAddrErr.textContent = 'DEX address cannot be empty'\n      Doc.show(page.dexAddrErr)\n      return\n    }\n\n    let cert = ''\n    if (page.certFile.value) {\n      cert = await page.certFile.files[0].text()\n    }\n\n    let pw = ''\n    if (!State.passwordIsCached()) {\n      pw = page.dexAddrAppPW.value || this.pwCache.pw\n    }\n\n    const loaded = app.loading(this.form)\n\n    const res = await postJSON('/api/discoveracct', {\n      addr: addr,\n      cert: cert,\n      pass: pw\n    })\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      if (res.msg === 'certificate required') {\n        Doc.hide(page.dexShowMore)\n        Doc.show(page.dexCertBox, page.dexNeedCert)\n      } else {\n        page.dexAddrErr.textContent = res.msg\n        Doc.show(page.dexAddrErr)\n      }\n\n      return\n    }\n\n    if (res.paid) {\n      await app.fetchUser()\n      app.loadPage('markets')\n      return\n    }\n\n    if (this.pwCache) this.pwCache.pw = pw\n    this.success(res.xc)\n  }\n\n  /**\n   * onCertFileChange when the input certFile changed, read the file\n   * and setting cert name into text of selectedCert to display on the view\n   */\n  async onCertFileChange () {\n    const page = this.page\n    const files = page.certFile.files\n    if (!files.length) return\n    page.selectedCert.textContent = files[0].name\n    Doc.show(page.removeCert)\n    Doc.hide(page.addCert)\n  }\n\n  /* clearCertFile cleanup certFile value and selectedCert text */\n  clearCertFile () {\n    const page = this.page\n    page.certFile.value = ''\n    page.selectedCert.textContent = this.defaultTLSText\n    Doc.hide(page.removeCert)\n    Doc.show(page.addCert)\n  }\n}\n\n/*\n * bind binds the click and submit events and prevents page reloading on\n * submission.\n */\nexport function bind (form, submitBttn, handler) {\n  const wrapper = e => {\n    if (e.preventDefault) e.preventDefault()\n    handler(e)\n  }\n  Doc.bind(submitBttn, 'click', wrapper)\n  Doc.bind(form, 'submit', wrapper)\n}\n\n// isTruthyString will be true if the provided string is recognized as a\n// value representing true.\nfunction isTruthyString (s) {\n  return s === '1' || s.toLowerCase() === 'true'\n}\n","export default class BasePage {\n  /* notify is called when a notification is received by the app. */\n  notify (note) {\n    if (!this.notifiers || !this.notifiers[note.type]) return\n    this.notifiers[note.type](note)\n  }\n\n  /* unload is called when the user navigates away from the page. */\n  unload () {}\n}\n","/*\n * requestJSON encodes the object and sends the JSON to the specified address.\n */\nexport async function requestJSON (method, addr, reqBody) {\n  try {\n    const response = await window.fetch(addr, {\n      method: method,\n      headers: new window.Headers({ 'content-type': 'application/json' }),\n      // credentials: \"same-origin\",\n      body: reqBody\n    })\n    if (response.status !== 200) { throw response }\n    const obj = await response.json()\n    obj.requestSuccessful = true\n    return obj\n  } catch (response) {\n    response.requestSuccessful = false\n    response.msg = await response.text()\n    return response\n  }\n}\n\n/*\n * postJSON sends a POST request with JSON-formatted data and returns the\n * response.\n */\nexport async function postJSON (addr, data) {\n  return requestJSON('POST', addr, JSON.stringify(data))\n}\n\n/*\n * getJSON sends a GET request and returns the response.\n */\nexport async function getJSON (addr) {\n  return requestJSON('GET', addr)\n}\n","// Code errors from client/core/errors.go\n// Need to be careful for not losing sync between them.\nexport const feeSendErr = 8\n\n// end of errors.\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport { postJSON } from './http'\nimport { NewWalletForm, DEXAddressForm, ConfirmRegistrationForm, bind as bindForm } from './forms'\nimport * as intl from './locales'\n\nconst animationLength = 300\n\nlet app\n\nexport default class RegistrationPage extends BasePage {\n  constructor (application, body) {\n    super()\n    app = application\n    this.body = body\n    this.notifiers = {}\n    this.pwCache = {}\n    const page = this.page = Doc.parsePage(body, [\n      // Form 1: Set the application password\n      'appPWForm', 'appPW', 'appPWAgain', 'appPWSubmit', 'appPWErrMsg',\n      'showSeedRestore', 'seedRestore', 'seedInput', 'rememberPass',\n      // Form 2: Create Decred wallet\n      'newWalletForm',\n      // Form 3: Unlock Decred wallet\n      'unlockWalletForm',\n      // Form 4: Configure DEX server\n      'dexAddrForm', 'dexAddr',\n      // Form 5: Confirm DEX registration and pay fee\n      'confirmRegForm', 'failedRegForm', 'regFundsErr'\n    ])\n\n    // Hide the form closers for the registration process.\n    body.querySelectorAll('.form-closer').forEach(el => Doc.hide(el))\n\n    // SET APP PASSWORD\n    bindForm(page.appPWForm, page.appPWSubmit, () => this.setAppPass())\n    Doc.bind(page.showSeedRestore, 'click', () => {\n      Doc.show(page.seedRestore)\n      Doc.hide(page.showSeedRestore)\n    })\n\n    this.walletForm = new NewWalletForm(app, page.newWalletForm, () => {\n      this.confirmRegisterForm.refresh()\n      this.changeForm(page.newWalletForm, page.confirmRegForm)\n    }, this.pwCache, () => this.changeForm(page.newWalletForm, page.confirmRegForm))\n    // ADD DEX\n    this.dexAddrForm = new DEXAddressForm(app, page.dexAddrForm, async (xc) => {\n      this.confirmRegisterForm.setExchange(xc)\n      await this.changeForm(page.dexAddrForm, page.confirmRegForm)\n    }, this.pwCache)\n\n    // SUBMIT DEX REGISTRATION\n    this.confirmRegisterForm = new ConfirmRegistrationForm(app,\n      page.confirmRegForm,\n      {\n        getCertFile: () => this.getCertFile(),\n        getDexAddr: () => this.getDexAddr()\n      },\n      () => this.registerDEXSuccess(),\n      (msg) => this.registerDEXFundsFail(msg),\n      (assetId) => {\n        this.walletForm.setAsset(assetId)\n        this.walletForm.loadDefaults()\n        this.changeForm(page.confirmRegForm, page.newWalletForm)\n      })\n    // Attempt to load the dcrwallet configuration from the default location.\n    if (app.user.authed) this.auth()\n  }\n\n  unload () {\n    delete this.pwCache.pw\n  }\n\n  // auth should be called once user is known to be authed with the server.\n  async auth () {\n    await app.fetchUser()\n  }\n\n  /* Swap this currently displayed form1 for form2 with an animation. */\n  async changeForm (form1, form2) {\n    const shift = this.body.offsetWidth / 2\n    await Doc.animate(animationLength, progress => {\n      form1.style.right = `${progress * shift}px`\n    }, 'easeInHard')\n    Doc.hide(form1)\n    form1.style.right = '0'\n    form2.style.right = -shift\n    Doc.show(form2)\n    if (form2.querySelector('input')) {\n      form2.querySelector('input').focus()\n    }\n    await Doc.animate(animationLength, progress => {\n      form2.style.right = `${-shift + progress * shift}px`\n    }, 'easeOutHard')\n    form2.style.right = '0'\n  }\n\n  /* Set the application password. Attached to form submission. */\n  async setAppPass () {\n    const page = this.page\n    Doc.hide(page.appPWErrMsg)\n    const pw = page.appPW.value\n    const pwAgain = page.appPWAgain.value\n    if (pw === '') {\n      page.appPWErrMsg.textContent = intl.prep(intl.ID_NO_PASS_ERROR_MSG)\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n    if (pw !== pwAgain) {\n      page.appPWErrMsg.textContent = intl.prep(intl.ID_PASSWORD_NOT_MATCH)\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n\n    // Clear the notification cache. Useful for development purposes, since\n    // the Application will only clear them on login, which would leave old\n    // browser-cached notifications in place after registering even if the\n    // client db is wiped.\n    app.setNotes([])\n    page.appPW.value = ''\n    page.appPWAgain.value = ''\n    const loaded = app.loading(page.appPWForm)\n    const seed = page.seedInput.value\n    const rememberPass = page.rememberPass.checked\n    const res = await postJSON('/api/init', {\n      pass: pw,\n      seed,\n      rememberPass\n    })\n    loaded()\n    if (!app.checkResponse(res)) {\n      page.appPWErrMsg.textContent = res.msg\n      Doc.show(page.appPWErrMsg)\n      return\n    }\n    this.pwCache.pw = pw\n    this.auth()\n    app.updateMenuItemsDisplay()\n    this.walletForm.refresh()\n    this.dexAddrForm.refresh()\n    await this.changeForm(page.appPWForm, page.dexAddrForm)\n  }\n\n  /* gets the contents of the cert file */\n  async getCertFile () {\n    let cert = ''\n    if (this.dexAddrForm.page.certFile.value) {\n      cert = await this.dexAddrForm.page.certFile.files[0].text()\n    }\n    return cert\n  }\n\n  /* gets the dex address input by the user */\n  getDexAddr () {\n    return this.page.dexAddr.value\n  }\n\n  /* Called when dex registration failed due to insufficient funds. */\n  async registerDEXFundsFail (msg) {\n    const page = this.page\n    page.regFundsErr.textContent = msg\n    Doc.show(page.regFundsErr)\n    await this.changeForm(page.confirmRegForm, page.failedRegForm)\n  }\n\n  /* Called after successful registration to a DEX. */\n  async registerDEXSuccess () {\n    await app.fetchUser()\n    app.loadPage('markets')\n  }\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport { postJSON } from './http'\nimport * as forms from './forms'\nimport * as intl from './locales'\n\nlet app\n\nexport default class LoginPage extends BasePage {\n  constructor (application, body) {\n    super()\n    app = application\n    const page = this.page = Doc.parsePage(body, [\n      'submit', 'errMsg', 'loginForm', 'pw', 'rememberPass'\n    ])\n    forms.bind(page.loginForm, page.submit, () => { this.login() })\n    page.pw.focus()\n  }\n\n  /* login submits the sign-in form and parses the result. */\n  async login (e) {\n    const page = this.page\n    Doc.hide(page.errMsg)\n    const pw = page.pw.value\n    page.pw.value = ''\n    const rememberPass = page.rememberPass.checked\n    if (pw === '') {\n      page.errMsg.textContent = intl.prep(intl.ID_NO_PASS_ERROR_MSG)\n      Doc.show(page.errMsg)\n      return\n    }\n    const loaded = app.loading(page.loginForm)\n    const res = await postJSON('/api/login', { pass: pw, rememberPass })\n    loaded()\n    if (!app.checkResponse(res)) {\n      page.errMsg.textContent = res.msg\n      Doc.show(page.errMsg)\n      return\n    }\n    if (res.notes) {\n      res.notes.reverse()\n    }\n    app.setNotes(res.notes || [])\n    await app.fetchUser()\n    app.loadPage('markets')\n  }\n}\n","export const IGNORE = 0\nexport const DATA = 1\nexport const POKE = 2\nexport const SUCCESS = 3\nexport const WARNING = 4\nexport const ERROR = 5\n\n/*\n * make constructs a new notification. The notification structure is a mirror of\n * the structure of notifications sent from the web server.\n * NOTE: I'm hoping to make this function obsolete, since errors generated in\n * javascript should usually be displayed/cached somewhere better. For example,\n * if the error is generated during submission of a form, the error should be\n * displayed on or near the form itself, not in the notifications.\n */\nexport function make (subject, details, severity) {\n  return {\n    subject: subject,\n    details: details,\n    severity: severity,\n    stamp: new Date().getTime()\n  }\n}\n","import Doc, { WalletIcons } from './doc'\nimport BasePage from './basepage'\nimport { postJSON } from './http'\nimport { NewWalletForm, WalletConfigForm, UnlockWalletForm, bind as bindForm } from './forms'\nimport * as ntfn from './notifications'\nimport State from './state'\nimport * as intl from './locales'\n\nconst bind = Doc.bind\nconst animationLength = 300\nlet app\n\nexport default class WalletsPage extends BasePage {\n  constructor (application, body) {\n    super()\n    app = application\n    this.body = body\n    const page = this.page = Doc.parsePage(body, [\n      'rightBox',\n      // Table Rows\n      'assetArrow', 'balanceArrow', 'statusArrow', 'walletTable',\n      // Available markets\n      'markets', 'dexTitle', 'marketsBox', 'oneMarket', 'marketsFor',\n      'marketsCard',\n      // New wallet, unlock wallet, wallet settings\n      'walletForm', 'openForm',\n      // Wallet configuration\n      'walletReconfig', 'recfgAssetLogo', 'recfgAssetName', 'reconfigInputs',\n      'submitReconfig', 'reconfigErr', 'appPW', 'showChangePW', 'changePW',\n      'switchPWMsg', 'hideIcon', 'showIcon', 'newPW',\n      // Deposit\n      'deposit', 'depositName', 'depositAddress', 'newDepAddrBttn',\n      'depositErr', 'depositLogo',\n      // Withdraw\n      'withdrawForm', 'withdrawLogo', 'withdrawName', 'withdrawAddr',\n      'withdrawAmt', 'withdrawAvail', 'submitWithdraw', // 'withdrawFee',\n      'withdrawUnit', 'withdrawPW', 'withdrawErr'\n    ])\n\n    // Read the document, storing some info about each asset's row.\n    const getAction = (row, name) => row.querySelector(`[data-action=${name}]`)\n    const rowInfos = this.rowInfos = {}\n    const rows = page.walletTable.querySelectorAll('tr')\n    let firstRow\n    for (const tr of rows) {\n      const assetID = parseInt(tr.dataset.assetID)\n      const rowInfo = rowInfos[assetID] = {}\n      if (!firstRow) firstRow = rowInfo\n      rowInfo.assetID = assetID\n      rowInfo.tr = tr\n      rowInfo.symbol = tr.dataset.symbol\n      rowInfo.name = tr.dataset.name\n      rowInfo.stateIcons = new WalletIcons(tr)\n      rowInfo.actions = {\n        connect: getAction(tr, 'connect'),\n        unlock: getAction(tr, 'unlock'),\n        withdraw: getAction(tr, 'withdraw'),\n        deposit: getAction(tr, 'deposit'),\n        create: getAction(tr, 'create'),\n        lock: getAction(tr, 'lock'),\n        settings: getAction(tr, 'settings')\n      }\n    }\n\n    // Prepare templates\n    page.dexTitle.removeAttribute('id')\n    page.dexTitle.remove()\n    page.oneMarket.removeAttribute('id')\n    page.oneMarket.remove()\n    page.markets.removeAttribute('id')\n    page.markets.remove()\n\n    // Methods to switch the item displayed on the right side, with a little\n    // fade-in animation.\n    this.displayed = null // The currently displayed right-side element.\n    this.animation = null // Store Promise of currently running animation.\n\n    this.openAsset = null\n    this.walletAsset = null\n    this.reconfigAsset = null\n\n    // Bind the new wallet form.\n    this.walletForm = new NewWalletForm(app, page.walletForm, () => { this.createWalletSuccess() })\n\n    // Bind the wallet reconfig form.\n    this.walletReconfig = new WalletConfigForm(app, page.reconfigInputs, false)\n\n    // Bind the wallet unlock form.\n    this.unlockForm = new UnlockWalletForm(app, page.openForm, () => { this.openWalletSuccess() })\n\n    // Bind the withdraw form.\n    bindForm(page.withdrawForm, page.submitWithdraw, () => { this.withdraw() })\n\n    // Bind the wallet reconfiguration submission.\n    bindForm(page.walletReconfig, page.submitReconfig, () => this.reconfig())\n\n    // Bind the row clicks, which shows the available markets for the asset.\n    for (const rowInfo of Object.values(rowInfos)) {\n      bind(rowInfo.tr, 'click', () => {\n        this.showMarkets(rowInfo.assetID)\n      })\n    }\n\n    page.rightBox.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => {\n        this.showMarkets(this.lastFormAsset)\n      })\n    })\n\n    this.keyup = e => {\n      if (e.key === 'Escape') {\n        this.showMarkets(this.lastFormAsset)\n      }\n    }\n    bind(document, 'keyup', this.keyup)\n\n    // Bind buttons\n    for (const [k, asset] of Object.entries(rowInfos)) {\n      const assetID = parseInt(k) // keys are string asset ID.\n      const a = asset.actions\n      const run = (e, f) => {\n        e.stopPropagation()\n        f(assetID, asset)\n      }\n      bind(a.connect, 'click', e => { run(e, this.doConnect.bind(this)) })\n      bind(a.withdraw, 'click', e => { run(e, this.showWithdraw.bind(this)) })\n      bind(a.deposit, 'click', e => { run(e, this.showDeposit.bind(this)) })\n      bind(a.create, 'click', e => { run(e, this.showNewWallet.bind(this)) })\n      bind(a.unlock, 'click', e => { run(e, this.openWallet.bind(this)) })\n      bind(a.lock, 'click', async e => { run(e, this.lock.bind(this)) })\n      bind(a.settings, 'click', e => { run(e, this.showReconfig.bind(this)) })\n    }\n\n    // New deposit address button.\n    bind(page.newDepAddrBttn, 'click', async () => { this.newDepositAddress() })\n\n    // Clicking on the available amount on the withdraw form populates the\n    // amount field.\n    bind(page.withdrawAvail, 'click', () => {\n      page.withdrawAmt.value = page.withdrawAvail.textContent\n    })\n\n    // A link on the wallet reconfiguration form to show/hide the password field.\n    bind(page.showChangePW, 'click', () => {\n      this.changeWalletPW = !this.changeWalletPW\n      this.setPWSettingViz(this.changeWalletPW)\n    })\n\n    if (!firstRow) return\n    this.showMarkets(firstRow.assetID)\n\n    this.notifiers = {\n      balance: note => { this.handleBalanceNote(note) },\n      walletstate: note => { this.handleWalletStateNote(note) },\n      walletconfig: note => { this.handleWalletStateNote(note) }\n    }\n  }\n\n  /*\n   * setPWSettingViz sets the visibility of the password field section.\n   */\n  setPWSettingViz (visible) {\n    if (visible) {\n      Doc.hide(this.page.showIcon)\n      Doc.show(this.page.hideIcon, this.page.changePW)\n      this.page.switchPWMsg.textContent = intl.prep(intl.ID_KEEP_WALLET_PASS)\n      return\n    }\n    Doc.hide(this.page.hideIcon, this.page.changePW)\n    Doc.show(this.page.showIcon)\n    this.page.switchPWMsg.textContent = intl.prep(intl.ID_NEW_WALLET_PASS)\n  }\n\n  /*\n   * hideBox hides the displayed box after waiting for the currently running\n   * animation to complete.\n   */\n  async hideBox () {\n    if (this.animation) await this.animation\n    if (!this.displayed) return\n    Doc.hide(this.displayed)\n  }\n\n  /*\n   * showBox shows the box with a fade-in animation.\n   */\n  async showBox (box, focuser) {\n    box.style.opacity = '0'\n    Doc.show(box)\n    if (focuser) focuser.focus()\n    await Doc.animate(animationLength, progress => {\n      box.style.opacity = `${progress}`\n    }, 'easeOut')\n    box.style.opacity = '1'\n    this.displayed = box\n  }\n\n  /*\n   * Show the markets box, which lists the markets available for a selected\n   * asset.\n   */\n  async showMarkets (assetID) {\n    const page = this.page\n    const box = page.marketsBox\n    const card = page.marketsCard\n    const rowInfo = this.rowInfos[assetID]\n    await this.hideBox()\n    Doc.empty(card)\n    page.marketsFor.textContent = rowInfo.name\n    for (const [host, xc] of Object.entries(app.user.exchanges)) {\n      let count = 0\n      for (const market of Object.values(xc.markets)) {\n        if (market.baseid === assetID || market.quoteid === assetID) count++\n      }\n      if (count === 0) continue\n      const header = page.dexTitle.cloneNode(true)\n      header.textContent = host\n      card.appendChild(header)\n      const marketsBox = page.markets.cloneNode(true)\n      card.appendChild(marketsBox)\n      for (const market of Object.values(xc.markets)) {\n        // Only show markets where this is the base or quote asset.\n        if (market.baseid !== assetID && market.quoteid !== assetID) continue\n        const mBox = page.oneMarket.cloneNode(true)\n        mBox.querySelector('span').textContent = prettyMarketName(market)\n        let counterSymbol = market.basesymbol\n        if (market.baseid === assetID) counterSymbol = market.quotesymbol\n        mBox.querySelector('img').src = Doc.logoPath(counterSymbol)\n        // Bind the click to a load of the markets page.\n        const pageData = { host: host, base: market.baseid, quote: market.quoteid }\n        bind(mBox, 'click', () => { app.loadPage('markets', pageData) })\n        marketsBox.appendChild(mBox)\n      }\n    }\n    this.animation = this.showBox(box)\n  }\n\n  /* Show the new wallet form. */\n  async showNewWallet (assetID) {\n    const page = this.page\n    const box = page.walletForm\n    await this.hideBox()\n    this.walletAsset = this.lastFormAsset = assetID\n    this.walletForm.setAsset(assetID)\n    this.animation = this.showBox(box)\n    await this.walletForm.loadDefaults()\n  }\n\n  /* Show the open wallet form if the password is not cached, and otherwise\n   * attempt to open the wallet.\n   */\n  async openWallet (assetID) {\n    if (!State.passwordIsCached()) {\n      this.showOpen(assetID)\n    } else {\n      this.openAsset = assetID\n      const open = {\n        assetID: parseInt(assetID)\n      }\n      const res = await postJSON('/api/openwallet', open)\n      if (app.checkResponse(res)) {\n        this.openWalletSuccess.bind(this)()\n      } else {\n        this.showOpen(assetID, `Error opening wallet: ${res.msg}`)\n      }\n    }\n  }\n\n  /* Show the form used to unlock a wallet. */\n  async showOpen (assetID, errorMsg) {\n    const page = this.page\n    this.openAsset = this.lastFormAsset = assetID\n    await this.hideBox()\n    this.unlockForm.setAsset(app.assets[assetID])\n    if (errorMsg) this.unlockForm.showErrorOnly(errorMsg)\n    this.animation = this.showBox(page.openForm, page.walletPass)\n  }\n\n  /* Show the form used to change wallet configuration settings. */\n  async showReconfig (assetID) {\n    const page = this.page\n    Doc.hide(page.reconfigErr)\n    // Hide update password section by default\n    this.changeWalletPW = false\n    this.setPWSettingViz(this.changeWalletPW)\n    const asset = app.assets[assetID]\n    this.walletReconfig.update(asset.info)\n    page.recfgAssetLogo.src = Doc.logoPath(asset.symbol)\n    page.recfgAssetName.textContent = asset.info.name\n    this.reconfigAsset = this.lastFormAsset = assetID\n    await this.hideBox()\n    this.animation = this.showBox(page.walletReconfig)\n    const loaded = app.loading(page.walletReconfig)\n    const res = await postJSON('/api/walletsettings', {\n      assetID: assetID\n    })\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.reconfigErr.textContent = res.msg\n      Doc.show(page.reconfigErr)\n      return\n    }\n    this.walletReconfig.setConfig(res.map)\n  }\n\n  /* Display a deposit address. */\n  async showDeposit (assetID) {\n    const page = this.page\n    Doc.hide(page.depositErr)\n    const box = page.deposit\n    const asset = app.assets[assetID]\n    page.depositLogo.src = Doc.logoPath(asset.symbol)\n    const wallet = app.walletMap[assetID]\n    this.depositAsset = this.lastFormAsset = assetID\n    if (!wallet) {\n      app.notify(ntfn.make(`No wallet found for ${asset.info.name}`, 'Cannot retrieve deposit address.', ntfn.ERROR)) // TODO: translate\n      return\n    }\n    await this.hideBox()\n    page.depositName.textContent = asset.info.name\n    page.depositAddress.textContent = wallet.address\n    this.animation = this.showBox(box)\n  }\n\n  /* Fetch a new address from the wallet. */\n  async newDepositAddress () {\n    const page = this.page\n    Doc.hide(page.depositErr)\n    const loaded = app.loading(page.deposit)\n    const res = await postJSON('/api/depositaddress', {\n      assetID: this.depositAsset\n    })\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.depositErr.textContent = res.msg\n      Doc.show(page.depositErr)\n      return\n    }\n    page.depositAddress.textContent = res.address\n  }\n\n  /* Show the form to withdraw funds. */\n  async showWithdraw (assetID) {\n    const page = this.page\n    const box = page.withdrawForm\n    const asset = app.assets[assetID]\n    const wallet = app.walletMap[assetID]\n    if (!wallet) {\n      app.notify(ntfn.make(`No wallet found for ${asset.info.name}`, 'Cannot withdraw.', ntfn.ERROR))\n    }\n    await this.hideBox()\n    page.withdrawAddr.value = ''\n    page.withdrawAmt.value = ''\n    page.withdrawPW.value = ''\n    page.withdrawAvail.textContent = (wallet.balance.available / 1e8).toFixed(8)\n    page.withdrawLogo.src = Doc.logoPath(asset.symbol)\n    page.withdrawName.textContent = asset.info.name\n    // page.withdrawFee.textContent = wallet.feerate\n    // page.withdrawUnit.textContent = wallet.units\n    box.dataset.assetID = this.lastFormAsset = assetID\n    this.animation = this.showBox(box, page.walletPass)\n  }\n\n  /* doConnect connects to a wallet via the connectwallet API route. */\n  async doConnect (assetID) {\n    const loaded = app.loading(this.body)\n    const res = await postJSON('/api/connectwallet', {\n      assetID: assetID\n    })\n    loaded()\n    if (!app.checkResponse(res)) return\n    const rowInfo = this.rowInfos[assetID]\n    Doc.hide(rowInfo.actions.connect)\n  }\n\n  /* createWalletSuccess is the success callback for wallet creation. */\n  async createWalletSuccess () {\n    const rowInfo = this.rowInfos[this.walletAsset]\n    this.showMarkets(rowInfo.assetID)\n    const a = rowInfo.actions\n    Doc.hide(a.create)\n    Doc.show(a.withdraw, a.deposit, a.settings)\n    await app.fetchUser()\n    if (app.walletMap[rowInfo.assetID].encrypted) {\n      Doc.show(a.lock)\n    }\n  }\n\n  /* openWalletSuccess is the success callback for wallet unlocking. */\n  async openWalletSuccess () {\n    const rowInfo = this.rowInfos[this.openAsset]\n    const a = rowInfo.actions\n    Doc.show(a.withdraw, a.deposit)\n    Doc.hide(a.unlock, a.connect)\n    if (app.walletMap[rowInfo.assetID].encrypted) {\n      Doc.show(a.lock)\n    }\n    this.showMarkets(this.openAsset)\n  }\n\n  /* withdraw submits the withdrawal form to the API. */\n  async withdraw () {\n    const page = this.page\n    Doc.hide(page.withdrawErr)\n    const assetID = parseInt(page.withdrawForm.dataset.assetID)\n    const open = {\n      assetID: assetID,\n      address: page.withdrawAddr.value,\n      value: parseInt(Math.round(page.withdrawAmt.value * 1e8)),\n      pw: page.withdrawPW.value\n    }\n    const loaded = app.loading(page.withdrawForm)\n    const res = await postJSON('/api/withdraw', open)\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.withdrawErr.textContent = res.msg\n      Doc.show(page.withdrawErr)\n      return\n    }\n    this.showMarkets(assetID)\n  }\n\n  /* update wallet configuration */\n  async reconfig () {\n    const page = this.page\n    Doc.hide(page.reconfigErr)\n    if (!page.appPW.value && !State.passwordIsCached()) {\n      page.reconfigErr.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(page.reconfigErr)\n      return\n    }\n    const loaded = app.loading(page.walletReconfig)\n    const req = {\n      assetID: this.reconfigAsset,\n      config: this.walletReconfig.map(),\n      appPW: page.appPW.value\n    }\n    if (this.changeWalletPW) req.newWalletPW = page.newPW.value\n    const res = await postJSON('/api/reconfigurewallet', req)\n    page.appPW.value = ''\n    page.newPW.value = ''\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.reconfigErr.textContent = res.msg\n      Doc.show(page.reconfigErr)\n      return\n    }\n    this.showMarkets(this.reconfigAsset)\n  }\n\n  /* lock instructs the API to lock the wallet. */\n  async lock (assetID, asset) {\n    const page = this.page\n    const loaded = app.loading(page.walletForm)\n    const res = await postJSON('/api/closewallet', { assetID: assetID })\n    loaded()\n    if (!app.checkResponse(res)) return\n    const a = asset.actions\n    Doc.hide(a.withdraw, a.lock, a.deposit)\n    Doc.show(a.unlock)\n  }\n\n  /* handleBalance handles notifications updating a wallet's balance. */\n  handleBalanceNote (note) {\n    const td = this.page.walletTable.querySelector(`[data-balance-target=\"${note.assetID}\"]`)\n    td.textContent = (note.balance.available / 1e8).toFixed(8)\n  }\n\n  /*\n   * handleWalletStateNote is a handler for both the 'walletstate' and\n   * 'walletconfig' notifications.\n   */\n  handleWalletStateNote (note) {\n    this.rowInfos[note.wallet.assetID].stateIcons.readWallet(note.wallet)\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /wallets page.\n   */\n  unload () {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n}\n\n/*\n * Given a market object as created with makeMarket, prettyMarketName will\n * create a string ABC-XYZ, where ABC and XYZ are the upper-case ticker symbols\n * for the base and quote assets respectively.\n */\nfunction prettyMarketName (market) {\n  return `${market.basesymbol.toUpperCase()}-${market.quotesymbol.toUpperCase()}`\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport State from './state'\nimport { postJSON } from './http'\nimport * as forms from './forms'\nimport * as intl from './locales'\n\nconst animationLength = 300\n\nlet app\n\nexport default class SettingsPage extends BasePage {\n  constructor (application, body) {\n    super()\n    app = application\n    this.body = body\n    const page = this.page = Doc.parsePage(body, [\n      'darkMode', 'commitHash',\n      'addADex',\n      // Form to configure DEX server\n      'dexAddrForm', 'dexAddr', 'certFile', 'selectedCert', 'removeCert', 'addCert',\n      'submitDEXAddr', 'dexAddrErr',\n      // Form to confirm DEX registration and pay fee\n      'forms', 'confirmRegForm',\n      // Export Account\n      'exchanges', 'authorizeAccountExportForm', 'exportAccountAppPass', 'authorizeExportAccountConfirm',\n      'exportAccountHost', 'exportAccountErr',\n      // Import Account\n      'importAccount', 'authorizeAccountImportForm', 'authorizeImportAccountConfirm', 'importAccountAppPass',\n      'accountFile', 'selectedAccount', 'removeAccount', 'addAccount', 'importAccountErr',\n      // Disable Account\n      'disableAccount', 'disableAccountForm', 'disableAccountConfirm', 'disableAccountAppPW',\n      'disableAccountHost', 'disableAccountErr',\n      // Change App Password\n      'changeAppPW', 'changeAppPWForm', 'appPW', 'newAppPW', 'confirmNewPW',\n      'submitNewPW', 'changePWErrMsg',\n      // Application seed\n      'exportSeedAuth', 'exportSeedPW', 'exportSeedSubmit', 'exportSeedErr',\n      'exportSeed', 'authorizeSeedDisplay', 'seedDiv',\n      // Others\n      'showPokes'\n    ])\n\n    this.forms = page.forms.querySelectorAll(':scope > form')\n\n    Doc.bind(page.darkMode, 'click', () => {\n      State.dark(page.darkMode.checked)\n      if (page.darkMode.checked) {\n        document.body.classList.add('dark')\n      } else {\n        document.body.classList.remove('dark')\n      }\n    })\n\n    Doc.bind(page.showPokes, 'click', () => {\n      const show = page.showPokes.checked\n      State.setCookie('popups', show ? '1' : '0')\n      app.showPopups = show\n    })\n\n    page.commitHash.textContent = app.commitHash.substring(0, 7)\n    Doc.bind(page.addADex, 'click', () => this.showForm(page.dexAddrForm))\n\n    this.confirmRegistrationForm = new forms.ConfirmRegistrationForm(app,\n      page.confirmRegForm,\n      {\n        getCertFile: () => this.getCertFile(),\n        getDexAddr: () => this.getDexAddr()\n      },\n      () => this.registerDEXSuccess())\n\n    this.dexAddrForm = new forms.DEXAddressForm(app, page.dexAddrForm, async (xc) => {\n      this.confirmRegistrationForm.setExchange(xc)\n      await this.showForm(page.confirmRegForm)\n    })\n\n    forms.bind(page.authorizeAccountExportForm, page.authorizeExportAccountConfirm, () => this.exportAccount())\n    forms.bind(page.disableAccountForm, page.disableAccountConfirm, () => this.disableAccount())\n\n    const exchangesDiv = page.exchanges\n    if (typeof app.user.exchanges !== 'undefined') {\n      for (const host of Object.keys(app.user.exchanges)) {\n        // Bind export account button click event.\n        const exportAccountButton = Doc.tmplElement(exchangesDiv, `exportAccount-${host}`)\n        Doc.bind(exportAccountButton, 'click', () => this.prepareAccountExport(host, page.authorizeAccountExportForm))\n        // Bind disable account button click event.\n        const disableAccountButton = Doc.tmplElement(exchangesDiv, `disableAccount-${host}`)\n        Doc.bind(disableAccountButton, 'click', () => this.prepareAccountDisable(host, page.disableAccountForm))\n      }\n    }\n\n    Doc.bind(page.importAccount, 'click', () => this.prepareAccountImport(page.authorizeAccountImportForm))\n    forms.bind(page.authorizeAccountImportForm, page.authorizeImportAccountConfirm, () => this.importAccount())\n\n    Doc.bind(page.changeAppPW, 'click', () => this.showForm(page.changeAppPWForm))\n    forms.bind(page.changeAppPWForm, page.submitNewPW, () => this.changeAppPW())\n\n    Doc.bind(page.accountFile, 'change', () => this.onAccountFileChange())\n    Doc.bind(page.removeAccount, 'click', () => this.clearAccountFile())\n    Doc.bind(page.addAccount, 'click', () => page.accountFile.click())\n\n    Doc.bind(page.exportSeed, 'click', () => this.showForm(page.exportSeedAuth))\n    forms.bind(page.exportSeedAuth, page.exportSeedSubmit, () => this.submitExportSeedReq())\n\n    const closePopups = () => {\n      Doc.hide(page.forms)\n      page.exportSeedPW.value = ''\n      page.seedDiv.textContent = ''\n    }\n\n    Doc.bind(page.forms, 'mousedown', e => {\n      if (!Doc.mouseInElement(e, this.currentForm)) { closePopups() }\n    })\n\n    this.keyup = e => {\n      if (e.key === 'Escape') {\n        closePopups()\n      }\n    }\n    Doc.bind(document, 'keyup', this.keyup)\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { closePopups() })\n    })\n  }\n\n  async prepareAccountExport (host, authorizeAccountExportForm) {\n    const page = this.page\n    page.exportAccountHost.textContent = host\n    page.exportAccountErr.textContent = ''\n    if (State.passwordIsCached()) {\n      this.exportAccount()\n    } else {\n      this.showForm(authorizeAccountExportForm)\n    }\n  }\n\n  async prepareAccountDisable (host, disableAccountForm) {\n    const page = this.page\n    page.disableAccountHost.textContent = host\n    page.disableAccountErr.textContent = ''\n    this.showForm(disableAccountForm)\n  }\n\n  // exportAccount exports and downloads the account info.\n  async exportAccount () {\n    const page = this.page\n    const pw = page.exportAccountAppPass.value\n    const host = page.exportAccountHost.textContent\n    page.exportAccountAppPass.value = ''\n    const req = {\n      pw,\n      host\n    }\n    const loaded = app.loading(this.body)\n    const res = await postJSON('/api/exportaccount', req)\n    loaded()\n    if (!app.checkResponse(res)) {\n      page.exportAccountErr.textContent = res.msg\n      Doc.show(page.exportAccountErr)\n      return\n    }\n    const accountForExport = JSON.parse(JSON.stringify(res.account))\n    const a = document.createElement('a')\n    a.setAttribute('download', 'dcrAccount-' + host + '.json')\n    a.setAttribute('href', 'data:text/json,' + JSON.stringify(accountForExport, null, 2))\n    a.click()\n    Doc.hide(page.forms)\n  }\n\n  // disableAccount disables the account associated with the provided host.\n  async disableAccount () {\n    const page = this.page\n    const pw = page.disableAccountAppPW.value\n    const host = page.disableAccountHost.textContent\n    page.disableAccountAppPW.value = ''\n    const req = {\n      pw,\n      host\n    }\n    const loaded = app.loading(this.body)\n    const res = await postJSON('/api/disableaccount', req)\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.disableAccountErr.textContent = res.msg\n      Doc.show(page.disableAccountErr)\n      return\n    }\n    Doc.hide(page.forms)\n    // Initial method of removing disabled account.\n    window.location.reload()\n  }\n\n  async onAccountFileChange () {\n    const page = this.page\n    const files = page.accountFile.files\n    if (!files.length) return\n    page.selectedAccount.textContent = files[0].name\n    Doc.show(page.removeAccount)\n    Doc.hide(page.addAccount)\n  }\n\n  /* clearAccountFile cleanup accountFile value and selectedAccount text */\n  clearAccountFile () {\n    const page = this.page\n    page.accountFile.value = ''\n    page.selectedAccount.textContent = 'none selected'\n    Doc.hide(page.removeAccount)\n    Doc.show(page.addAccount)\n  }\n\n  async prepareAccountImport (authorizeAccountImportForm) {\n    const page = this.page\n    page.importAccountErr.textContent = ''\n    this.showForm(authorizeAccountImportForm)\n  }\n\n  // importAccount imports the account\n  async importAccount () {\n    const page = this.page\n    const pw = page.importAccountAppPass.value\n    page.importAccountAppPass.value = ''\n    let accountString = ''\n    if (page.accountFile.value) {\n      accountString = await page.accountFile.files[0].text()\n    }\n    let account\n    try {\n      account = JSON.parse(accountString)\n    } catch (e) {\n      page.importAccountErr.textContent = e.message\n      Doc.show(page.importAccountErr)\n      return\n    }\n    if (typeof account === 'undefined') {\n      page.importAccountErr.textContent = intl.prep(intl.ID_ACCT_UNDEFINED)\n      Doc.show(page.importAccountErr)\n      return\n    }\n    const req = {\n      pw: pw,\n      account: account\n    }\n    const loaded = app.loading(this.body)\n    const importResponse = await postJSON('/api/importaccount', req)\n    loaded()\n    if (!app.checkResponse(importResponse)) {\n      page.importAccountErr.textContent = importResponse.msg\n      Doc.show(page.importAccountErr)\n      return\n    }\n    const loginResponse = await postJSON('/api/login', { pass: pw })\n    if (!app.checkResponse(loginResponse)) {\n      page.importAccountErr.textContent = loginResponse.msg\n      Doc.show(page.importAccountErr)\n      return\n    }\n    await app.fetchUser()\n    Doc.hide(page.forms)\n    // Initial method of displaying imported account.\n    window.location.reload()\n  }\n\n  async submitExportSeedReq () {\n    const page = this.page\n    const pw = page.exportSeedPW.value\n    const loaded = app.loading(this.body)\n    const res = await postJSON('/api/exportseed', { pass: pw })\n    loaded()\n    if (!app.checkResponse(res)) {\n      page.exportAccountErr.textContent = res.msg\n      Doc.show(page.exportSeedE)\n      return\n    }\n    page.exportSeedPW.value = ''\n    page.seedDiv.textContent = res.seed\n    this.showForm(page.authorizeSeedDisplay)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form) {\n    const page = this.page\n    this.currentForm = form\n    this.forms.forEach(form => Doc.hide(form))\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  /* clearCertFile cleanup certFile value and selectedCert text */\n  clearCertFile () {\n    const page = this.page\n    page.certFile.value = ''\n    page.selectedCert.textContent = this.defaultTLSText\n    Doc.hide(page.removeCert)\n    Doc.show(page.addCert)\n  }\n\n  /* gets the contents of the cert file */\n  async getCertFile () {\n    let cert = ''\n    if (this.dexAddrForm.page.certFile.value) {\n      cert = await this.dexAddrForm.page.certFile.files[0].text()\n    }\n    return cert\n  }\n\n  /* gets the dex address input by the user */\n  getDexAddr () {\n    const page = this.page\n    return page.dexAddr.value\n  }\n\n  /* Called after successful registration to a DEX. */\n  async registerDEXSuccess () {\n    const page = this.page\n    page.dexAddr.value = ''\n    this.clearCertFile()\n    Doc.hide(page.forms)\n    await app.fetchUser()\n    // Initial method of displaying added dex.\n    window.location.reload()\n  }\n\n  /* Change application password  */\n  async changeAppPW () {\n    const page = this.page\n    Doc.hide(page.changePWErrMsg)\n\n    const clearValues = () => {\n      page.appPW.value = ''\n      page.newAppPW.value = ''\n      page.confirmNewPW.value = ''\n    }\n    // Ensure password fields are nonempty.\n    if (!page.appPW.value || !page.newAppPW.value || !page.confirmNewPW.value) {\n      page.changePWErrMsg.textContent = intl.prep(intl.ID_NO_APP_PASS_ERROR_MSG)\n      Doc.show(page.changePWErrMsg)\n      clearValues()\n      return\n    }\n    // Ensure password confirmation matches.\n    if (page.newAppPW.value !== page.confirmNewPW.value) {\n      page.changePWErrMsg.textContent = intl.prep(intl.ID_PASSWORD_NOT_MATCH)\n      Doc.show(page.changePWErrMsg)\n      clearValues()\n      return\n    }\n    const loaded = app.loading(page.changeAppPW)\n    const req = {\n      appPW: page.appPW.value,\n      newAppPW: page.newAppPW.value\n    }\n    clearValues()\n    const res = await postJSON('/api/changeapppass', req)\n    loaded()\n    if (!app.checkResponse(res, true)) {\n      page.changePWErrMsg.textContent = res.msg\n      Doc.show(page.changePWErrMsg)\n      return\n    }\n    Doc.hide(page.forms)\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /settings page.\n   */\n  unload () {\n    Doc.unbind(document, 'keyup', this.keyup)\n  }\n}\n","export default class OrderBook {\n  constructor (mktBook, baseSymbol, quoteSymbol) {\n    this.base = mktBook.base\n    this.baseSymbol = baseSymbol\n    this.quote = mktBook.quote\n    this.quoteSymbol = quoteSymbol\n    // Books are sorted mid-gap first.\n    this.buys = mktBook.book.buys || []\n    this.sells = mktBook.book.sells || []\n  }\n\n  /* add adds an order to the order book. */\n  add (ord) {\n    const side = ord.sell ? this.sells : this.buys\n    side.splice(findIdx(side, ord.rate, !ord.sell), 0, ord)\n  }\n\n  /* remove removes an order from the order book. */\n  remove (token) {\n    if (this.removeFromSide(this.sells, token)) return\n    this.removeFromSide(this.buys, token)\n  }\n\n  /* removeFromSide removes an order from the list of orders. */\n  removeFromSide (side, token) {\n    const [ord, i] = this.findOrder(side, token)\n    if (ord) {\n      side.splice(i, 1)\n      return true\n    }\n    return false\n  }\n\n  /* findOrder finds an order in a specified side */\n  findOrder (side, token) {\n    for (const i in side) {\n      if (side[i].token === token) {\n        return [side[i], i]\n      }\n    }\n    return [null, -1]\n  }\n\n  /* updates the remaining quantity of an order. */\n  updateRemaining (token, qty) {\n    if (this.updateRemainingSide(this.sells, token, qty)) return\n    this.updateRemainingSide(this.buys, token, qty)\n  }\n\n  /*\n   * updateRemainingSide looks for the order in the side and updates the\n   * quantity, returning true on success, false if order not found.\n   */\n  updateRemainingSide (side, token, qty) {\n    const ord = this.findOrder(side, token)[0]\n    if (ord) {\n      ord.qty = qty\n      return true\n    }\n    return false\n  }\n\n  /*\n   * setEpoch sets the current epoch and clear any orders from previous epochs.\n   */\n  setEpoch (epochIdx) {\n    const approve = ord => ord.epoch === undefined || ord.epoch === 0 || ord.epoch === epochIdx\n    this.sells = this.sells.filter(approve)\n    this.buys = this.buys.filter(approve)\n  }\n\n  /* empty will return true if both the buys and sells lists are empty. */\n  empty () {\n    return !this.sells.length && !this.buys.length\n  }\n\n  /* count is the total count of both buy and sell orders. */\n  count () {\n    return this.sells.length + this.buys.length\n  }\n\n  /* bestGapOrder will return the best non-epoch order if one exists, or the\n   * best epoch order if there are only epoch orders, or null if there are no\n   * orders.\n   */\n  bestGapOrder (side) {\n    let best = null\n    for (const ord of side) {\n      if (!ord.epoch) return ord\n      if (!best) {\n        best = ord\n      }\n    }\n    return best\n  }\n\n  bestGapBuy () {\n    return this.bestGapOrder(this.buys)\n  }\n\n  bestGapSell () {\n    return this.bestGapOrder(this.sells)\n  }\n}\n\n/*\n * findIdx find the index at which to insert the order into the list of orders.\n */\nfunction findIdx (side, rate, less) {\n  for (const i in side) {\n    if ((side[i].rate < rate) === less) return i\n  }\n  return side.length\n}\n","import Doc from './doc'\nimport State from './state'\n\nconst bind = Doc.bind\nconst unbind = Doc.unbind\nconst PIPI = 2 * Math.PI\nconst plusChar = String.fromCharCode(59914)\nconst minusChar = String.fromCharCode(59915)\n\nconst darkTheme = {\n  axisLabel: '#b1b1b1',\n  gridBorder: '#3a3a3a',\n  gridLines: '#2a2a2a',\n  gapLine: '#6b6b6b',\n  value: '#9a9a9a',\n  zoom: '#5b5b5b',\n  zoomHover: '#aaa',\n  sellLine: '#ae3333',\n  buyLine: '#05a35a',\n  sellFill: '#591a1a',\n  buyFill: '#02572f',\n  crosshairs: '#888',\n  legendFill: 'black',\n  legendText: '#d5d5d5'\n}\n\nconst lightTheme = {\n  axisLabel: '#1b1b1b',\n  gridBorder: '#3a3a3a',\n  gridLines: '#dadada',\n  gapLine: '#595959',\n  value: '#4d4d4d',\n  zoom: '#777',\n  zoomHover: '#333',\n  sellLine: '#99302b',\n  buyLine: '#207a46',\n  sellFill: '#bd5959',\n  buyFill: '#4cad75',\n  crosshairs: '#595959',\n  legendFill: '#e6e6e6',\n  legendText: '#1b1b1b'\n}\n\n// Chart is the base class for charts.\nclass Chart {\n  constructor (parent) {\n    this.parent = parent\n    this.theme = State.isDark() ? darkTheme : lightTheme\n    this.canvas = document.createElement('canvas')\n    this.visible = true\n    parent.appendChild(this.canvas)\n    this.ctx = this.canvas.getContext('2d')\n    this.ctx.textAlign = 'center'\n    this.ctx.textBaseline = 'middle'\n    // Mouse handling\n    this.mousePos = null\n    bind(this.canvas, 'mousemove', e => {\n      // this.rect will be set in resize().\n      this.mousePos = {\n        x: e.clientX - this.rect.left,\n        y: e.clientY - this.rect.y\n      }\n      this.draw()\n    })\n    bind(this.canvas, 'mouseleave', () => {\n      this.mousePos = null\n      this.draw()\n    })\n    // Scrolling by wheel is smoother when the rate is slightly limited.\n    this.wheelLimiter = null\n    this.wheeled = () => {\n      this.wheelLimiter = setTimeout(() => { this.wheelLimiter = null }, 100)\n    }\n    bind(this.canvas, 'wheel', e => { this.wheel(e) })\n    this.boundResizer = () => { this.resize(parent.clientHeight) }\n    bind(window, 'resize', this.boundResizer)\n    bind(this.canvas, 'click', e => { this.click(e) })\n  }\n\n  /* clear the canvas. */\n  clear () {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n  }\n\n  /* draw calls the child class's render method. */\n  draw () {\n    this.render()\n  }\n\n  /* click is the handler for a click event on the canvas. */\n  click (e) {\n    this.clicked(e)\n  }\n\n  /* wheel is a mousewheel event handler. */\n  wheel (e) {\n    this.zoom(e.deltaY < 0)\n    e.preventDefault()\n  }\n\n  /*\n   * resize updates the chart size. The parentHeight is an argument to support\n   * updating the height programatically after the caller sets a style.height\n   * but before the clientHeight has been updated.\n   */\n  resize (parentHeight) {\n    this.canvas.width = this.parent.clientWidth\n    this.canvas.height = parentHeight - 20 // magic number derived from a soup of css values.\n    const xLblHeight = 30\n    const yGuess = 40 // y label width guess. Will be adjusted when drawn.\n    const plotExtents = new Extents(yGuess, this.canvas.width, 10, this.canvas.height - xLblHeight)\n    const xLblExtents = new Extents(yGuess, this.canvas.width, this.canvas.height - xLblHeight, this.canvas.height)\n    const yLblExtents = new Extents(0, yGuess, 10, this.canvas.height - xLblHeight)\n    this.plotRegion = new Region(this.ctx, plotExtents)\n    this.xRegion = new Region(this.ctx, xLblExtents)\n    this.yRegion = new Region(this.ctx, yLblExtents)\n    // After changing the visibility, this.canvas.getBoundingClientRect will\n    // return nonsense until a render.\n    window.requestAnimationFrame(() => {\n      this.rect = this.canvas.getBoundingClientRect()\n      this.resized()\n    })\n  }\n\n  /* zoom is called when the user scrolls the mouse wheel on the canvas. */\n  zoom (bigger) {\n    if (this.wheelLimiter) return\n    this.zoomed(bigger)\n  }\n\n  /* hide hides the canvas */\n  hide () {\n    this.visible = false\n    Doc.hide(this.canvas)\n  }\n\n  /* show shows the canvas */\n  show () {\n    this.visible = true\n    Doc.show(this.canvas)\n    this.resize(this.parent.clientHeight)\n  }\n\n  /* The market handler will call unattach when the markets page is unloaded. */\n  unattach () {\n    unbind(window, 'resize', this.boundResizer)\n  }\n\n  /* render must be implemented by the child class. */\n  render () {\n    console.error('child class must override render method')\n  }\n\n  /* applyLabelStyle applies the style used for axis tick labels. */\n  applyLabelStyle () {\n    this.ctx.textAlign = 'center'\n    this.ctx.textBaseline = 'middle'\n    this.ctx.font = '12px \\'sans\\', sans-serif'\n    this.ctx.fillStyle = this.theme.axisLabel\n  }\n\n  /* plotXLabels applies the provided labels to the x axis and draws the grid. */\n  plotXLabels (labels, minX, maxX, unitLines) {\n    const extents = new Extents(minX, maxX, 0, 1)\n    this.xRegion.plot(extents, (ctx, tools) => {\n      this.applyLabelStyle()\n      const centerX = (maxX + minX) / 2\n      let lastX = minX\n      let unitCenter = centerX\n      labels.lbls.forEach(lbl => {\n        ctx.fillText(lbl.txt, tools.x(lbl.val), tools.y(0.5))\n        if (centerX >= lastX && centerX < lbl.val) {\n          unitCenter = (lastX + lbl.val) / 2\n        }\n        lastX = lbl.val\n      })\n      ctx.font = '11px \\'sans\\', sans-serif'\n      if (unitLines.length === 2) {\n        ctx.fillText(unitLines[0], tools.x(unitCenter), tools.y(0.63))\n        ctx.fillText(unitLines[1], tools.x(unitCenter), tools.y(0.23))\n      } else if (unitLines.length === 1) {\n        ctx.fillText(unitLines[0], tools.x(unitCenter), tools.y(0.5))\n      }\n    }, true)\n    this.plotRegion.plot(extents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridLines\n      labels.lbls.forEach(lbl => {\n        line(ctx, tools.x(lbl.val), tools.y(0), tools.x(lbl.val), tools.y(1))\n      })\n    }, true)\n  }\n\n  /*\n   * plotYLabels applies the y labels based on the provided plot region, and\n   * draws the grid.\n   */\n  plotYLabels (region, labels, minY, maxY, unit) {\n    const extents = new Extents(0, 1, minY, maxY)\n    this.yRegion.plot(extents, (ctx, tools) => {\n      this.applyLabelStyle()\n      const centerY = maxY / 2\n      let lastY = 0\n      let unitCenter = centerY\n      labels.lbls.forEach(lbl => {\n        ctx.fillText(lbl.txt, tools.x(0.5), tools.y(lbl.val))\n        if (centerY >= lastY && centerY < lbl.val) {\n          unitCenter = (lastY + lbl.val) / 2\n        }\n        lastY = lbl.val\n      })\n      ctx.fillText(unit, tools.x(0.5), tools.y(unitCenter))\n    }, true)\n    region.plot(extents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridLines\n      labels.lbls.forEach(lbl => {\n        line(ctx, tools.x(0), tools.y(lbl.val), tools.x(1), tools.y(lbl.val))\n      })\n    }, true)\n  }\n\n  /*\n   * doYLabels generates and applies the y-axis labels, based upon the\n   * provided plot region.\n   */\n  doYLabels (region, step, unit, valFmt) {\n    const yLabels = makeLabels(this.ctx, region.height(), this.dataExtents.y.min,\n      this.dataExtents.y.max, 50, step, unit, valFmt)\n\n    // Reassign the width of the y-label column to accommodate the widest text.\n    const yAxisWidth = yLabels.widest * 1.5\n    this.yRegion.extents.x.max = yAxisWidth\n    this.yRegion.extents.y.max = region.extents.y.max\n\n    this.plotRegion.extents.x.min = yAxisWidth\n    this.xRegion.extents.x.min = yAxisWidth\n    // Print the y labels.\n    this.plotYLabels(region, yLabels, this.dataExtents.y.min, this.dataExtents.y.max, unit)\n    return yLabels\n  }\n\n  // drawFrame draws an outline around the plotRegion.\n  drawFrame () {\n    this.plotRegion.plot(new Extents(0, 1, 0, 1), (ctx, tools) => {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = this.theme.gridBorder\n      ctx.beginPath()\n      tools.dataCoords(() => {\n        ctx.moveTo(0, 0)\n        ctx.lineTo(0, 1)\n        ctx.lineTo(1, 1)\n        ctx.lineTo(1, 0)\n        ctx.lineTo(0, 0)\n      })\n      ctx.stroke()\n    })\n  }\n}\n\n/* DepthChart is a javascript Canvas-based depth chart renderer. */\nexport class DepthChart extends Chart {\n  constructor (parent, reporters, zoom) {\n    super(parent)\n    this.reporters = reporters\n    this.book = null\n    this.dataExtents = null\n    this.zoomLevel = zoom\n    this.lotSize = null\n    this.rateStep = null\n    this.lines = []\n    this.markers = {\n      buys: [],\n      sells: []\n    }\n    this.resize(parent.clientHeight)\n  }\n\n  /* resized is called when the window or parent element are resized. */\n  resized () {\n    // The button region extents are set during drawing.\n    this.zoomInBttn = new Region(this.ctx, new Extents(0, 0, 0, 0))\n    this.zoomOutBttn = new Region(this.ctx, new Extents(0, 0, 0, 0))\n    if (this.book) this.draw()\n  }\n\n  /* zoomed zooms the current view in or out. bigger=true is zoom in. */\n  zoomed (bigger) {\n    if (!this.zoomLevel) return\n    if (!this.book.buys || !this.book.sells) return\n    this.wheeled()\n    // Zoom in to 66%, but out to 150% = 1 / (2/3) so that the same zoom levels\n    // are hit when reversing direction.\n    this.zoomLevel *= bigger ? 2 / 3 : 3 / 2\n    this.zoomLevel = clamp(this.zoomLevel, 0.005, 2)\n    this.draw()\n    this.reporters.zoom(this.zoomLevel)\n  }\n\n  /* clicked is the canvas 'click' event handler. */\n  clicked (e) {\n    if (!this.dataExtents) return\n    const x = e.clientX - this.rect.left\n    const y = e.clientY - this.rect.y\n    if (this.zoomInBttn.contains(x, y)) { this.zoom(true); return }\n    if (this.zoomOutBttn.contains(x, y)) { this.zoom(false); return }\n    const translator = this.plotRegion.translator(this.dataExtents)\n    this.reporters.click(translator.unx(x))\n  }\n\n  /* set sets the current data set and draws. */\n  set (book, lotSize, rateStep) {\n    this.book = book\n    this.lotSize = lotSize / 1e8\n    this.rateStep = rateStep / 1e8\n    this.baseTicker = book.baseSymbol.toUpperCase()\n    this.quoteTicker = book.quoteSymbol.toUpperCase()\n    if (!this.zoomLevel) {\n      const [midGap, gapWidth] = this.gap()\n      // Default to 5% zoom, but with a minimum of 5 * midGap, but still observing\n      // the hard cap of 200%.\n      const minZoom = Math.max(gapWidth / midGap * 5, 0.05)\n      this.zoomLevel = Math.min(minZoom, 2)\n    }\n    this.draw()\n  }\n\n  /*\n   * render draws the chart.\n   * 1. Calculate the data extents and translate the order book data to a\n   *    cumulative form.\n   * 2. Draw axis ticks and grid, mid-gap line and value, zoom buttons, mouse\n   *    position indicator...\n   * 4. Tick labels.\n   * 5. Data.\n   * 6. Epoch line legend.\n   * 7. Hover legend.\n   */\n  render () {\n    // if connection fails it is not possible to get book.\n    if (!this.book || !this.visible) return\n\n    this.clear()\n    // if (!this.book || this.book.empty()) return\n\n    const ctx = this.ctx\n    const mousePos = this.mousePos\n    const buys = this.book.buys\n    const sells = this.book.sells\n    const [midGap, gapWidth] = this.gap()\n\n    const halfWindow = this.zoomLevel * midGap / 2\n    const high = midGap + halfWindow\n    const low = midGap - halfWindow\n\n    // Get a sorted copy of the markers list.\n    const buyMarkers = [...this.markers.buys]\n    const sellMarkers = [...this.markers.sells]\n    buyMarkers.sort((a, b) => b.rate - a.rate)\n    sellMarkers.sort((a, b) => a.rate - b.rate)\n    const markers = []\n\n    const buyDepth = []\n    const buyEpoch = []\n    const sellDepth = []\n    const sellEpoch = []\n    const volumeReport = {\n      buyBase: 0,\n      buyQuote: 0,\n      sellBase: 0,\n      sellQuote: 0\n    }\n    let sum = 0\n    // The epoch line is above the non-epoch region, so the epochSum y value\n    // must account for non-epoch orders too.\n    let epochSum = 0\n\n    for (let i = 0; i < buys.length; i++) {\n      const ord = buys[i]\n      epochSum += ord.qty\n      if (ord.rate >= low) buyEpoch.push([ord.rate, epochSum])\n      if (ord.epoch) continue\n      sum += ord.qty\n      buyDepth.push([ord.rate, sum])\n      volumeReport.buyBase += ord.qty\n      volumeReport.buyQuote += ord.qty * ord.rate\n      while (buyMarkers.length && floatCompare(buyMarkers[0].rate, ord.rate)) {\n        const mark = buyMarkers.shift()\n        markers.push({\n          rate: mark.rate,\n          qty: ord.epoch ? epochSum : sum,\n          sell: ord.sell,\n          active: mark.active\n        })\n      }\n    }\n    const buySum = buyDepth.length ? last(buyDepth)[1] : 0\n    buyDepth.push([low, buySum])\n    const epochBuySum = buyEpoch.length ? last(buyEpoch)[1] : 0\n    buyEpoch.push([low, epochBuySum])\n\n    epochSum = sum = 0\n    for (let i = 0; i < sells.length; i++) {\n      const ord = sells[i]\n      epochSum += ord.qty\n      if (ord.rate <= high) sellEpoch.push([ord.rate, epochSum])\n      if (ord.epoch) continue\n      sum += ord.qty\n      sellDepth.push([ord.rate, sum])\n      volumeReport.sellBase += ord.qty\n      volumeReport.sellQuote += ord.qty * ord.rate\n      while (sellMarkers.length && floatCompare(sellMarkers[0].rate, ord.rate)) {\n        const mark = sellMarkers.shift()\n        markers.push({\n          rate: mark.rate,\n          qty: ord.epoch ? epochSum : sum,\n          sell: ord.sell,\n          active: mark.active\n        })\n      }\n    }\n    // Add a data point going to the left so that the data doesn't end with a\n    // vertical line.\n    const sellSum = sellDepth.length ? last(sellDepth)[1] : 0\n    sellDepth.push([high, sellSum])\n    const epochSellSum = sellEpoch.length ? last(sellEpoch)[1] : 0\n    sellEpoch.push([high, epochSellSum])\n\n    // Add ~30px padding to the top of the chart.\n    const h = this.xRegion.extents.y.min\n    const growthFactor = (h + 30) / h\n    const maxY = (epochSellSum && epochBuySum ? Math.max(epochBuySum, epochSellSum) : epochSellSum || epochBuySum || 1) * growthFactor\n\n    const dataExtents = new Extents(low, high, 0, maxY)\n    this.dataExtents = dataExtents\n\n    this.doYLabels(this.plotRegion, this.lotSize, this.book.baseSymbol)\n\n    const xLabels = makeLabels(ctx, this.plotRegion.width(), dataExtents.x.min,\n      dataExtents.x.max, 100, this.rateStep, `${this.book.quoteSymbol}/${this.book.baseSymbol}`)\n\n    // Print the x labels\n    this.plotXLabels(xLabels, low, high, [`${this.quoteTicker}/`, this.baseTicker])\n\n    // A function to be run at the end if there is legend data to display.\n    let mouseData\n\n    // Draw the grid.\n    this.drawFrame()\n    this.plotRegion.plot(dataExtents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      // first, a square around the plot area.\n      ctx.strokeStyle = this.theme.gridBorder\n      // draw a line to indicate mid-gap\n      ctx.lineWidth = 2.5\n      ctx.strokeStyle = this.theme.gapLine\n      line(ctx, tools.x(midGap), tools.y(0), tools.x(midGap), tools.y(0.3 * dataExtents.y.max))\n\n      ctx.font = '30px \\'demi-sans\\', sans-serif'\n      ctx.textAlign = 'center'\n      ctx.textBaseline = 'middle'\n      ctx.fillStyle = this.theme.value\n      const y = 0.5 * dataExtents.y.max\n      ctx.fillText(formatLabelValue(midGap), tools.x(midGap), tools.y(y))\n      ctx.font = '12px \\'sans\\', sans-serif'\n      // ctx.fillText('mid-market price', tools.x(midGap), tools.y(y) + 24)\n      ctx.fillText(`${(gapWidth / midGap * 100).toFixed(2)}% spread`,\n        tools.x(midGap), tools.y(y) + 24)\n\n      // Draw zoom buttons.\n      ctx.textAlign = 'center'\n      ctx.textBaseline = 'middle'\n      const topCenterX = this.plotRegion.extents.midX\n      const topCenterY = tools.y(maxY * 0.9)\n      const zoomPct = dataExtents.xRange / midGap * 100\n      const zoomText = `${zoomPct.toFixed(1)}%`\n      const w = ctx.measureText(zoomText).width\n      ctx.font = '13px \\'sans\\', sans-serif'\n      ctx.fillText(zoomText, topCenterX, topCenterY + 1)\n      // define the region for the zoom button\n      const bttnSize = 20\n      const xPad = 10\n      let bttnLeft = topCenterX - w / 2 - xPad - bttnSize\n      const bttnTop = topCenterY - bttnSize / 2\n      this.zoomOutBttn.setExtents(\n        bttnLeft,\n        bttnLeft + bttnSize,\n        bttnTop,\n        bttnTop + bttnSize\n      )\n      let hover = mousePos && this.zoomOutBttn.contains(mousePos.x, mousePos.y)\n      this.zoomOutBttn.plot(new Extents(0, 1, 0, 1), (ctx, tools) => {\n        ctx.font = '12px \\'icomoon\\''\n        ctx.fillStyle = this.theme.zoom\n        if (hover) {\n          ctx.fillStyle = this.theme.zoomHover\n          ctx.font = '13px \\'icomoon\\''\n        }\n        ctx.fillText(minusChar, this.zoomOutBttn.extents.midX, this.zoomOutBttn.extents.midY)\n      })\n      bttnLeft = topCenterX + w / 2 + xPad\n      this.zoomInBttn.setExtents(\n        bttnLeft,\n        bttnLeft + bttnSize,\n        bttnTop,\n        bttnTop + bttnSize\n      )\n      hover = mousePos && this.zoomInBttn.contains(mousePos.x, mousePos.y)\n      this.zoomInBttn.plot(new Extents(0, 1, 0, 1), (ctx, tools) => {\n        ctx.font = '12px \\'icomoon\\''\n        ctx.fillStyle = this.theme.zoom\n        if (hover) {\n          ctx.fillStyle = this.theme.zoomHover\n          ctx.font = '14px \\'icomoon\\''\n        }\n        ctx.fillText(plusChar, this.zoomInBttn.extents.midX, this.zoomInBttn.extents.midY)\n      })\n\n      // Draw a dotted vertical line where the mouse is, and a dot at the level\n      // of the depth line.\n      const drawLine = (x, color) => {\n        if (x > high || x < low) return\n        ctx.save()\n        ctx.setLineDash([3, 5])\n        ctx.lineWidth = 1.5\n        ctx.strokeStyle = color\n        line(ctx, tools.x(x), tools.y(0), tools.x(x), tools.y(maxY))\n        ctx.restore()\n      }\n\n      for (const line of this.lines || []) {\n        drawLine(line.rate, line.color)\n      }\n\n      const tolerance = (high - low) * 0.005\n      const hoverMarkers = []\n      for (const marker of markers || []) {\n        const hovered = (mousePos && withinTolerance(marker.rate, tools.unx(mousePos.x), tolerance))\n        if (hovered) hoverMarkers.push(marker.rate)\n        ctx.save()\n        ctx.lineWidth = (hovered || marker.active) ? 5 : 3\n        ctx.strokeStyle = marker.sell ? this.theme.sellLine : this.theme.buyLine\n        ctx.fillStyle = marker.sell ? this.theme.sellFill : this.theme.buyFill\n        const size = (hovered || marker.active) ? 10 : 8\n        ctx.beginPath()\n        const tip = {\n          x: tools.x(marker.rate),\n          y: tools.y(marker.qty) - 8\n        }\n        const top = tip.y - (Math.sqrt(3) * size / 2) // cos(30)\n        ctx.moveTo(tip.x, tip.y)\n        ctx.lineTo(tip.x - size / 2, top)\n        ctx.lineTo(tip.x + size / 2, top)\n        ctx.closePath()\n        ctx.stroke()\n        ctx.fill()\n        ctx.restore()\n      }\n\n      // If the mouse is in the chart area, draw the crosshairs.\n      if (!mousePos) return\n      if (!this.plotRegion.contains(mousePos.x, mousePos.y)) return\n      // The mouse is in the plot region. Get the data coordinates and find the\n      // side and depth for the x value.\n      const dataX = tools.unx(mousePos.x)\n      let evalSide = sellDepth\n      let trigger = (ptX) => ptX >= dataX\n      let dotColor = this.theme.sellLine\n      if (dataX < midGap) {\n        evalSide = buyDepth\n        trigger = (ptX) => ptX <= dataX\n        dotColor = this.theme.buyLine\n      }\n      let bestDepth = evalSide[0]\n      for (let i = 0; i < evalSide.length; i++) {\n        const pt = evalSide[i]\n        if (trigger(pt[0])) break\n        bestDepth = pt\n      }\n      drawLine(dataX, this.theme.crosshairs, true)\n      mouseData = {\n        rate: dataX,\n        depth: bestDepth[1],\n        dotColor: dotColor,\n        hoverMarkers: hoverMarkers\n      }\n    })\n\n    // Draw the epoch lines\n    ctx.lineWidth = 1.5\n    ctx.setLineDash([3, 3])\n    // epoch sells\n    ctx.fillStyle = this.theme.sellFill\n    ctx.strokeStyle = this.theme.sellLine\n    this.drawDepth(sellEpoch)\n    // epoch buys\n    ctx.fillStyle = this.theme.buyFill\n    ctx.strokeStyle = this.theme.buyLine\n    this.drawDepth(buyEpoch)\n\n    // Draw the book depth.\n    ctx.lineWidth = 2.5\n    ctx.setLineDash([])\n    // book sells\n    ctx.fillStyle = this.theme.sellFill\n    ctx.strokeStyle = this.theme.sellLine\n    this.drawDepth(sellDepth)\n    // book buys\n    ctx.fillStyle = this.theme.buyFill\n    ctx.strokeStyle = this.theme.buyLine\n    this.drawDepth(buyDepth)\n\n    // Display the dot at the intersection of the mouse hover line and the depth\n    // line. This should be drawn after the depths.\n    if (mouseData) {\n      this.plotRegion.plot(dataExtents, (ctx, tools) => {\n        dot(ctx, tools.x(mouseData.rate), tools.y(mouseData.depth), mouseData.dotColor, 5)\n      })\n    }\n\n    // Report the book volumes.\n    this.reporters.volume(volumeReport)\n    this.reporters.mouse(mouseData)\n  }\n\n  /* drawDepth draws a single side's depth chart data. */\n  drawDepth (depth) {\n    const firstPt = depth[0]\n    let y = firstPt[1]\n    let x\n    this.plotRegion.plot(this.dataExtents, (ctx, tools) => {\n      tools.dataCoords(() => {\n        ctx.beginPath()\n        ctx.moveTo(firstPt[0], firstPt[1])\n        for (let i = 0; i < depth.length; i++) {\n          // Set x, but don't set y until we draw the horizontal line.\n          x = depth[i][0]\n          ctx.lineTo(x, y)\n          // If this is past the render edge, quit drawing.\n          y = depth[i][1]\n          ctx.lineTo(x, y)\n        }\n      })\n      ctx.stroke()\n      tools.dataCoords(() => {\n        ctx.lineTo(x, 0)\n        ctx.lineTo(firstPt[0], 0)\n      })\n      ctx.closePath()\n      ctx.globalAlpha = 0.25\n      ctx.fill()\n    })\n  }\n\n  /* returns the mid-gap rate and gap width as a tuple. */\n  gap () {\n    const [b, s] = [this.book.bestGapBuy(), this.book.bestGapSell()]\n    if (!b) {\n      if (!s) return [1, 0]\n      return [s.rate, 0]\n    } else if (!s) return [b.rate, 0]\n    return [(s.rate + b.rate) / 2, s.rate - b.rate]\n  }\n\n  /* setLines stores the indicator lines to draw. */\n  setLines (lines) {\n    this.lines = lines\n  }\n\n  /* setMarkers sets the indicator markers to draw. */\n  setMarkers (markers) {\n    this.markers = markers\n  }\n}\n\n/* CandleChart is a candlestick data renderer. */\nexport class CandleChart extends Chart {\n  constructor (parent, reporters) {\n    super(parent)\n    this.reporters = reporters\n    this.data = null\n    this.dataExtents = null\n    this.zoomLevel = 1\n    this.numToShow = 100\n    this.resize(parent.clientHeight)\n  }\n\n  /* resized is called when the window or parent element are resized. */\n  resized () {\n    const ext = this.plotRegion.extents\n    const candleExtents = new Extents(ext.x.min, ext.x.max, ext.y.min, ext.y.min + ext.yRange * 0.85)\n    this.candleRegion = new Region(this.ctx, candleExtents)\n    const volumeExtents = new Extents(ext.x.min, ext.x.max, ext.y.min + 0.85 * ext.yRange, ext.y.max)\n    this.volumeRegion = new Region(this.ctx, volumeExtents)\n    // Set a delay on the render to prevent lag.\n    if (this.resizeTimer) clearTimeout(this.resizeTimer)\n    this.resizeTimer = setTimeout(() => this.draw(), 100)\n  }\n\n  clicked (e) {}\n\n  /* zoomed zooms the current view in or out. bigger=true is zoom in. */\n  zoomed (bigger) {\n    // bigger actually means fewer candles -> reduce zoomLevels index.\n    const idx = this.zoomLevels.indexOf(this.numToShow)\n    if (bigger) {\n      if (idx === 0) return\n      this.numToShow = this.zoomLevels[idx - 1]\n    } else {\n      if (this.zoomLevels.length <= idx + 1 || this.numToShow > this.data.candles.length) return\n      this.numToShow = this.zoomLevels[idx + 1]\n    }\n    this.draw()\n  }\n\n  /* render draws the chart */\n  render () {\n    const data = this.data\n    if (!data || !this.visible) return\n    const candleWidth = data.ms\n    const mousePos = this.mousePos\n    const allCandles = data.candles || []\n\n    const n = Math.min(this.numToShow, allCandles.length)\n    const candles = allCandles.slice(allCandles.length - n)\n\n    this.clear()\n\n    // If there are no candles. just don't draw anything.\n    if (n === 0) return\n\n    // padding definition and some helper functions to parse candles.\n    const candleWidthPadding = 0.2\n    const start = c => truncate(c.endStamp, candleWidth)\n    const end = c => start(c) + candleWidth\n    const paddedStart = c => start(c) + candleWidthPadding * candleWidth\n    const paddedWidth = (1 - 2 * candleWidthPadding) * candleWidth\n\n    const first = candles[0]\n    const last = candles[n - 1]\n\n    let [high, low, highVol] = [first.highRate, first.lowRate, first.matchVolume]\n    for (const c of candles) {\n      if (c.highRate > high) high = c.highRate\n      if (c.lowRate < low) low = c.lowRate\n      if (c.matchVolume > highVol) highVol = c.matchVolume\n    }\n\n    // Calculate data extents and store them. They are used to apply labels.\n    const rateStep = this.market.ratestep\n    const dataExtents = new Extents(start(first), end(last), low, high)\n    if (low === high) {\n      // If there is no price movement at all in the window, show a little more\n      // top and bottom so things render nicely.\n      dataExtents.y.min -= rateStep\n      dataExtents.y.max += rateStep\n    }\n    this.dataExtents = dataExtents\n\n    // Apply labels.\n    this.doYLabels(this.candleRegion, rateStep, this.market.quotesymbol, v => formatLabelValue(v / 1e8))\n    this.candleRegion.extents.x.min = this.yRegion.extents.x.max\n    this.volumeRegion.extents.x.min = this.yRegion.extents.x.max\n\n    const xLabels = makeCandleTimeLabels(candles, candleWidth, this.plotRegion.width(), 100)\n\n    this.plotXLabels(xLabels, start(first), end(last), [])\n\n    this.drawFrame()\n\n    // Highlight the candle if the user mouse is over the canvas.\n    let mouseCandle\n    if (mousePos) {\n      this.plotRegion.plot(new Extents(dataExtents.x.min, dataExtents.x.max, 0, 1), (ctx, tools) => {\n        const selectedStartStamp = truncate(tools.unx(mousePos.x), candleWidth)\n        for (const c of candles) {\n          if (start(c) === selectedStartStamp) {\n            mouseCandle = c\n            ctx.fillStyle = this.theme.gridLines\n            ctx.fillRect(tools.x(start(c)), tools.y(0), tools.w(candleWidth), tools.h(1))\n            break\n          }\n        }\n      })\n      if (mouseCandle) {\n        const yExt = this.xRegion.extents.y\n        this.xRegion.plot(new Extents(dataExtents.x.min, dataExtents.x.max, yExt.min, yExt.max), (ctx, tools) => {\n          this.applyLabelStyle()\n          const rangeTxt = `${new Date(start(mouseCandle)).toLocaleString()} - ${new Date(end(mouseCandle)).toLocaleString()}`\n          const [xPad, yPad] = [25, 2]\n          const rangeWidth = ctx.measureText(rangeTxt).width + 2 * xPad\n          const rangeHeight = 16\n          let centerX = tools.x((start(mouseCandle) + end(mouseCandle)) / 2)\n          let left = centerX - rangeWidth / 2\n          const xExt = this.xRegion.extents.x\n          if (left < xExt.min) left = xExt.min\n          else if (left + rangeWidth > xExt.max) left = xExt.max - rangeWidth\n          centerX = left + rangeWidth / 2\n          const top = yExt.min + (this.xRegion.height() - rangeHeight) / 2\n          ctx.fillStyle = this.theme.legendFill\n          ctx.strokeStyle = this.theme.gridBorder\n          const rectArgs = [left - xPad, top - yPad, rangeWidth + 2 * xPad, rangeHeight + 2 * yPad]\n          ctx.fillRect(...rectArgs)\n          ctx.strokeRect(...rectArgs)\n          this.applyLabelStyle()\n          ctx.fillText(rangeTxt, centerX, this.xRegion.extents.midY, rangeWidth)\n        })\n      }\n    }\n\n    // Draw the volume bars.\n    const volDataExtents = new Extents(start(first), end(last), 0, highVol)\n    this.volumeRegion.plot(volDataExtents, (ctx, tools) => {\n      ctx.fillStyle = this.theme.gridBorder\n      for (const c of candles) {\n        ctx.fillRect(tools.x(paddedStart(c)), tools.y(0), tools.w(paddedWidth), tools.h(c.matchVolume))\n      }\n    })\n\n    // Draw the candles.\n    this.candleRegion.plot(dataExtents, (ctx, tools) => {\n      ctx.lineWidth = 1\n      for (const c of candles) {\n        const desc = c.startRate > c.endRate\n        const [x, y, w, h] = [tools.x(paddedStart(c)), tools.y(c.startRate), tools.w(paddedWidth), tools.h(c.endRate - c.startRate)]\n        const [high, low, cx] = [tools.y(c.highRate), tools.y(c.lowRate), w / 2 + x]\n        ctx.strokeStyle = desc ? this.theme.sellLine : this.theme.buyLine\n        ctx.fillStyle = desc ? this.theme.sellFill : this.theme.buyFill\n\n        ctx.beginPath()\n        ctx.moveTo(cx, high)\n        ctx.lineTo(cx, low)\n        ctx.stroke()\n\n        ctx.fillRect(x, y, w, h)\n        ctx.strokeRect(x, y, w, h)\n      }\n    })\n\n    // Report the mouse candle.\n    this.reporters.mouse(mouseCandle)\n  }\n\n  /* setCandles sets the candle data and redraws the chart. */\n  setCandles (data, market) {\n    this.data = data\n    if (!data.candles) return\n    this.market = market\n    let n = 25\n    this.zoomLevels = []\n    const maxCandles = Math.max(data.candles.length, 1000)\n    while (n < maxCandles) {\n      this.zoomLevels.push(n)\n      n *= 2\n    }\n    this.numToShow = 100\n    this.draw()\n  }\n}\n\n/*\n * Extents holds a min and max in both the x and y directions, and provides\n * getters for related data.\n */\nclass Extents {\n  constructor (xMin, xMax, yMin, yMax) {\n    this.setExtents(xMin, xMax, yMin, yMax)\n  }\n\n  setExtents (xMin, xMax, yMin, yMax) {\n    this.x = {\n      min: xMin,\n      max: xMax\n    }\n    this.y = {\n      min: yMin,\n      max: yMax\n    }\n  }\n\n  get xRange () {\n    return this.x.max - this.x.min\n  }\n\n  get midX () {\n    return (this.x.max + this.x.min) / 2\n  }\n\n  get yRange () {\n    return this.y.max - this.y.min\n  }\n\n  get midY () {\n    return (this.y.max + this.y.min) / 2\n  }\n}\n\n/*\n * Region applies an Extents to the canvas, providing utilities for coordinate\n * transformations and restricting drawing to a specified region of the canvas.\n */\nclass Region {\n  constructor (context, extents) {\n    this.context = context\n    this.extents = extents\n  }\n\n  setExtents (xMin, xMax, yMin, yMax) {\n    this.extents.setExtents(xMin, xMax, yMin, yMax)\n  }\n\n  width () {\n    return this.extents.xRange\n  }\n\n  height () {\n    return this.extents.yRange\n  }\n\n  contains (x, y) {\n    const ext = this.extents\n    return (x < ext.x.max && x > ext.x.min &&\n      y < ext.y.max && y > ext.y.min)\n  }\n\n  /*\n   * A translator provides 4 function for coordinate transformations. x and y\n   * translate data coordinates to canvas coordinates for the specified data\n   * Extents. unx and uny translate canvas coordinates to data coordinates.\n   */\n  translator (dataExtents) {\n    const region = this.extents\n    const xMin = dataExtents.x.min\n    // const xMax = dataExtents.x.max\n    const yMin = dataExtents.y.min\n    // const yMax = dataExtents.y.max\n    const yRange = dataExtents.yRange\n    const xRange = dataExtents.xRange\n    const screenMinX = region.x.min\n    const screenW = region.x.max - screenMinX\n    const screenMaxY = region.y.max\n    const screenH = screenMaxY - region.y.min\n    const xFactor = screenW / xRange\n    const yFactor = screenH / yRange\n    return {\n      x: x => (x - xMin) * xFactor + screenMinX,\n      y: y => screenMaxY - (y - yMin) * yFactor,\n      unx: x => (x - screenMinX) / xFactor + xMin,\n      uny: y => yMin - (y - screenMaxY) / yFactor,\n      w: w => w / xRange * screenW,\n      h: h => -h / yRange * screenH\n    }\n  }\n\n  /* clear clears the region. */\n  clear () {\n    const ext = this.extents\n    this.ctx.clearRect(ext.x.min, ext.y.min, ext.xRange, ext.yRange)\n  }\n\n  /* plot prepares tools for drawing using data coordinates. */\n  plot (dataExtents, drawFunc, skipMask) {\n    const ctx = this.context\n    const region = this.extents\n    ctx.save() // Save the original state\n    if (!skipMask) {\n      ctx.beginPath()\n      ctx.rect(region.x.min, region.y.min, region.xRange, region.yRange)\n      ctx.clip()\n    }\n\n    // The drawFunc will be passed a set of tool that can be used to assist\n    // drawing. The tools start with the transformation functions.\n    const tools = this.translator(dataExtents)\n\n    // Create a transformation that allows drawing in data coordinates. It's\n    // not advisable to stroke or add text with this transform in place, as the\n    // result will be distorted. You can however use ctx.moveTo and ctx.lineTo\n    // with this transform in place using data coordinates, and remove the\n    // transform before stroking. The dataCoords method of the supplied tool\n    // provides this functionality.\n    const yRange = dataExtents.yRange\n    const xFactor = region.xRange / dataExtents.xRange\n    const yFactor = region.yRange / yRange\n    const xMin = dataExtents.x.min\n    const yMin = dataExtents.y.min\n    // These translation factors are complicated because the (0, 0) of the\n    // region is not necessarily the (0, 0) of the canvas.\n    const tx = (region.x.min + xMin) - xMin * xFactor\n    const ty = -region.y.min - (yRange - yMin) * yFactor\n    const setTransform = () => {\n      // Data coordinates are flipped about y. Flip the coordinates and\n      // translate top left corner to canvas (0, 0).\n      ctx.transform(1, 0, 0, -1, -xMin, yMin)\n      // Scale to data coordinates and shift into place for the region's offset\n      // on the canvas.\n      ctx.transform(xFactor, 0, 0, yFactor, tx, ty)\n    }\n    // dataCoords allows some drawing to be performed directly in data\n    // coordinates. Most actual drawing functions like ctx.stroke and\n    // ctx.fillRect should not be called from inside dataCoords, but\n    // ctx.moveTo and ctx.LineTo are fine.\n    tools.dataCoords = f => {\n      ctx.save()\n      setTransform()\n      f()\n      ctx.restore()\n    }\n\n    drawFunc(this.context, tools)\n    ctx.restore()\n  }\n}\n\n/*\n * makeLabels attempts to create the appropriate labels for the specified\n * screen size, context, and label spacing.\n */\nfunction makeLabels (ctx, screenW, min, max, spacingGuess, step, unit, valFmt) {\n  valFmt = valFmt || formatLabelValue\n  const n = screenW / spacingGuess\n  const diff = max - min\n  const tickGuess = diff / n\n  // make the tick spacing a multiple of the step\n  const tick = tickGuess + step - (tickGuess % step)\n  let x = min + tick - (min % tick)\n  const absMax = Math.max(Math.abs(max), Math.abs(min))\n  // The Math.round part is the minimum precision required to see the change in the numbers.\n  // The 2 accounts for the precision of the tick.\n  const sigFigs = Math.round(Math.log10(absMax / tick)) + 2\n  const pts = []\n  let widest = 0\n  while (x < max) {\n    x = Number(x.toPrecision(sigFigs))\n    const lbl = valFmt(x)\n    widest = Math.max(widest, ctx.measureText(lbl).width)\n    pts.push({\n      val: x,\n      txt: lbl\n    })\n    x += tick\n  }\n  const unitW = ctx.measureText(unit).width\n  if (unitW > widest) widest = unitW\n  return {\n    widest: widest,\n    lbls: pts\n  }\n}\n\nconst months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul', 'aug', 'sep', 'oct', 'nov', 'dec']\n\n/* makeCandleTimeLabels prepares labels for candlestick data. */\nfunction makeCandleTimeLabels (candles, dur, screenW, spacingGuess) {\n  const first = candles[0]\n  const last = candles[candles.length - 1]\n  const start = truncate(first.endStamp, dur)\n  const end = truncate(last.endStamp, dur) + dur\n  const diff = end - start\n  const n = Math.min(candles.length, screenW / spacingGuess)\n  const tick = truncate(diff / n, dur)\n  if (tick === 0) return console.error('zero tick', dur, diff, n) // probably won't happen, but it'd suck if it did\n  let x = start\n  const zoneOffset = new Date().getTimezoneOffset()\n  const dayStamp = x => {\n    x = x - zoneOffset * 60000\n    return x - (x % 86400000)\n  }\n  let lastDay = dayStamp(start)\n  let lastYear = 0 // new Date(start).getFullYear()\n  if (dayStamp(first) === dayStamp(last)) lastDay = 0 // Force at least one day stamp.\n  const pts = []\n  let label\n  if (dur < 86400000) {\n    label = (d, x) => {\n      const day = dayStamp(x)\n      if (day !== lastDay) return `${months[d.getMonth()]}${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`\n      else return `${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`\n    }\n  } else {\n    label = d => {\n      const year = d.getFullYear()\n      if (year !== lastYear) return `${months[d.getMonth()]}${d.getDate()} '${String(year).slice(2, 4)}`\n      else return `${months[d.getMonth()]}${d.getDate()}`\n    }\n  }\n  while (x <= end) {\n    const d = new Date(x)\n    pts.push({\n      val: x,\n      txt: label(d, x)\n    })\n    lastDay = dayStamp(x)\n    lastYear = d.getFullYear()\n    x += tick\n  }\n  return { lbls: pts }\n}\n\n/* The last element of an array. */\nfunction last (arr) {\n  return arr[arr.length - 1]\n}\n\n/* line draws a line with the provided context. */\nfunction line (ctx, x0, y0, x1, y1, skipStroke) {\n  ctx.beginPath()\n  ctx.moveTo(x0, y0)\n  ctx.lineTo(x1, y1)\n  if (!skipStroke) ctx.stroke()\n}\n\n/* dot draws a circle with the provided context. */\nfunction dot (ctx, x, y, color, radius) {\n  ctx.fillStyle = color\n  ctx.beginPath()\n  ctx.arc(x, y, radius, 0, PIPI)\n  ctx.fill()\n}\n\n/* clamp returns v if min <= v <= max, else min or max. */\nfunction clamp (v, min, max) {\n  if (v < min) return min\n  if (v > max) return max\n  return v\n}\n\n/* labelSpecs is specifications for axis tick labels. */\nconst labelSpecs = {\n  minimumSignificantDigits: 4,\n  maximumSignificantDigits: 5\n}\n\n/* formatLabelValue formats the provided value using the labelSpecs format. */\nfunction formatLabelValue (x) {\n  return x.toLocaleString('en-us', labelSpecs)\n}\n\n/* floatCompare compares two floats to within a tolerance of  1e-8. */\nfunction floatCompare (a, b) {\n  return withinTolerance(a, b, 1e-8)\n}\n\n/*\n * withinTolerance returns true if the difference between a and b are with\n * the specified tolerance.\n */\nfunction withinTolerance (a, b, tolerance) {\n  return Math.abs(a - b) < Math.abs(tolerance)\n}\n\nfunction truncate (v, w) {\n  return v - (v % w)\n}\n","import Doc from './doc'\nimport * as intl from './locales'\n\nexport const Limit = 1\nexport const Market = 2\nexport const CANCEL = 3\n\n/* The time-in-force specifiers are a mirror of dex/order.TimeInForce. */\nexport const ImmediateTiF = 0\nexport const StandingTiF = 1\n\n/* The order statuses are a mirror of dex/order.OrderStatus. */\nexport const StatusUnknown = 0\nexport const StatusEpoch = 1\nexport const StatusBooked = 2\nexport const StatusExecuted = 3\nexport const StatusCanceled = 4\nexport const StatusRevoked = 5\n\n/* The match statuses are a mirror of dex/order.MatchStatus. */\nexport const NewlyMatched = 0\nexport const MakerSwapCast = 1\nexport const TakerSwapCast = 2\nexport const MakerRedeemed = 3\nexport const MatchComplete = 4\n\n/* The match sides are a mirror of dex/order.MatchSide. */\nexport const Maker = 0\nexport const Taker = 1\n\nexport function sellString (ord) { return ord.sell ? 'sell' : 'buy' }\nexport function typeString (ord) { return ord.type === Limit ? (ord.tif === ImmediateTiF ? 'limit (i)' : 'limit') : 'market' }\nexport function rateString (ord) { return ord.type === Market ? 'market' : Doc.formatCoinValue(ord.rate / 1e8) }\n\n/* isMarketBuy will return true if the order is a market buy order. */\nexport function isMarketBuy (ord) {\n  return ord.type === Market && !ord.sell\n}\n\n/*\n * hasLiveMatches returns true if the order has matches that have not completed\n * settlement yet.\n */\nexport function hasLiveMatches (order) {\n  if (!order.matches) return false\n  for (const match of order.matches) {\n    if (!match.revoked && match.status < MakerRedeemed) return true\n  }\n  return false\n}\n\n/* statusString converts the order status to a string */\nexport function statusString (order) {\n  const isLive = hasLiveMatches(order)\n  switch (order.status) {\n    case StatusUnknown: return intl.prep(intl.ID_UNKNOWN)\n    case StatusEpoch: return intl.prep(intl.ID_EPOCH)\n    case StatusBooked:\n      if (order.cancelling) return intl.prep(intl.ID_CANCELING)\n      return isLive ? `${intl.prep(intl.ID_BOOKED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_BOOKED)\n    case StatusExecuted:\n      if (isLive) return intl.prep(intl.ID_SETTLING)\n      return (order.filled === 0) ? intl.prep(intl.ID_NO_MATCH) : intl.prep(intl.ID_EXECUTED)\n    case StatusCanceled:\n      return isLive ? `${intl.prep(intl.ID_CANCELED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_CANCELED)\n    case StatusRevoked:\n      return isLive ? `${intl.prep(intl.ID_REVOKED)}/${intl.prep(intl.ID_SETTLING)}` : intl.prep(intl.ID_REVOKED)\n  }\n}\n\n/* settled sums the quantities of the matches that have completed. */\nexport function settled (order) {\n  if (!order.matches) return 0\n  const qty = isMarketBuy(order) ? m => m.qty * m.rate * 1e-8 : m => m.qty\n  return order.matches.reduce((settled, match) => {\n    if (match.isCancel) return settled\n    const redeemed = (match.side === Maker && match.status >= MakerRedeemed) ||\n      (match.side === Taker && match.status >= MatchComplete)\n    return redeemed ? settled + qty(match) : settled\n  }, 0)\n}\n\n/*\n * matchStatusString is a string used to create a displayable string describing\n * describing the match status.\n */\nexport function matchStatusString (status, side) {\n  switch (status) {\n    case NewlyMatched:\n      return '(0 / 4) Newly Matched'\n    case MakerSwapCast:\n      return '(1 / 4) First Swap Sent'\n    case TakerSwapCast:\n      return '(2 / 4) Second Swap Sent'\n    case MakerRedeemed:\n      if (side === Maker) {\n        return 'Match Complete'\n      }\n      return '(3 / 4) Maker Redeemed'\n    case MatchComplete:\n      return 'Match Complete'\n  }\n  return 'Unknown Order Status'\n}\n","// MessageSocket is a WebSocket manager that uses the Decred DEX Mesage format\n// for communications.\n//\n// Message request format:\n// {\n//   route: 'name',\n//   id: int,\n//   payload: anything or nothing\n// }\n//\n// Message response payload will be a result object with either a valid 'result'\n// field or an 'error' field\n//\n// Functions for external use:\n// registerRoute (route, handler) -- register a function to handle events\n// of the given type\n// request (route, payload) -- create a JSON message in the above format and\n// send it\n//\n// Based on messagesocket_service.js by Jonathan Chappelow @ dcrdata, which is\n// based on ws_events_dispatcher.js by Ismael Celis\n\nconst typeRequest = 1\n\nfunction forward (route, payload, handlers) {\n  if (!route && payload.error) {\n    const err = payload.error\n    console.error(`websocket error (code ${err.code}): ${err.message}`)\n    return\n  }\n  if (typeof handlers[route] === 'undefined') {\n    // console.log(`unhandled message for ${route}: ${payload}`)\n    return\n  }\n  // call each handler\n  for (let i = 0; i < handlers[route].length; i++) {\n    handlers[route][i](payload)\n  }\n}\n\nlet id = 0\n\nclass MessageSocket {\n  constructor () {\n    this.uri = undefined\n    this.connection = undefined\n    this.handlers = {}\n    this.queue = []\n    this.maxQlength = 5\n  }\n\n  registerRoute (route, handler) {\n    this.handlers[route] = this.handlers[route] || []\n    this.handlers[route].push(handler)\n  }\n\n  deregisterRoute (route) {\n    this.handlers[route] = []\n  }\n\n  // request sends a request-type message to the server\n  request (route, payload) {\n    if (!this.connection || this.connection.readyState !== window.WebSocket.OPEN) {\n      while (this.queue.length > this.maxQlength - 1) this.queue.shift()\n      this.queue.push([route, payload])\n      return\n    }\n    id++\n    const message = JSON.stringify({\n      route: route,\n      type: typeRequest,\n      id: id,\n      payload: payload\n    })\n\n    window.log('ws', 'sending', message)\n    this.connection.send(message)\n  }\n\n  close (reason) {\n    window.log('ws', 'close, reason:', reason, this.handlers)\n    this.handlers = {}\n    this.connection.close()\n  }\n\n  connect (uri, reloader) {\n    this.uri = uri\n    this.reloader = reloader\n    let retrys = 0\n    const go = () => {\n      window.log('ws', `connecting to ${uri}`)\n      let conn = this.connection = new window.WebSocket(uri)\n      const timeout = setTimeout(() => {\n        // readyState is still WebSocket.CONNECTING. Cancel and trigger onclose.\n        conn.close()\n      }, 500)\n\n      // unmarshal message, and forward the message to registered handlers\n      conn.onmessage = (evt) => {\n        const message = JSON.parse(evt.data)\n        forward(message.route, message.payload, this.handlers)\n      }\n\n      // Stub out standard functions\n      conn.onclose = (evt) => {\n        window.log('ws', 'onclose')\n        clearTimeout(timeout)\n        conn = this.connection = null\n        forward('close', null, this.handlers)\n        retrys++\n        // 1.2, 1.6, 2.0, 2.4, 3.1, 3.8, 4.8, 6.0, 7.5, 9.3, ...\n        const delay = Math.min(Math.pow(1.25, retrys), 10)\n        console.error(`websocket disconnected (${evt.code}), trying again in ${delay.toFixed(1)} seconds`)\n        setTimeout(() => {\n          go()\n        }, delay * 1000)\n      }\n\n      conn.onopen = () => {\n        window.log('ws', 'onopen')\n        clearTimeout(timeout)\n        if (retrys > 0) {\n          retrys = 0\n          reloader()\n        }\n        forward('open', null, this.handlers)\n        const queue = this.queue\n        this.queue = []\n        for (const [route, message] of queue) {\n          this.request(route, message)\n        }\n      }\n\n      conn.onerror = (evt) => {\n        window.log('ws', 'onerror:', evt)\n        forward('error', evt, this.handlers)\n      }\n    }\n    go()\n  }\n}\n\nconst ws = new MessageSocket()\nexport default ws\n","import Doc, { WalletIcons } from './doc'\nimport State from './state'\nimport BasePage from './basepage'\nimport OrderBook from './orderbook'\nimport { CandleChart, DepthChart } from './charts'\nimport { postJSON } from './http'\nimport { NewWalletForm, UnlockWalletForm, bind as bindForm } from './forms'\nimport * as Order from './orderutil'\nimport ws from './ws'\nimport * as intl from './locales'\n\nlet app\nconst bind = Doc.bind\n\nconst bookRoute = 'book'\nconst bookOrderRoute = 'book_order'\nconst unbookOrderRoute = 'unbook_order'\nconst updateRemainingRoute = 'update_remaining'\nconst epochOrderRoute = 'epoch_order'\nconst candlesRoute = 'candles'\nconst candleUpdateRoute = 'candle_update'\nconst unmarketRoute = 'unmarket'\n\nconst lastMarketKey = 'selectedMarket'\nconst chartRatioKey = 'chartRatio'\nconst depthZoomKey = 'depthZoom'\n\nconst animationLength = 500\n\nconst anHour = 60 * 60 * 1000 // milliseconds\n\nconst depthChart = 'depth_chart'\nconst candleChart = 'candle_chart'\n\nconst check = document.createElement('span')\ncheck.classList.add('ico-check')\n\nexport default class MarketsPage extends BasePage {\n  constructor (application, main, data) {\n    super()\n    app = application\n    const page = this.page = Doc.parsePage(main, [\n      // Templates, loaders, chart div...\n      'marketLoader', 'marketList', 'rowTemplate', 'buyRows', 'sellRows',\n      'marketSearch', 'rightSide',\n      // Registration status\n      'registrationStatus', 'regStatusTitle', 'regStatusMessage', 'regStatusConfsDisplay',\n      'regStatusDex', 'confReq',\n      // Order form\n      'orderForm', 'priceBox', 'buyBttn', 'sellBttn', 'limitBttn', 'marketBttn',\n      'tifBox', 'submitBttn', 'qtyField', 'rateField', 'orderErr',\n      'baseWalletIcons', 'quoteWalletIcons', 'lotSize', 'rateStep', 'lotField',\n      'tifNow', 'mktBuyBox', 'mktBuyLots', 'mktBuyField', 'minMktBuy', 'qtyBox',\n      'loaderMsg', 'balanceTable', 'orderPreview',\n      // Wallet unlock form\n      'forms', 'openForm', 'uwAppPass',\n      // Order submission is verified with the user's password.\n      'verifyForm', 'vHeader', 'vSideHeader', 'vSide', 'vQty', 'vBase', 'vRate',\n      'vTotal', 'vQuote', 'vPass', 'vSideSubmit', 'vBaseSubmit', 'vSubmit',\n      'vLoader', 'verifyLimit', 'verifyMarket',\n      'vmTotal', 'vmAsset', 'vmLots', 'mktBuyScore', 'vErr',\n      // Create wallet form\n      'walletForm',\n      // Active orders\n      'liveTemplate', 'liveList', 'liveTable',\n      // Cancel order form\n      'cancelForm', 'cancelRemain', 'cancelUnit', 'cancelPass', 'cancelSubmit',\n      // Chart and legend\n      'marketChart', 'chartResizer', 'sellBookedBase', 'sellBookedQuote',\n      'buyBookedBase', 'buyBookedQuote', 'hoverData', 'hoverPrice',\n      'hoverVolume', 'chartLegend', 'chartErrMsg', 'candlestickBttn',\n      'depthBttn', 'epochLine', 'durBttnTemplate', 'durBttnBox',\n      'depthHoverData', 'candleHoverData', 'candleHigh', 'candleLow',\n      'candleStart', 'candleEnd', 'candleVol', 'depthSummary',\n      // Max order section\n      'maxOrd', 'maxLbl', 'maxFromLots', 'maxFromAmt', 'maxFromTicker',\n      'maxToAmt', 'maxToTicker', 'maxAboveZero', 'maxLotBox', 'maxFromLotsLbl',\n      'maxBox'\n    ])\n    this.main = main\n    this.loaded = app.loading(this.main.parentElement)\n    this.maxLoaded = null\n    // There may be multiple pending updates to the max order. This makes sure\n    // that the screen is updated with the most recent one.\n    this.maxOrderUpdateCounter = 0\n    this.market = null\n    this.registrationStatus = {}\n    this.currentForm = null\n    this.openAsset = null\n    this.openFunc = null\n    this.currentCreate = null\n    this.preorderTimer = null\n    this.book = null\n    this.cancelData = null\n    this.metaOrders = {}\n    this.depthLines = {\n      hover: [],\n      input: []\n    }\n    this.activeMarkerRate = null\n    this.hovers = []\n    // 'Your Orders' list sort key and direction.\n    this.ordersSortKey = 'stamp'\n    // 1 if sorting ascendingly, -1 if sorting descendingly.\n    this.ordersSortDirection = 1\n    // store original title so we can re-append it when updating market value.\n    this.ogTitle = document.title\n\n    const depthReporters = {\n      click: p => { this.reportDepthClick(p) },\n      volume: d => { this.reportDepthVolume(d) },\n      mouse: d => { this.reportDepthMouse(d) },\n      zoom: z => { this.reportDepthZoom(z) }\n    }\n    this.depthChart = new DepthChart(page.marketChart, depthReporters, State.fetch(depthZoomKey))\n\n    const candleReporters = {\n      mouse: c => { this.reportMouseCandle(c) }\n    }\n    this.candleChart = new CandleChart(page.marketChart, candleReporters)\n\n    // TODO: Store user's state and reload last known configuration.\n    this.candleChart.hide()\n    this.currentChart = depthChart\n    this.candleDur = ''\n\n    // Set up the BalanceWidget.\n    {\n      const wgt = this.balanceWgt = new BalanceWidget(page.balanceTable)\n      const baseIcons = wgt.base.stateIcons.icons\n      const quoteIcons = wgt.quote.stateIcons.icons\n      bind(wgt.base.connect, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(wgt.quote.connect, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(wgt.base.expired, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(wgt.quote.expired, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(baseIcons.sleeping, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(quoteIcons.sleeping, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(baseIcons.locked, 'click', () => { this.showOpen(this.market.base, this.walletUnlocked) })\n      bind(quoteIcons.locked, 'click', () => { this.showOpen(this.market.quote, this.walletUnlocked) })\n      bind(wgt.base.newWalletBttn, 'click', () => { this.showCreate(this.market.base) })\n      bind(wgt.quote.newWalletBttn, 'click', () => { this.showCreate(this.market.quote) })\n    }\n\n    // Prepare templates for the buy and sell tables and the user's order table.\n    cleanTemplates(page.rowTemplate, page.liveTemplate, page.durBttnTemplate)\n\n    // Prepare the list of markets.\n    this.marketList = new MarketList(page.marketList)\n    for (const xc of this.marketList.xcSections) {\n      for (const mkt of xc.marketRows) {\n        bind(mkt.row, 'click', () => {\n          this.setMarket(xc.host, mkt.baseID, mkt.quoteID)\n        })\n      }\n    }\n\n    // Store the elements that need their ticker changed when the market\n    // changes.\n    this.quoteUnits = main.querySelectorAll('[data-unit=quote]')\n    this.baseUnits = main.querySelectorAll('[data-unit=base]')\n\n    // Buttons to set order type and side.\n    bind(page.buyBttn, 'click', () => {\n      swapBttns(page.sellBttn, page.buyBttn)\n      page.submitBttn.classList.remove('sellred')\n      page.submitBttn.classList.add('buygreen')\n      page.maxLbl.textContent = intl.prep(intl.ID_BUY)\n      this.setOrderBttnText()\n      this.setOrderVisibility()\n      this.drawChartLines()\n    })\n    bind(page.sellBttn, 'click', () => {\n      swapBttns(page.buyBttn, page.sellBttn)\n      page.submitBttn.classList.add('sellred')\n      page.submitBttn.classList.remove('buygreen')\n      page.maxLbl.textContent = intl.prep(intl.ID_SELL)\n      this.setOrderBttnText()\n      this.setOrderVisibility()\n      this.drawChartLines()\n    })\n    bind(page.limitBttn, 'click', () => {\n      swapBttns(page.marketBttn, page.limitBttn)\n      this.setOrderVisibility()\n      if (!page.rateField.value) return\n      this.depthLines.input = [{\n        rate: page.rateField.value,\n        color: this.isSell() ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n      }]\n      this.drawChartLines()\n    })\n    bind(page.marketBttn, 'click', () => {\n      swapBttns(page.limitBttn, page.marketBttn)\n      this.setOrderVisibility()\n      this.setMarketBuyOrderEstimate()\n      this.depthLines.input = []\n      this.drawChartLines()\n    })\n    bind(page.maxOrd, 'click', () => {\n      if (this.isSell()) page.lotField.value = this.market.maxSell.swap.lots\n      else page.lotField.value = this.market.maxBuys[this.adjustedRate()].swap.lots\n      this.lotChanged()\n    })\n    bind(page.depthBttn, 'click', () => {\n      this.depthChartSelected()\n    })\n    bind(page.candlestickBttn, 'click', () => {\n      this.candleChartSelected()\n    })\n\n    Doc.disableMouseWheel(page.rateField, page.lotField, page.qtyField, page.mktBuyField)\n\n    // Handle the full orderbook sent on the 'book' route.\n    ws.registerRoute(bookRoute, data => { this.handleBookRoute(data) })\n    // Handle the new order for the order book on the 'book_order' route.\n    ws.registerRoute(bookOrderRoute, data => { this.handleBookOrderRoute(data) })\n    // Remove the order sent on the 'unbook_order' route from the orderbook.\n    ws.registerRoute(unbookOrderRoute, data => { this.handleUnbookOrderRoute(data) })\n    // Update the remaining quantity on a booked order.\n    ws.registerRoute(updateRemainingRoute, data => { this.handleUpdateRemainingRoute(data) })\n    // Handle the new order for the order book on the 'epoch_order' route.\n    ws.registerRoute(epochOrderRoute, data => { this.handleEpochOrderRoute(data) })\n    // Handle the intial candlestick data on the 'candles' route.\n    ws.registerRoute(candleUpdateRoute, data => { this.handleCandleUpdateRoute(data) })\n    // Handle the candles update on the 'candles' route.\n    ws.registerRoute(candlesRoute, data => { this.handleCandlesRoute(data) })\n    // Bind the wallet unlock form.\n    this.unlockForm = new UnlockWalletForm(app, page.openForm, async () => { this.openFunc() })\n    // Create a wallet\n    this.walletForm = new NewWalletForm(app, page.walletForm, async () => { this.createWallet() })\n    // Main order form.\n    bindForm(page.orderForm, page.submitBttn, async () => { this.stepSubmit() })\n    // Order verification form.\n    bindForm(page.verifyForm, page.vSubmit, async () => { this.submitOrder() })\n    // Cancel order form.\n    bindForm(page.cancelForm, page.cancelSubmit, async () => { this.submitCancel() })\n    // Bind active orders list's header sort events.\n    page.liveTable.querySelectorAll('[data-ordercol]')\n      .forEach(th => bind(th, 'click', () => setOrdersSortCol(th.dataset.ordercol)))\n\n    const setOrdersSortCol = (key) => {\n      // First unset header's current sorted col classes.\n      unsetOrdersSortColClasses()\n      // If already sorting by key change sort direction.\n      if (this.ordersSortKey === key) {\n        this.ordersSortDirection *= -1\n      } else {\n        // Otherwise update sort key and set default direction to ascending.\n        this.ordersSortKey = key\n        this.ordersSortDirection = 1\n      }\n      this.refreshActiveOrders()\n      // Set header's new sorted col classes.\n      setOrdersSortColClasses()\n    }\n\n    const sortClassByDirection = () => {\n      if (this.ordersSortDirection === 1) return 'sorted-asc'\n      return 'sorted-dsc'\n    }\n\n    const unsetOrdersSortColClasses = () => {\n      page.liveTable.querySelectorAll('[data-ordercol]')\n        .forEach(th => th.classList.remove('sorted-asc', 'sorted-dsc'))\n    }\n\n    const setOrdersSortColClasses = () => {\n      const key = this.ordersSortKey\n      const sortCls = sortClassByDirection()\n      page.liveTable.querySelector(`[data-ordercol=${key}]`).classList.add(sortCls)\n    }\n\n    // Set default's sorted col header classes.\n    setOrdersSortColClasses()\n\n    const closePopups = () => {\n      Doc.hide(page.forms)\n      page.vPass.value = ''\n      page.cancelPass.value = ''\n    }\n\n    // If the user clicks outside of a form, it should close the page overlay.\n    bind(page.forms, 'mousedown', e => {\n      if (!Doc.mouseInElement(e, this.currentForm)) {\n        closePopups()\n      }\n    })\n\n    this.keyup = e => {\n      if (e.key === 'Escape') {\n        closePopups()\n      }\n    }\n    bind(document, 'keyup', this.keyup)\n\n    page.forms.querySelectorAll('.form-closer').forEach(el => {\n      Doc.bind(el, 'click', () => { closePopups() })\n    })\n\n    // Event listeners for interactions with the various input fields.\n    bind(page.lotField, 'change', () => { this.lotChanged() })\n    bind(page.lotField, 'keyup', () => { this.lotChanged() })\n    bind(page.qtyField, 'change', () => { this.quantityChanged(true) })\n    bind(page.qtyField, 'keyup', () => { this.quantityChanged(false) })\n    bind(page.mktBuyField, 'change', () => { this.marketBuyChanged() })\n    bind(page.mktBuyField, 'keyup', () => { this.marketBuyChanged() })\n    bind(page.rateField, 'change', () => { this.rateFieldChanged() })\n    bind(page.rateField, 'keyup', () => { this.previewQuoteAmt(true) })\n\n    // Market search input bindings.\n    bind(page.marketSearch, 'change', () => { this.filterMarkets() })\n    bind(page.marketSearch, 'keyup', () => { this.filterMarkets() })\n\n    const clearChartLines = () => {\n      this.depthLines.hover = []\n      this.drawChartLines()\n    }\n    bind(page.buyRows, 'mouseleave', clearChartLines)\n    bind(page.sellRows, 'mouseleave', clearChartLines)\n    bind(page.liveList, 'mouseleave', () => {\n      this.activeMarkerRate = null\n      this.setDepthMarkers()\n    })\n\n    // Load the user's layout preferences.\n    const setChartRatio = r => {\n      if (r > 0.7) r = 0.7\n      else if (r < 0.25) r = 0.25\n\n      const h = r * (this.main.clientHeight - app.header.offsetHeight)\n      page.marketChart.style.height = `${h}px`\n\n      this.depthChart.resize(h)\n      this.candleChart.resize(h)\n    }\n    const chartDivRatio = State.fetch(chartRatioKey)\n    if (chartDivRatio) {\n      setChartRatio(chartDivRatio)\n    }\n    // Bind chart resizing.\n    bind(page.chartResizer, 'mousedown', e => {\n      if (e.button !== 0) return\n      e.preventDefault()\n      let chartRatio\n      const trackMouse = ee => {\n        ee.preventDefault()\n        const box = page.rightSide.getBoundingClientRect()\n        const h = box.bottom - box.top\n        chartRatio = (ee.pageY - box.top) / h\n        setChartRatio(chartRatio)\n      }\n      bind(document, 'mousemove', trackMouse)\n      bind(document, 'mouseup', () => {\n        if (chartRatio) State.store(chartRatioKey, chartRatio)\n        Doc.unbind(document, 'mousemove', trackMouse)\n      })\n    })\n\n    // Notification filters.\n    this.notifiers = {\n      order: note => { this.handleOrderNote(note) },\n      epoch: note => { this.handleEpochNote(note) },\n      conn: note => { this.handleConnNote(note) },\n      balance: note => { this.handleBalanceNote(note) },\n      feepayment: note => { this.handleFeePayment(note) },\n      walletstate: note => { this.handleWalletStateNote(note) }\n    }\n\n    // Fetch the first market in the list, or the users last selected market, if\n    // it exists.\n    let selected\n    if (data && data.host && typeof data.base !== 'undefined' && typeof data.quote !== 'undefined') {\n      selected = makeMarket(data.host, parseInt(data.base), parseInt(data.quote))\n    } else {\n      selected = State.fetch(lastMarketKey)\n    }\n    if (!selected || !this.marketList.exists(selected.host, selected.base, selected.quote)) {\n      selected = this.marketList.first()\n    }\n    this.setMarket(selected.host, selected.base, selected.quote)\n\n    // Start a ticker to update time-since values.\n    this.secondTicker = setInterval(() => {\n      for (const metaOrder of Object.values(this.metaOrders)) {\n        const td = Doc.tmplElement(metaOrder.row, 'age')\n        td.textContent = Doc.timeSince(metaOrder.order.stamp)\n      }\n    }, 1000)\n\n    // set the initial state for the registration status\n    this.setRegistrationStatusVisibility()\n    this.setBalanceVisibility()\n  }\n\n  /* isSell is true if the user has selected sell in the order options. */\n  isSell () {\n    return this.page.sellBttn.classList.contains('selected')\n  }\n\n  /* isLimit is true if the user has selected the \"limit order\" tab. */\n  isLimit () {\n    return this.page.limitBttn.classList.contains('selected')\n  }\n\n  /* hasFeePending is true if the fee payment is pending */\n  hasFeePending () {\n    return !!this.market.dex.pendingFee\n  }\n\n  /* assetsAreSupported is true if all the assets of the current market are\n   * supported\n   */\n  assetsAreSupported () {\n    const [b, q] = [this.market.base, this.market.quote]\n    return b && q\n  }\n\n  /*\n   * setOrderVisibility sets which form is visible based on the specified\n   * options.\n   */\n  setOrderVisibility () {\n    const page = this.page\n    if (this.isLimit()) {\n      Doc.show(page.priceBox, page.tifBox, page.qtyBox, page.maxBox)\n      Doc.hide(page.mktBuyBox)\n      this.previewQuoteAmt(true)\n    } else {\n      Doc.hide(page.tifBox, page.maxBox, page.priceBox)\n      if (this.isSell()) {\n        Doc.hide(page.mktBuyBox)\n        Doc.show(page.qtyBox)\n        this.previewQuoteAmt(true)\n      } else {\n        Doc.show(page.mktBuyBox)\n        Doc.hide(page.qtyBox)\n        this.previewQuoteAmt(false)\n      }\n    }\n  }\n\n  /* resolveOrderFormVisibility displays or hides the 'orderForm' based on\n   * a set of conditions to be met.\n   */\n  resolveOrderFormVisibility () {\n    const page = this.page\n    // By default the order form should be hidden, and only if market is set\n    // and ready for trading the form should show up.\n    Doc.hide(page.orderForm)\n    const feePaid = !this.hasFeePending()\n    const assetsAreSupported = this.assetsAreSupported()\n    const base = this.market.base\n    const quote = this.market.quote\n    const hasWallets = base && app.assets[base.id].wallet && quote && app.assets[quote.id].wallet\n\n    if (feePaid && assetsAreSupported && hasWallets) {\n      Doc.show(page.orderForm)\n    }\n  }\n\n  /* setLoaderMsgVisibility displays a message in case a dex asset is not\n   * supported\n   */\n  setLoaderMsgVisibility () {\n    const page = this.page\n    const { base, quote } = this.market\n\n    if (this.assetsAreSupported()) {\n      // make sure to hide the loader msg\n      Doc.hide(page.loaderMsg)\n      return\n    }\n    const symbol = (!base && this.market.baseCfg.symbol) || (!quote && this.market.quoteCfg.symbol)\n\n    page.loaderMsg.textContent = intl.prep(intl.ID_NOT_SUPPORTED, { asset: symbol.toUpperCase() })\n    Doc.show(page.loaderMsg)\n  }\n\n  /* setRegistrationStatusView sets the text content and class for the\n   * registration status view\n   */\n  setRegistrationStatusView (titleContent, confStatusMsg, titleClass) {\n    const page = this.page\n    page.regStatusTitle.textContent = titleContent\n    page.regStatusConfsDisplay.textContent = confStatusMsg\n    page.registrationStatus.classList.remove('completed', 'error', 'waiting')\n    page.registrationStatus.classList.add(titleClass)\n  }\n\n  /*\n   * updateRegistrationStatusView updates the view based on the current\n   * registration status\n   */\n  updateRegistrationStatusView () {\n    const { page, market: { dex } } = this\n    page.regStatusDex.textContent = dex.host\n\n    const pending = dex.pendingFee\n    if (!pending) {\n      this.setRegistrationStatusView(intl.prep(intl.ID_REGISTRATION_FEE_SUCCESS), '', 'completed')\n      return\n    }\n\n    const confirmationsRequired = dex.regFees[pending.symbol].confs\n    page.confReq.textContent = confirmationsRequired\n    const confStatusMsg = `${pending.confs} / ${confirmationsRequired}`\n    this.setRegistrationStatusView(intl.prep(intl.ID_WAITING_FOR_CONFS), confStatusMsg, 'waiting')\n  }\n\n  /*\n   * setRegistrationStatusVisibility toggles the registration status view based\n   * on the dex data.\n   */\n  setRegistrationStatusVisibility () {\n    const { page, market: { dex } } = this\n\n    // If dex is not connected to server, is not possible to know fee\n    // registration status.\n    if (!dex.connected) return\n\n    this.updateRegistrationStatusView()\n\n    if (dex.pendingFee) {\n      Doc.show(page.registrationStatus)\n    } else {\n      const toggle = () => {\n        Doc.hide(page.registrationStatus)\n        this.resolveOrderFormVisibility()\n      }\n      if (Doc.isHidden(page.orderForm)) {\n        // wait a couple of seconds before showing the form so the success\n        // message is shown to the user\n        setTimeout(toggle, 5000)\n        return\n      }\n      toggle()\n    }\n  }\n\n  setOrderBttnText () {\n    if (this.isSell()) {\n      this.page.submitBttn.textContent = intl.prep(intl.ID_SET_BUTTON_SELL, { asset: this.market.base.symbol.toUpperCase() })\n    } else this.page.submitBttn.textContent = intl.prep(intl.ID_SET_BUTTON_BUY, { asset: this.market.base.symbol.toUpperCase() })\n  }\n\n  setCandleDurBttns () {\n    const { page, market } = this\n    Doc.empty(page.durBttnBox)\n    for (const dur of market.dex.candleDurs) {\n      const bttn = page.durBttnTemplate.cloneNode(true)\n      bttn.textContent = dur\n      Doc.bind(bttn, 'click', () => this.candleDurationSelected(dur))\n      page.durBttnBox.appendChild(bttn)\n    }\n  }\n\n  /* setMarket sets the currently displayed market. */\n  async setMarket (host, base, quote) {\n    const dex = app.user.exchanges[host]\n    const page = this.page\n    // If we have not yet connected, there is no dex.assets or any other\n    // exchange data, so just put up a message and wait for the connection to be\n    // established, at which time handleConnNote will refresh and reload.\n    if (!dex.connected) {\n      this.market = { dex: dex }\n      page.chartErrMsg.textContent = intl.prep(intl.ID_CONNECTION_FAILED)\n      Doc.show(page.chartErrMsg)\n      this.loaded()\n      this.main.style.opacity = 1\n      Doc.hide(page.marketLoader)\n      return\n    }\n\n    const baseCfg = dex.assets[base]\n    const quoteCfg = dex.assets[quote]\n    Doc.hide(page.maxOrd, page.chartErrMsg)\n    if (this.preorderTimer) {\n      window.clearTimeout(this.preorderTimer)\n      this.preorderTimer = null\n    }\n    const mktId = marketID(baseCfg.symbol, quoteCfg.symbol)\n    this.market = {\n      dex: dex,\n      sid: mktId, // A string market identifier used by the DEX.\n      cfg: dex.markets[mktId],\n      // app.assets is a map of core.SupportedAsset type, which can be found at\n      // client/core/types.go.\n      base: app.assets[base],\n      quote: app.assets[quote],\n      // dex.assets is a map of dex.Asset type, which is defined at\n      // dex/asset.go.\n      baseCfg: baseCfg,\n      quoteCfg: quoteCfg,\n      maxSell: null,\n      maxBuys: {},\n      candleCaches: {}\n    }\n\n    Doc.show(page.marketLoader)\n    if (!dex.candleDurs || dex.candleDurs.length === 0) this.currentChart = depthChart\n    if (this.currentChart === depthChart) ws.request('loadmarket', makeMarket(host, base, quote))\n    else {\n      if (dex.candleDurs.indexOf(this.candleDur) === -1) this.candleDur = dex.candleDurs[0]\n      this.loadCandles()\n    }\n    this.setLoaderMsgVisibility()\n    this.setRegistrationStatusVisibility()\n    this.resolveOrderFormVisibility()\n    this.setOrderBttnText()\n    this.setCandleDurBttns()\n  }\n\n  /*\n   * reportDepthClick is a callback used by the DepthChart when the user clicks\n   * on the chart area. The rate field is set to the x-value of the click.\n   */\n  reportDepthClick (p) {\n    this.page.rateField.value = p.toFixed(8)\n    this.rateFieldChanged()\n  }\n\n  /*\n   * reportDepthVolume accepts a volume report from the DepthChart and sets the\n   * values in the chart legend.\n   */\n  reportDepthVolume (d) {\n    const page = this.page\n    page.sellBookedBase.textContent = Doc.formatCoinValue(d.sellBase)\n    page.sellBookedQuote.textContent = Doc.formatCoinValue(d.sellQuote)\n    page.buyBookedBase.textContent = Doc.formatCoinValue(d.buyBase)\n    page.buyBookedQuote.textContent = Doc.formatCoinValue(d.buyQuote)\n  }\n\n  /*\n   * reportDepthMouse accepts informations about the mouse position on the\n   * chart area.\n   */\n  reportDepthMouse (d) {\n    while (this.hovers.length) this.hovers.shift().classList.remove('hover')\n    const page = this.page\n    if (!d) {\n      Doc.hide(page.hoverData)\n      return\n    }\n\n    // If the user is hovered to within a small percent (based on chart width)\n    // of a user order, highlight that order's row.\n    const markers = d.hoverMarkers.map(v => Math.round(v * 1e8))\n    for (const metaOrd of Object.values(this.metaOrders)) {\n      const [row, ord] = [metaOrd.row, metaOrd.order]\n      if (ord.status !== Order.StatusBooked) continue\n      if (markers.indexOf(ord.rate) > -1) {\n        row.classList.add('hover')\n        this.hovers.push(row)\n      }\n    }\n\n    page.hoverPrice.textContent = Doc.formatCoinValue(d.rate)\n    page.hoverVolume.textContent = Doc.formatCoinValue(d.depth)\n    page.hoverVolume.style.color = d.dotColor\n    Doc.show(page.hoverData)\n  }\n\n  /*\n   * reportDepthZoom accepts informations about the current depth chart zoom level.\n   * This information is saved to disk so that the zoom level can be maintained\n   * across reloads.\n   */\n  reportDepthZoom (zoom) {\n    State.store(depthZoomKey, zoom)\n  }\n\n  reportMouseCandle (candle) {\n    const page = this.page\n    if (!candle) {\n      Doc.hide(page.hoverData)\n      return\n    }\n\n    page.candleStart.textContent = Doc.formatCoinValue(candle.startRate / 1e8)\n    page.candleEnd.textContent = Doc.formatCoinValue(candle.endRate / 1e8)\n    page.candleHigh.textContent = Doc.formatCoinValue(candle.highRate / 1e8)\n    page.candleLow.textContent = Doc.formatCoinValue(candle.lowRate / 1e8)\n    page.candleVol.textContent = Doc.formatCoinValue(candle.matchVolume / 1e8)\n    Doc.show(page.hoverData)\n  }\n\n  /*\n   * parseOrder pulls the order information from the form fields. Data is not\n   * validated in any way.\n   */\n  parseOrder () {\n    const page = this.page\n    let qtyField = page.qtyField\n    const limit = this.isLimit()\n    const sell = this.isSell()\n    const market = this.market\n    if (!limit && !sell) {\n      qtyField = page.mktBuyField\n    }\n    return {\n      host: market.dex.host,\n      isLimit: limit,\n      sell: sell,\n      base: market.base.id,\n      quote: market.quote.id,\n      qty: asAtoms(qtyField.value),\n      rate: asAtoms(page.rateField.value), // message-rate\n      tifnow: page.tifNow.checked\n    }\n  }\n\n  /**\n   * previewQuoteAmt shows quote amount when rate or quantity input are changed\n   */\n  previewQuoteAmt (show) {\n    const page = this.page\n    const order = this.parseOrder()\n    const adjusted = this.adjustedRate()\n    page.orderErr.textContent = ''\n    if (adjusted) {\n      if (order.sell) this.preSell()\n      else this.preBuy()\n    }\n    this.depthLines.input = []\n    if (adjusted && this.isLimit()) {\n      this.depthLines.input = [{\n        rate: order.rate / 1e8,\n        color: order.sell ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n      }]\n    }\n    this.drawChartLines()\n    if (!show || !adjusted || !order.qty) {\n      page.orderPreview.textContent = ''\n      this.drawChartLines()\n      return\n    }\n    const quoteAsset = app.assets[order.quote]\n    const total = Doc.formatCoinValue(order.rate / 1e8 * order.qty / 1e8)\n    page.orderPreview.textContent = intl.prep(intl.ID_ORDER_PREVIEW, { total, asset: quoteAsset.symbol.toUpperCase() })\n    if (this.isSell()) this.preSell()\n    else this.preBuy()\n  }\n\n  /**\n   * preSell populates the max order message for the largest available sell.\n   */\n  preSell () {\n    this.maxOrderUpdateCounter++\n    const mkt = this.market\n    const baseWallet = app.assets[mkt.base.id].wallet\n    if (baseWallet.available < mkt.cfg.lotsize) {\n      this.setMaxOrder({ lots: 0 }, this.adjustedRate() / 1e8)\n      return\n    }\n    if (mkt.maxSell) {\n      this.setMaxOrder(mkt.maxSell.swap, this.adjustedRate() / 1e8)\n      return\n    }\n    // We only fetch pre-sell once per balance update, so don't delay.\n    this.schedulePreOrder('/api/maxsell', {}, 0, res => {\n      mkt.maxSell = res.maxSell\n      mkt.sellBalance = baseWallet.balance.available\n      this.setMaxOrder(res.maxSell.swap, this.adjustedRate() / 1e8)\n    })\n  }\n\n  /**\n   * preBuy populates the max order message for the largest available buy.\n   */\n  preBuy () {\n    this.maxOrderUpdateCounter++\n    const mkt = this.market\n    const rate = this.adjustedRate()\n    const quoteWallet = app.assets[mkt.quote.id].wallet\n    const aLot = mkt.cfg.lotsize * (rate / 1e8)\n    if (quoteWallet.balance.available < aLot) {\n      this.setMaxOrder({ lots: 0 }, 1e8 / rate)\n      return\n    }\n    if (mkt.maxBuys[rate]) {\n      this.setMaxOrder(mkt.maxBuys[rate].swap, 1e8 / rate)\n      return\n    }\n    // 0 delay for first fetch after balance update or market change, otherwise\n    // meter these at 1 / sec.\n    const delay = mkt.maxBuys ? 1000 : 0\n    this.schedulePreOrder('/api/maxbuy', { rate: rate }, delay, res => {\n      mkt.maxBuys[rate] = res.maxBuy\n      mkt.buyBalance = app.assets[mkt.quote.id].wallet.balance.available\n      this.setMaxOrder(res.maxBuy.swap, 1e8 / rate)\n    })\n  }\n\n  /**\n   * schedulePreorder shows the loading icon and schedules a call to an order\n   * estimate api endpoint. If another call to schedulePreorder is made before\n   * this one is fired (after delay), this call will be canceled.\n   */\n  schedulePreOrder (path, args, delay, success) {\n    const page = this.page\n    if (!this.maxLoaded) this.maxLoaded = app.loading(page.maxOrd)\n    const [bid, qid] = [this.market.base.id, this.market.quote.id]\n    const [bWallet, qWallet] = [app.assets[bid].wallet, app.assets[qid].wallet]\n    if (!bWallet || !bWallet.running || !qWallet || !qWallet.running) return\n    if (this.preorderTimer) window.clearTimeout(this.preorderTimer)\n\n    Doc.show(page.maxOrd, page.maxLotBox)\n    Doc.hide(page.maxAboveZero)\n    page.maxFromLots.textContent = intl.prep(intl.ID_CALCULATING)\n    page.maxFromLotsLbl.textContent = ''\n    const counter = this.maxOrderUpdateCounter\n    this.preorderTimer = window.setTimeout(async () => {\n      this.preorderTimer = null\n      if (counter !== this.maxOrderUpdateCounter) return\n      const res = await postJSON(path, {\n        host: this.market.dex.host,\n        base: bid,\n        quote: qid,\n        ...args\n      })\n      if (counter !== this.maxOrderUpdateCounter) return\n      if (!app.checkResponse(res, true)) {\n        console.warn('max order estimate not available:', res)\n        page.maxFromLots.textContent = intl.prep(intl.ID_ESTIMATE_UNAVAILABLE)\n        if (this.maxLoaded) {\n          this.maxLoaded()\n          this.maxLoaded = null\n        }\n        return\n      }\n      success(res)\n    }, delay)\n  }\n\n  /* setMaxOrder sets the max order text. */\n  setMaxOrder (maxOrder, rate) {\n    const page = this.page\n    if (this.maxLoaded) {\n      this.maxLoaded()\n      this.maxLoaded = null\n    }\n    Doc.show(page.maxOrd, page.maxLotBox, page.maxAboveZero)\n    const sell = this.isSell()\n    page.maxFromLots.textContent = maxOrder.lots.toString()\n    // XXX add plural into format details, so we don't need this\n    page.maxFromLotsLbl.textContent = maxOrder.lots === 1 ? 'lot' : 'lots'\n    if (maxOrder.lots === 0) {\n      Doc.hide(page.maxAboveZero)\n      return\n    }\n    // Could add the maxOrder.estimatedFees here, but that might also be\n    // confusing.\n    page.maxFromAmt.textContent = Doc.formatCoinValue(maxOrder.value / 1e8)\n    page.maxFromTicker.textContent = sell ? this.market.base.symbol : this.market.quote.symbol.toUpperCase()\n    // Could subtract the maxOrder.redemptionFees here.\n    page.maxToAmt.textContent = Doc.formatCoinValue(maxOrder.value / 1e8 * rate)\n    page.maxToTicker.textContent = sell ? this.market.quote.symbol : this.market.base.symbol.toUpperCase()\n  }\n\n  /*\n   * validateOrder performs some basic order sanity checks, returning boolean\n   * true if the order appears valid.\n   */\n  validateOrder (order) {\n    const page = this.page\n    if (order.isLimit && !order.rate) {\n      Doc.show(page.orderErr)\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ZERO_RATE)\n      return false\n    }\n    if (!order.qty) {\n      Doc.show(page.orderErr)\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ZERO_QUANTITY)\n      return false\n    }\n    return true\n  }\n\n  /* handleBook accepts the data sent in the 'book' notification. */\n  handleBook (data) {\n    const [b, q] = [this.market.baseCfg, this.market.quoteCfg]\n    this.book = new OrderBook(data, b.symbol, q.symbol)\n    this.loadTable()\n    for (const order of (data.book.epoch || [])) {\n      if (order.rate > 0) this.book.add(order)\n      this.addTableOrder(order)\n    }\n    if (!this.book) {\n      this.depthChart.clear()\n      Doc.empty(this.page.buyRows)\n      Doc.empty(this.page.sellRows)\n      return\n    }\n    this.depthChart.set(this.book, this.market.cfg.lotsize, this.market.cfg.ratestep)\n  }\n\n  /*\n   * midGap returns the value in the middle of the best buy and best sell. If\n   * either one of the buy or sell sides are empty, midGap returns the best\n   * rate from the other side. If both sides are empty, midGap returns the\n   * value null.\n   */\n  midGap () {\n    const book = this.book\n    if (!book) return\n    if (book.buys && book.buys.length) {\n      if (book.sells && book.sells.length) {\n        return (book.buys[0].rate + book.sells[0].rate) / 2\n      }\n      return book.buys[0].rate\n    }\n    if (book.sells && book.sells.length) {\n      return book.sells[0].rate\n    }\n    return null\n  }\n\n  /*\n   * setMarketBuyOrderEstimate sets the \"min. buy\" display for the current\n   * market.\n   */\n  setMarketBuyOrderEstimate () {\n    const market = this.market\n    const lotSize = market.cfg.lotsize\n    const xc = app.user.exchanges[market.dex.host]\n    const buffer = xc.markets[market.sid].buybuffer\n    const gap = this.midGap()\n    if (gap) {\n      this.page.minMktBuy.textContent = Doc.formatCoinValue(lotSize * buffer * gap / 1e8)\n    }\n  }\n\n  /*\n   * ordersSortCompare returns sort compare function according to the active\n   * sort key and direction.\n   */\n  ordersSortCompare () {\n    switch (this.ordersSortKey) {\n      case 'stamp':\n        return (a, b) => this.ordersSortDirection * (b.stamp - a.stamp)\n      case 'rate':\n        return (a, b) => this.ordersSortDirection * (a.rate - b.rate)\n      case 'qty':\n        return (a, b) => this.ordersSortDirection * (a.qty - b.qty)\n      case 'type':\n        return (a, b) => this.ordersSortDirection *\n          Order.typeString(a).localeCompare(Order.typeString(b))\n      case 'sell':\n        return (a, b) => this.ordersSortDirection *\n          (Order.sellString(a)).localeCompare(Order.sellString(b))\n      case 'status':\n        return (a, b) => this.ordersSortDirection *\n          (Order.statusString(a)).localeCompare(Order.statusString(b))\n      case 'settled':\n        return (a, b) => this.ordersSortDirection *\n          ((Order.settled(a) * 100 / a.qty) - (Order.settled(b) * 100 / b.qty))\n      case 'filled':\n        return (a, b) => this.ordersSortDirection *\n          ((a.filled * 100 / a.qty) - (b.filled * 100 / b.qty))\n    }\n  }\n\n  /* refreshActiveOrders refreshes the user's active order list. */\n  refreshActiveOrders () {\n    const page = this.page\n    const metaOrders = this.metaOrders\n    const market = this.market\n    for (const oid in metaOrders) delete metaOrders[oid]\n    const orders = app.orders(market.dex.host, marketID(market.baseCfg.symbol, market.quoteCfg.symbol))\n    // Sort orders by sort key.\n    const compare = this.ordersSortCompare()\n    orders.sort(compare)\n\n    Doc.empty(page.liveList)\n    for (const ord of orders) {\n      const row = page.liveTemplate.cloneNode(true)\n      metaOrders[ord.id] = {\n        row: row,\n        order: ord\n      }\n      Doc.bind(row, 'mouseenter', e => {\n        this.activeMarkerRate = ord.rate\n        this.setDepthMarkers()\n      })\n      updateUserOrderRow(row, ord)\n      if (ord.type === Order.Limit && (ord.tif === Order.StandingTiF && ord.status < Order.StatusExecuted)) {\n        const icon = Doc.tmplElement(row, 'cancelBttn')\n        Doc.show(icon)\n        bind(icon, 'click', e => {\n          e.stopPropagation()\n          this.showCancel(row, ord.id)\n        })\n      }\n      const side = Doc.tmplElement(row, 'side')\n      side.classList.add(ord.sell ? 'sellcolor' : 'buycolor')\n      const link = Doc.tmplElement(row, 'link')\n      link.href = `order/${ord.id}`\n      app.bindInternalNavigation(row)\n      page.liveList.appendChild(row)\n      app.bindTooltips(row)\n    }\n    this.setDepthMarkers()\n  }\n\n  /* setDepthMarkers sets the depth chart markers for booked orders. */\n  setDepthMarkers () {\n    const markers = {\n      buys: [],\n      sells: []\n    }\n    for (const mo of Object.values(this.metaOrders)) {\n      const ord = mo.order\n      if (ord.rate && ord.status === Order.StatusBooked) {\n        if (ord.sell) {\n          markers.sells.push({\n            rate: ord.rate / 1e8,\n            active: ord.rate === this.activeMarkerRate\n          })\n        } else {\n          markers.buys.push({\n            rate: ord.rate / 1e8,\n            active: ord.rate === this.activeMarkerRate\n          })\n        }\n      }\n    }\n    this.depthChart.setMarkers(markers)\n    if (this.book) this.depthChart.draw()\n  }\n\n  /* updateTitle update the browser title based on the midgap value and the\n   * selected assets.\n   */\n  updateTitle () {\n    // gets first price value from buy or from sell, so we can show it on\n    // title.\n    const midGapValue = this.midGap()\n    if (!midGapValue) return\n\n    const market = this.market\n    const [b, q] = [market.baseCfg, market.quoteCfg]\n    const baseSymb = b.symbol.toUpperCase()\n    const quoteSymb = q.symbol.toUpperCase()\n    // more than 6 numbers it gets too big for the title.\n    document.title = `${midGapValue.toFixed(6)} | ${baseSymb}${quoteSymb} | ${this.ogTitle}`\n  }\n\n  /* handleBookRoute is the handler for the 'book' notification, which is sent\n   * in response to a new market subscription. The data received will contain\n   * the entire order book.\n   */\n  handleBookRoute (note) {\n    app.log('book', 'handleBookRoute:', note)\n    const mktBook = note.payload\n    const market = this.market\n    const page = this.page\n    const host = market.dex.host\n    const [b, q] = [market.baseCfg, market.quoteCfg]\n    if (mktBook.base !== b.id || mktBook.quote !== q.id) return\n    this.refreshActiveOrders()\n    this.handleBook(mktBook)\n    this.updateTitle()\n    Doc.hide(page.marketLoader)\n    this.marketList.select(host, b.id, q.id)\n\n    State.store(lastMarketKey, {\n      host: note.host,\n      base: mktBook.base,\n      quote: mktBook.quote\n    })\n\n    page.lotSize.textContent = Doc.formatCoinValue(market.cfg.lotsize / 1e8)\n    page.rateStep.textContent = market.cfg.ratestep / 1e8\n    this.baseUnits.forEach(el => { el.textContent = b.symbol.toUpperCase() })\n    this.quoteUnits.forEach(el => { el.textContent = q.symbol.toUpperCase() })\n    this.balanceWgt.setWallets(host, b.id, q.id)\n    this.setMarketBuyOrderEstimate()\n    this.refreshActiveOrders()\n    if (this.loaded) {\n      this.loaded()\n      this.loaded = null\n      Doc.animate(250, progress => {\n        this.main.style.opacity = progress\n      })\n    }\n  }\n\n  /* handleBookOrderRoute is the handler for 'book_order' notifications. */\n  handleBookOrderRoute (data) {\n    app.log('book', 'handleBookOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload\n    if (order.rate > 0) this.book.add(order)\n    this.addTableOrder(order)\n    this.updateTitle()\n    this.depthChart.draw()\n  }\n\n  /* handleUnbookOrderRoute is the handler for 'unbook_order' notifications. */\n  handleUnbookOrderRoute (data) {\n    app.log('book', 'handleUnbookOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload\n    this.book.remove(order.token)\n    this.removeTableOrder(order)\n    this.updateTitle()\n    this.depthChart.draw()\n  }\n\n  /*\n   * handleUpdateRemainingRoute is the handler for 'update_remaining'\n   * notifications.\n   */\n  handleUpdateRemainingRoute (data) {\n    app.log('book', 'handleUpdateRemainingRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const update = data.payload\n    this.book.updateRemaining(update.token, update.qty)\n    this.updateTableOrder(update)\n    this.depthChart.draw()\n  }\n\n  /* handleEpochOrderRoute is the handler for 'epoch_order' notifications. */\n  handleEpochOrderRoute (data) {\n    app.log('book', 'handleEpochOrderRoute:', data)\n    if (data.host !== this.market.dex.host || data.marketID !== this.market.sid) return\n    const order = data.payload\n    if (order.rate > 0) this.book.add(order) // No cancels or market orders\n    if (order.qty > 0) this.addTableOrder(order) // No cancel orders\n    this.depthChart.draw()\n  }\n\n  /* handleCandlesRoute is the handler for 'candles' notifications. */\n  handleCandlesRoute (data) {\n    if (this.candlesLoading) {\n      clearTimeout(this.candlesLoading.timer)\n      this.candlesLoading.loaded()\n      this.candlesLoading = null\n    }\n    this.depthChart.hide()\n    this.candleChart.show()\n    if (data.host !== this.market.dex.host) return\n    const dur = data.payload.dur\n    this.market.candleCaches[dur] = data.payload\n    if (this.currentChart !== candleChart || this.candleDur !== dur) return\n    this.candleChart.setCandles(data.payload, this.market.cfg)\n  }\n\n  /* handleCandleUpdateRoute is the handler for 'candle_update' notifications. */\n  handleCandleUpdateRoute (data) {\n    if (data.host !== this.market.dex.host) return\n    const { dur, candle } = data.payload\n    const cache = this.market.candleCaches[dur]\n    if (!cache) return // must not have seen the 'candles' notification yet?\n    const candles = cache.candles\n    if (candles.length === 0) candles.push(candle)\n    else {\n      const last = candles[candles.length - 1]\n      if (last.startStamp === candle.startStamp) candles[candles.length - 1] = candle\n      else candles.push(candle)\n    }\n    if (this.currentChart !== candleChart || this.candleDur !== dur) return\n    this.candleChart.draw()\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form) {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(page.openForm, page.verifyForm, page.walletForm, page.cancelForm)\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0'\n  }\n\n  /* showOpen shows the form to unlock a wallet. */\n  async showOpen (asset, f) {\n    const page = this.page\n    this.openAsset = asset\n    this.openFunc = f\n    this.unlockForm.setAsset(app.assets[asset.id])\n    this.showForm(page.openForm)\n    page.uwAppPass.focus()\n  }\n\n  /* showVerify shows the form to accept the currently parsed order information\n   * and confirm submission of the order to the dex.\n   */\n  showVerify () {\n    const page = this.page\n    const order = this.parseOrder()\n    const isSell = order.sell\n    const baseAsset = app.assets[order.base]\n    const quoteAsset = app.assets[order.quote]\n    const toAsset = isSell ? quoteAsset : baseAsset\n    const fromAsset = isSell ? baseAsset : quoteAsset\n\n    page.vQty.textContent = Doc.formatCoinValue(order.qty / 1e8)\n    page.vSideHeader.textContent = isSell ? intl.prep(intl.ID_SELL) : intl.prep(intl.ID_BUY)\n    page.vSideSubmit.textContent = page.vSideHeader.textContent\n    page.vBaseSubmit.textContent = baseAsset.symbol.toUpperCase()\n    if (order.isLimit) {\n      Doc.show(page.verifyLimit)\n      Doc.hide(page.verifyMarket)\n      page.vRate.textContent = Doc.formatCoinValue(order.rate / 1e8)\n      page.vQuote.textContent = quoteAsset.symbol.toUpperCase()\n      page.vTotal.textContent = Doc.formatCoinValue(order.rate / 1e8 * order.qty / 1e8)\n      page.vBase.textContent = baseAsset.symbol.toUpperCase()\n      page.vSide.textContent = isSell ? intl.prep(intl.ID_SELL).toLowerCase() : intl.prep(intl.ID_BUY).toLowerCase()\n    } else {\n      Doc.hide(page.verifyLimit)\n      Doc.show(page.verifyMarket)\n      page.vSide.textContent = intl.prep(intl.ID_TRADE)\n      page.vBase.textContent = fromAsset.symbol.toUpperCase()\n      const gap = this.midGap()\n      if (gap) {\n        const received = order.sell ? order.qty * gap : order.qty / gap\n        const lotSize = this.market.cfg.lotsize\n        const lots = order.sell ? order.qty / lotSize : received / lotSize\n        // TODO: Some kind of adjustment to align with lot sizes for market buy?\n        page.vmTotal.textContent = Doc.formatCoinValue(received / 1e8)\n        page.vmAsset.textContent = toAsset.symbol.toUpperCase()\n        page.vmLots.textContent = lots.toFixed(1)\n      } else {\n        Doc.hide(page.verifyMarket)\n      }\n    }\n    // Visually differentiate between buy/sell orders.\n    const buyBtnClass = 'buygreen'\n    const sellBtnClass = 'sellred'\n    if (isSell) {\n      page.vHeader.classList.add(sellBtnClass)\n      page.vHeader.classList.remove(buyBtnClass)\n      page.vSubmit.classList.add(sellBtnClass)\n      page.vSubmit.classList.remove(buyBtnClass)\n    } else {\n      page.vHeader.classList.add(buyBtnClass)\n      page.vHeader.classList.remove(sellBtnClass)\n      page.vSubmit.classList.add(buyBtnClass)\n      page.vSubmit.classList.remove(sellBtnClass)\n    }\n    this.showForm(page.verifyForm)\n    page.vPass.focus()\n  }\n\n  async submitCancel () {\n    // this will be the page.cancelSubmit button (evt.currentTarget)\n    const page = this.page\n    const cancelData = this.cancelData\n    const order = cancelData.order\n    const req = {\n      orderID: order.id,\n      pw: page.cancelPass.value\n    }\n    page.cancelPass.value = ''\n    const res = await postJSON('/api/cancel', req)\n    if (!app.checkResponse(res)) return\n    Doc.hide(cancelData.bttn, page.forms)\n    order.cancelling = true\n  }\n\n  /* showCancel shows a form to confirm submission of a cancel order. */\n  showCancel (row, orderID) {\n    const order = this.metaOrders[orderID].order\n    const page = this.page\n    const remaining = order.qty - order.filled\n    page.cancelRemain.textContent = Doc.formatCoinValue(remaining / 1e8)\n    const symbol = Order.isMarketBuy(order) ? this.market.quote.symbol : this.market.base.symbol\n    page.cancelUnit.textContent = symbol.toUpperCase()\n    this.showForm(page.cancelForm)\n    page.cancelPass.focus()\n    this.cancelData = {\n      bttn: Doc.tmplElement(row, 'cancelBttn'),\n      order: order\n    }\n  }\n\n  /* showCreate shows the new wallet creation form. */\n  showCreate (asset) {\n    const page = this.page\n    this.currentCreate = asset\n    this.walletForm.setAsset(asset.id)\n    this.showForm(page.walletForm)\n    this.walletForm.loadDefaults()\n  }\n\n  /*\n   * stepSubmit will examine the current state of wallets and step the user\n   * through the process of order submission.\n   * NOTE: I expect this process will be streamlined soon such that the wallets\n   * will attempt to be unlocked in the order submission process, negating the\n   * need to unlock ahead of time.\n   */\n  stepSubmit () {\n    const page = this.page\n    const market = this.market\n    Doc.hide(page.orderErr)\n    if (!this.validateOrder(this.parseOrder())) return\n    const baseWallet = app.walletMap[market.base.id]\n    const quoteWallet = app.walletMap[market.quote.id]\n    if (!baseWallet) {\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ASSET_WALLET, { asset: market.base.symbol })\n      Doc.show(page.orderErr)\n      return\n    }\n    if (!quoteWallet) {\n      page.orderErr.textContent = intl.prep(intl.ID_NO_ASSET_WALLET, { asset: market.quote.symbol })\n      Doc.show(page.orderErr)\n      return\n    }\n    this.showVerify()\n  }\n\n  /*\n   * handleWalletStateNote is the handler for the 'walletstate' notification\n   * type.\n   */\n  handleWalletStateNote (note) {\n    this.balanceWgt.updateAsset(note.wallet.assetID)\n  }\n\n  /*\n   * handleFeePayment is the handler for the 'feepayment' notification type.\n   * This is used to update the registration status of the current exchange.\n   */\n  handleFeePayment (note) {\n    const dexAddr = note.dex\n    if (dexAddr !== this.market.dex.host) return\n    // update local dex\n    this.market.dex = app.exchanges[dexAddr]\n    this.setRegistrationStatusVisibility()\n  }\n\n  /*\n   * handleOrderNote is the handler for the 'order'-type notification, which are\n   * used to update a user's order's status.\n   */\n  handleOrderNote (note) {\n    const order = note.order\n    const metaOrder = this.metaOrders[order.id]\n    // If metaOrder doesn't exist for the given order it means it was\n    // created via dexcctl and the GUI isn't aware of it.\n    // Call refreshActiveOrders to grab the order.\n    if (!metaOrder) return this.refreshActiveOrders()\n    const oldStatus = metaOrder.status\n    metaOrder.order = order\n    const bttn = Doc.tmplElement(metaOrder.row, 'cancelBttn')\n    if (note.topic === 'MissedCancel') {\n      Doc.show(bttn)\n    }\n    if (order.filled === order.qty) {\n      // Remove the cancellation button.\n      Doc.hide(bttn)\n    }\n    updateUserOrderRow(metaOrder.row, order)\n    // Only reset markers if there is a change, since the chart is redrawn.\n    if ((oldStatus === Order.StatusEpoch && order.status === Order.StatusBooked) ||\n      (oldStatus === Order.StatusBooked && order.status > Order.StatusBooked)) this.setDepthMarkers()\n  }\n\n  /*\n   * handleEpochNote handles notifications signalling the start of a new epoch.\n   */\n  handleEpochNote (note) {\n    app.log('book', 'handleEpochNote:', note)\n    if (note.host !== this.market.dex.host || note.marketID !== this.market.sid) return\n    if (this.book) {\n      this.book.setEpoch(note.epoch)\n      this.depthChart.draw()\n    }\n\n    this.clearOrderTableEpochs(note.epoch)\n    for (const metaOrder of Object.values(this.metaOrders)) {\n      const order = metaOrder.order\n      const alreadyMatched = note.epoch > order.epoch\n      const statusTD = Doc.tmplElement(metaOrder.row, 'status')\n      switch (true) {\n        case order.type === Order.Limit && order.status === Order.StatusEpoch && alreadyMatched:\n          statusTD.textContent = order.tif === Order.ImmediateTiF ? intl.prep(intl.ID_EXECUTED) : intl.prep(intl.ID_BOOKED)\n          order.status = order.tif === Order.ImmediateTiF ? Order.StatusExecuted : Order.StatusBooked\n          break\n        case order.type === Order.Market && order.status === Order.StatusEpoch:\n          // Technically don't know if this should be 'executed' or 'settling'.\n          statusTD.textContent = intl.prep(intl.ID_EXECUTED)\n          order.status = Order.StatusExecuted\n          break\n      }\n    }\n  }\n\n  setBalanceVisibility () {\n    if (this.market.dex.connected) {\n      Doc.show(this.page.balanceTable)\n    } else {\n      Doc.hide(this.page.balanceTable)\n    }\n  }\n\n  /* handleBalanceNote handles notifications updating a wallet's balance. */\n  handleBalanceNote (note) {\n    this.setBalanceVisibility()\n    // if connection to dex server fails, it is not possible to retrieve\n    // markets.\n    if (!this.market.dex.connected) return\n    this.balanceWgt.updateAsset(note.assetID)\n    // If there's a balance update, refresh the max order section.\n    const mkt = this.market\n    const avail = note.balance.available\n    switch (note.assetID) {\n      case mkt.base.id:\n        // If we're not showing the max order panel yet, don't do anything.\n        if (!mkt.maxSell) break\n        if (typeof mkt.sellBalance === 'number' && mkt.sellBalance !== avail) mkt.maxSell = null\n        if (this.isSell()) this.preSell()\n        break\n      case mkt.quote.id:\n        if (!Object.keys(mkt.maxBuys).length) break\n        if (typeof mkt.buyBalance === 'number' && mkt.buyBalance !== avail) mkt.maxBuys = {}\n        if (!this.isSell()) this.preBuy()\n    }\n  }\n\n  /*\n   * submitOrder is attached to the affirmative button on the order validation\n   * form. Clicking the button is the last step in the order submission process.\n   */\n  async submitOrder () {\n    const page = this.page\n    Doc.hide(page.orderErr, page.vErr)\n    const order = this.parseOrder()\n    const pw = page.vPass.value\n    page.vPass.value = ''\n    const req = {\n      order: order,\n      pw: pw\n    }\n    if (!this.validateOrder(order)) return\n    // Show loader and hide submit button.\n    page.vSubmit.classList.add('d-hide')\n    page.vLoader.classList.remove('d-hide')\n    const res = await postJSON('/api/trade', req)\n    // Hide loader and show submit button.\n    page.vSubmit.classList.remove('d-hide')\n    page.vLoader.classList.add('d-hide')\n    // If errors display error on confirmation modal.\n    if (!app.checkResponse(res, true)) {\n      page.vErr.textContent = res.msg\n      Doc.show(page.vErr)\n      return\n    }\n    // Hide confirmation modal only on success.\n    Doc.hide(page.forms)\n    this.refreshActiveOrders()\n    this.depthChart.draw()\n  }\n\n  /*\n   * createWallet is attached to successful submission of the wallet creation\n   * form. createWallet is only called once the form is submitted and a success\n   * response is received from the client.\n   */\n  async createWallet () {\n    const user = await app.fetchUser()\n    const asset = user.assets[this.currentCreate.id]\n    Doc.hide(this.page.forms)\n    this.balanceWgt.updateAsset(asset.id)\n    this.resolveOrderFormVisibility()\n  }\n\n  /*\n   * walletUnlocked is attached to successful submission of the wallet unlock\n   * form. walletUnlocked is only called once the form is submitted and a\n   * success response is received from the client.\n   */\n  async walletUnlocked () {\n    Doc.hide(this.page.forms)\n    this.balanceWgt.updateAsset(this.openAsset.id)\n  }\n\n  /* lotChanged is attached to the keyup and change events of the lots input. */\n  lotChanged () {\n    const page = this.page\n    const lots = parseInt(page.lotField.value)\n    if (lots <= 0) {\n      page.lotField.value = 0\n      page.qtyField.value = ''\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    page.lotField.value = lots\n    page.qtyField.value = (lots * lotSize / 1e8)\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * quantityChanged is attached to the keyup and change events of the quantity\n   * input.\n   */\n  quantityChanged (finalize) {\n    const page = this.page\n    const order = this.parseOrder()\n    if (order.qty <= 0) {\n      page.lotField.value = 0\n      page.qtyField.value = ''\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    const lots = Math.floor(order.qty / lotSize)\n    const adjusted = lots * lotSize\n    page.lotField.value = lots\n    if (!order.isLimit && !order.sell) return\n    if (finalize) page.qtyField.value = (adjusted / 1e8)\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * marketBuyChanged is attached to the keyup and change events of the quantity\n   * input for the market-buy form.\n   */\n  marketBuyChanged () {\n    const page = this.page\n    const qty = asAtoms(page.mktBuyField.value)\n    const gap = this.midGap()\n    if (!gap || !qty) {\n      page.mktBuyLots.textContent = '0'\n      page.mktBuyScore.textContent = '0'\n      return\n    }\n    const lotSize = this.market.cfg.lotsize\n    const received = qty / gap\n    page.mktBuyLots.textContent = (received / lotSize).toFixed(1)\n    page.mktBuyScore.textContent = Doc.formatCoinValue(received / 1e8)\n  }\n\n  /*\n   * rateFieldChanged is attached to the keyup and change events of the rate\n   * input.\n   */\n  rateFieldChanged () {\n    // Truncate to rate step. If it is a market buy order, do not adjust.\n    const adjusted = this.adjustedRate()\n    if (adjusted <= 0) {\n      this.depthLines.input = []\n      this.drawChartLines()\n      this.page.rateField.value = 0\n      return\n    }\n    const order = this.parseOrder()\n    const v = (adjusted / 1e8)\n    this.page.rateField.value = v\n    this.depthLines.input = [{\n      rate: v,\n      color: order.sell ? this.depthChart.theme.sellLine : this.depthChart.theme.buyLine\n    }]\n    this.drawChartLines()\n    this.previewQuoteAmt(true)\n  }\n\n  /*\n   * adjustedRate is the current rate field rate, rounded down to a\n   * multiple of rateStep.\n   */\n  adjustedRate () {\n    const v = this.page.rateField.value\n    if (!v) return null\n    const rate = asAtoms(v)\n    const rateStep = this.market.cfg.ratestep\n    return rate - (rate % rateStep)\n  }\n\n  /* loadTable reloads the table from the current order book information. */\n  loadTable () {\n    this.loadTableSide(true)\n    this.loadTableSide(false)\n  }\n\n  /* binOrdersByRateAndEpoch takes a list of sorted orders and returns the\n     same orders grouped into arrays. The orders are grouped by their rate\n     and whether or not they are epoch queue orders. Epoch queue orders\n     will come after non epoch queue orders with the same rate. */\n  binOrdersByRateAndEpoch (orders) {\n    if (!orders || !orders.length) return []\n    const bins = []\n    let currEpochBin = []\n    let currNonEpochBin = []\n    let currRate = orders[0].rate\n    if (orders[0].epoch) currEpochBin.push(orders[0])\n    else currNonEpochBin.push(orders[0])\n    for (let i = 1; i < orders.length; i++) {\n      if (orders[i].rate !== currRate) {\n        bins.push(currNonEpochBin)\n        bins.push(currEpochBin)\n        currEpochBin = []\n        currNonEpochBin = []\n        currRate = orders[i].rate\n      }\n      if (orders[i].epoch) currEpochBin.push(orders[i])\n      else currNonEpochBin.push(orders[i])\n    }\n    bins.push(currNonEpochBin)\n    bins.push(currEpochBin)\n    return bins.filter(bin => bin.length > 0)\n  }\n\n  /* loadTables loads the order book side into its table. */\n  loadTableSide (sell) {\n    const bookSide = sell ? this.book.sells : this.book.buys\n    const tbody = sell ? this.page.sellRows : this.page.buyRows\n    Doc.empty(tbody)\n    if (!bookSide || !bookSide.length) return\n    const orderBins = this.binOrdersByRateAndEpoch(bookSide)\n    orderBins.forEach(bin => { tbody.appendChild(this.orderTableRow(bin)) })\n  }\n\n  /* addTableOrder adds a single order to the appropriate table. */\n  addTableOrder (order) {\n    const tbody = order.sell ? this.page.sellRows : this.page.buyRows\n    let row = tbody.firstChild\n    // Handle market order differently.\n    if (order.rate === 0) {\n      // This is a market order.\n      if (row && row.manager.getRate() === 0) {\n        row.manager.insertOrder(order)\n      } else {\n        row = this.orderTableRow([order])\n        tbody.insertBefore(row, tbody.firstChild)\n      }\n      return\n    }\n    // Must be a limit order. Sort by rate. Skip the market order row.\n    if (row && row.manager.getRate() === 0) row = row.nextSibling\n    while (row) {\n      if (row.manager.compare(order) === 0) {\n        row.manager.insertOrder(order)\n        return\n      } else if (row.manager.compare(order) > 0) {\n        const tr = this.orderTableRow([order])\n        tbody.insertBefore(tr, row)\n        return\n      }\n      row = row.nextSibling\n    }\n    const tr = this.orderTableRow([order])\n    tbody.appendChild(tr)\n  }\n\n  /* removeTableOrder removes a single order from its table. */\n  removeTableOrder (order) {\n    const token = order.token\n    for (const tbody of [this.page.sellRows, this.page.buyRows]) {\n      for (const tr of Array.from(tbody.children)) {\n        if (tr.manager.removeOrder(token)) {\n          return\n        }\n      }\n    }\n  }\n\n  /* updateTableOrder looks for the order in the table and updates the qty */\n  updateTableOrder (update) {\n    const token = update.token\n    const qty = update.qty\n    for (const tbody of [this.page.sellRows, this.page.buyRows]) {\n      for (const tr of Array.from(tbody.children)) {\n        if (tr.manager.updateOrderQty(token, qty)) {\n          return\n        }\n      }\n    }\n  }\n\n  /*\n   * clearOrderTableEpochs removes immediate-tif orders whose epoch has expired.\n   */\n  clearOrderTableEpochs (newEpoch) {\n    this.clearOrderTableEpochSide(this.page.sellRows)\n    this.clearOrderTableEpochSide(this.page.buyRows)\n  }\n\n  /*\n   * clearOrderTableEpochs removes immediate-tif orders whose epoch has expired\n   * for a single side.\n   */\n  clearOrderTableEpochSide (tbody, newEpoch) {\n    for (const tr of Array.from(tbody.children)) {\n      tr.manager.removeEpochOrders()\n    }\n  }\n\n  /*\n   * orderTableRow creates a new <tr> element to insert into an order table.\n     Takes a bin of orders with the same rate, and displays the total quantity.\n   */\n  orderTableRow (orderBin) {\n    const tr = this.page.rowTemplate.cloneNode(true)\n    const manager = new OrderTableRowManager(tr, orderBin)\n    tr.manager = manager\n    bind(tr, 'click', () => {\n      this.reportDepthClick(tr.manager.getRate())\n    })\n    if (tr.manager.getRate() !== 0) {\n      Doc.bind(tr, 'mouseenter', e => {\n        const chart = this.depthChart\n        this.depthLines.hover = [{\n          rate: tr.manager.getRate(),\n          color: tr.manager.isSell() ? chart.theme.sellLine : chart.theme.buyLine\n        }]\n        this.drawChartLines()\n      })\n    }\n    return tr\n  }\n\n  /* handleConnNote handles the 'conn' notification.\n   */\n  async handleConnNote (note) {\n    this.marketList.setConnectionStatus(note)\n    if (note.connected) {\n      // Having been disconnected from a DEX server, anything may have changed,\n      // or this may be the first opportunity to get the server's config, so\n      // fetch it all before reloading the markets page.\n      await app.fetchUser()\n      app.loadPage('markets')\n    }\n  }\n\n  /*\n   * filterMarkets sets the display of markets in the markets list based on the\n   * value of the search input.\n   */\n  filterMarkets () {\n    const filterTxt = this.page.marketSearch.value\n    const filter = filterTxt ? mkt => mkt.name.includes(filterTxt) : () => true\n    this.marketList.setFilter(filter)\n  }\n\n  /* drawChartLines draws the hover and input lines on the chart. */\n  drawChartLines () {\n    this.depthChart.setLines([...this.depthLines.hover, ...this.depthLines.input])\n    this.depthChart.draw()\n  }\n\n  /*\n   * depthChartSelected is called when the user clicks a button to show the\n   * depth chart.\n  */\n  depthChartSelected () {\n    const page = this.page\n    Doc.hide(page.depthBttn, page.durBttnBox, page.candleHoverData)\n    Doc.show(page.candlestickBttn, page.epochLine, page.depthHoverData, page.depthSummary)\n    this.currentChart = depthChart\n    this.depthChart.show()\n    this.candleChart.hide()\n  }\n\n  /*\n   * candleChartSelected is called when the user clicks a button to show the\n   * historical market data (candlestick) chart.\n  */\n  candleChartSelected () {\n    const page = this.page\n    const dex = this.market.dex\n    this.currentChart = candleChart\n    Doc.hide(page.candlestickBttn, page.epochLine, page.depthHoverData, page.depthSummary)\n    Doc.show(page.depthBttn, page.durBttnBox, page.candleHoverData)\n    if (dex.candleDurs.indexOf(this.candleDur) === -1) this.candleDur = dex.candleDurs[0]\n    this.loadCandles()\n  }\n\n  /* candleDurationSelected sets the candleDur and loads the candles. */\n  candleDurationSelected (dur) {\n    this.candleDur = dur\n    this.loadCandles()\n  }\n\n  /*\n   * loadCandles loads the candles for the current candleDur. If a cache is already\n   * active, the cache will be used without a loadcandles request.\n   */\n  loadCandles () {\n    for (const bttn of this.page.durBttnBox.children) {\n      if (bttn.textContent === this.candleDur) bttn.classList.add('selected')\n      else bttn.classList.remove('selected')\n    }\n    const { candleCaches, cfg } = this.market\n    const cache = candleCaches[this.candleDur]\n    if (cache) {\n      this.depthChart.hide()\n      this.candleChart.show()\n      this.candleChart.setCandles(cache, cfg)\n      return\n    }\n    this.requestCandles()\n  }\n\n  /* requestCandles sends the loadcandles request. */\n  requestCandles () {\n    this.candlesLoading = {\n      loaded: () => { Doc.hide(this.page.marketLoader) },\n      timer: setTimeout(() => {\n        if (this.candlesLoading) {\n          this.candlesLoading = null\n          Doc.hide(this.page.marketLoader)\n          console.error('candles not received')\n        }\n      }, 10000)\n    }\n    const { dex, base, quote } = this.market\n    ws.request('loadcandles', { host: dex.host, base: base.id, quote: quote.id, dur: this.candleDur })\n  }\n\n  /*\n   * unload is called by the Application when the user navigates away from\n   * the /markets page.\n   */\n  unload () {\n    ws.request(unmarketRoute, {})\n    ws.deregisterRoute(bookRoute)\n    ws.deregisterRoute(epochOrderRoute)\n    ws.deregisterRoute(bookOrderRoute)\n    ws.deregisterRoute(unbookOrderRoute)\n    ws.deregisterRoute(candlesRoute)\n    ws.deregisterRoute(candleUpdateRoute)\n    this.depthChart.unattach()\n    this.candleChart.unattach()\n    Doc.unbind(document, 'keyup', this.keyup)\n    clearInterval(this.secondTicker)\n  }\n}\n\n/*\n *  MarketList represents the list of exchanges and markets on the left side of\n * markets view. The MarketList provides utilities for adjusting the visibility\n * and sort order of markets.\n */\nclass MarketList {\n  constructor (div) {\n    this.selected = null\n    const xcTmpl = Doc.tmplElement(div, 'xc')\n    cleanTemplates(xcTmpl)\n    this.xcSections = []\n    for (const dex of Object.values(app.user.exchanges)) {\n      this.xcSections.push(new ExchangeSection(xcTmpl, dex))\n    }\n    // Initial sort is alphabetical.\n    for (const xc of this.sortedSections()) {\n      div.appendChild(xc.box)\n    }\n  }\n\n  /*\n   * sortedSections returns a list of ExchangeSection sorted alphabetically by\n   * host.\n   */\n  sortedSections () {\n    return [...this.xcSections].sort((a, b) => a.host < b.host ? -1 : 1)\n  }\n\n  /*\n   * xcSection is a getter for the ExchangeSection for a specified host.\n   */\n  xcSection (host) {\n    for (const xc of this.xcSections) {\n      if (xc.host === host) return xc\n    }\n    return null\n  }\n\n  /* exists will be true if the specified market exists. */\n  exists (host, baseID, quoteID) {\n    const xc = this.xcSection(host)\n    if (!xc) return false\n    for (const mkt of xc.marketRows) {\n      if (mkt.baseID === baseID && mkt.quoteID === quoteID) return true\n    }\n    return false\n  }\n\n  /* first gets the first market from the first exchange, alphabetically. */\n  first () {\n    const firstXC = this.sortedSections()[0]\n    const firstMkt = firstXC.first()\n    // Cannot find markets if server connection failed.\n    if (!firstMkt) return makeMarket(firstXC.host)\n    return makeMarket(firstXC.host, firstMkt.baseID, firstMkt.quoteID)\n  }\n\n  /* select sets the specified market as selected. */\n  select (host, baseID, quoteID) {\n    if (this.selected) this.selected.row.classList.remove('selected')\n    this.selected = this.xcSection(host).marketRow(baseID, quoteID)\n    this.selected.row.classList.add('selected')\n  }\n\n  /* setConnectionStatus sets the visibility of the disconnected icon based\n   * on the core.ConnEventNote.\n   */\n  setConnectionStatus (note) {\n    this.xcSection(note.host).setConnected(note.connected)\n  }\n\n  /*\n   * setFilter sets the visibility of market rows based on the provided filter.\n   */\n  setFilter (filter) {\n    for (const xc of this.xcSections) {\n      xc.setFilter(filter)\n    }\n  }\n}\n\n/*\n * ExchangeSection is a top level section of the MarketList.\n */\nclass ExchangeSection {\n  constructor (tmpl, dex) {\n    this.dex = dex\n    this.host = dex.host\n    const box = tmpl.cloneNode(true)\n    this.box = box\n    const header = Doc.tmplElement(box, 'header')\n    this.disconnectedIcon = Doc.tmplElement(header, 'disconnected')\n    if (dex.connected) Doc.hide(this.disconnectedIcon)\n    header.append(dex.host)\n\n    this.marketRows = []\n    this.rows = Doc.tmplElement(box, 'mkts')\n    const rowTmpl = Doc.tmplElement(this.rows, 'mktrow')\n    this.rows.removeChild(rowTmpl)\n    // If disconnected is not possible to get the markets from the server.\n    if (!dex.markets) return\n\n    for (const mkt of Object.values(dex.markets)) {\n      this.marketRows.push(new MarketRow(rowTmpl, mkt))\n    }\n    for (const market of this.sortedMarkets()) {\n      this.rows.appendChild(market.row)\n    }\n  }\n\n  /*\n   * sortedMarkets is the list of MarketRow sorted alphabetically by the base\n   * symbol first, quote symbol second.\n   */\n  sortedMarkets () {\n    return [...this.marketRows].sort((a, b) => a.name < b.name ? -1 : 1)\n  }\n\n  /*\n   * first returns the first market in the alphabetically-sorted list of\n   * markets.\n   */\n  first () {\n    return this.sortedMarkets()[0]\n  }\n\n  /*\n   * marketRow gets the MarketRow for the specified market.\n   */\n  marketRow (baseID, quoteID) {\n    for (const mkt of this.marketRows) {\n      if (mkt.baseID === baseID && mkt.quoteID === quoteID) return mkt\n    }\n    return null\n  }\n\n  /* setConnected sets the visiblity of the disconnected icon. */\n  setConnected (isConnected) {\n    if (isConnected) Doc.hide(this.disconnectedIcon)\n    else Doc.show(this.disconnectedIcon)\n  }\n\n  /*\n   * setFilter sets the visibility of market rows based on the provided filter.\n   */\n  setFilter (filter) {\n    for (const mkt of this.marketRows) {\n      if (filter(mkt)) Doc.show(mkt.row)\n      else Doc.hide(mkt.row)\n    }\n  }\n}\n\n/*\n * MarketRow represents one row in the MarketList. A MarketRow is a subsection\n * of the ExchangeSection.\n */\nclass MarketRow {\n  constructor (tmpl, mkt) {\n    this.name = mkt.name\n    this.baseID = mkt.baseid\n    this.quoteID = mkt.quoteid\n    this.lotSize = mkt.lotsize\n    this.rateStep = mkt.ratestep\n    const row = tmpl.cloneNode(true)\n    this.row = row\n    Doc.tmplElement(row, 'baseicon').src = Doc.logoPath(mkt.basesymbol)\n    Doc.tmplElement(row, 'quoteicon').src = Doc.logoPath(mkt.quotesymbol)\n    row.append(`${mkt.basesymbol.toUpperCase()}-${mkt.quotesymbol.toUpperCase()}`)\n  }\n}\n\n/*\n * BalanceWidget is a display of balance information. Because the wallet can be\n * in any number of states, and because every exchange has different funding\n * coin confirmation requirements, the BalanceWidget displays a number of state\n * indicators and buttons, as well as tabulated balance data with rows for\n * locked and immature balance.\n */\nclass BalanceWidget {\n  constructor (table) {\n    const els = Doc.parsePage(table, [\n      'baseAvail', 'quoteAvail', 'baseNewWalletRow', 'quoteNewWalletRow',\n      'baseNewButton', 'quoteNewButton', 'baseLocked', 'quoteLocked',\n      'baseImmature', 'quoteImmature', 'baseImg', 'quoteImg',\n      'quoteUnsupported', 'baseUnsupported', 'baseExpired', 'quoteExpired',\n      'baseConnect', 'quoteConnect', 'baseSpinner', 'quoteSpinner',\n      'baseWalletState', 'quoteWalletState'\n    ])\n    this.base = {\n      id: 0,\n      cfg: null,\n      logo: els.baseImg,\n      avail: els.baseAvail,\n      newWalletRow: els.baseNewWalletRow,\n      newWalletBttn: els.baseNewButton,\n      locked: els.baseLocked,\n      immature: els.baseImmature,\n      unsupported: els.baseUnsupported,\n      expired: els.baseExpired,\n      connect: els.baseConnect,\n      spinner: els.baseSpinner,\n      iconBox: els.baseWalletState,\n      stateIcons: new WalletIcons(els.baseWalletState)\n    }\n    this.quote = {\n      id: 0,\n      cfg: null,\n      logo: els.quoteImg,\n      avail: els.quoteAvail,\n      newWalletRow: els.quoteNewWalletRow,\n      newWalletBttn: els.quoteNewButton,\n      locked: els.quoteLocked,\n      immature: els.quoteImmature,\n      unsupported: els.quoteUnsupported,\n      expired: els.quoteExpired,\n      connect: els.quoteConnect,\n      spinner: els.quoteSpinner,\n      iconBox: els.quoteWalletState,\n      stateIcons: new WalletIcons(els.quoteWalletState)\n    }\n    this.dex = null\n  }\n\n  /*\n   * setWallet sets the balance widget to display data for specified market.\n   */\n  setWallets (host, baseID, quoteID) {\n    this.dex = app.user.exchanges[host]\n    this.base.id = baseID\n    this.base.cfg = this.dex.assets[baseID]\n    this.quote.id = quoteID\n    this.quote.cfg = this.dex.assets[quoteID]\n    this.updateWallet(this.base)\n    this.updateWallet(this.quote)\n  }\n\n  /*\n   * updateWallet updates the displayed wallet information based on the\n   * core.Wallet state.\n   */\n  updateWallet (side) {\n    const asset = app.assets[side.id]\n    // Just hide everything to start.\n    Doc.hide(\n      side.newWalletRow, side.avail, side.immature, side.locked,\n      side.expired, side.unsupported, side.connect, side.spinner, side.iconBox\n    )\n    side.logo.src = Doc.logoPath(side.cfg.symbol)\n    // Handle an unsupported asset.\n    if (!asset) {\n      Doc.show(side.unsupported)\n      return\n    }\n    Doc.show(side.iconBox)\n    const wallet = asset.wallet\n    side.stateIcons.readWallet(wallet)\n    // Handle no wallet configured.\n    if (!wallet) {\n      Doc.show(side.newWalletRow)\n      return\n    }\n    const bal = wallet.balance\n    // Handle not connected and no balance known for the DEX.\n    if (!bal && !wallet.running) {\n      Doc.show(side.connect)\n      return\n    }\n    // If there is no balance, but the wallet is connected, show the loading\n    // icon while we fetch an update.\n    if (!bal) {\n      this.fetchBalance(side.id)\n      Doc.show(side.spinner)\n      return\n    }\n    // We have a wallet and a DEX-specific balance. Set all of the fields.\n    Doc.show(side.avail, side.immature, side.locked)\n    side.avail.textContent = Doc.formatCoinValue(bal.available / 1e8)\n    side.locked.textContent = Doc.formatCoinValue((bal.locked + bal.contractlocked) / 1e8)\n    side.immature.textContent = Doc.formatCoinValue(bal.immature / 1e8)\n    // If the current balance update time is older than an hour, show the\n    // expiration icon. Request a balance update, if possible.\n    const expired = new Date().getTime() - new Date(bal.stamp).getTime() > anHour\n    if (expired) {\n      Doc.show(side.expired)\n      if (wallet.running) this.fetchBalance(side.id)\n    } else Doc.hide(side.expired)\n  }\n\n  /*\n   * updateAsset updates the info for one side of the existing market. If the\n   * specified asset ID is not one of the current market's base or quote assets,\n   * it is silently ignored.\n   */\n  updateAsset (assetID) {\n    if (assetID === this.base.id) this.updateWallet(this.base)\n    else if (assetID === this.quote.id) this.updateWallet(this.quote)\n  }\n\n  /*\n   * fetchBalance requests a balance update from the API. The API response does\n   * include the balance, but we're ignoring it, since a balance update\n   * notification is received via the Application anyways.\n   */\n  async fetchBalance (assetID) {\n    const res = await postJSON('/api/balance', { assetID: assetID })\n    if (!app.checkResponse(res)) {\n      console.error('failed to fetch balance for asset ID', assetID)\n    }\n  }\n}\n\n/* makeMarket creates a market object that specifies basic market details. */\nfunction makeMarket (host, base, quote) {\n  return {\n    host: host,\n    base: base,\n    quote: quote\n  }\n}\n\n/* marketID creates a DEX-compatible market name from the ticker symbols. */\nexport function marketID (b, q) { return `${b}_${q}` }\n\n/* asAtoms converts the float string to atoms. */\nfunction asAtoms (s) {\n  return Math.round(parseFloat(s) * 1e8)\n}\n\n/* swapBttns changes the 'selected' class of the buttons. */\nfunction swapBttns (before, now) {\n  before.classList.remove('selected')\n  now.classList.add('selected')\n}\n\n/*\n * updateDataCol sets the textContent of descendent template element.\n */\nfunction updateDataCol (tr, col, s) {\n  Doc.tmplElement(tr, col).textContent = s\n}\n\n/*\n * updateUserOrderRow sets the td contents of the user's order table row.\n */\nfunction updateUserOrderRow (tr, ord) {\n  updateDataCol(tr, 'type', Order.typeString(ord))\n  updateDataCol(tr, 'side', Order.sellString(ord))\n  updateDataCol(tr, 'age', Doc.timeSince(ord.stamp))\n  updateDataCol(tr, 'rate', Doc.formatCoinValue(ord.rate / 1e8))\n  updateDataCol(tr, 'qty', Doc.formatCoinValue(ord.qty / 1e8))\n  updateDataCol(tr, 'filled', `${(ord.filled / ord.qty * 100).toFixed(1)}%`)\n  updateDataCol(tr, 'settled', `${(Order.settled(ord) / ord.qty * 100).toFixed(1)}%`)\n  updateDataCol(tr, 'status', Order.statusString(ord))\n}\n\n/*\n * cleanTemplates removes the elements from the DOM and deletes the id\n * attribute.\n */\nfunction cleanTemplates (...tmpls) {\n  tmpls.forEach(tmpl => {\n    tmpl.remove()\n    tmpl.removeAttribute('id')\n  })\n}\n\n// OrderTableRowManager manages the data within a row in an order table. Each row\n// represents all the orders in the order book with the same rate, but orders that\n// are booked or still in the epoch queue are displayed in separate rows.\nclass OrderTableRowManager {\n  constructor (tableRow, orderBin) {\n    this.tableRow = tableRow\n    this.orderBin = orderBin\n    this.sell = orderBin[0].sell\n    this.rate = orderBin[0].rate\n    this.epoch = !!orderBin[0].epoch\n    this.setRateEl()\n    this.setEpochEl()\n    this.updateQtyNumOrdersEl()\n  }\n\n  // setEpochEl displays a checkmark in the row if the orders represented by\n  // this row are in the epoch queue.\n  setEpochEl () {\n    const epochEl = Doc.tmplElement(this.tableRow, 'epoch')\n    if (this.isEpoch()) epochEl.appendChild(check.cloneNode())\n  }\n\n  // setRateEl popuplates the rate element in the row.\n  setRateEl () {\n    const rateEl = Doc.tmplElement(this.tableRow, 'rate')\n    if (this.rate === 0) {\n      rateEl.innerText = 'market'\n    } else {\n      const cssClass = this.isSell() ? 'sellcolor' : 'buycolor'\n      rateEl.innerText = this.rate.toFixed(8)\n      rateEl.classList.add(cssClass)\n    }\n  }\n\n  // updateQtyNumOrdersEl populates the quantity element in the row, and also\n  // displays the number of orders if there is more than one order in the order\n  // bin.\n  updateQtyNumOrdersEl () {\n    const qty = this.orderBin.reduce((total, curr) => total + curr.qty, 0)\n    const numOrders = this.orderBin.length\n    const qtyEl = Doc.tmplElement(this.tableRow, 'qty')\n    const numOrdersEl = Doc.tmplElement(this.tableRow, 'numorders')\n    qtyEl.innerText = qty.toFixed(8)\n    if (numOrders > 1) {\n      numOrdersEl.removeAttribute('hidden')\n      numOrdersEl.innerText = numOrders\n      numOrdersEl.title = `quantity is comprised of ${numOrders} orders`\n    } else {\n      numOrdersEl.setAttribute('hidden', true)\n    }\n  }\n\n  // insertOrder adds an order to the order bin and updates the row elements\n  // accordingly.\n  insertOrder (order) {\n    this.orderBin.push(order)\n    this.updateQtyNumOrdersEl()\n  }\n\n  // updateOrderQuantity updates the quantity of the order identified by a token,\n  // if it exists in the row, and updates the row elements accordingly. The function\n  // returns true if the order is in the bin, and false otherwise.\n  updateOrderQty (token, qty) {\n    for (let i = 0; i < this.orderBin.length; i++) {\n      if (this.orderBin[i].token === token) {\n        this.orderBin[i].qty = qty\n        this.updateQtyNumOrdersEl()\n        return true\n      }\n    }\n    return false\n  }\n\n  // removeOrder removes the order identified by the token, if it exists in the row,\n  // and updates the row elements accordingly. If the order bin is empty, the row is\n  // removed from the screen. The function returns true if an order was removed, and\n  // false otherwise.\n  removeOrder (token) {\n    const index = this.orderBin.findIndex(order => order.token === token)\n    if (index < 0) return false\n    this.orderBin.splice(index, 1)\n    if (!this.orderBin.length) this.tableRow.remove()\n    else this.updateQtyNumOrdersEl()\n    return true\n  }\n\n  // removeEpochOrders removes all the orders from the row that are not in the\n  // new epoch's epoch queue and updates the elements accordingly.\n  removeEpochOrders (newEpoch) {\n    this.orderBin = this.orderBin.filter((order) => {\n      return !(order.epoch && order.epoch !== newEpoch)\n    })\n    if (!this.orderBin.length) this.tableRow.remove()\n    else this.updateQtyNumOrdersEl()\n  }\n\n  // getRate returns the rate of the orders in the row.\n  getRate () {\n    return this.rate\n  }\n\n  // isEpoch returns whether the orders in this row are in the epoch queue.\n  isEpoch () {\n    return this.epoch\n  }\n\n  // isSell returns whether the orders in this row are sell orders.\n  isSell () {\n    return this.sell\n  }\n\n  // compare takes an order and returns 0 if the order belongs in this row,\n  // 1 if the order should go after this row in the table, and -1 if it should\n  // be before this row in the table. Sell orders are displayed in ascending order,\n  // buy orders are displayed in descending order, and epoch orders always come\n  // after booked orders.\n  compare (order) {\n    if (this.getRate() === order.rate && this.isEpoch() === !!order.epoch) {\n      return 0\n    } else if (this.getRate() !== order.rate) {\n      return (this.getRate() > order.rate) === order.sell ? 1 : -1\n    } else {\n      return this.isEpoch() ? 1 : -1\n    }\n  }\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport * as Order from './orderutil'\nimport { postJSON } from './http'\n\nlet app\n\nconst orderBatchSize = 50\n\nexport default class OrdersPage extends BasePage {\n  constructor (application, main) {\n    super()\n    app = application\n    this.main = main\n    // if offset is '', there are no more orders available to auto-load for\n    // never-ending scrolling.\n    this.offset = ''\n    this.loading = false\n    const page = this.page = Doc.parsePage(main, [\n      'rowTmpl', 'tableBody', 'hostFilter', 'assetFilter', 'statusFilter',\n      'orderLoader', 'ordersTable', 'exportOrders'\n    ])\n    this.orderTmpl = page.rowTmpl\n    this.orderTmpl.remove()\n\n    // filterState will store arrays of strings. The assets and statuses\n    // sub-filters will need to be converted to ints for JSON encoding.\n    const filterState = this.filterState = {\n      hosts: [],\n      assets: [],\n      statuses: []\n    }\n\n    const search = new URLSearchParams(window.location.search)\n    const readFilter = (form, filterKey) => {\n      const v = search.get(filterKey)\n      if (!v || v.length === 0) return\n      const subFilter = v.split(',')\n      if (v) {\n        filterState[filterKey] = subFilter\n      }\n      form.querySelectorAll('input').forEach(bttn => {\n        if (subFilter.indexOf(bttn.value) >= 0) bttn.checked = true\n      })\n    }\n    readFilter(page.hostFilter, 'hosts')\n    readFilter(page.assetFilter, 'assets')\n    readFilter(page.statusFilter, 'statuses')\n\n    const applyButtons = []\n    const monitorFilter = (form, filterKey) => {\n      const applyBttn = form.querySelector('.apply-bttn')\n      applyButtons.push(applyBttn)\n      Doc.bind(applyBttn, 'click', () => {\n        this.submitFilter()\n        applyButtons.forEach(bttn => Doc.hide(bttn))\n      })\n      form.querySelectorAll('input').forEach(bttn => {\n        Doc.bind(bttn, 'change', () => {\n          const subFilter = parseSubFilter(form)\n          if (compareSubFilter(subFilter, filterState[filterKey])) {\n            // Same as currently loaded. Hide the apply button.\n            Doc.hide(applyBttn)\n          } else {\n            Doc.show(applyBttn)\n          }\n        })\n      })\n    }\n\n    monitorFilter(page.hostFilter, 'hosts')\n    monitorFilter(page.assetFilter, 'assets')\n    monitorFilter(page.statusFilter, 'statuses')\n\n    Doc.bind(this.main, 'scroll', () => {\n      if (this.loading) return\n      const belowBottom = page.ordersTable.offsetHeight - this.main.offsetHeight - this.main.scrollTop\n      if (belowBottom < 0) {\n        this.nextPage()\n      }\n    })\n\n    Doc.bind(page.exportOrders, 'click', () => {\n      this.exportOrders()\n    })\n\n    this.submitFilter()\n  }\n\n  /* setOrders empties the order table and appends the specified orders. */\n  setOrders (orders) {\n    Doc.empty(this.page.tableBody)\n    this.appendOrders(orders)\n  }\n\n  /* appendOrders appends orders to the orders table. */\n  appendOrders (orders) {\n    const tbody = this.page.tableBody\n    for (const ord of orders) {\n      const tr = this.orderTmpl.cloneNode(true)\n      const set = (tmplID, s) => { Doc.tmplElement(tr, tmplID).textContent = s }\n      const mktID = `${ord.baseSymbol.toUpperCase()}-${ord.quoteSymbol.toUpperCase()}`\n      set('host', `${mktID} @ ${ord.host}`)\n      let from, to, fromQty\n      let toQty = ''\n      if (ord.sell) {\n        [from, to] = [ord.baseSymbol, ord.quoteSymbol]\n        fromQty = Doc.formatCoinValue(ord.qty / 1e8)\n        if (ord.type === Order.Limit) {\n          toQty = Doc.formatCoinValue(ord.qty / 1e8 * ord.rate / 1e8)\n        }\n      } else {\n        [from, to] = [ord.quoteSymbol, ord.baseSymbol]\n        if (ord.type === Order.Market) {\n          fromQty = Doc.formatCoinValue(ord.qty / 1e8)\n        } else {\n          fromQty = Doc.formatCoinValue(ord.qty / 1e8 * ord.rate / 1e8)\n          toQty = Doc.formatCoinValue(ord.qty / 1e8)\n        }\n      }\n\n      set('fromQty', fromQty)\n      Doc.tmplElement(tr, 'fromLogo').src = Doc.logoPath(from)\n      set('fromSymbol', from)\n      set('toQty', toQty)\n      Doc.tmplElement(tr, 'toLogo').src = Doc.logoPath(to)\n      set('toSymbol', to)\n      set('type', `${Order.typeString(ord)} ${Order.sellString(ord)}`)\n      set('rate', Order.rateString(ord))\n      set('status', Order.statusString(ord))\n      set('filled', `${(ord.filled / ord.qty * 100).toFixed(1)}%`)\n      set('settled', `${(Order.settled(ord) / ord.qty * 100).toFixed(1)}%`)\n      const dateTime = new Date(ord.stamp).toLocaleString()\n      set('time', `${Doc.timeSince(ord.stamp)} ago, ${dateTime}`)\n      const link = Doc.tmplElement(tr, 'link')\n      link.href = `order/${ord.id}`\n      app.bindInternalNavigation(tr)\n      tbody.appendChild(tr)\n    }\n    if (orders.length === orderBatchSize) {\n      this.offset = orders[orders.length - 1].id\n    } else {\n      this.offset = ''\n    }\n  }\n\n  /* submitFilter submits the current filter and reloads the order table. */\n  async submitFilter () {\n    const page = this.page\n    this.offset = ''\n    const filterState = this.filterState\n    filterState.hosts = parseSubFilter(page.hostFilter)\n    filterState.assets = parseSubFilter(page.assetFilter)\n    filterState.statuses = parseSubFilter(page.statusFilter)\n    this.setOrders(await this.fetchOrders())\n  }\n\n  /* fetchOrders fetches orders using the current filter. */\n  async fetchOrders () {\n    const loaded = app.loading(this.main)\n    const res = await postJSON('/api/orders', this.currentFilter())\n    loaded()\n    return res.orders\n  }\n\n  /* exportOrders downloads a csv of the user's orders based on the current filter. */\n  exportOrders () {\n    this.offset = ''\n    const filterState = this.currentFilter()\n    const url = new URL(window.location)\n    const search = new URLSearchParams('')\n    const setQuery = (k) => {\n      const subFilter = filterState[k]\n      subFilter.forEach(e => {\n        search.append(k, e)\n      })\n    }\n    setQuery('hosts')\n    setQuery('assets')\n    setQuery('statuses')\n    url.search = search.toString()\n    url.pathname = '/orders/export'\n    window.open(url.toString())\n  }\n\n  /*\n   * currentFilter converts the local filter type (which is all strings) to the\n   * server's filter type.\n   */\n  currentFilter () {\n    const filterState = this.filterState\n    return {\n      hosts: filterState.hosts,\n      assets: filterState.assets.map(s => parseInt(s)),\n      statuses: filterState.statuses.map(s => parseInt(s)),\n      n: orderBatchSize,\n      offset: this.offset\n    }\n  }\n\n  /*\n   * nextPage resubmits the filter with the offset set to the last loaded order.\n   */\n  async nextPage () {\n    if (this.offset === '' || this.loading) return\n    this.loading = true\n    Doc.show(this.page.orderLoader)\n    const orders = await this.fetchOrders()\n    this.loading = false\n    Doc.hide(this.page.orderLoader)\n    this.appendOrders(orders)\n  }\n}\n\n/*\n * parseSubFilter parses a bool-map from the checkbox inputs in the specified\n * ancestor element.\n */\nfunction parseSubFilter (form) {\n  const entries = []\n  form.querySelectorAll('input').forEach(box => {\n    if (box.checked) entries.push(box.value)\n  })\n  return entries\n}\n\n/* compareSubFilter compares the two filter arrays for unordered equivalence. */\nfunction compareSubFilter (filter1, filter2) {\n  if (filter1.length !== filter2.length) return false\n  for (const entry of filter1) {\n    if (filter2.indexOf(entry) === -1) return false\n  }\n  return true\n}\n","import Doc from './doc'\nimport BasePage from './basepage'\nimport * as Order from './orderutil'\nimport { bind as bindForm } from './forms'\nimport { postJSON } from './http'\nimport * as intl from './locales'\n\nconst Mainnet = 0\nconst Testnet = 1\n// const Regtest = 3\n\nconst animationLength = 500\n\nlet app, net\n\nexport default class OrderPage extends BasePage {\n  constructor (application, main) {\n    super()\n    app = application\n    const stampers = main.querySelectorAll('[data-stamp]')\n    net = parseInt(main.dataset.net)\n    // Find the order\n    this.orderID = main.dataset.oid\n    this.order = app.order(this.orderID)\n    // app.order can only access active orders. If the order is not active,\n    // we'll need to get the data from the database.\n    if (!this.order) this.fetchOrder()\n    const page = this.page = Doc.parsePage(main, [\n      'cancelBttn', 'cancelRemain', 'cancelUnit', 'cancelForm', 'forms',\n      'cancelSubmit', 'cancelPass', 'status', 'matchBox', 'matchesLabel'\n    ])\n\n    if (page.cancelBttn) {\n      Doc.bind(page.cancelBttn, 'click', () => {\n        this.showForm(page.cancelForm)\n      })\n    }\n\n    // If the user clicks outside of a form, it should close the page overlay.\n    Doc.bind(page.forms, 'mousedown', e => {\n      if (!Doc.mouseInElement(e, this.currentForm)) {\n        Doc.hide(page.forms)\n        page.cancelPass.value = ''\n      }\n    })\n\n    // Cancel order form\n    bindForm(page.cancelForm, page.cancelSubmit, async () => { this.submitCancel() })\n\n    main.querySelectorAll('[data-explorer-id]').forEach(link => {\n      setCoinHref(link)\n    })\n\n    const setStamp = () => {\n      for (const span of stampers) {\n        span.textContent = Doc.timeSince(parseInt(span.dataset.stamp))\n      }\n    }\n    setStamp()\n\n    this.secondTicker = setInterval(() => {\n      setStamp()\n    }, 10000) // update every 10 seconds\n\n    this.notifiers = {\n      order: note => { this.handleOrderNote(note) },\n      match: note => { this.handleMatchNote(note) }\n    }\n  }\n\n  unload () {\n    clearInterval(this.secondTicker)\n  }\n\n  /* fetchOrder fetches the order from the client. */\n  async fetchOrder () {\n    const res = await postJSON('/api/order', this.orderID)\n    if (!app.checkResponse(res)) return\n    this.order = res.order\n  }\n\n  /* showCancel shows a form to confirm submission of a cancel order. */\n  showCancel () {\n    const order = this.order\n    const page = this.page\n    const remaining = order.qty - order.filled\n    page.cancelRemain.textContent = Doc.formatCoinValue(remaining / 1e8)\n    const symbol = Order.isMarketBuy(order) ? this.market.quote.symbol : this.market.base.symbol\n    page.cancelUnit.textContent = symbol.toUpperCase()\n    this.showForm(page.cancelForm)\n  }\n\n  /* showForm shows a modal form with a little animation. */\n  async showForm (form) {\n    this.currentForm = form\n    const page = this.page\n    Doc.hide(page.cancelForm)\n    form.style.right = '10000px'\n    Doc.show(page.forms, form)\n    const shift = (page.forms.offsetWidth + form.offsetWidth) / 2\n    await Doc.animate(animationLength, progress => {\n      form.style.right = `${(1 - progress) * shift}px`\n    }, 'easeOutHard')\n    form.style.right = '0px'\n  }\n\n  /* submitCancel submits a cancellation for the order. */\n  async submitCancel () {\n    // this will be the page.cancelSubmit button (evt.currentTarget)\n    const page = this.page\n    const order = this.order\n    const req = {\n      orderID: order.id,\n      pw: page.cancelPass.value\n    }\n    page.cancelPass.value = ''\n    const loaded = app.loading(page.cancelForm)\n    const res = await postJSON('/api/cancel', req)\n    loaded()\n    if (!app.checkResponse(res)) return\n    page.status.textContent = intl.prep(intl.ID_CANCELING)\n    Doc.hide(page.forms)\n    order.cancelling = true\n  }\n\n  /*\n   * handleOrderNote is the handler for the 'order'-type notification, which are\n   * used to update an order's status.\n   */\n  handleOrderNote (note) {\n    const order = note.order\n    const bttn = this.page.cancelBttn\n    if (bttn && order.id === this.orderID) {\n      if (bttn && order.status > Order.StatusBooked) Doc.hide(bttn)\n      this.page.status.textContent = Order.statusString(order)\n    }\n    for (const m of order.matches || []) this.processMatch(m)\n  }\n\n  /* handleMatchNote handles a 'match' notification. */\n  handleMatchNote (note) {\n    if (note.orderID !== this.orderID) return\n    this.processMatch(note.match)\n  }\n\n  /*\n   * processMatch synchronizes a match's card with a match received in a\n   * 'order' or 'match' notification.\n   */\n  processMatch (m) {\n    let card\n    for (const div of Array.from(this.page.matchBox.querySelectorAll('.match-card'))) {\n      if (div.dataset.matchID === m.matchID) {\n        card = div\n        break\n      }\n    }\n    if (!card) {\n      // TO DO: Create a new card from template.\n      return\n    }\n\n    const setCoin = (divName, linkName, coin) => {\n      if (!coin) return\n      Doc.show(Doc.tmplElement(card, divName))\n      const coinLink = Doc.tmplElement(card, linkName)\n      coinLink.textContent = coin.stringID\n      coinLink.dataset.explorerCoin = coin.stringID\n      setCoinHref(coinLink)\n    }\n\n    setCoin('swap', 'swapCoin', m.swap)\n    setCoin('counterSwap', 'counterSwapCoin', m.counterSwap)\n    setCoin('redeem', 'redeemCoin', m.redeem)\n    setCoin('counterRedeem', 'counterRedeemCoin', m.counterRedeem)\n    setCoin('refund', 'refundCoin', m.refund)\n\n    const swapSpan = Doc.tmplElement(card, 'swapMsg')\n    const cSwapSpan = Doc.tmplElement(card, 'counterSwapMsg')\n\n    if (inCounterSwapCast(m)) {\n      cSwapSpan.textContent = confirmationString(m.counterSwap)\n      Doc.hide(Doc.tmplElement(card, 'swapMsg'))\n      Doc.show(cSwapSpan)\n    } else if (inSwapCast(m)) {\n      swapSpan.textContent = confirmationString(m.swap)\n      Doc.hide(Doc.tmplElement(card, 'counterSwapMsg'))\n      Doc.show(swapSpan)\n    } else {\n      Doc.hide(swapSpan, cSwapSpan)\n    }\n\n    Doc.tmplElement(card, 'status').textContent = Order.matchStatusString(m.status, m.side)\n  }\n}\n\n/*\n * confirmationString is a string describing the state of confirmations for a\n * coin\n * */\nfunction confirmationString (coin) {\n  if (!coin.confs) return ''\n  return `${coin.confs.count} / ${coin.confs.required} confirmations`\n}\n\n/*\n * inCounterSwapCast will be true if we are waiting on confirmations for the\n * counterparty's swap.\n */\nfunction inCounterSwapCast (m) {\n  return (m.side === Order.Taker && m.status === Order.MakerSwapCast) || (m.side === Order.Maker && m.status === Order.TakerSwapCast)\n}\n\n/*\n * inCounterSwapCast will be true if we are waiting on confirmations for our own\n * swap.\n */\nfunction inSwapCast (m) {\n  return (m.side === Order.Maker && m.status === Order.MakerSwapCast) || (m.side === Order.Taker && m.status === Order.TakerSwapCast)\n}\n\n/*\n * setCoinHref sets the hyperlink element's href attribute based on its\n * data-explorer-id and data-explorer-coin values.\n */\nfunction setCoinHref (link) {\n  const assetExplorer = CoinExplorers[parseInt(link.dataset.explorerId)]\n  if (!assetExplorer) return\n  const formatter = assetExplorer[net]\n  if (!formatter) return\n  link.classList.remove('plainlink')\n  link.classList.add('subtlelink')\n  link.href = formatter(link.dataset.explorerCoin)\n}\n\nconst CoinExplorers = {\n  42: { // dcr\n    [Mainnet]: cid => {\n      const [txid, vout] = cid.split(':')\n      return `https://explorer.dcrdata.org/tx/${txid}/out/${vout}`\n    },\n    [Testnet]: cid => {\n      const [txid, vout] = cid.split(':')\n      return `https://testnet.dcrdata.org/tx/${txid}/out/${vout}`\n    }\n  },\n  0: { // btc\n    [Mainnet]: cid => `https://bitaps.com/${cid.split(':')[0]}`,\n    [Testnet]: cid => `https://tbtc.bitaps.com/${cid.split(':')[0]}`\n  },\n  2: { // ltc\n    [Mainnet]: cid => `https://ltc.bitaps.com/${cid.split(':')[0]}`,\n    [Testnet]: cid => `https://tltc.bitaps.com/${cid.split(':')[0]}`\n  }\n}\n","import Doc from './doc'\nimport State from './state'\nimport RegistrationPage from './register'\nimport LoginPage from './login'\nimport WalletsPage from './wallets'\nimport SettingsPage from './settings'\nimport MarketsPage from './markets'\nimport OrdersPage from './orders'\nimport OrderPage from './order'\nimport { getJSON, postJSON } from './http'\nimport * as ntfn from './notifications'\nimport ws from './ws'\nimport * as intl from './locales'\n\nconst idel = Doc.idel // = element by id\nconst bind = Doc.bind\nconst unbind = Doc.unbind\n\nconst notificationRoute = 'notify'\nconst loggersKey = 'loggers'\nconst recordersKey = 'recorders'\nconst noteCacheSize = 100\n\n/* constructors is a map to page constructors. */\nconst constructors = {\n  login: LoginPage,\n  register: RegistrationPage,\n  markets: MarketsPage,\n  wallets: WalletsPage,\n  settings: SettingsPage,\n  orders: OrdersPage,\n  order: OrderPage\n}\n\n// unathedPages are pages that don't require authorization to load.\n// These are endpoints outside of the requireLogin block in webserver.New.\nconst unauthedPages = ['register', 'login', 'settings']\n\n// Application is the main javascript web application for the Decred DEX client.\nexport default class Application {\n  constructor () {\n    this.notes = []\n    this.pokes = []\n    // The \"user\" is a large data structure that contains nearly all state\n    // information, including exchanges, markets, wallets, and orders.\n    this.user = {\n      accounts: {},\n      wallets: {}\n    }\n    this.commitHash = process.env.COMMITHASH\n    this.showPopups = State.getCookie('popups') === '1'\n    console.log('Decred DEX Client App, Build', this.commitHash.substring(0, 7))\n\n    // Loggers can be enabled by setting a truthy value to the loggerID using\n    // enableLogger. Settings are stored across sessions. See docstring for the\n    // log method for more info.\n    this.loggers = State.fetch(loggersKey) || {}\n    window.enableLogger = (loggerID, state) => {\n      if (state) this.loggers[loggerID] = true\n      else delete this.loggers[loggerID]\n      State.store(loggersKey, this.loggers)\n      return `${loggerID} logger ${state ? 'enabled' : 'disabled'}`\n    }\n    // Enable logging from anywhere.\n    window.log = (...a) => { this.log(...a) }\n\n    // Recorders can record log messages, and then save them to file on request.\n    const recorderKeys = State.fetch(recordersKey) || []\n    this.recorders = {}\n    for (const loggerID of recorderKeys) {\n      console.log('recording', loggerID)\n      this.recorders[loggerID] = []\n    }\n    window.recordLogger = (loggerID, on) => {\n      if (on) this.recorders[loggerID] = []\n      else delete this.recorders[loggerID]\n      State.store(recordersKey, Object.keys(this.recorders))\n      return `${loggerID} recorder ${on ? 'enabled' : 'disabled'}`\n    }\n    window.dumpLogger = loggerID => {\n      const record = this.recorders[loggerID]\n      if (!record) return `no recorder for logger ${loggerID}`\n      const a = document.createElement('a')\n      a.href = `data:application/octet-stream;base64,${window.btoa(JSON.stringify(record, null, 4))}`\n      a.download = `${loggerID}.json`\n      document.body.appendChild(a)\n      a.click()\n      setTimeout(() => {\n        document.body.removeChild(a)\n      }, 0)\n    }\n\n    // use user current locale set by backend\n    intl.setLocale()\n  }\n\n  /**\n   * Start the application. This is the only thing done from the index.js entry\n   * point. Read the id = main element and attach handlers.\n   */\n  async start () {\n    // Handle back navigation from the browser.\n    bind(window, 'popstate', (e) => {\n      const page = e.state.page\n      if (!page && page !== '') return\n      this.loadPage(page, e.state.data, true)\n    })\n    // The main element is the interchangeable part of the page that doesn't\n    // include the header. Main should define a data-handler attribute\n    // associated with  one of the available constructors.\n    this.main = idel(document, 'main')\n    const handler = this.main.dataset.handler\n    // Don't fetch the user until we know what page we're on.\n    await this.fetchUser()\n    // The application is free to respond with a page that differs from the\n    // one requested in the omnibox, e.g. routing though a login page. Set the\n    // current URL state based on the actual page.\n    const url = new URL(window.location)\n    if (handlerFromPath(url.pathname) !== handler) {\n      url.pathname = `/${handler}`\n      url.search = ''\n      window.history.replaceState({ page: handler }, '', url)\n    }\n    // Attach stuff.\n    this.attachHeader()\n    this.attachCommon(this.header)\n    this.attach()\n    // Load recent notifications from Window.localStorage.\n    const notes = State.fetch('notifications')\n    this.setNotes(notes || [])\n    // Connect the websocket and register the notification route.\n    ws.connect(getSocketURI(), this.reconnected)\n    ws.registerRoute(notificationRoute, note => {\n      this.notify(note)\n    })\n  }\n\n  /*\n   * reconnected is called by the websocket client when a reconnection is made.\n   */\n  reconnected () {\n    window.location.reload() // This triggers another websocket disconnect/connect (!)\n    // a fetchUser() and loadPage(window.history.state.page) might work\n  }\n\n  /*\n   * Fetch and save the user, which is the primary core state that must be\n   * maintained by the Application.\n   */\n  async fetchUser () {\n    const user = await getJSON('/api/user')\n    // If it's not a page that requires auth, skip the error notification.\n    const skipNote = unauthedPages.indexOf(this.main.dataset.handler) > -1\n    if (!this.checkResponse(user, skipNote)) return\n    this.user = user\n    this.assets = user.assets\n    this.exchanges = user.exchanges\n    this.walletMap = {}\n    this.locale = user.locale\n    for (const [assetID, asset] of Object.entries(user.assets)) {\n      if (asset.wallet) {\n        this.walletMap[assetID] = asset.wallet\n      }\n    }\n    this.updateMenuItemsDisplay()\n    return user\n  }\n\n  /* Load the page from the server. Insert and bind the DOM. */\n  async loadPage (page, data, skipPush) {\n    // Close some menus and tooltips.\n    this.tooltip.style.left = '-10000px'\n    Doc.hide(this.page.noteBox, this.page.profileBox)\n    // Parse the request.\n    const url = new URL(`/${page}`, window.location.origin)\n    const requestedHandler = handlerFromPath(page)\n    // Fetch and parse the page.\n    const response = await window.fetch(url)\n    if (!response.ok) return false\n    const html = await response.text()\n    const doc = Doc.noderize(html)\n    const main = idel(doc, 'main')\n    const delivered = main.dataset.handler\n    // Append the request to the page history.\n    if (!skipPush) {\n      const path = delivered === requestedHandler ? url.toString() : `/${delivered}`\n      window.history.pushState({ page: page, data: data }, delivered, path)\n    }\n    // Insert page and attach handlers.\n    document.title = doc.title\n    this.main.replaceWith(main)\n    this.main = main\n    this.attach(data)\n    return true\n  }\n\n  /* attach binds the common handlers and calls the page constructor. */\n  attach (data) {\n    const handlerID = this.main.dataset.handler\n    if (!handlerID) {\n      console.error('cannot attach to content with no specified handler')\n      return\n    }\n    this.attachCommon(this.main)\n    if (this.loadedPage) this.loadedPage.unload()\n    const constructor = constructors[handlerID]\n    if (constructor) this.loadedPage = new constructor(this, this.main, data)\n    else this.loadedPage = null\n\n    // Bind the tooltips.\n    this.bindTooltips(this.main)\n  }\n\n  bindTooltips (ancestor) {\n    ancestor.querySelectorAll('[data-tooltip]').forEach(el => {\n      bind(el, 'mouseenter', () => {\n        this.tooltip.textContent = el.dataset.tooltip\n        const lyt = Doc.layoutMetrics(el)\n        let left = lyt.centerX - this.tooltip.offsetWidth / 2\n        if (left < 0) left = 5\n        if (left + this.tooltip.offsetWidth > document.body.offsetWidth) {\n          left = document.body.offsetWidth - this.tooltip.offsetWidth - 5\n        }\n        this.tooltip.style.left = `${left}px`\n        this.tooltip.style.top = `${lyt.bodyTop - this.tooltip.offsetHeight - 5}px`\n      })\n      bind(el, 'mouseleave', () => {\n        this.tooltip.style.left = '-10000px'\n      })\n    })\n  }\n\n  /* attachHeader attaches the header element, which unlike the main element,\n   * isn't replaced during page navigation.\n   */\n  attachHeader () {\n    this.header = idel(document.body, 'header')\n    this.popupNotes = idel(document.body, 'popupNotes')\n    this.popupTmpl = Doc.tmplElement(this.popupNotes, 'note')\n    this.popupTmpl.remove()\n    this.tooltip = idel(document.body, 'tooltip')\n    const pg = this.page = Doc.parsePage(this.header, [\n      'noteIndicator', 'noteList', 'noteTmpl', 'marketsMenuEntry',\n      'walletsMenuEntry', 'noteMenuEntry', 'loader', 'profileMenuEntry',\n      'profileIndicator', 'profileSignout', 'innerNoteIcon', 'innerProfileIcon',\n      'noteBox', 'profileBox', 'pokeCat', 'noteCat', 'pokeBox', 'pokeList',\n      'pokeTmpl'\n    ])\n    delete pg.noteTmpl.id\n    pg.noteTmpl.remove()\n    delete pg.pokeTmpl.id\n    pg.pokeTmpl.remove()\n    pg.loader.remove()\n    pg.loader.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'\n    Doc.show(pg.loader)\n\n    bind(pg.noteMenuEntry, 'click', async () => {\n      Doc.hide(pg.pokeList)\n      Doc.show(pg.noteList)\n      this.ackNotes()\n      pg.noteCat.classList.add('active')\n      pg.pokeCat.classList.remove('active')\n      this.showDropdown(pg.noteMenuEntry, pg.noteBox)\n      Doc.hide(pg.noteIndicator)\n      for (const note of this.notes) {\n        if (note.acked) {\n          note.el.classList.remove('firstview')\n        }\n      }\n      this.setNoteTimes(pg.noteList)\n      this.setNoteTimes(pg.pokeList)\n      this.storeNotes()\n    })\n\n    bind(pg.profileMenuEntry, 'click', () => {\n      this.showDropdown(pg.profileMenuEntry, pg.profileBox)\n    })\n\n    bind(pg.innerNoteIcon, 'click', () => { Doc.hide(pg.noteBox) })\n    bind(pg.innerProfileIcon, 'click', () => { Doc.hide(pg.profileBox) })\n\n    bind(pg.profileSignout, 'click', async e => await this.signOut())\n\n    bind(pg.pokeCat, 'click', () => {\n      this.setNoteTimes(pg.pokeList)\n      pg.pokeCat.classList.add('active')\n      pg.noteCat.classList.remove('active')\n      Doc.hide(pg.noteList)\n      Doc.show(pg.pokeList)\n      this.ackNotes()\n    })\n\n    bind(pg.noteCat, 'click', () => {\n      this.setNoteTimes(pg.noteList)\n      pg.noteCat.classList.add('active')\n      pg.pokeCat.classList.remove('active')\n      Doc.hide(pg.pokeList)\n      Doc.show(pg.noteList)\n      this.ackNotes()\n    })\n  }\n\n  /*\n   * showDropdown sets the position and visibility of the specified dropdown\n   * dialog according to the position of its icon button.\n   */\n  showDropdown (icon, dialog) {\n    const ico = icon.getBoundingClientRect()\n    Doc.hide(this.page.noteBox, this.page.profileBox)\n    Doc.show(dialog)\n    dialog.style.right = `${window.innerWidth - ico.left - ico.width + 11}px`\n    dialog.style.top = `${ico.top - 9}px`\n\n    const hide = e => {\n      if (!Doc.mouseInElement(e, dialog)) {\n        Doc.hide(dialog)\n        unbind(document, 'click', hide)\n        if (dialog === this.page.noteBox && Doc.isDisplayed(this.page.noteList)) {\n          this.ackNotes()\n        }\n      }\n    }\n    bind(document, 'click', hide)\n  }\n\n  ackNotes () {\n    const acks = []\n    for (const note of this.notes) {\n      if (note.acked) {\n        note.el.classList.remove('firstview')\n      } else {\n        note.acked = true\n        if (note.id && note.severity > ntfn.POKE) acks.push(note.id)\n      }\n    }\n    if (acks.length) ws.request('acknotes', acks)\n    Doc.hide(this.page.noteIndicator)\n  }\n\n  setNoteTimes (noteList) {\n    for (const el of Array.from(noteList.children)) {\n      el.querySelector('span.note-time').textContent = Doc.timeSince(el.note.stamp)\n    }\n  }\n\n  /*\n   * bindInternalNavigation hijacks navigation by click on any local links that\n   * are descendents of ancestor.\n   */\n  bindInternalNavigation (ancestor) {\n    const pageURL = new URL(window.location)\n    ancestor.querySelectorAll('a').forEach(a => {\n      if (!a.href) return\n      const url = new URL(a.href)\n      if (url.origin === pageURL.origin) {\n        const token = url.pathname.substring(1)\n        const params = {}\n        if (url.search) {\n          url.searchParams.forEach((v, k) => {\n            params[k] = v\n          })\n        }\n        Doc.bind(a, 'click', e => {\n          e.preventDefault()\n          this.loadPage(token, params)\n        })\n      }\n    })\n  }\n\n  /*\n   * storeNotes stores the list of notifications in Window.localStorage. The\n   * actual stored list is stripped of information not necessary for display.\n   */\n  storeNotes () {\n    State.store('notifications', this.notes.map(n => {\n      return {\n        subject: n.subject,\n        details: n.details,\n        severity: n.severity,\n        stamp: n.stamp,\n        id: n.id,\n        acked: n.acked\n      }\n    }))\n  }\n\n  /*\n   * updateMenuItemsDisplay should be called when the user has signed in or out,\n   * and when the user registers a DEX.\n   */\n  updateMenuItemsDisplay () {\n    const pg = this.page\n    if (!pg) {\n      // initial page load, header elements not yet attached but menu items\n      // would already be hidden/displayed as appropriate.\n      return\n    }\n    if (!this.user.authed) {\n      Doc.hide(pg.noteMenuEntry, pg.walletsMenuEntry, pg.marketsMenuEntry, pg.profileMenuEntry)\n      return\n    }\n    Doc.show(pg.noteMenuEntry, pg.walletsMenuEntry, pg.profileMenuEntry)\n    if (Object.keys(this.user.exchanges).length > 0) {\n      Doc.show(pg.marketsMenuEntry)\n    } else {\n      Doc.hide(pg.marketsMenuEntry)\n    }\n  }\n\n  /* attachCommon scans the provided node and handles some common bindings. */\n  attachCommon (node) {\n    this.bindInternalNavigation(node)\n  }\n\n  /*\n   * updateExchangeRegistration updates the information for the exchange\n   * registration payment\n   */\n  updateExchangeRegistration (dexAddr, isPaid, confs, asset) {\n    const dex = this.exchanges[dexAddr]\n\n    if (isPaid) {\n      // setting the null value in the 'confs' field indicates that the fee\n      // payment was completed\n      dex.pendingFee = null\n      return\n    }\n\n    const symbol = this.assets[asset].symbol\n    dex.pendingFee = { confs, asset, symbol }\n  }\n\n  /*\n   * handleFeePaymentNote is the handler for the 'feepayment'-type notification, which\n   * is used to update the dex registration status.\n   */\n  handleFeePaymentNote (note) {\n    switch (note.topic) {\n      case 'RegUpdate':\n        this.updateExchangeRegistration(note.dex, false, note.confirmations, note.asset)\n        break\n      case 'AccountRegistered':\n        this.updateExchangeRegistration(note.dex, true)\n        break\n      default:\n        break\n    }\n  }\n\n  /*\n   * setNotes sets the current notification cache and populates the notification\n   * display.\n   */\n  setNotes (notes) {\n    this.log('notes', 'setNotes', notes)\n    this.notes = []\n    Doc.empty(this.page.noteList)\n    for (let i = 0; i < notes.length; i++) {\n      this.prependNoteElement(notes[i], true)\n    }\n    this.storeNotes()\n  }\n\n  /*\n   * notify is the top-level handler for notifications received from the client.\n   * Notifications are propagated to the loadedPage.\n   */\n  notify (note) {\n    // Handle type-specific updates.\n    this.log('notes', 'notify', note)\n    switch (note.type) {\n      case 'order': {\n        const order = note.order\n        const mkt = this.user.exchanges[order.host].markets[order.market]\n        // Updates given order in market's orders list if it finds it.\n        // Returns a bool which indicates if order was found.\n        const updateOrder = (mkt, ord) => {\n          for (const i in mkt.orders || []) {\n            if (mkt.orders[i].id === ord.id) {\n              mkt.orders[i] = ord\n              return true\n            }\n          }\n          return false\n        }\n        // If the notification order already exists we update it.\n        // In case market's orders list is empty or the notification order isn't\n        // part of it we add it manually as this means the order was\n        // just placed.\n        if (!mkt.orders) mkt.orders = [order]\n        else if (!updateOrder(mkt, order)) mkt.orders.push(order)\n        break\n      }\n      case 'balance': {\n        const wallet = this.user.assets &&\n          this.user.assets[note.assetID].wallet\n        if (wallet) wallet.balance = note.balance\n        break\n      }\n      case 'feepayment':\n        this.handleFeePaymentNote(note)\n        break\n      case 'walletstate':\n      case 'walletconfig': {\n        // assets can be null if failed to connect to dex server.\n        if (!this.assets) return\n        const wallet = note.wallet\n        this.assets[wallet.assetID].wallet = wallet\n        this.walletMap[wallet.assetID] = wallet\n        const balances = this.main.querySelectorAll(`[data-balance-target=\"${wallet.assetID}\"]`)\n        balances.forEach(el => { el.textContent = (wallet.balance.available / 1e8).toFixed(8) })\n        break\n      }\n      case 'match': {\n        const ord = this.order(note.orderID)\n        if (ord) updateMatch(ord, note.match)\n        break\n      }\n      case 'conn': {\n        const dex = this.user.exchanges[note.host]\n        if (dex) dex.connected = note.connected\n      }\n    }\n\n    // Inform the page.\n    if (this.loadedPage) this.loadedPage.notify(note)\n    // Discard data notifications.\n    if (note.severity < ntfn.POKE) return\n    // Poke notifications have their own display.\n    if (this.showPopups) {\n      const span = this.popupTmpl.cloneNode(true)\n      Doc.tmplElement(span, 'text').textContent = `${note.subject}: ${note.details}`\n      const indicator = Doc.tmplElement(span, 'indicator')\n      if (note.severity === ntfn.POKE) {\n        Doc.hide(indicator)\n      } else setSeverityClass(indicator, note.severity)\n      const pn = this.popupNotes\n      pn.appendChild(span)\n      // These take up screen space. Only show max 5 at a time.\n      while (pn.children.length > 5) pn.removeChild(pn.firstChild)\n      setTimeout(async () => {\n        await Doc.animate(500, progress => {\n          span.style.opacity = 1 - progress\n        })\n        span.remove()\n      }, 6000)\n    }\n    // Success and higher severity go to the bell dropdown.\n    if (note.severity === ntfn.POKE) this.prependPokeElement(note)\n    else this.prependNoteElement(note)\n  }\n\n  /*\n   * log prints to the console if a logger has been enabled. Loggers are created\n   * implicitly by passing a loggerID to log. i.e. you don't create a logger,\n   * you just log to it. Loggers are enabled by invoking a global function,\n   * enableLogger(loggerID, onOffBoolean), from the browser's js console. Your\n   * choices are stored across sessions. Some common and useful loggers are\n   * listed below, but this list is not meant to be comprehensive.\n   *\n   * LoggerID   Description\n   * --------   -----------\n   * notes      Notifications of all levels.\n   * book       Order book feed.\n   * ws.........Websocket connection status changes.\n   */\n  log (loggerID, ...msg) {\n    if (this.loggers[loggerID]) console.log(`${nowString()}[${loggerID}]:`, ...msg)\n    if (this.recorders[loggerID]) {\n      this.recorders[loggerID].push({\n        time: nowString(),\n        msg: msg\n      })\n    }\n  }\n\n  prependPokeElement (note) {\n    this.pokes.push(note)\n    while (this.pokes.length > noteCacheSize) this.pokes.shift()\n    const el = this.makePoke(note)\n    this.prependListElement(this.page.pokeList, note, el)\n  }\n\n  prependNoteElement (note, skipSave) {\n    this.notes.push(note)\n    while (this.notes.length > noteCacheSize) this.notes.shift()\n    const noteList = this.page.noteList\n    const el = this.makeNote(note)\n    this.prependListElement(noteList, note, el)\n    if (!skipSave) this.storeNotes()\n    // Set the indicator color.\n    if (this.notes.length === 0 || (Doc.isDisplayed(this.page.noteBox) && Doc.isDisplayed(noteList))) return\n    let unacked = 0\n    const severity = this.notes.reduce((s, note) => {\n      if (!note.acked) unacked++\n      if (!note.acked && note.severity > s) return note.severity\n      return s\n    }, ntfn.IGNORE)\n    const ni = this.page.noteIndicator\n    setSeverityClass(ni, severity)\n    if (unacked) {\n      ni.textContent = (unacked > noteCacheSize - 1) ? `${noteCacheSize - 1}+` : unacked\n      Doc.show(ni)\n    } else Doc.hide(ni)\n  }\n\n  prependListElement (noteList, note, el) {\n    note.el = el\n    el.note = note\n    noteList.prepend(el)\n    while (noteList.children.length > noteCacheSize) noteList.removeChild(noteList.lastChild)\n    this.setNoteTimes(noteList)\n  }\n\n  /*\n   * makeNote constructs a single notification element for the drop-down\n   * notification list.\n   */\n  makeNote (note) {\n    const el = this.page.noteTmpl.cloneNode(true)\n    if (note.severity > ntfn.POKE) {\n      const cls = note.severity === ntfn.SUCCESS ? 'good' : note.severity === ntfn.WARNING ? 'warn' : 'bad'\n      el.querySelector('div.note-indicator').classList.add(cls)\n    }\n\n    el.querySelector('div.note-subject').textContent = note.subject\n    el.querySelector('div.note-details').textContent = note.details\n    return el\n  }\n\n  makePoke (note) {\n    const el = this.page.pokeTmpl.cloneNode(true)\n    const d = new Date(note.stamp)\n    Doc.tmplElement(el, 'dateTime').textContent = `${d.toLocaleDateString()}, ${d.toLocaleTimeString()}`\n    Doc.tmplElement(el, 'details').textContent = `${note.subject}: ${note.details}`\n    return el\n  }\n\n  /*\n   * loading appends the loader to the specified element and displays the\n   * loading icon. The loader will block all interaction with the specified\n   * element until Application.loaded is called.\n   */\n  loading (el) {\n    const loader = this.page.loader.cloneNode(true)\n    el.appendChild(loader)\n    return () => { loader.remove() }\n  }\n\n  /* orders retrieves a list of orders for the specified dex and market. */\n  orders (host, mktID) {\n    let o = this.user.exchanges[host].markets[mktID].orders\n    if (!o) {\n      o = []\n      this.user.exchanges[host].markets[mktID].orders = o\n    }\n    return o\n  }\n\n  /* order attempts to locate an order by order ID. */\n  order (oid) {\n    for (const xc of Object.values(this.user.exchanges)) {\n      for (const market of Object.values(xc.markets)) {\n        if (!market.orders) continue\n        for (const ord of market.orders) {\n          if (ord.id === oid) return ord\n        }\n      }\n    }\n  }\n\n  /*\n   * checkResponse checks the response object as returned from the functions in\n   * the http module. If the response indicates that the request failed, a\n   * message will be displayed in the drop-down notifications and false will be\n   * returned.\n   */\n  checkResponse (resp, skipNote) {\n    if (!resp.requestSuccessful || !resp.ok) {\n      if (this.user.inited && !skipNote) this.notify(ntfn.make(intl.prep(intl.ID_API_ERROR), resp.msg, ntfn.ERROR))\n      return false\n    }\n    return true\n  }\n\n  /**\n   * signOut call to /api/logout, if response with no errors occurred clear all\n   * store, remove auth, darkMode cookies and reload the page, otherwise will\n   * show a notification\n   */\n  async signOut () {\n    const res = await postJSON('/api/logout')\n    if (!this.checkResponse(res)) {\n      Doc.hide(this.page.profileBox)\n      return\n    }\n    State.clearAllStore()\n    State.removeAuthCK()\n    window.location.href = '/login'\n  }\n}\n\n/* getSocketURI returns the websocket URI for the client. */\nfunction getSocketURI () {\n  const protocol = (window.location.protocol === 'https:') ? 'wss' : 'ws'\n  return `${protocol}://${window.location.host}/ws`\n}\n\n/*\n * severityClassMap maps a notification severity level to a CSS class that\n * assigns a background color.\n */\nconst severityClassMap = {\n  [ntfn.SUCCESS]: 'good',\n  [ntfn.ERROR]: 'bad',\n  [ntfn.WARNING]: 'warn'\n}\n\n/* handlerFromPath parses the handler name from the path. */\nfunction handlerFromPath (path) {\n  return path.replace(/^\\//, '').split('/')[0].split('?')[0].split('#')[0]\n}\n\n/* nowString creates a string formatted like HH:MM:SS.xxx */\nfunction nowString () {\n  const stamp = new Date()\n  const h = stamp.getHours().toString().padStart(2, '0')\n  const m = stamp.getMinutes().toString().padStart(2, '0')\n  const s = stamp.getSeconds().toString().padStart(2, '0')\n  const ms = stamp.getMilliseconds().toString().padStart(3, '0')\n  return `${h}:${m}:${s}.${ms}`\n}\n\nfunction setSeverityClass (el, severity) {\n  el.classList.remove('bad', 'warn', 'good')\n  el.classList.add(severityClassMap[severity])\n}\n\n/* updateMatch updates the match in or adds the match to the order. */\nfunction updateMatch (order, match) {\n  for (const i in order.matches) {\n    const m = order.matches[i]\n    if (m.matchID === match.matchID) {\n      order.matches[i] = match\n      return\n    }\n  }\n  order.matches = order.matches || []\n  order.matches.push(match)\n}\n","import Application from './js/app'\nimport './css/application.scss'\nconst app = new Application()\napp.start()\n"],"names":["locale","ID_NO_PASS_ERROR_MSG","ID_NO_APP_PASS_ERROR_MSG","ID_SET_BUTTON_BUY","ID_SET_BUTTON_SELL","ID_OFF","ID_READY","ID_LOCKED","ID_NOWALLET","ID_WALLET_SYNC_PROGRESS","ID_HIDE_ADDITIONAL_SETTINGS","ID_SHOW_ADDITIONAL_SETTINGS","ID_BUY","ID_SELL","ID_NOT_SUPPORTED","ID_CONNECTION_FAILED","ID_ORDER_PREVIEW","ID_CALCULATING","ID_ESTIMATE_UNAVAILABLE","ID_NO_ZERO_RATE","ID_NO_ZERO_QUANTITY","ID_TRADE","ID_NO_ASSET_WALLET","ID_EXECUTED","ID_BOOKED","ID_CANCELING","ID_PASSWORD_NOT_MATCH","ID_ACCT_UNDEFINED","ID_KEEP_WALLET_PASS","ID_NEW_WALLET_PASS","ID_LOT","ID_LOTS","ID_UNKNOWN","ID_EPOCH","ID_SETTLING","ID_NO_MATCH","ID_CANCELED","ID_REVOKED","ID_WAITING_FOR_CONFS","ID_NONE_SELECTED","ID_REGISTRATION_FEE_SUCCESS","ID_API_ERROR","ID_SETUP_WALLET","ID_WALLET_READY","localesMap","prep","k","args","undefined","stringTemplateParser","expression","valueObj","replace","_","value","parser","window","DOMParser","BipSymbols","Object","values","0","42","2","22","28","3","145","60","intFormatter","Intl","NumberFormat","navigator","languages","decimalFormatter","minimumFractionDigits","maximumFractionDigits","Doc","el","id","querySelector","ev","f","addEventListener","removeEventListener","html","parseFromString","e","rect","getBoundingClientRect","pageX","left","right","pageY","top","bottom","box","docEl","document","documentElement","scrollTop","scrollLeft","w","offsetWidth","h","offsetHeight","bodyTop","bodyLeft","width","height","centerX","centerY","firstChild","removeChild","els","classList","add","remove","contains","duration","easingAlgo","easer","Easing","linear","start","Date","getTime","end","range","now","sleep","main","ids","page","forEach","s","idel","v","Number","isInteger","format","symbol","indexOf","substring","ancestor","t","y","mo","d","m","seconds","Math","floor","result","count","n","timeMod","aYear","aMonth","aDay","anHour","aMinute","inputFields","inputField","preventDefault","easeIn","easeOut","easeInHard","easeOutHard","WalletIcons","stateElement","name","this","icons","sleeping","locked","unlocked","nowallet","syncing","status","i","hide","show","textContent","intl","wallet","icon","running","synced","dataset","tooltip","syncProgress","toFixed","setSyncing","open","console","error","ms","Promise","resolve","setTimeout","dur","darkModeCK","popupsCK","State","cname","cvalue","setTime","expires","toUTCString","cookie","split","trim","dark","setCookie","body","filter","item","includes","length","getCookie","localStorage","setItem","JSON","stringify","clear","getItem","parse","app","BasePage","note","notifiers","type","requestJSON","method","addr","reqBody","response","fetch","headers","Headers","obj","json","requestSuccessful","msg","text","postJSON","data","NewWalletForm","application","form","success","pwCache","closerFn","currentAsset","fields","parsePage","refresh","querySelectorAll","bind","subform","WalletConfigForm","walletSettings","submitAdd","pw","nwAppPass","passwordIsCached","newWalletErr","createForm","assetID","parseInt","pass","newWalletPass","config","map","appPass","loaded","loading","res","checkResponse","setError","newWalletAppPWBox","asset","assets","nwAssetLogo","src","logoPath","nwAssetName","info","update","errMsg","setLoadedConfig","sectionize","configElements","configOpts","allSettings","tmplElement","dynamicOpts","textInputTmpl","checkboxTmpl","fileSelector","fileInput","showOther","showIcon","hideIcon","showHideMsg","otherSettings","loadedSettingsMsg","loadedSettings","defaultSettingsMsg","defaultSettings","click","fileInputChanged","setOtherSettingsViz","files","configtext","keys","append","setConfig","reorder","children","loadedOpts","defaultOpts","walletInfo","configopts","empty","defaultedOpts","addOpt","opt","elID","key","isboolean","cloneNode","input","configOpt","label","htmlFor","prepend","displayname","appendChild","noecho","description","checked","push","bindTooltips","visible","cfg","finds","toLowerCase","ConfirmRegistrationForm","insufficientFundsFail","setupWalletFn","getDexAddr","getCertFile","feeAssetID","submitConfirm","submitForm","xc","fees","regFees","marketsTableRows","feeTableRows","fee","user","haveWallet","tr","feeRowTemplate","Array","from","row","innerText","toUpperCase","confs","amount","setupWallet","walletReady","appPassBox","appPassSpan","entries","markets","sort","m1","m2","compareBase","basesymbol","localeCompare","compareQuote","quotesymbol","market","marketRowTemplate","lotsize","regErr","feeAsset","cert","registration","code","setExchange","UnlockWalletForm","submitUnlock","submit","uwAssetLogo","uwAssetName","uwAppPass","uwAppPassBox","unlockErr","submitUnlockDiv","DEXAddressForm","defaultTLSText","selectedCert","certFile","onCertFileChange","removeCert","clearCertFile","addCert","dexShowMore","dexCertBox","submitDEXAddr","checkDEX","dexAddrAppPWBox","dexAddrErr","dexAddr","dexAddrAppPW","paid","fetchUser","loadPage","dexNeedCert","submitBttn","handler","wrapper","RegistrationPage","bindForm","appPWForm","appPWSubmit","setAppPass","showSeedRestore","seedRestore","walletForm","newWalletForm","confirmRegisterForm","changeForm","confirmRegForm","dexAddrForm","registerDEXSuccess","registerDEXFundsFail","assetId","setAsset","loadDefaults","authed","auth","form1","form2","shift","animate","progress","style","focus","appPWErrMsg","appPW","pwAgain","appPWAgain","setNotes","seed","seedInput","rememberPass","updateMenuItemsDisplay","regFundsErr","failedRegForm","LoginPage","forms","loginForm","login","notes","reverse","make","subject","details","severity","stamp","WalletsPage","firstRow","getAction","rowInfos","walletTable","rowInfo","stateIcons","actions","connect","unlock","withdraw","deposit","create","lock","settings","dexTitle","removeAttribute","oneMarket","displayed","animation","openAsset","walletAsset","reconfigAsset","createWalletSuccess","walletReconfig","reconfigInputs","unlockForm","openForm","openWalletSuccess","withdrawForm","submitWithdraw","submitReconfig","reconfig","showMarkets","rightBox","lastFormAsset","keyup","a","run","stopPropagation","doConnect","showWithdraw","showDeposit","showNewWallet","openWallet","showReconfig","newDepAddrBttn","newDepositAddress","withdrawAvail","withdrawAmt","showChangePW","changeWalletPW","setPWSettingViz","balance","handleBalanceNote","walletstate","handleWalletStateNote","walletconfig","changePW","switchPWMsg","focuser","opacity","marketsBox","card","marketsCard","hideBox","marketsFor","exchanges","host","baseid","quoteid","header","mBox","prettyMarketName","counterSymbol","pageData","base","quote","showBox","showOpen","errorMsg","showErrorOnly","walletPass","reconfigErr","recfgAssetLogo","recfgAssetName","depositErr","depositLogo","walletMap","depositAsset","depositName","depositAddress","address","notify","ntfn","withdrawAddr","withdrawPW","available","withdrawLogo","withdrawName","encrypted","withdrawErr","round","req","newWalletPW","newPW","readWallet","unbind","SettingsPage","darkMode","showPokes","showPopups","commitHash","addADex","showForm","confirmRegistrationForm","authorizeAccountExportForm","authorizeExportAccountConfirm","exportAccount","disableAccountForm","disableAccountConfirm","disableAccount","exchangesDiv","exportAccountButton","prepareAccountExport","disableAccountButton","prepareAccountDisable","importAccount","prepareAccountImport","authorizeAccountImportForm","authorizeImportAccountConfirm","changeAppPW","changeAppPWForm","submitNewPW","accountFile","onAccountFileChange","removeAccount","clearAccountFile","addAccount","exportSeed","exportSeedAuth","exportSeedSubmit","submitExportSeedReq","closePopups","exportSeedPW","seedDiv","mouseInElement","currentForm","exportAccountHost","exportAccountErr","disableAccountHost","disableAccountErr","exportAccountAppPass","accountForExport","account","createElement","setAttribute","disableAccountAppPW","location","reload","selectedAccount","importAccountErr","importAccountAppPass","accountString","message","importResponse","loginResponse","exportSeedE","authorizeSeedDisplay","changePWErrMsg","clearValues","newAppPW","confirmNewPW","OrderBook","mktBook","baseSymbol","quoteSymbol","buys","book","sells","ord","side","sell","splice","rate","less","findIdx","token","removeFromSide","findOrder","qty","updateRemainingSide","epochIdx","approve","epoch","best","bestGapOrder","PIPI","PI","plusChar","String","fromCharCode","minusChar","darkTheme","axisLabel","gridBorder","gridLines","gapLine","zoom","zoomHover","sellLine","buyLine","sellFill","buyFill","crosshairs","legendFill","legendText","lightTheme","Chart","parent","theme","isDark","canvas","ctx","getContext","textAlign","textBaseline","mousePos","x","clientX","clientY","draw","wheelLimiter","wheeled","wheel","boundResizer","resize","clientHeight","clearRect","render","clicked","deltaY","parentHeight","clientWidth","plotExtents","Extents","xLblExtents","yLblExtents","plotRegion","Region","xRegion","yRegion","requestAnimationFrame","resized","bigger","zoomed","font","fillStyle","labels","minX","maxX","unitLines","extents","plot","tools","applyLabelStyle","lastX","unitCenter","lbls","lbl","fillText","txt","val","lineWidth","strokeStyle","line","region","minY","maxY","unit","lastY","step","valFmt","yLabels","makeLabels","dataExtents","min","max","yAxisWidth","widest","plotYLabels","beginPath","dataCoords","moveTo","lineTo","stroke","DepthChart","reporters","zoomLevel","lotSize","rateStep","lines","markers","zoomInBttn","zoomOutBttn","translator","unx","baseTicker","quoteTicker","gap","midGap","gapWidth","minZoom","halfWindow","high","low","buyMarkers","sellMarkers","b","buyDepth","buyEpoch","sellDepth","sellEpoch","volumeReport","buyBase","buyQuote","sellBase","sellQuote","sum","epochSum","floatCompare","mark","active","buySum","last","epochBuySum","sellSum","epochSellSum","growthFactor","doYLabels","mouseData","xLabels","plotXLabels","drawFrame","formatLabelValue","topCenterX","midX","topCenterY","zoomPct","xRange","zoomText","measureText","bttnLeft","bttnTop","bttnSize","setExtents","hover","midY","drawLine","color","save","setLineDash","restore","tolerance","hoverMarkers","marker","hovered","withinTolerance","size","tip","sqrt","closePath","fill","dataX","evalSide","trigger","ptX","dotColor","bestDepth","pt","depth","drawDepth","radius","arc","dot","volume","mouse","firstPt","globalAlpha","bestGapBuy","bestGapSell","CandleChart","numToShow","ext","candleExtents","yRange","candleRegion","volumeExtents","volumeRegion","resizeTimer","clearTimeout","idx","zoomLevels","candles","candleWidth","allCandles","slice","c","truncate","endStamp","paddedStart","paddedWidth","first","highRate","lowRate","matchVolume","highVol","ratestep","mouseCandle","screenW","spacingGuess","diff","tick","zoneOffset","getTimezoneOffset","dayStamp","lastDay","lastYear","pts","months","getMonth","getDate","getHours","getMinutes","padStart","year","getFullYear","makeCandleTimeLabels","selectedStartStamp","fillRect","yExt","rangeTxt","toLocaleString","rangeWidth","xExt","rectArgs","rangeHeight","strokeRect","volDataExtents","desc","startRate","endRate","cx","maxCandles","xMin","xMax","yMin","yMax","context","screenMinX","screenMaxY","screenH","xFactor","yFactor","uny","drawFunc","skipMask","clip","tx","ty","transform","tickGuess","absMax","abs","sigFigs","log10","toPrecision","unitW","arr","x0","y0","x1","y1","skipStroke","labelSpecs","minimumSignificantDigits","maximumSignificantDigits","sellString","typeString","tif","isMarketBuy","statusString","order","isLive","matches","match","revoked","hasLiveMatches","cancelling","filled","settled","reduce","isCancel","forward","route","payload","handlers","err","MessageSocket","uri","connection","queue","maxQlength","readyState","WebSocket","OPEN","log","send","reason","close","reloader","retrys","go","conn","timeout","onmessage","evt","onclose","delay","pow","onopen","request","onerror","bookRoute","bookOrderRoute","unbookOrderRoute","epochOrderRoute","candlesRoute","candleUpdateRoute","lastMarketKey","chartRatioKey","depthZoomKey","depthChart","candleChart","check","MarketsPage","parentElement","maxLoaded","maxOrderUpdateCounter","registrationStatus","openFunc","currentCreate","preorderTimer","cancelData","metaOrders","depthLines","activeMarkerRate","hovers","ordersSortKey","ordersSortDirection","ogTitle","title","depthReporters","p","reportDepthClick","reportDepthVolume","reportDepthMouse","z","reportDepthZoom","marketChart","candleReporters","reportMouseCandle","currentChart","candleDur","wgt","balanceWgt","BalanceWidget","balanceTable","baseIcons","quoteIcons","walletUnlocked","expired","newWalletBttn","showCreate","cleanTemplates","rowTemplate","liveTemplate","durBttnTemplate","marketList","MarketList","xcSections","marketRows","mkt","setMarket","baseID","quoteID","quoteUnits","baseUnits","buyBttn","swapBttns","sellBttn","maxLbl","setOrderBttnText","setOrderVisibility","drawChartLines","limitBttn","marketBttn","rateField","isSell","setMarketBuyOrderEstimate","maxOrd","lotField","maxSell","swap","lots","maxBuys","adjustedRate","lotChanged","depthBttn","depthChartSelected","candlestickBttn","candleChartSelected","disableMouseWheel","qtyField","mktBuyField","ws","handleBookRoute","handleBookOrderRoute","handleUnbookOrderRoute","handleUpdateRemainingRoute","handleEpochOrderRoute","handleCandleUpdateRoute","handleCandlesRoute","createWallet","orderForm","stepSubmit","verifyForm","vSubmit","submitOrder","cancelForm","cancelSubmit","submitCancel","liveTable","th","setOrdersSortCol","ordercol","unsetOrdersSortColClasses","refreshActiveOrders","setOrdersSortColClasses","sortCls","vPass","cancelPass","quantityChanged","marketBuyChanged","rateFieldChanged","previewQuoteAmt","marketSearch","filterMarkets","clearChartLines","buyRows","sellRows","liveList","setDepthMarkers","selected","setChartRatio","r","chartDivRatio","chartResizer","button","chartRatio","trackMouse","ee","rightSide","store","handleOrderNote","handleEpochNote","handleConnNote","feepayment","handleFeePayment","makeMarket","exists","secondTicker","setInterval","metaOrder","timeSince","setRegistrationStatusVisibility","setBalanceVisibility","dex","pendingFee","isLimit","priceBox","tifBox","qtyBox","maxBox","mktBuyBox","feePaid","hasFeePending","assetsAreSupported","hasWallets","loaderMsg","baseCfg","quoteCfg","titleContent","confStatusMsg","titleClass","regStatusTitle","regStatusConfsDisplay","regStatusDex","pending","confirmationsRequired","confReq","setRegistrationStatusView","connected","updateRegistrationStatusView","toggle","resolveOrderFormVisibility","isHidden","durBttnBox","candleDurs","bttn","candleDurationSelected","chartErrMsg","marketLoader","mktId","marketID","sid","candleCaches","loadCandles","setLoaderMsgVisibility","setCandleDurBttns","sellBookedBase","formatCoinValue","sellBookedQuote","buyBookedBase","buyBookedQuote","metaOrd","hoverPrice","hoverVolume","hoverData","candle","candleStart","candleEnd","candleHigh","candleLow","candleVol","limit","asAtoms","tifnow","tifNow","parseOrder","adjusted","orderErr","preSell","preBuy","orderPreview","quoteAsset","total","baseWallet","setMaxOrder","schedulePreOrder","sellBalance","quoteWallet","aLot","maxBuy","buyBalance","path","bid","qid","bWallet","qWallet","maxLotBox","maxAboveZero","maxFromLots","maxFromLotsLbl","counter","warn","maxOrder","toString","maxFromAmt","maxFromTicker","maxToAmt","maxToTicker","q","loadTable","addTableOrder","set","buffer","buybuffer","minMktBuy","Order","oid","orders","compare","ordersSortCompare","updateUserOrderRow","showCancel","href","bindInternalNavigation","setMarkers","midGapValue","baseSymb","quoteSymb","handleBook","updateTitle","select","setWallets","removeTableOrder","updateRemaining","updateTableOrder","candlesLoading","timer","setCandles","cache","startStamp","baseAsset","toAsset","fromAsset","vQty","vSideHeader","vSideSubmit","vBaseSubmit","verifyLimit","verifyMarket","vRate","vQuote","vTotal","vBase","vSide","received","vmTotal","vmAsset","vmLots","buyBtnClass","sellBtnClass","vHeader","orderID","remaining","cancelRemain","cancelUnit","validateOrder","showVerify","updateAsset","oldStatus","topic","setEpoch","clearOrderTableEpochs","alreadyMatched","statusTD","avail","vErr","vLoader","finalize","mktBuyLots","mktBuyScore","loadTableSide","bins","currEpochBin","currNonEpochBin","currRate","bin","bookSide","tbody","binOrdersByRateAndEpoch","orderTableRow","manager","getRate","nextSibling","insertOrder","insertBefore","removeOrder","updateOrderQty","newEpoch","clearOrderTableEpochSide","removeEpochOrders","orderBin","OrderTableRowManager","chart","setConnectionStatus","filterTxt","setFilter","setLines","candleHoverData","epochLine","depthHoverData","depthSummary","requestCandles","unattach","clearInterval","div","xcTmpl","ExchangeSection","sortedSections","xcSection","firstXC","firstMkt","marketRow","setConnected","tmpl","disconnectedIcon","rows","rowTmpl","MarketRow","sortedMarkets","isConnected","table","logo","baseImg","baseAvail","newWalletRow","baseNewWalletRow","baseNewButton","baseLocked","immature","baseImmature","unsupported","baseUnsupported","baseExpired","baseConnect","spinner","baseSpinner","iconBox","baseWalletState","quoteImg","quoteAvail","quoteNewWalletRow","quoteNewButton","quoteLocked","quoteImmature","quoteUnsupported","quoteExpired","quoteConnect","quoteSpinner","quoteWalletState","updateWallet","bal","fetchBalance","contractlocked","parseFloat","before","updateDataCol","col","tmpls","tableRow","setRateEl","setEpochEl","updateQtyNumOrdersEl","epochEl","isEpoch","rateEl","cssClass","curr","numOrders","qtyEl","numOrdersEl","index","findIndex","OrdersPage","offset","orderTmpl","filterState","hosts","statuses","search","URLSearchParams","readFilter","filterKey","get","subFilter","hostFilter","assetFilter","statusFilter","applyButtons","monitorFilter","applyBttn","submitFilter","filter1","filter2","entry","compareSubFilter","parseSubFilter","ordersTable","nextPage","exportOrders","tableBody","appendOrders","tmplID","mktID","to","fromQty","toQty","dateTime","setOrders","fetchOrders","currentFilter","url","URL","setQuery","pathname","orderLoader","net","OrderPage","stampers","fetchOrder","cancelBttn","link","setCoinHref","setStamp","span","handleMatchNote","processMatch","matchBox","matchID","setCoin","divName","linkName","coin","coinLink","stringID","explorerCoin","counterSwap","redeem","counterRedeem","refund","swapSpan","cSwapSpan","inCounterSwapCast","inSwapCast","confirmationString","required","assetExplorer","CoinExplorers","explorerId","formatter","cid","txid","vout","loggersKey","recordersKey","constructors","register","wallets","unauthedPages","Application","pokes","accounts","process","loggers","enableLogger","loggerID","state","recorderKeys","recorders","recordLogger","on","dumpLogger","record","btoa","download","lang","handlerFromPath","history","replaceState","attachHeader","attachCommon","attach","protocol","reconnected","getJSON","skipNote","skipPush","noteBox","profileBox","origin","requestedHandler","ok","doc","noderize","delivered","pushState","replaceWith","handlerID","loadedPage","unload","constructor","lyt","layoutMetrics","popupNotes","popupTmpl","pg","noteTmpl","pokeTmpl","loader","backgroundColor","noteMenuEntry","pokeList","noteList","ackNotes","noteCat","pokeCat","showDropdown","noteIndicator","acked","setNoteTimes","storeNotes","profileMenuEntry","innerNoteIcon","innerProfileIcon","profileSignout","signOut","dialog","ico","innerWidth","isDisplayed","acks","pageURL","params","searchParams","walletsMenuEntry","marketsMenuEntry","node","isPaid","updateExchangeRegistration","confirmations","prependNoteElement","updateOrder","handleFeePaymentNote","updateMatch","indicator","setSeverityClass","pn","prependPokeElement","nowString","time","makePoke","prependListElement","skipSave","makeNote","unacked","ni","noteCacheSize","lastChild","cls","toLocaleDateString","toLocaleTimeString","o","resp","inited","clearAllStore","removeAuthCK","severityClassMap","getSeconds","getMilliseconds"],"sourceRoot":""}