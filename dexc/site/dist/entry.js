!function(t){var r={};function __webpack_require__(o){if(r[o])return r[o].exports;var a=r[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}__webpack_require__.m=t,__webpack_require__.c=r,__webpack_require__.d=function(t,r,o){__webpack_require__.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,r){if(1&r&&(t=__webpack_require__(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(__webpack_require__.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var a in t)__webpack_require__.d(o,a,function(r){return t[r]}.bind(null,a));return o},__webpack_require__.n=function(t){var r=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(r,"a",r),r},__webpack_require__.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},__webpack_require__.p="/dist/",__webpack_require__(__webpack_require__.s=2)}([function(t,r){t.exports="a141f4f93989c3d0a79b9c2ac8857e9d59d15a6d"},function(t,r,o){},function(t,r,o){"use strict";function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),t}o.r(r);var a=new window.DOMParser,i=Object.values({0:"btc",42:"dcr",2:"ltc",22:"mona",28:"vtc",3:"doge"}),l={minimumSignificantDigits:4,maximumSignificantDigits:8,minimumFractionDigits:8,maximumFractionDigits:8},c=function(){function Doc(){_classCallCheck(this,Doc)}var t;return _createClass(Doc,null,[{key:"idel",value:function idel(t,r){return t.querySelector("#".concat(r))}},{key:"bind",value:function bind(t,r,o){t.addEventListener(r,o)}},{key:"unbind",value:function unbind(t,r,o){t.removeEventListener(r,o)}},{key:"noderize",value:function noderize(t){return a.parseFromString(t,"text/html")}},{key:"mouseInElement",value:function mouseInElement(t,r){var o=r.getBoundingClientRect();return t.pageX>=o.left&&t.pageX<=o.right&&t.pageY>=o.top&&t.pageY<=o.bottom}},{key:"layoutMetrics",value:function layoutMetrics(t){var r=t.getBoundingClientRect(),o=document.documentElement,a=r.top+o.scrollTop,i=r.left+o.scrollLeft,l=t.offsetWidth,c=t.offsetHeight;return{bodyTop:a,bodyLeft:i,width:l,height:c,centerX:i+l/2,centerY:a+c/2}}},{key:"empty",value:function empty(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},{key:"hide",value:function hide(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];for(var a=0,i=r;a<i.length;a++){var l=i[a];l.classList.add("d-hide")}}},{key:"show",value:function show(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];for(var a=0,i=r;a<i.length;a++){var l=i[a];l.classList.remove("d-hide")}}},{key:"isHidden",value:function isHidden(t){return t.classList.contains("d-hide")}},{key:"isDisplayed",value:function isDisplayed(t){return!t.classList.contains("d-hide")}},{key:"animate",value:(t=function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}((function*(t,r,o){for(var a=o?u[o]:u.linear,i=(new Date).getTime(),l=i+t,c=l-i,d=i;d<l;)r(a((d-i)/c)),yield sleep(33.333333333333336),d=(new Date).getTime();r(1)})),function animate(r,o,a){return t.apply(this,arguments)})},{key:"parsePage",value:function parsePage(t,r){var o={};return r.forEach((function(r){o[r]=function get(r){return Doc.idel(t,r)}(r)})),o}},{key:"formatCoinValue",value:function formatCoinValue(t){var r=_slicedToArray(t.toLocaleString("en-us",l).split("."),2),o=r[0],a=r[1];return a?"00000000"===(a=a.substring(0,8))?o:"".concat(o,".").concat(a.replace(/,+$/,"")):o}},{key:"logoPath",value:function logoPath(t){return-1===i.indexOf(t)&&(t=t.substring(0,1)),"/img/coins/".concat(t,".png")}},{key:"tmplElement",value:function tmplElement(t,r){return t.querySelector('[data-tmpl="'.concat(r,'"]'))}},{key:"timeSince",value:function timeSince(t){var r,o,a,i,l,c,u=Math.floor((new Date).getTime()-t),d="",b=0,w=function add(t,r){return(t>0||b>0)&&b++,t>0&&(d+="".concat(t," ").concat(r," ")),b>=2},k=_slicedToArray(timeMod(u,h),2);if(r=k[0],u=k[1],w(r,"y"))return d;var _=_slicedToArray(timeMod(u,p),2);if(o=_[0],u=_[1],w(o,"mo"))return d;var S=_slicedToArray(timeMod(u,m),2);if(a=S[0],u=S[1],w(a,"d"))return d;var C=_slicedToArray(timeMod(u,v),2);if(i=C[0],u=C[1],w(i,"h"))return d;var O=_slicedToArray(timeMod(u,g),2);if(l=O[0],u=O[1],w(l,"m"))return d;var P=_slicedToArray(timeMod(u,1e3),2);return c=P[0],u=P[1],w(c,"s"),d||"0 s"}},{key:"disableMouseWheel",value:function disableMouseWheel(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];for(var a=0,i=r;a<i.length;a++){var l=i[a];l.addEventListener("wheel",(function(t){t.preventDefault()}))}}}]),Doc}(),u={linear:function linear(t){return t},easeIn:function easeIn(t){return t*t},easeOut:function easeOut(t){return t*(2-t)},easeInHard:function easeInHard(t){return t*t*t},easeOutHard:function easeOutHard(t){return--t*t*t+1}},d=function(){function WalletIcons(t){_classCallCheck(this,WalletIcons);var r=function stateElement(r){return t.querySelector("[data-state=".concat(r,"]"))};this.icons={},this.icons.sleeping=r("sleeping"),this.icons.locked=r("locked"),this.icons.unlocked=r("unlocked"),this.icons.nowallet=r("nowallet"),this.icons.syncing=r("syncing"),this.status=r("status")}return _createClass(WalletIcons,[{key:"sleeping",value:function sleeping(){var t=this.icons;c.hide(t.locked,t.unlocked,t.nowallet,t.syncing),c.show(t.sleeping),this.status&&(this.status.textContent="off")}},{key:"locked",value:function locked(){var t=this.icons;c.hide(t.unlocked,t.nowallet,t.sleeping),c.show(t.locked),this.status&&(this.status.textContent="locked")}},{key:"unlocked",value:function unlocked(){var t=this.icons;c.hide(t.locked,t.nowallet,t.sleeping),c.show(t.unlocked),this.status&&(this.status.textContent="ready")}},{key:"nowallet",value:function nowallet(){var t=this.icons;c.hide(t.locked,t.unlocked,t.sleeping,t.syncing),c.show(t.nowallet),this.status&&(this.status.textContent="no wallet")}},{key:"setSyncing",value:function setSyncing(t){var r=this.icons.syncing;t&&t.running?t.synced?c.hide(r):(c.show(r),r.dataset.tooltip="wallet is ".concat((100*t.syncProgress).toFixed(1),"% synced")):c.hide(r)}},{key:"readWallet",value:function readWallet(t){switch(this.setSyncing(t),!0){case!t:this.nowallet();break;case!t.running:this.sleeping();break;case!t.open:this.locked();break;case t.open:this.unlocked();break;default:console.error("wallet in unknown state",t)}}}]),WalletIcons}();function sleep(t){return new Promise((function(r){return setTimeout(r,t)}))}var h=31536e6,p=2592e6,m=864e5,v=36e5,g=6e4;function timeMod(t,r){var o=Math.floor(t/r);return[o,t-o*r]}function state_slicedToArray(t,r){return function state_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function state_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||state_unsupportedIterableToArray(t,r)||function state_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function state_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return state_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?state_arrayLikeToArray(t,r):void 0}}function state_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function state_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var b=function(){function State(){!function state_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,State)}return function state_createClass(t,r,o){return r&&state_defineProperties(t.prototype,r),o&&state_defineProperties(t,o),t}(State,null,[{key:"setCookie",value:function setCookie(t,r){var o=new Date;o.setTime(o.getTime()+31536e7);var a="expires="+o.toUTCString();document.cookie=t+"="+r+";"+a+";path=/"}},{key:"getCookie",value:function getCookie(t){var r,o=function _createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=state_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}(document.cookie.split(";"));try{for(o.s();!(r=o.n()).done;){var a=state_slicedToArray(r.value.split("="),2),i=a[0],l=a[1];if(i.trim()===t)return l}}catch(t){o.e(t)}finally{o.f()}return null}},{key:"dark",value:function dark(t){this.setCookie("darkMode",t?"1":"0"),t?document.body.classList.add("dark"):document.body.classList.remove("dark")}},{key:"isDark",value:function isDark(){return document.cookie.split(";").filter((function(t){return t.includes("".concat("darkMode","=1"))})).length}},{key:"store",value:function store(t,r){window.localStorage.setItem(t,JSON.stringify(r))}},{key:"clearAllStore",value:function clearAllStore(){window.localStorage.clear()}},{key:"removeAuthCK",value:function removeAuthCK(){document.cookie="".concat("dexauth","=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")}},{key:"fetch",value:function fetch(t){var r=window.localStorage.getItem(t);return null!==r?JSON.parse(r):null}}]),State}();function basepage_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}null===b.getCookie("darkMode")&&b.setCookie("darkMode","1"),null===b.getCookie("popups")&&b.setCookie("popups","1");var w,k=function(){function BasePage(){!function basepage_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,BasePage)}return function basepage_createClass(t,r,o){return r&&basepage_defineProperties(t.prototype,r),o&&basepage_defineProperties(t,o),t}(BasePage,[{key:"notify",value:function notify(t){this.notifiers&&this.notifiers[t.type]&&this.notifiers[t.type](t)}},{key:"unload",value:function unload(){}}]),BasePage}();function http_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function http_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){http_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){http_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function requestJSON(t,r,o){return _requestJSON.apply(this,arguments)}function _requestJSON(){return(_requestJSON=http_asyncToGenerator((function*(t,r,o){try{var a=yield window.fetch(r,{method:t,headers:new window.Headers({"content-type":"application/json"}),body:o});if(200!==a.status)throw a;var i=yield a.json();return i.requestSuccessful=!0,i}catch(a){return a.requestSuccessful=!1,a.msg=yield a.text(),a}}))).apply(this,arguments)}function postJSON(t,r){return _postJSON.apply(this,arguments)}function _postJSON(){return(_postJSON=http_asyncToGenerator((function*(t,r){return requestJSON("POST",t,JSON.stringify(r))}))).apply(this,arguments)}function _getJSON(){return(_getJSON=http_asyncToGenerator((function*(t){return requestJSON("GET",t)}))).apply(this,arguments)}function forms_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=forms_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return forms_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||forms_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function forms_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return forms_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?forms_arrayLikeToArray(t,r):void 0}}function forms_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function forms_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function forms_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){forms_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){forms_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function forms_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function forms_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function forms_createClass(t,r,o){return r&&forms_defineProperties(t.prototype,r),o&&forms_defineProperties(t,o),t}var _=function(){function NewWalletForm(t,r,o){var a=this;forms_classCallCheck(this,NewWalletForm),this.form=r,this.currentAsset=null;var i=this.fields=c.parsePage(r,["nwAssetLogo","nwAssetName","newWalletPass","nwAppPass","walletSettings","selectCfgFile","cfgFile","submitAdd","newWalletErr"]);this.subform=new S(t,i.walletSettings,!0),bind(r,i.submitAdd,forms_asyncToGenerator((function*(){if(""===i.nwAppPass.value)return i.newWalletErr.textContent="app password cannot be empty",void c.show(i.newWalletErr);c.hide(i.newWalletErr);var t={assetID:parseInt(a.currentAsset.id),pass:i.newWalletPass.value||"",config:a.subform.map(),appPass:i.nwAppPass.value};i.nwAppPass.value="",w.loading(r);var l=yield postJSON("/api/newwallet",t);w.loaded(),w.checkResponse(l)?(i.newWalletPass.value="",o()):a.setError(l.msg)})))}var t,r,o;return forms_createClass(NewWalletForm,[{key:"setAsset",value:(o=forms_asyncToGenerator((function*(t){var r=this.fields;this.currentAsset&&this.currentAsset.id===t.id||(this.currentAsset=t,r.nwAssetLogo.src=c.logoPath(t.symbol),r.nwAssetName.textContent=t.info.name,r.newWalletPass.value="",this.subform.update(t.info),c.hide(r.newWalletErr))})),function setAsset(t){return o.apply(this,arguments)})},{key:"setError",value:(r=forms_asyncToGenerator((function*(t){this.fields.newWalletErr.textContent=t,c.show(this.fields.newWalletErr)})),function setError(t){return r.apply(this,arguments)})},{key:"loadDefaults",value:(t=forms_asyncToGenerator((function*(){w.loading(this.form);var t=yield postJSON("/api/defaultwalletcfg",{assetID:this.currentAsset.id});w.loaded(),w.checkResponse(t)?this.subform.setLoadedConfig(t.config):this.setError(t.msg)})),function loadDefaults(){return t.apply(this,arguments)})}]),NewWalletForm}(),S=function(){function WalletConfigForm(t,r,o){var a=this;forms_classCallCheck(this,WalletConfigForm),w=t,this.form=r,this.configElements={},this.configOpts=[],this.sectionize=o,this.allSettings=c.tmplElement(r,"allSettings"),this.dynamicOpts=c.tmplElement(r,"dynamicOpts"),this.textInputTmpl=c.tmplElement(r,"textInput"),this.textInputTmpl.remove(),this.checkboxTmpl=c.tmplElement(r,"checkbox"),this.checkboxTmpl.remove(),this.fileSelector=c.tmplElement(r,"fileSelector"),this.fileInput=c.tmplElement(r,"fileInput"),this.errMsg=c.tmplElement(r,"errMsg"),this.showOther=c.tmplElement(r,"showOther"),this.showIcon=c.tmplElement(r,"showIcon"),this.hideIcon=c.tmplElement(r,"hideIcon"),this.showHideMsg=c.tmplElement(r,"showHideMsg"),this.otherSettings=c.tmplElement(r,"otherSettings"),this.loadedSettingsMsg=c.tmplElement(r,"loadedSettingsMsg"),this.loadedSettings=c.tmplElement(r,"loadedSettings"),this.defaultSettingsMsg=c.tmplElement(r,"defaultSettingsMsg"),this.defaultSettings=c.tmplElement(r,"defaultSettings"),o||c.hide(this.showOther),c.bind(this.fileSelector,"click",(function(){return a.fileInput.click()})),c.bind(this.fileInput,"change",forms_asyncToGenerator((function*(){return a.fileInputChanged()}))),c.bind(this.showOther,"click",(function(){a.setOtherSettingsViz(a.hideIcon.classList.contains("d-hide"))}))}var t;return forms_createClass(WalletConfigForm,[{key:"fileInputChanged",value:(t=forms_asyncToGenerator((function*(){var t;if(this.fileInput.value){w.loading(this.form);var r=yield this.fileInput.files[0].text();if(r){var o=yield postJSON("/api/parseconfig",{configtext:r});if(w.loaded(),!w.checkResponse(o))return this.errMsg.textContent=o.msg,void c.show(this.errMsg);if(0!==Object.keys(o.map).length){(t=this.dynamicOpts).append.apply(t,_toConsumableArray(this.setConfig(o.map))),this.reorder(this.dynamicOpts);var a=[this.loadedSettings.children.length,this.defaultSettings.children.length],i=a[0],l=a[1];0===i&&c.hide(this.loadedSettings,this.loadedSettingsMsg),0===l&&c.hide(this.defaultSettings,this.defaultSettingsMsg),i+l===0&&c.hide(this.showOther,this.otherSettings)}}}})),function fileInputChanged(){return t.apply(this,arguments)})},{key:"update",value:function update(t){var r=this;this.configElements={},this.configOpts=t.configopts,c.empty(this.dynamicOpts,this.otherSettings),this.setOtherSettingsViz(!1),c.hide(this.loadedSettingsMsg,this.loadedSettings,this.defaultSettingsMsg,this.defaultSettings,this.errMsg);var o,a=[],i=function addOpt(t,o){var a="wcfg-"+o.key,i=o.isboolean?r.checkboxTmpl.cloneNode(!0):r.textInputTmpl.cloneNode(!0);r.configElements[o.key]=i;var l=i.querySelector("input");l.id=a,l.configOpt=o;var c=i.querySelector("label");c.htmlFor=a,c.prepend(o.displayname),t.appendChild(i),o.noecho&&(l.type="password"),o.description&&(c.dataset.tooltip=o.description),o.isboolean?l.checked=o.default:l.value=null!==o.default?o.default:""},l=forms_createForOfIteratorHelper(this.configOpts);try{for(l.s();!(o=l.n()).done;){var u=o.value;this.sectionize&&null!==u.default?a.push(u):i(this.dynamicOpts,u)}}catch(t){l.e(t)}finally{l.f()}if(a.length){var d,h=forms_createForOfIteratorHelper(a);try{for(h.s();!(d=h.n()).done;){var p=d.value;i(this.defaultSettings,p)}}catch(t){h.e(t)}finally{h.f()}c.show(this.showOther,this.defaultSettingsMsg,this.defaultSettings)}else c.hide(this.showOther);w.bindTooltips(this.allSettings)}},{key:"setOtherSettingsViz",value:function setOtherSettingsViz(t){if(t)return c.hide(this.showIcon),c.show(this.hideIcon,this.otherSettings),void(this.showHideMsg.textContent="hide additional settings");c.hide(this.hideIcon,this.otherSettings),c.show(this.showIcon),this.showHideMsg.textContent="show additional settings"}},{key:"setConfig",value:function setConfig(t){var r=this,o=[];return this.allSettings.querySelectorAll("input").forEach((function(a){var i=a.configOpt.key,l=t[i];void 0!==l&&(o.push(r.configElements[i]),a.configOpt.isboolean?a.checked=function isTruthyString(t){return"1"===t||"true"===t.toLowerCase()}(l):a.value=l)})),o}},{key:"setLoadedConfig",value:function setLoadedConfig(t){var r,o=this.setConfig(t);this.sectionize&&0!==o.length&&((r=this.loadedSettings).append.apply(r,_toConsumableArray(o)),this.reorder(this.loadedSettings),c.show(this.loadedSettings,this.loadedSettingsMsg),0===this.defaultSettings.children.length&&c.hide(this.defaultSettings,this.defaultSettingsMsg))}},{key:"map",value:function map(){var t={};return this.allSettings.querySelectorAll("input").forEach((function(r){r.configOpt.isboolean&&r.configOpt.key?t[r.configOpt.key]=r.checked?"1":"0":r.value&&(t[r.configOpt.key]=r.value)})),t}},{key:"reorder",value:function reorder(t){var r=this,o={};t.querySelectorAll("input").forEach((function(t){var a=t.configOpt.key;o[a]=r.configElements[a]}));var a,i=forms_createForOfIteratorHelper(this.configOpts);try{for(i.s();!(a=i.n()).done;){var l=a.value,c=o[l.key];c&&t.append(c)}}catch(t){i.e(t)}finally{i.f()}}}]),WalletConfigForm}();function bindOpenWallet(t,r,o){var a,i=c.parsePage(r,["uwAssetLogo","uwAssetName","uwAppPass","submitUnlock","unlockErr"]);r.setAsset=function(t){a=t,i.uwAssetLogo.src=c.logoPath(t.symbol),i.uwAssetName.textContent=t.info.name,i.uwAppPass.value=""},bind(r,i.submitUnlock,forms_asyncToGenerator((function*(){if(""===i.uwAppPass.value)return i.unlockErr.textContent="app password cannot be empty",void c.show(i.unlockErr);c.hide(i.unlockErr);var l={assetID:parseInt(a.id),pass:i.uwAppPass.value};i.uwAppPass.value="",t.loading(r);var u=yield postJSON("/api/openwallet",l);if(t.loaded(),!t.checkResponse(u))return i.unlockErr.textContent=u.msg,void c.show(i.unlockErr);o()})))}function bind(t,r,o){var a=function wrapper(t){t.preventDefault&&t.preventDefault(),o(t)};c.bind(r,"click",a),c.bind(t,"submit",a)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function register_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function register_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){register_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){register_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function register_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _setPrototypeOf(t,r){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){return!r||"object"!==_typeof(r)&&"function"!=typeof r?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var C,O,P=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&_setPrototypeOf(t,r)}(RegistrationPage,t);var r,o,a,i,l,u=_createSuper(RegistrationPage);function RegistrationPage(t,r){var o;!function register_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RegistrationPage),o=u.call(this),C=t,o.body=r,o.notifiers={};var a=o.page=c.parsePage(r,["appPWForm","appPW","appPWAgain","appPWSubmit","appPWErrMsg","newWalletForm","unlockWalletForm","dexAddrForm","dexAddr","certFile","selectedCert","removeCert","addCert","submitDEXAddr","dexAddrErr","dexCertFile","dexNeedCert","dexShowMore","confirmRegForm","feeDisplay","appPass","submitConfirm","regErr","dexCertBox"]);return r.querySelectorAll(".form-closer").forEach((function(t){return c.hide(t)})),bind(a.appPWForm,a.appPWSubmit,(function(){o.setAppPass()})),o.walletForm=new _(C,a.newWalletForm,(function(){o.changeForm(a.newWalletForm,a.dexAddrForm)})),o.walletForm.setAsset(C.assets[42]),bindOpenWallet(C,a.unlockWalletForm,(function(){o.changeForm(a.unlockWalletForm,a.dexAddrForm)})),a.unlockWalletForm.setAsset(C.assets[42]),o.defaultTLSText="none selected",a.selectedCert.textContent=o.defaultTLSText,c.bind(a.certFile,"change",(function(){return o.readCert()})),c.bind(a.removeCert,"click",(function(){return o.resetCert()})),c.bind(a.addCert,"click",(function(){return a.certFile.click()})),bind(a.dexAddrForm,a.submitDEXAddr,(function(){o.checkDEX()})),c.bind(a.dexShowMore,"click",(function(){c.hide(a.dexShowMore),c.show(a.dexCertBox)})),bind(a.confirmRegForm,a.submitConfirm,(function(){o.registerDEX()})),o.walletForm.loadDefaults(),o}return function register_createClass(t,r,o){return r&&register_defineProperties(t.prototype,r),o&&register_defineProperties(t,o),t}(RegistrationPage,[{key:"changeForm",value:(l=register_asyncToGenerator((function*(t,r){var o=this.body.offsetWidth/2;yield c.animate(300,(function(r){t.style.right="".concat(r*o,"px")}),"easeInHard"),c.hide(t),t.style.right="0px",r.style.right=-o,c.show(r),r.querySelector("input").focus(),yield c.animate(300,(function(t){r.style.right="".concat(t*o-o,"px")}),"easeOutHard"),r.style.right="0px"})),function changeForm(t,r){return l.apply(this,arguments)})},{key:"setAppPass",value:(i=register_asyncToGenerator((function*(){var t=this.page;c.hide(t.appPWErrMsg);var r=t.appPW.value,o=t.appPWAgain.value;if(""===r)return t.appPWErrMsg.textContent="password cannot be empty",void c.show(t.appPWErrMsg);if(r!==o)return t.appPWErrMsg.textContent="passwords do not match",void c.show(t.appPWErrMsg);C.setNotes([]),t.appPW.value="",t.appPWAgain.value="",C.loading(t.appPWForm);var a=yield postJSON("/api/init",{pass:r});if(C.loaded(),!C.checkResponse(a))return t.appErrMsg.textContent=a.msg,void c.show(t.appErrMsg);C.user.authed=!0,C.updateMenuItemsDisplay(),this.changeForm(t.appPWForm,t.newWalletForm)})),function setAppPass(){return i.apply(this,arguments)})},{key:"checkDEX",value:(a=register_asyncToGenerator((function*(){var t=this.page;c.hide(t.dexAddrErr);var r=t.dexAddr.value;if(""===r)return t.dexAddrErr.textContent="DEX address cannot be empty",void c.show(t.dexAddrErr);var o="";t.certFile.value&&(o=yield t.certFile.files[0].text()),C.loading(t.dexAddrForm);var a=yield postJSON("/api/getfee",{addr:r,cert:o});C.loaded(),C.checkResponse(a,!0)?(this.fee=a.fee,t.feeDisplay.textContent=c.formatCoinValue(a.fee/1e8),yield this.changeForm(t.dexAddrForm,t.confirmRegForm)):"certificate required"===a.msg?(c.hide(t.dexShowMore),c.show(t.dexCertBox,t.dexNeedCert)):(t.regErr.textContent=a.msg,c.show(t.regErr))})),function checkDEX(){return a.apply(this,arguments)})},{key:"registerDEX",value:(o=register_asyncToGenerator((function*(){var t=this.page;c.hide(t.regErr);var r="";t.certFile.value&&(r=yield t.certFile.files[0].text());var o={addr:t.dexAddr.value,pass:t.appPass.value,fee:this.fee,cert:r};t.appPass.value="",C.loading(t.confirmRegForm);var a=yield postJSON("/api/register",o);if(C.loaded(),!C.checkResponse(a))return t.regErr.textContent=a.msg,void c.show(t.regErr);yield C.fetchUser(),C.loadPage("markets")})),function registerDEX(){return o.apply(this,arguments)})},{key:"readCert",value:(r=register_asyncToGenerator((function*(){var t=this.page,r=t.certFile.files;r.length&&(t.selectedCert.textContent=r[0].name,c.show(t.removeCert),c.hide(t.addCert))})),function readCert(){return r.apply(this,arguments)})},{key:"resetCert",value:function resetCert(){var t=this.page;t.certFile.value="",t.selectedCert.textContent=this.defaultTLSText,c.hide(t.removeCert),c.show(t.addCert)}}]),RegistrationPage}(k);function login_typeof(t){return(login_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function login_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function login_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function login_setPrototypeOf(t,r){return(login_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function login_createSuper(t){var r=function login_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=login_getPrototypeOf(t);if(r){var i=login_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return login_possibleConstructorReturn(this,o)}}function login_possibleConstructorReturn(t,r){return!r||"object"!==login_typeof(r)&&"function"!=typeof r?function login_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function login_getPrototypeOf(t){return(login_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var T=function(t){!function login_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&login_setPrototypeOf(t,r)}(LoginPage,t);var r,o=login_createSuper(LoginPage);function LoginPage(t,r){var a;!function login_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,LoginPage),a=o.call(this),O=t;var i=a.page=c.parsePage(r,["submit","errMsg","loginForm","pw"]);return bind(i.loginForm,i.submit,(function(){a.login()})),i.pw.focus(),a}return function login_createClass(t,r,o){return r&&login_defineProperties(t.prototype,r),o&&login_defineProperties(t,o),t}(LoginPage,[{key:"login",value:(r=function login_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){login_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){login_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}((function*(t){var r=this.page;c.hide(r.errMsg);var o=r.pw.value;if(r.pw.value="",""===o)return r.errMsg.textContent="password cannot be empty",void c.show(r.errMsg);O.loading(r.loginForm);var a=yield postJSON("/api/login",{pass:o});if(O.loaded(),!O.checkResponse(a))return r.errMsg.textContent=a.msg,void c.show(r.errMsg);a.notes&&a.notes.reverse(),O.setNotes(a.notes||[]),yield O.fetchUser(),O.loadPage("markets")})),function login(t){return r.apply(this,arguments)})}]),LoginPage}(k);function make(t,r,o){return{subject:t,details:r,severity:o,stamp:(new Date).getTime()}}function wallets_typeof(t){return(wallets_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wallets_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function wallets_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){wallets_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){wallets_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function wallets_slicedToArray(t,r){return function wallets_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function wallets_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||wallets_unsupportedIterableToArray(t,r)||function wallets_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wallets_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return wallets_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?wallets_arrayLikeToArray(t,r):void 0}}function wallets_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function wallets_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function wallets_setPrototypeOf(t,r){return(wallets_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function wallets_createSuper(t){var r=function wallets_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=wallets_getPrototypeOf(t);if(r){var i=wallets_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return wallets_possibleConstructorReturn(this,o)}}function wallets_possibleConstructorReturn(t,r){return!r||"object"!==wallets_typeof(r)&&"function"!=typeof r?wallets_assertThisInitialized(t):r}function wallets_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wallets_getPrototypeOf(t){return(wallets_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var A,E=c.bind,I=function(t){!function wallets_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&wallets_setPrototypeOf(t,r)}(WalletsPage,t);var r,o,a,i,l,u,h,p,m,v,g,b,w,k,C,O,P,T=wallets_createSuper(WalletsPage);function WalletsPage(t,r){var o;!function wallets_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,WalletsPage),o=T.call(this),A=t,o.body=r;var a,i,l=o.page=c.parsePage(r,["rightBox","assetArrow","balanceArrow","statusArrow","walletTable","markets","dexTitle","marketsBox","oneMarket","marketsFor","marketsCard","walletForm","openForm","walletReconfig","recfgAssetLogo","recfgAssetName","reconfigInputs","submitReconfig","reconfigErr","reconfigPW","changePW","walletRepw","repwAssetLogo","repwAssetName","repwNewPw","repwAppPw","submitRepw","repwErr","deposit","depositName","depositAddress","newDepAddrBttn","depositErr","depositLogo","withdrawForm","withdrawLogo","withdrawName","withdrawAddr","withdrawAmt","withdrawAvail","submitWithdraw","withdrawUnit","withdrawPW","withdrawErr"]),u=function getAction(t,r){return t.querySelector("[data-action=".concat(r,"]"))},h=o.rowInfos={},p=function wallets_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=wallets_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}(l.walletTable.querySelectorAll("tr"));try{for(p.s();!(i=p.n()).done;){var m=i.value,v=parseInt(m.dataset.assetID),g=h[v]={};a||(a=g),g.assetID=v,g.tr=m,g.symbol=m.dataset.symbol,g.name=m.dataset.name,g.stateIcons=new d(m),g.actions={connect:u(m,"connect"),unlock:u(m,"unlock"),withdraw:u(m,"withdraw"),deposit:u(m,"deposit"),create:u(m,"create"),lock:u(m,"lock"),settings:u(m,"settings")}}}catch(t){p.e(t)}finally{p.f()}l.dexTitle.removeAttribute("id"),l.dexTitle.remove(),l.oneMarket.removeAttribute("id"),l.oneMarket.remove(),l.markets.removeAttribute("id"),l.markets.remove(),o.displayed=null,o.animation=null,o.openAsset=null,o.walletAsset=null,o.reconfigAsset=null,o.walletForm=new _(A,l.walletForm,(function(){o.createWalletSuccess()})),o.walletReconfig=new S(A,l.reconfigInputs,!1),bindOpenWallet(A,l.openForm,(function(){o.openWalletSuccess()})),bind(l.withdrawForm,l.submitWithdraw,(function(){o.withdraw()})),bind(l.walletReconfig,l.submitReconfig,(function(){return o.reconfig()}));for(var b=function _loop(){var t=k[w];E(t.tr,"click",(function(){o.showMarkets(t.assetID)}))},w=0,k=Object.values(h);w<k.length;w++)b();l.rightBox.querySelectorAll(".form-closer").forEach((function(t){c.bind(t,"click",(function(){o.showMarkets(o.lastFormAsset)}))}));for(var C=function _loop2(){var t=wallets_slicedToArray(P[O],2),r=t[0],a=t[1],i=parseInt(r),l=a.actions,c=function run(t,r){t.stopPropagation(),r(i,a)};E(l.connect,"click",(function(t){c(t,o.doConnect.bind(wallets_assertThisInitialized(o)))})),E(l.withdraw,"click",(function(t){c(t,o.showWithdraw.bind(wallets_assertThisInitialized(o)))})),E(l.deposit,"click",(function(t){c(t,o.showDeposit.bind(wallets_assertThisInitialized(o)))})),E(l.create,"click",(function(t){c(t,o.showNewWallet.bind(wallets_assertThisInitialized(o)))})),E(l.unlock,"click",(function(t){c(t,o.showOpen.bind(wallets_assertThisInitialized(o)))})),E(l.lock,"click",function(){var t=wallets_asyncToGenerator((function*(t){c(t,o.lock.bind(wallets_assertThisInitialized(o)))}));return function(r){return t.apply(this,arguments)}}()),E(l.settings,"click",(function(t){c(t,o.showReconfig.bind(wallets_assertThisInitialized(o)))}))},O=0,P=Object.entries(h);O<P.length;O++)C();return E(l.newDepAddrBttn,"click",wallets_asyncToGenerator((function*(){o.newDepositAddress()}))),E(l.withdrawAvail,"click",(function(){l.withdrawAmt.value=l.withdrawAvail.textContent})),E(l.changePW,"click",(function(){o.showChangePW()})),bind(l.walletRepw,l.submitRepw,(function(){o.submitChangePW()})),a?(o.showMarkets(a.assetID),o.notifiers={balance:function balance(t){o.handleBalanceNote(t)},walletstate:function walletstate(t){o.handleWalletStateNote(t)},walletconfig:function walletconfig(t){o.handleWalletStateNote(t)}},o):wallets_possibleConstructorReturn(o)}return function wallets_createClass(t,r,o){return r&&wallets_defineProperties(t.prototype,r),o&&wallets_defineProperties(t,o),t}(WalletsPage,[{key:"hideBox",value:(P=wallets_asyncToGenerator((function*(){this.animation&&(yield this.animation),this.displayed&&c.hide(this.displayed)})),function hideBox(){return P.apply(this,arguments)})},{key:"showBox",value:(O=wallets_asyncToGenerator((function*(t,r){t.style.opacity="0",c.show(t),r&&r.focus(),yield c.animate(300,(function(r){t.style.opacity="".concat(r)}),"easeOut"),t.style.opacity="1",this.displayed=t})),function showBox(t,r){return O.apply(this,arguments)})},{key:"showMarkets",value:(C=wallets_asyncToGenerator((function*(t){var r=this.page,o=r.marketsBox,a=r.marketsCard,i=this.rowInfos[t];yield this.hideBox(),c.empty(a),r.marketsFor.textContent=i.name;for(var l=0,u=Object.entries(A.user.exchanges);l<u.length;l++){for(var d=wallets_slicedToArray(u[l],2),h=d[0],p=d[1],m=0,v=0,g=Object.values(p.markets);v<g.length;v++){var b=g[v];b.baseid!==t&&b.quoteid!==t||m++}if(0!==m){var w=r.dexTitle.cloneNode(!0);w.textContent=h,a.appendChild(w);var k=r.markets.cloneNode(!0);a.appendChild(k);for(var _=function _loop3(){var o=C[S];if(o.baseid!==t&&o.quoteid!==t)return"continue";var a=r.oneMarket.cloneNode(!0);a.querySelector("span").textContent=prettyMarketName(o);var i=o.basesymbol;o.baseid===t&&(i=o.quotesymbol),a.querySelector("img").src=c.logoPath(i);var l={host:h,base:o.baseid,quote:o.quoteid};E(a,"click",(function(){A.loadPage("markets",l)})),k.appendChild(a)},S=0,C=Object.values(p.markets);S<C.length;S++)_()}}this.animation=this.showBox(o)})),function showMarkets(t){return C.apply(this,arguments)})},{key:"showNewWallet",value:(k=wallets_asyncToGenerator((function*(t){var r=this.page.walletForm,o=A.assets[t];yield this.hideBox(),this.walletAsset=this.lastFormAsset=t,this.walletForm.setAsset(o),this.animation=this.showBox(r),yield this.walletForm.loadDefaults()})),function showNewWallet(t){return k.apply(this,arguments)})},{key:"showOpen",value:(w=wallets_asyncToGenerator((function*(t){var r=this.page;this.openAsset=this.lastFormAsset=t,yield this.hideBox(),r.openForm.setAsset(A.assets[t]),this.animation=this.showBox(r.openForm,r.walletPass)})),function showOpen(t){return w.apply(this,arguments)})},{key:"showReconfig",value:(b=wallets_asyncToGenerator((function*(t){var r=this.page;c.hide(r.reconfigErr);var o=A.assets[t];this.walletReconfig.update(o.info),r.recfgAssetLogo.src=c.logoPath(o.symbol),r.recfgAssetName.textContent=o.info.name,this.reconfigAsset=this.lastFormAsset=t,yield this.hideBox(),this.animation=this.showBox(r.walletReconfig),A.loading(r.walletReconfig);var a=yield postJSON("/api/walletsettings",{assetID:t});if(A.loaded(),!A.checkResponse(a,!0))return r.reconfigErr.textContent=a.msg,void c.show(r.reconfigErr);this.walletReconfig.setConfig(a.map)})),function showReconfig(t){return b.apply(this,arguments)})},{key:"showChangePW",value:(g=wallets_asyncToGenerator((function*(){var t=this.page;c.hide(t.repwErr);var r=this.lastFormAsset=this.reconfigAsset,o=A.assets[r];t.repwAssetLogo.src=c.logoPath(o.symbol),t.repwAssetName.textContent=o.info.name,yield this.hideBox(),this.animation=this.showBox(t.walletRepw)})),function showChangePW(){return g.apply(this,arguments)})},{key:"submitChangePW",value:(v=wallets_asyncToGenerator((function*(){var t=this.page;if(c.hide(t.repwErr),!t.repwAppPw.value)return t.repwErr.textContent="app password cannot be empty",void c.show(t.repwErr);A.loading(t.walletRepw);var r=yield postJSON("/api/setwalletpass",{assetID:this.reconfigAsset,newPW:t.repwNewPw.value,appPW:t.repwAppPw.value});if(t.repwNewPw.value="",t.repwAppPw.value="",A.loaded(),!A.checkResponse(r,!0))return t.repwErr.textContent=r.msg,void c.show(t.repwErr);this.showMarkets(this.reconfigAsset)})),function submitChangePW(){return v.apply(this,arguments)})},{key:"showDeposit",value:(m=wallets_asyncToGenerator((function*(t){var r=this.page;c.hide(r.depositErr);var o=r.deposit,a=A.assets[t];r.depositLogo.src=c.logoPath(a.symbol);var i=A.walletMap[t];this.depositAsset=this.lastFormAsset=t,i?(yield this.hideBox(),r.depositName.textContent=a.info.name,r.depositAddress.textContent=i.address,this.animation=this.showBox(o)):A.notify(make("No wallet found for ".concat(a.info.name),"Cannot retrieve deposit address.",5))})),function showDeposit(t){return m.apply(this,arguments)})},{key:"newDepositAddress",value:(p=wallets_asyncToGenerator((function*(){var t=this.page;c.hide(t.depositErr),A.loading(t.deposit);var r=yield postJSON("/api/depositaddress",{assetID:this.depositAsset});if(A.loaded(),!A.checkResponse(r,!0))return t.depositErr.textContent=r.msg,void c.show(t.depositErr);t.depositAddress.textContent=r.address})),function newDepositAddress(){return p.apply(this,arguments)})},{key:"showWithdraw",value:(h=wallets_asyncToGenerator((function*(t){var r=this.page,o=r.withdrawForm,a=A.assets[t],i=A.walletMap[t];i||A.notify(make("No wallet found for ".concat(a.info.name),"Cannot withdraw.",5)),yield this.hideBox(),r.withdrawAddr.value="",r.withdrawAmt.value="",r.withdrawAvail.textContent=(i.balance.available/1e8).toFixed(8),r.withdrawLogo.src=c.logoPath(a.symbol),r.withdrawName.textContent=a.info.name,o.dataset.assetID=this.lastFormAsset=t,this.animation=this.showBox(o,r.walletPass)})),function showWithdraw(t){return h.apply(this,arguments)})},{key:"doConnect",value:(u=wallets_asyncToGenerator((function*(t){A.loading(this.body);var r=yield postJSON("/api/connectwallet",{assetID:t});if(A.loaded(),A.checkResponse(r)){var o=this.rowInfos[t];c.hide(o.actions.connect)}})),function doConnect(t){return u.apply(this,arguments)})},{key:"createWalletSuccess",value:(l=wallets_asyncToGenerator((function*(){var t=this.rowInfos[this.walletAsset];this.showMarkets(t.assetID);var r=t.actions;c.hide(r.create),c.show(r.withdraw,r.deposit,r.settings),yield A.fetchUser(),A.walletMap[t.assetID].encrypted&&c.show(r.lock)})),function createWalletSuccess(){return l.apply(this,arguments)})},{key:"openWalletSuccess",value:(i=wallets_asyncToGenerator((function*(){var t=this.rowInfos[this.openAsset],r=t.actions;c.show(r.withdraw,r.deposit),c.hide(r.unlock,r.connect),A.walletMap[t.assetID].encrypted&&c.show(r.lock),this.showMarkets(this.openAsset)})),function openWalletSuccess(){return i.apply(this,arguments)})},{key:"withdraw",value:(a=wallets_asyncToGenerator((function*(){var t=this.page;c.hide(t.withdrawErr);var r=parseInt(t.withdrawForm.dataset.assetID),o={assetID:r,address:t.withdrawAddr.value,value:parseInt(Math.round(1e8*t.withdrawAmt.value)),pw:t.withdrawPW.value};A.loading(t.withdrawForm);var a=yield postJSON("/api/withdraw",o);if(A.loaded(),!A.checkResponse(a,!0))return t.withdrawErr.textContent=a.msg,void c.show(t.withdrawErr);this.showMarkets(r)})),function withdraw(){return a.apply(this,arguments)})},{key:"reconfig",value:(o=wallets_asyncToGenerator((function*(){var t=this.page;if(c.hide(t.reconfigErr),!t.reconfigPW.value)return t.reconfigErr.textContent="app password cannot be empty",void c.show(t.reconfigErr);A.loading(t.walletReconfig);var r=yield postJSON("/api/reconfigurewallet",{assetID:this.reconfigAsset,config:this.walletReconfig.map(),pw:t.reconfigPW.value});if(t.reconfigPW.value="",A.loaded(),!A.checkResponse(r,!0))return t.reconfigErr.textContent=r.msg,void c.show(t.reconfigErr);this.showMarkets(this.reconfigAsset)})),function reconfig(){return o.apply(this,arguments)})},{key:"lock",value:(r=wallets_asyncToGenerator((function*(t,r){var o=this.page;A.loading(o.walletForm);var a=yield postJSON("/api/closewallet",{assetID:t});if(A.loaded(),A.checkResponse(a)){var i=r.actions;c.hide(i.withdraw,i.lock,i.deposit),c.show(i.unlock)}})),function lock(t,o){return r.apply(this,arguments)})},{key:"handleBalanceNote",value:function handleBalanceNote(t){this.page.walletTable.querySelector('[data-balance-target="'.concat(t.assetID,'"]')).textContent=(t.balance.available/1e8).toFixed(8)}},{key:"handleWalletStateNote",value:function handleWalletStateNote(t){this.rowInfos[t.wallet.assetID].stateIcons.readWallet(t.wallet)}}]),WalletsPage}(k);function prettyMarketName(t){return"".concat(t.basesymbol.toUpperCase(),"-").concat(t.quotesymbol.toUpperCase())}function settings_typeof(t){return(settings_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function settings_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function settings_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){settings_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){settings_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function settings_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function settings_setPrototypeOf(t,r){return(settings_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function settings_createSuper(t){var r=function settings_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=settings_getPrototypeOf(t);if(r){var i=settings_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return settings_possibleConstructorReturn(this,o)}}function settings_possibleConstructorReturn(t,r){return!r||"object"!==settings_typeof(r)&&"function"!=typeof r?function settings_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function settings_getPrototypeOf(t){return(settings_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R,L=function(t){!function settings_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&settings_setPrototypeOf(t,r)}(SettingsPage,t);var r,o,a,i,l=settings_createSuper(SettingsPage);function SettingsPage(t,r){var o;!function settings_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,SettingsPage),o=l.call(this),R=t;var a=o.page=c.parsePage(r,["darkMode","commitHash","addADex","dexAddrForm","dexAddr","certFile","selectedCert","removeCert","addCert","submitDEXAddr","dexAddrErr","forms","confirmRegForm","feeDisplay","appPass","submitConfirm","regErr","showPokes"]);c.bind(a.darkMode,"click",(function(){b.dark(a.darkMode.checked),a.darkMode.checked?document.body.classList.add("dark"):document.body.classList.remove("dark")})),c.bind(a.showPokes,"click",(function(){var t=a.showPokes.checked;b.setCookie("popups",t?"1":"0"),R.showPopups=t})),a.commitHash.textContent=R.commitHash.substring(0,7),c.bind(a.addADex,"click",(function(){return o.showForm(a.dexAddrForm)})),c.bind(a.certFile,"change",(function(){return o.onCertFileChange()})),c.bind(a.removeCert,"click",(function(){return o.clearCertFile()})),c.bind(a.addCert,"click",(function(){return o.page.certFile.click()})),bind(a.dexAddrForm,a.submitDEXAddr,(function(){o.verifyDEX()})),bind(a.confirmRegForm,a.submitConfirm,(function(){o.registerDEX()}));var i=function closePopups(){c.hide(a.forms),a.appPass.value=""};return c.bind(a.forms,"mousedown",(function(t){c.mouseInElement(t,o.currentForm)||i()})),a.forms.querySelectorAll(".form-closer").forEach((function(t){c.bind(t,"click",(function(){i()}))})),o}return function settings_createClass(t,r,o){return r&&settings_defineProperties(t.prototype,r),o&&settings_defineProperties(t,o),t}(SettingsPage,[{key:"showForm",value:(i=settings_asyncToGenerator((function*(t){var r=this.page;this.currentForm=t,c.hide(r.dexAddrForm,r.confirmRegForm),t.style.right="10000px",c.show(r.forms,t);var o=(r.forms.offsetWidth+t.offsetWidth)/2;yield c.animate(300,(function(r){t.style.right="".concat((1-r)*o,"px")}),"easeOutHard"),t.style.right="0px"})),function showForm(t){return i.apply(this,arguments)})},{key:"onCertFileChange",value:(a=settings_asyncToGenerator((function*(){var t=this.page,r=t.certFile.files;r.length&&(t.selectedCert.textContent=r[0].name,c.show(t.removeCert),c.hide(t.addCert))})),function onCertFileChange(){return a.apply(this,arguments)})},{key:"clearCertFile",value:function clearCertFile(){var t=this.page;t.certFile.value="",t.selectedCert.textContent=this.defaultTLSText,c.hide(t.removeCert),c.show(t.addCert)}},{key:"verifyDEX",value:(o=settings_asyncToGenerator((function*(){var t=this.page;c.hide(t.dexAddrErr);var r=t.dexAddr.value;if(""===r)return t.dexAddrErr.textContent="URL cannot be empty",void c.show(t.dexAddrErr);var o="";t.certFile.value&&(o=yield t.certFile.files[0].text()),R.loading(t.dexAddrForm);var a=yield postJSON("/api/getfee",{addr:r,cert:o});if(R.loaded(),!R.checkResponse(a))return t.dexAddrErr.textContent=a.msg,void c.show(t.dexAddrErr);this.fee=a.fee,t.feeDisplay.textContent=c.formatCoinValue(a.fee/1e8),yield this.showForm(t.confirmRegForm)})),function verifyDEX(){return o.apply(this,arguments)})},{key:"registerDEX",value:(r=settings_asyncToGenerator((function*(){var t=this.page;c.hide(t.regErr);var r="";t.certFile.value&&(r=yield t.certFile.files[0].text());var o={addr:t.dexAddr.value,pass:t.appPass.value,fee:this.fee,cert:r};t.appPass.value="",R.loading(t.confirmRegForm);var a=yield postJSON("/api/register",o);if(!R.checkResponse(a))return t.regErr.textContent=a.msg,c.show(t.regErr),void R.loaded();t.dexAddr.value="",this.clearCertFile(),c.hide(t.forms),yield R.fetchUser(),R.loaded()})),function registerDEX(){return r.apply(this,arguments)})}]),SettingsPage}(k);function orderbook_slicedToArray(t,r){return function orderbook_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function orderbook_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||orderbook_unsupportedIterableToArray(t,r)||function orderbook_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function orderbook_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return orderbook_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?orderbook_arrayLikeToArray(t,r):void 0}}function orderbook_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function orderbook_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var q=function(){function OrderBook(t,r,o){!function orderbook_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OrderBook),this.base=t.base,this.baseSymbol=r,this.quote=t.quote,this.quoteSymbol=o,this.buys=t.book.buys||[],this.sells=t.book.sells||[]}return function orderbook_createClass(t,r,o){return r&&orderbook_defineProperties(t.prototype,r),o&&orderbook_defineProperties(t,o),t}(OrderBook,[{key:"add",value:function add(t){var r=t.sell?this.sells:this.buys;r.splice(function findIdx(t,r,o){for(var a in t)if(t[a].rate<r===o)return a;return t.length}(r,t.rate,!t.sell),0,t)}},{key:"remove",value:function remove(t){this.removeFromSide(this.sells,t)||this.removeFromSide(this.buys,t)}},{key:"removeFromSide",value:function removeFromSide(t,r){var o=orderbook_slicedToArray(this.findOrder(t,r),2),a=o[0],i=o[1];return!!a&&(t.splice(i,1),!0)}},{key:"findOrder",value:function findOrder(t,r){for(var o in t)if(t[o].token===r)return[t[o],o];return[null,-1]}},{key:"updateRemaining",value:function updateRemaining(t,r){this.updateRemainingSide(this.sells,t,r)||this.updateRemainingSide(this.buys,t,r)}},{key:"updateRemainingSide",value:function updateRemainingSide(t,r,o){var a=this.findOrder(t,r)[0];return!!a&&(a.qty=o,!0)}},{key:"setEpoch",value:function setEpoch(t){var r=function approve(r){return void 0===r.epoch||0===r.epoch||r.epoch===t};this.sells=this.sells.filter(r),this.buys=this.buys.filter(r)}},{key:"empty",value:function empty(){return!this.sells.length&&!this.buys.length}},{key:"count",value:function count(){return this.sells.length+this.buys.length}},{key:"bestGapOrder",value:function bestGapOrder(t){var r,o=null,a=function orderbook_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=orderbook_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(!i.epoch)return i;o||(o=i)}}catch(t){a.e(t)}finally{a.f()}return o}},{key:"bestGapBuy",value:function bestGapBuy(){return this.bestGapOrder(this.buys)}},{key:"bestGapSell",value:function bestGapSell(){return this.bestGapOrder(this.sells)}}]),OrderBook}();function charts_slicedToArray(t,r){return function charts_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function charts_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||function charts_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return charts_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return charts_arrayLikeToArray(t,r)}(t,r)||function charts_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function charts_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function charts_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function charts_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function charts_createClass(t,r,o){return r&&charts_defineProperties(t.prototype,r),o&&charts_defineProperties(t,o),t}var B=c.bind,M=c.unbind,D=2*Math.PI,W=String.fromCharCode(59914),N=String.fromCharCode(59915),j={axisLabel:"#b1b1b1",gridBorder:"#3a3a3a",gridLines:"#2a2a2a",gapLine:"#6b6b6b",value:"#9a9a9a",zoom:"#5b5b5b",zoomHover:"#aaa",sellLine:"#ae3333",buyLine:"#05a35a",sellFill:"#591a1a",buyFill:"#02572f",crosshairs:"#888",legendFill:"black",legendText:"#d5d5d5"},G={axisLabel:"#1b1b1b",gridBorder:"#3a3a3a",gridLines:"#dadada",gapLine:"#595959",value:"#4d4d4d",zoom:"#777",zoomHover:"#333",sellLine:"#99302b",buyLine:"#207a46",sellFill:"#bd5959",buyFill:"#4cad75",crosshairs:"#595959",legendFill:"#e6e6e6",legendText:"#1b1b1b"},U=function(){function DepthChart(t,r){var o=this;charts_classCallCheck(this,DepthChart),this.theme=b.isDark()?j:G,this.canvas=document.createElement("canvas"),this.parent=t,this.reporters=r,this.ctx=this.canvas.getContext("2d"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.book=null,this.dataExtents=null,this.zoomLevel=null,this.lotSize=null,this.rateStep=null,t.appendChild(this.canvas),this.mousePos=null,B(this.canvas,"mousemove",(function(t){o.mousePos={x:t.clientX-o.rect.left,y:t.clientY-o.rect.y},o.draw()})),B(this.canvas,"mouseleave",(function(){o.mousePos=null,o.draw()})),this.wheelLimiter=null,this.wheeled=function(){o.wheelLimiter=setTimeout((function(){o.wheelLimiter=null}),100)},B(this.canvas,"wheel",(function(t){o.wheel(t)})),this.resize=function(t){o.resize_(t)},B(window,"resize",this.resize),B(this.canvas,"click",(function(t){o.click(t)})),this.resize()}return charts_createClass(DepthChart,[{key:"unattach",value:function unattach(){M(window,"resize",this.resize)}},{key:"resize_",value:function resize_(){this.canvas.width=this.parent.clientWidth,this.canvas.height=this.parent.clientHeight;var t=new z(40,this.canvas.width,10,this.canvas.height-30),r=new z(40,this.canvas.width,this.canvas.height-30,this.canvas.height),o=new z(0,40,10,this.canvas.height-30);this.plotRegion=new H(this.ctx,t),this.xRegion=new H(this.ctx,r),this.yRegion=new H(this.ctx,o),this.zoomInBttn=new H(this.ctx,new z(0,0,0,0)),this.zoomOutBttn=new H(this.ctx,new z(0,0,0,0)),this.rect=this.canvas.getBoundingClientRect(),this.book&&this.draw()}},{key:"wheel",value:function wheel(t){this.zoom(t.deltaY<0)}},{key:"zoom",value:function zoom(t){this.zoomLevel&&(this.wheelLimiter||this.book.buys&&this.book.sells&&(this.wheeled(),this.zoomLevel*=t?2/3:1.5,this.zoomLevel=function clamp(t,r,o){return t<r?r:t>o?o:t}(this.zoomLevel,.005,2),this.draw()))}},{key:"click",value:function click(t){if(this.dataExtents){var r=t.clientX-this.rect.left,o=t.clientY-this.rect.y;if(this.zoomInBttn.contains(r,o))this.zoom(!0);else if(this.zoomOutBttn.contains(r,o))this.zoom(!1);else{var a=this.plotRegion.translator(this.dataExtents);this.reporters.price(a.unx(r))}}}},{key:"clear",value:function clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"set",value:function set(t,r,o){this.book=t,this.lotSize=r/1e8,this.rateStep=o/1e8,this.baseTicker=t.baseSymbol.toUpperCase(),this.quoteTicker=t.quoteSymbol.toUpperCase();var a=charts_slicedToArray(this.gap(),2),i=a[0],l=a[1],c=Math.max(l/i*5,.05);this.zoomLevel=Math.min(c,2),this.draw()}},{key:"draw",value:function draw(){var t=this;this.clear(),this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(var r=this.mousePos,o=this.book.buys,a=this.book.sells,i=charts_slicedToArray(this.gap(),2),l=i[0],c=i[1],u=this.zoomLevel*l/2,d=l+u,h=l-u,p=[],m=[],v=[],g=[],b=0,w=0,k=0;k<o.length;k++){var _=o[k];if(w+=_.qty,m.push([_.rate,w]),_.epoch||(b+=_.qty,p.push([_.rate,b])),_.rate<h)break}var S=p.length?last(p)[1]:0;p.push([h,S]);var C=m.length?last(m)[1]:0;m.push([h,C]),b=0,w=0;for(var O=0;O<a.length;O++){var P=a[O];if(w+=P.qty,g.push([P.rate,w]),P.epoch||(b+=P.qty,v.push([P.rate,b])),P.rate>d)break}var T=v.length?last(v)[1]:0;v.push([d,T]);var A=g.length?last(g)[1]:0;g.push([d,A]);var E=A&&C?1.05*Math.max(C,A):A||C||1,I=new z(h,d,0,E);this.dataExtents=I;var R=this.ctx;R.font="12px 'sans', sans-serif",R.fillStyle=this.theme.axisLabel;var L=makeLabels(R,this.plotRegion.height(),I.y.min,I.y.max,50,this.lotSize,this.book.baseSymbol),q=1.5*L.widest;this.yRegion.extents.x.max=q,this.plotRegion.extents.x.min=q,this.xRegion.extents.x.min=q;var B,M=makeLabels(R,this.plotRegion.width(),I.x.min,I.x.max,100,this.rateStep,"".concat(this.book.quoteSymbol,"/").concat(this.book.baseSymbol));if(R.lineWidth=1,this.plotRegion.plot(I,(function(o,a){o.strokeStyle=t.theme.gridBorder;var i=I.x,u=I.y;o.beginPath(),a.dataCoords((function(){o.moveTo(i.min,u.min),o.lineTo(i.min,u.max),o.lineTo(i.max,u.max),o.lineTo(i.max,u.min),o.lineTo(i.min,u.min)})),o.stroke(),o.strokeStyle=t.theme.gridLines,M.lbls.forEach((function(t){line(o,a.x(t.val),a.y(0),a.x(t.val),a.y(u.max))})),L.lbls.forEach((function(t){line(o,a.x(i.min),a.y(t.val),a.x(i.max),a.y(t.val))})),o.lineWidth=2.5,o.strokeStyle=t.theme.gapLine,line(o,a.x(l),a.y(0),a.x(l),a.y(.3*u.max)),o.font="30px 'demi-sans', sans-serif",o.fillStyle=t.theme.value;var d=.5*u.max;o.fillText(formatLabelValue(l),a.x(l),a.y(d)),o.font="12px 'sans', sans-serif",o.fillText("".concat((c/l*100).toFixed(2),"% spread"),a.x(l),a.y(d)+24);var h=t.plotRegion.extents.midX,m=a.y(.9*E),g=I.xRange/l*100,b="".concat(g.toFixed(1),"%"),w=o.measureText(b).width;o.font="13px 'sans', sans-serif",o.fillText(b,h,m+1);var k=h-w/2-10-20,_=m-10;t.zoomOutBttn.setExtents(k,k+20,_,_+20);var S=r&&t.zoomOutBttn.contains(r.x,r.y);if(t.zoomOutBttn.plot(new z(0,1,0,1),(function(r,o){r.font="12px 'icomoon'",r.fillStyle=t.theme.zoom,S&&(r.fillStyle=t.theme.zoomHover,r.font="13px 'icomoon'"),r.fillText(N,t.zoomOutBttn.extents.midX,t.zoomOutBttn.extents.midY)})),k=h+w/2+10,t.zoomInBttn.setExtents(k,k+20,_,_+20),S=r&&t.zoomInBttn.contains(r.x,r.y),t.zoomInBttn.plot(new z(0,1,0,1),(function(r,o){r.font="12px 'icomoon'",r.fillStyle=t.theme.zoom,S&&(r.fillStyle=t.theme.zoomHover,r.font="14px 'icomoon'"),r.fillText(W,t.zoomInBttn.extents.midX,t.zoomInBttn.extents.midY)})),r&&t.plotRegion.contains(r.x,r.y)){var C=a.unx(r.x),O=v,P=function trigger(t){return t>=C},T=t.theme.sellLine;C<l&&(O=p,P=function trigger(t){return t<=C},T=t.theme.buyLine);for(var A=O[0],R=0;R<O.length;R++){var q=O[R];if(P(q[0]))break;A=q}o.setLineDash([3,5]),o.lineWidth=1,o.strokeStyle=t.theme.crosshairs,line(o,a.x(C),a.y(0),a.x(C),a.y(E)),B={dataX:C,depth:A[1],dotColor:T}}})),this.yRegion.plot(new z(0,1,0,E),(function(r,o){var a=E/2,i=0,l=a;L.lbls.forEach((function(t){r.fillText(t.txt,o.x(.5),o.y(t.val)),a>=i&&a<t.val&&(l=(i+t.val)/2),i=t.val})),r.fillText(t.baseTicker,o.x(.5),o.y(l))}),!0),this.xRegion.plot(new z(h,d,0,1),(function(r,o){var a=(d+h)/2,i=h,l=a;M.lbls.forEach((function(t){r.fillText(t.txt,o.x(t.val),o.y(.5)),a>=i&&a<t.val&&(l=(i+t.val)/2),i=t.val})),r.font="11px 'sans', sans-serif",r.fillText("".concat(t.quoteTicker,"/"),o.x(l),o.y(.63)),r.fillText(t.baseTicker,o.x(l),o.y(.23))}),!0),this.ctx.lineWidth=1.5,R.setLineDash([3,3]),R.fillStyle=this.theme.sellFill,R.strokeStyle=this.theme.sellLine,this.drawDepth(g),R.fillStyle=this.theme.buyFill,R.strokeStyle=this.theme.buyLine,this.drawDepth(m),this.ctx.lineWidth=2.5,R.setLineDash([]),R.fillStyle=this.theme.sellFill,R.strokeStyle=this.theme.sellLine,this.drawDepth(v),R.fillStyle=this.theme.buyFill,R.strokeStyle=this.theme.buyLine,this.drawDepth(p),this.plotRegion.plot(new z(0,1,0,1),(function(r,o){r.font="".concat(14,"px 'sans', sans-serif");var a={x:o.x(0)+5,y:o.y(1)+5},i=r.measureText("epoch"),l=i.width+10,c={x:a.x+l,y:a.y};r.fillStyle=t.theme.legendFill,r.globalAlpha=.9,r.fillRect(a.x,c.y,2*l,28);var u=c.y+14;t.ctx.lineWidth=1.5,r.setLineDash([3,3]),r.strokeStyle=t.theme.legendText,line(r,a.x+10,u,c.x-10,u),r.fillStyle=t.theme.legendText,r.fillText("epoch",c.x+i.width/2,c.y+14+1)})),B){var j=B.dataX;this.plotRegion.plot(I,(function(r,o){var a=o.x(j);!function dot(t,r,o,a,i){t.fillStyle=a,t.beginPath(),t.arc(r,o,i,0,D),t.fill()}(r,a,o.y(B.depth),B.dotColor,5);var i="price: ".concat(formatLabelValue(j)," ").concat(t.quoteTicker),c="depth: ".concat(formatLabelValue(B.depth)," ").concat(t.baseTicker);r.font="14px 'sans', sans-serif";var u=1.3*function widest(t){for(var r=0,o=arguments.length,a=new Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];return a.forEach((function(o){r=Math.max(r,t.measureText(o).width)})),r}(r,i,c),d=o.y(B.depth)-30,h=t.plotRegion.extents.y;d=(d=d<=h.min+5?h.min+5:d)>h.max-60-5?h.max-60-5:d;var p=j<l?a+10:a-10-u;r.fillStyle=t.theme.legendFill,r.globalAlpha=.85,r.fillRect(p,d,u,60),r.globalAlpha=1,r.textAlign="left",r.textBaseline="top",r.fillStyle=t.theme.legendText,r.fillText(i,p+.12*u,d+12),r.fillText(c,p+.12*u,d+37)}))}}},{key:"drawDepth",value:function drawDepth(t){var r,o=t[0],a=o[1];this.plotRegion.plot(this.dataExtents,(function(i,l){l.dataCoords((function(){i.beginPath(),i.moveTo(o[0],o[1]);for(var l=0;l<t.length;l++)r=t[l][0],i.lineTo(r,a),a=t[l][1],i.lineTo(r,a)})),i.stroke(),l.dataCoords((function(){i.lineTo(r,0),i.lineTo(o[0],0)})),i.closePath(),i.globalAlpha=.25,i.fill()}))}},{key:"gap",value:function gap(){var t=[this.book.bestGapBuy(),this.book.bestGapSell()],r=t[0],o=t[1];return r?o?[(o.rate+r.rate)/2,o.rate-r.rate]:[r.rate,0]:o?[o.rate,0]:[1,0]}}]),DepthChart}(),z=function(){function Extents(t,r,o,a){charts_classCallCheck(this,Extents),this.setExtents(t,r,o,a)}return charts_createClass(Extents,[{key:"setExtents",value:function setExtents(t,r,o,a){this.x={min:t,max:r},this.y={min:o,max:a}}},{key:"xRange",get:function get(){return this.x.max-this.x.min}},{key:"midX",get:function get(){return(this.x.max+this.x.min)/2}},{key:"yRange",get:function get(){return this.y.max-this.y.min}},{key:"midY",get:function get(){return(this.y.max+this.y.min)/2}}]),Extents}(),H=function(){function Region(t,r){charts_classCallCheck(this,Region),this.context=t,this.extents=r}return charts_createClass(Region,[{key:"setExtents",value:function setExtents(t,r,o,a){this.extents.setExtents(t,r,o,a)}},{key:"width",value:function width(){return this.extents.xRange}},{key:"height",value:function height(){return this.extents.yRange}},{key:"contains",value:function contains(t,r){var o=this.extents;return t<o.x.max&&t>o.x.min&&r<o.y.max&&r>o.y.min}},{key:"translator",value:function translator(t){var r=this.extents,o=t.x.min,a=t.y.min,i=t.yRange,l=t.xRange,c=r.x.min,u=r.x.max-c,d=r.y.max,h=d-r.y.min,p=u/l,m=h/i;return{x:function x(t){return(t-o)*p+c},y:function y(t){return d-(t-a)*m},unx:function unx(t){return(t-c)/p+o},uny:function uny(t){return a-(t-d)/m}}}},{key:"clear",value:function clear(){var t=this.extents;this.ctx.clearRect(t.x.min,t.y.min,t.xRange,t.yRange)}},{key:"plot",value:function plot(t,r,o){var a=this.context,i=this.extents;a.save(),o||(a.beginPath(),a.rect(i.x.min,i.y.min,i.xRange,i.yRange),a.clip());var l=this.translator(t),c=t.yRange,u=i.xRange/t.xRange,d=i.yRange/c,h=t.x.min,p=t.y.min,m=i.x.min+h-h*u,v=-i.y.min-(c-p)*d;l.dataCoords=function(t){a.save(),function setTransform(){a.transform(1,0,0,-1,-h,p),a.transform(u,0,0,d,m,v)}(),t(),a.restore()},r(this.context,l),a.restore()}}]),Region}();function makeLabels(t,r,o,a,i,l,c){for(var u=(a-o)/(r/i),d=u+l-u%l,h=o+d-o%d,p=Math.max(Math.abs(a),Math.abs(o)),m=Math.round(Math.log10(p/d))+2,v=[],g=0;h<a;){var b=formatLabelValue(h=Number(h.toPrecision(m)));g=Math.max(g,t.measureText(b).width),v.push({val:h,txt:b}),h+=d}var w=t.measureText(c).width;return w>g&&(g=w),{widest:g,lbls:v}}function last(t){return t[t.length-1]}function line(t,r,o,a,i,l){t.beginPath(),t.moveTo(r,o),t.lineTo(a,i),l||t.stroke()}var V={minimumSignificantDigits:4,maximumSignificantDigits:5};function formatLabelValue(t){return t.toLocaleString("en-us",V)}function orderutil_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function orderutil_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return orderutil_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return orderutil_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function orderutil_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function sellString(t){return t.sell?"sell":"buy"}function typeString(t){return 1===t.type?0===t.tif?"limit (i)":"limit":"market"}function isMarketBuy(t){return 2===t.type&&!t.sell}function statusString(t){var r=function hasLiveMatches(t){if(!t.matches)return!1;var r,o=orderutil_createForOfIteratorHelper(t.matches);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(!a.revoked&&a.status<3)return!0}}catch(t){o.e(t)}finally{o.f()}return!1}(t);switch(t.status){case 0:return"unknown";case 1:return"epoch";case 2:return t.cancelling?"cancelling":"booked";case 3:return r?"settling":"executed";case 4:return r?"canceled/settling":"canceled";case 5:return r?"revoked/settling":"revoked"}}function settled(t){if(!t.matches)return 0;var r=isMarketBuy(t)?function(t){return t.qty*t.rate*1e-8}:function(t){return t.qty};return t.matches.reduce((function(t,o){return o.isCancel?t:0===o.side&&o.status>=3||1===o.side&&o.status>=4?t+r(o):t}),0)}function ws_slicedToArray(t,r){return function ws_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function ws_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||ws_unsupportedIterableToArray(t,r)||function ws_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ws_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return ws_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?ws_arrayLikeToArray(t,r):void 0}}function ws_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function ws_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function forward(t,r,o){if(t||!r.error){if(void 0!==o[t])for(var a=0;a<o[t].length;a++)o[t][a](r)}else{var i=r.error;console.error("websocket error (code ".concat(i.code,"): ").concat(i.message))}}var J,X=0,$=new(function(){function MessageSocket(){!function ws_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,MessageSocket),this.uri=void 0,this.connection=void 0,this.handlers={},this.queue=[],this.maxQlength=5}return function ws_createClass(t,r,o){return r&&ws_defineProperties(t.prototype,r),o&&ws_defineProperties(t,o),t}(MessageSocket,[{key:"registerRoute",value:function registerRoute(t,r){this.handlers[t]=this.handlers[t]||[],this.handlers[t].push(r)}},{key:"deregisterRoute",value:function deregisterRoute(t){this.handlers[t]=[]}},{key:"request",value:function request(t,r){if(this.connection&&this.connection.readyState===window.WebSocket.OPEN){X++;var o=JSON.stringify({route:t,type:1,id:X,payload:r});window.log("ws","sending",o),this.connection.send(o)}else{for(;this.queue.length>this.maxQlength-1;)this.queue.shift();this.queue.push([t,r])}}},{key:"close",value:function close(t){window.log("ws","close, reason:",t,this.handlers),this.handlers={},this.connection.close()}},{key:"connect",value:function connect(t,r){var o=this;this.uri=t,this.reloader=r;var a=0;!function go(){window.log("ws","connecting to ".concat(t));var i=o.connection=new window.WebSocket(t),l=setTimeout((function(){i.close()}),500);i.onmessage=function(t){var r=JSON.parse(t.data);forward(r.route,r.payload,o.handlers)},i.onclose=function(t){window.log("ws","onclose"),clearTimeout(l),i=o.connection=null,forward("close",null,o.handlers),a++;var r=Math.min(Math.pow(1.25,a),10);console.error("websocket disconnected (".concat(t.code,"), trying again in ").concat(r.toFixed(1)," seconds")),setTimeout((function(){go()}),1e3*r)},i.onopen=function(){window.log("ws","onopen"),clearTimeout(l),a>0&&(a=0,r()),forward("open",null,o.handlers);var t=o.queue;o.queue=[];var i,c=function ws_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=ws_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}(t);try{for(c.s();!(i=c.n()).done;){var u=ws_slicedToArray(i.value,2),d=u[0],h=u[1];o.request(d,h)}}catch(t){c.e(t)}finally{c.f()}},i.onerror=function(t){window.log("ws","onerror:",t),forward("error",t,o.handlers)}}()}}]),MessageSocket}());function markets_toConsumableArray(t){return function markets_arrayWithoutHoles(t){if(Array.isArray(t))return markets_arrayLikeToArray(t)}(t)||function markets_iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||markets_unsupportedIterableToArray(t)||function markets_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function markets_typeof(t){return(markets_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function markets_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function markets_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){markets_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){markets_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function markets_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=markets_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function markets_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return markets_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?markets_arrayLikeToArray(t,r):void 0}}function markets_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function markets_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function markets_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function markets_createClass(t,r,o){return r&&markets_defineProperties(t.prototype,r),o&&markets_defineProperties(t,o),t}function markets_setPrototypeOf(t,r){return(markets_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function markets_createSuper(t){var r=function markets_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=markets_getPrototypeOf(t);if(r){var i=markets_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return markets_possibleConstructorReturn(this,o)}}function markets_possibleConstructorReturn(t,r){return!r||"object"!==markets_typeof(r)&&"function"!=typeof r?function markets_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function markets_getPrototypeOf(t){return(markets_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Q=c.bind,Y=document.createElement("span");Y.classList.add("ico-check");var K,Z=function(t){!function markets_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&markets_setPrototypeOf(t,r)}(MarketsPage,t);var r,o,a,i,l,u,d,h=markets_createSuper(MarketsPage);function MarketsPage(t,r,o){var a;markets_classCallCheck(this,MarketsPage),a=h.call(this),J=t;var i=a.page=c.parsePage(r,["marketLoader","marketChart","marketList","rowTemplate","buyRows","sellRows","marketSearch","chartResizer","rightSide","registrationStatus","regStatusTitle","regStatusMessage","regStatusConfsDisplay","regStatusDex","confReq","orderForm","priceBox","buyBttn","sellBttn","limitBttn","marketBttn","tifBox","submitBttn","qtyField","rateField","orderErr","baseWalletIcons","quoteWalletIcons","lotSize","rateStep","lotField","tifNow","mktBuyBox","mktBuyLots","mktBuyField","minMktBuy","qtyBox","loaderMsg","balanceTable","orderPreview","forms","openForm","uwAppPass","verifyForm","vSide","vQty","vBase","vRate","vTotal","vQuote","vPass","vSubmit","verifyLimit","verifyMarket","vmTotal","vmAsset","vmLots","mktBuyScore","walletForm","liveTemplate","liveList","cancelForm","cancelRemain","cancelUnit","cancelPass","cancelSubmit"]);a.main=r,J.loading(a.main.parentElement),a.loaded=!1,a.market=null,a.registrationStatus={},a.currentForm=null,a.openAsset=null,a.openFunc=null,a.currentCreate=null,a.book=null,a.cancelData=null,a.metaOrders={};var l={price:function price(t){a.reportPrice(t)}};a.chart=new U(i.marketChart,l);var u=a.balanceWgt=new ne(i.balanceTable),d=u.base.stateIcons.icons,p=u.quote.stateIcons.icons;Q(u.base.connect,"click",(function(){a.showOpen(a.market.base,a.walletUnlocked)})),Q(u.quote.connect,"click",(function(){a.showOpen(a.market.quote,a.walletUnlocked)})),Q(u.base.expired,"click",(function(){a.showOpen(a.market.base,a.walletUnlocked)})),Q(u.quote.expired,"click",(function(){a.showOpen(a.market.quote,a.walletUnlocked)})),Q(d.sleeping,"click",(function(){a.showOpen(a.market.base,a.walletUnlocked)})),Q(p.sleeping,"click",(function(){a.showOpen(a.market.quote,a.walletUnlocked)})),Q(d.locked,"click",(function(){a.showOpen(a.market.base,a.walletUnlocked)})),Q(p.locked,"click",(function(){a.showOpen(a.market.quote,a.walletUnlocked)})),Q(u.base.newWalletBttn,"click",(function(){a.showCreate(a.market.base)})),Q(u.quote.newWalletBttn,"click",(function(){a.showCreate(a.market.quote)})),cleanTemplates(i.rowTemplate,i.liveTemplate),a.marketList=new ee(i.marketList);var m,v=markets_createForOfIteratorHelper(a.marketList.xcSections);try{var g=function _loop(){var t,r=m.value,o=markets_createForOfIteratorHelper(r.marketRows);try{var i=function _loop2(){var o=t.value;Q(o.row,"click",(function(){a.setMarket(r.host,o.baseID,o.quoteID)}))};for(o.s();!(t=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}};for(v.s();!(m=v.n()).done;)g()}catch(t){v.e(t)}finally{v.f()}a.quoteUnits=r.querySelectorAll("[data-unit=quote]"),a.baseUnits=r.querySelectorAll("[data-unit=base]"),Q(i.buyBttn,"click",(function(){swapBttns(i.sellBttn,i.buyBttn),i.submitBttn.classList.remove("sellred"),i.submitBttn.classList.add("buygreen"),a.setOrderBttnText(),a.setOrderVisibility()})),Q(i.sellBttn,"click",(function(){swapBttns(i.buyBttn,i.sellBttn),i.submitBttn.classList.add("sellred"),i.submitBttn.classList.remove("buygreen"),a.setOrderBttnText(),a.setOrderVisibility()})),Q(i.limitBttn,"click",(function(){swapBttns(i.marketBttn,i.limitBttn),a.setOrderVisibility()})),Q(i.marketBttn,"click",(function(){swapBttns(i.limitBttn,i.marketBttn),a.setOrderVisibility(),a.setMarketBuyOrderEstimate()})),c.disableMouseWheel(i.rateField,i.lotField,i.qtyField,i.mktBuyField),$.registerRoute("book",(function(t){a.handleBookRoute(t)})),$.registerRoute("book_order",(function(t){a.handleBookOrderRoute(t)})),$.registerRoute("unbook_order",(function(t){a.handleUnbookOrderRoute(t)})),$.registerRoute("update_remaining",(function(t){a.handleUpdateRemainingRoute(t)})),$.registerRoute("epoch_order",(function(t){a.handleEpochOrderRoute(t)})),bindOpenWallet(J,i.openForm,markets_asyncToGenerator((function*(){a.openFunc()}))),a.walletForm=new _(J,i.walletForm,markets_asyncToGenerator((function*(){a.createWallet()}))),bind(i.orderForm,i.submitBttn,markets_asyncToGenerator((function*(){a.stepSubmit()}))),bind(i.verifyForm,i.vSubmit,markets_asyncToGenerator((function*(){a.submitOrder()}))),bind(i.cancelForm,i.cancelSubmit,markets_asyncToGenerator((function*(){a.submitCancel()})));var w=function closePopups(){c.hide(i.forms),i.vPass.value="",i.cancelPass.value=""};Q(i.forms,"mousedown",(function(t){c.mouseInElement(t,a.currentForm)||w()})),i.forms.querySelectorAll(".form-closer").forEach((function(t){c.bind(t,"click",(function(){w()}))})),Q(i.lotField,"change",(function(){a.lotChanged()})),Q(i.lotField,"keyup",(function(){a.lotChanged()})),Q(i.qtyField,"change",(function(){a.quantityChanged(!0)})),Q(i.qtyField,"keyup",(function(){a.quantityChanged(!1)})),Q(i.mktBuyField,"change",(function(){a.marketBuyChanged()})),Q(i.mktBuyField,"keyup",(function(){a.marketBuyChanged()})),Q(i.rateField,"change",(function(){a.rateFieldChanged()})),Q(i.rateField,"keyup",(function(){a.previewOrder(!0)})),Q(i.marketSearch,"change",(function(){a.filterMarkets()})),Q(i.marketSearch,"keyup",(function(){a.filterMarkets()}));var k,S=function setChartRatio(t){t>.7?t=.7:t<.25&&(t=.25),i.marketChart.style.height="".concat(100*t,"%"),a.chart.resize()},C=b.fetch("chartRatio");return C&&S(C),Q(i.chartResizer,"mousedown",(function(t){if(0===t.button){var r;t.preventDefault();var o=function trackMouse(t){t.preventDefault();var o=i.rightSide.getBoundingClientRect(),a=o.bottom-o.top;r=(t.pageY-o.top)/a,S(r)};Q(document,"mousemove",o),Q(document,"mouseup",(function(){r&&b.store("chartRatio",r),c.unbind(document,"mousemove",o)}))}})),a.notifiers={order:function order(t){a.handleOrderNote(t)},epoch:function epoch(t){a.handleEpochNote(t)},conn:function conn(t){a.marketList.setConnectionStatus(t)},balance:function balance(t){a.handleBalanceNote(t)},feepayment:function feepayment(t){a.handleFeePayment(t)}},(k=o&&o.host&&void 0!==o.base&&void 0!==o.quote?makeMarket(o.host,parseInt(o.base),parseInt(o.quote)):b.fetch("selectedMarket"))&&a.marketList.exists(k.host,k.base,k.quote)||(k=a.marketList.first()),a.setMarket(k.host,k.base,k.quote),a.secondTicker=setInterval((function(){for(var t=0,r=Object.values(a.metaOrders);t<r.length;t++){var o=r[t];c.tmplElement(o.row,"age").textContent=c.timeSince(o.order.stamp)}}),1e3),a.setRegistrationStatusVisibility(),a}return markets_createClass(MarketsPage,[{key:"isSell",value:function isSell(){return this.page.sellBttn.classList.contains("selected")}},{key:"isLimit",value:function isLimit(){return this.page.limitBttn.classList.contains("selected")}},{key:"hasFeePending",value:function hasFeePending(){var t=this.market.dex;return"number"==typeof t.confs&&t.confs<t.confsrequired}},{key:"assetsAreSupported",value:function assetsAreSupported(){var t=[this.market.base,this.market.quote];return t[0]&&t[1]}},{key:"setOrderVisibility",value:function setOrderVisibility(){var t=this.page;this.isLimit()?(c.show(t.priceBox,t.tifBox,t.qtyBox),c.hide(t.mktBuyBox),this.previewOrder(!0)):(c.hide(t.tifBox),c.hide(t.priceBox),this.isSell()?(c.hide(t.mktBuyBox),c.show(t.qtyBox),this.previewOrder(!0)):(c.show(t.mktBuyBox),c.hide(t.qtyBox),this.previewOrder(!1)))}},{key:"resolveOrderFormVisibility",value:function resolveOrderFormVisibility(){var t=this.page,r=!this.hasFeePending(),o=this.assetsAreSupported(),a=this.market.base,i=this.market.quote,l=a&&J.assets[a.id].wallet&&i&&J.assets[i.id].wallet;r&&o&&l?c.show(t.orderForm):c.hide(t.orderForm)}},{key:"setLoaderMsgVisibility",value:function setLoaderMsgVisibility(){var t=this.page,r=this.market,o=r.base,a=r.quote;if(this.assetsAreSupported())c.hide(t.loaderMsg);else{var i=!o&&this.market.baseCfg.symbol||!a&&this.market.quoteCfg.symbol;t.loaderMsg.textContent="".concat(i.toUpperCase()," is not supported"),c.show(t.loaderMsg)}}},{key:"setRegistrationStatusView",value:function setRegistrationStatusView(t,r,o){var a=this.page;a.regStatusTitle.textContent=t,a.regStatusConfsDisplay.textContent=r,a.registrationStatus.classList.remove("completed","error","waiting"),a.registrationStatus.classList.add(o)}},{key:"updateRegistrationStatusView",value:function updateRegistrationStatusView(t,r,o,a){var i=this.page;if(i.confReq.textContent=o,i.regStatusDex.textContent=t,r)this.setRegistrationStatusView("Registration fee payment successful!","","completed");else{var l="".concat(a," / ").concat(o);this.setRegistrationStatusView("Waiting for confirmations...",l,"waiting")}}},{key:"setRegistrationStatusVisibility",value:function setRegistrationStatusVisibility(){var t=this,r=this.page,o=this.market.dex,a=o.confs,i=o.confsrequired,l=this.hasFeePending();if(this.updateRegistrationStatusView(o.host,!l,i,a),l)c.show(r.registrationStatus);else{var u=function toggle(){c.hide(r.registrationStatus),t.resolveOrderFormVisibility()};if(c.isHidden(r.orderForm))return void setTimeout(u,5e3);u()}}},{key:"setOrderBttnText",value:function setOrderBttnText(){this.isSell()?this.page.submitBttn.textContent="Place order to sell ".concat(this.market.base.symbol.toUpperCase()):this.page.submitBttn.textContent="Place order to buy  ".concat(this.market.base.symbol.toUpperCase())}},{key:"setMarket",value:(d=markets_asyncToGenerator((function*(t,r,o){var a=J.user.exchanges[t],i=a.assets[r],l=a.assets[o];this.market={dex:a,sid:marketID(i.symbol,l.symbol),base:J.assets[r],quote:J.assets[o],baseCfg:a.assets[r],quoteCfg:a.assets[o]},this.page.marketLoader.classList.remove("d-none"),$.request("loadmarket",makeMarket(t,r,o)),this.setLoaderMsgVisibility(),this.setRegistrationStatusVisibility(),this.resolveOrderFormVisibility(),this.setOrderBttnText()})),function setMarket(t,r,o){return d.apply(this,arguments)})},{key:"reportPrice",value:function reportPrice(t){this.page.rateField.value=t.toFixed(8),this.rateFieldChanged()}},{key:"parseOrder",value:function parseOrder(){var t=this.page,r=t.qtyField,o=this.isLimit(),a=this.isSell(),i=this.market;return o||a||(r=t.mktBuyField),{host:i.dex.host,isLimit:o,sell:a,base:i.base.id,quote:i.quote.id,qty:asAtoms(r.value),rate:asAtoms(t.rateField.value),tifnow:t.tifNow.checked}}},{key:"previewOrder",value:function previewOrder(t){var r=this.page,o=this.parseOrder();if(r.orderErr.textContent="",t&&o.rate&&o.qty){var a=J.assets[o.quote],i=c.formatCoinValue(o.rate/1e8*o.qty/1e8);r.orderPreview.textContent="Total: ".concat(i," ").concat(a.symbol.toUpperCase())}else r.orderPreview.textContent=""}},{key:"validateOrder",value:function validateOrder(t){var r=this.page;return t.isLimit&&!t.rate?(c.show(r.orderErr),r.orderErr.textContent="zero rate not allowed",!1):!!t.qty||(c.show(r.orderErr),r.orderErr.textContent="zero quantity not allowed",!1)}},{key:"handleBook",value:function handleBook(t){var r=[this.market.baseCfg,this.market.quoteCfg],o=r[0],a=r[1];this.book=new q(t,o.symbol,a.symbol),this.loadTable();var i,l=markets_createForOfIteratorHelper(t.book.epoch||[]);try{for(l.s();!(i=l.n()).done;){var u=i.value;u.rate>0&&this.book.add(u),this.addTableOrder(u)}}catch(t){l.e(t)}finally{l.f()}if(!this.book)return this.chart.clear(),c.empty(this.page.buyRows),void c.empty(this.page.sellRows);this.chart.set(this.book,o.lotSize,a.rateStep)}},{key:"midGap",value:function midGap(){var t=this.book;if(t)return t.buys&&t.buys.length?t.sells&&t.sells.length?(t.buys[0].rate+t.sells[0].rate)/2:t.buys[0].rate:t.sells&&t.sells.length?t.sells[0].rate:null}},{key:"setMarketBuyOrderEstimate",value:function setMarketBuyOrderEstimate(){var t=this.market,r=t.baseCfg.lotSize,o=J.user.exchanges[t.dex.host].markets[t.sid].buybuffer,a=this.midGap();a&&(this.page.minMktBuy.textContent=c.formatCoinValue(r*o*a/1e8))}},{key:"refreshActiveOrders",value:function refreshActiveOrders(){var t=this,r=this.page,o=this.metaOrders,a=this.market;for(var i in o)delete o[i];var l=J.orders(a.dex.host,marketID(a.baseCfg.symbol,a.quoteCfg.symbol));c.empty(r.liveList);var u,d=markets_createForOfIteratorHelper(l);try{var h=function _loop3(){var a=u.value,i=r.liveTemplate.cloneNode(!0);if(o[a.id]={row:i,order:a},updateUserOrderRow(i,a),1===a.type&&1===a.tif&&a.status<3){var l=c.tmplElement(i,"cancelBttn");c.show(l),Q(l,"click",(function(r){r.stopPropagation(),t.showCancel(i,a.id)}))}c.tmplElement(i,"link").href="order/".concat(a.id),J.bindInternalNavigation(i),r.liveList.appendChild(i),J.bindTooltips(i)};for(d.s();!(u=d.n()).done;)h()}catch(t){d.e(t)}finally{d.f()}}},{key:"handleBookRoute",value:function handleBookRoute(t){var r=this;J.log("book","handleBookRoute:",t);var o=t.payload,a=this.market,i=this.page,l=a.dex.host,u=[a.baseCfg,a.quoteCfg],d=u[0],h=u[1];o.base===d.id&&o.quote===h.id&&(this.handleBook(o),i.marketLoader.classList.add("d-none"),this.marketList.select(l,d.id,h.id),b.store("selectedMarket",{host:t.host,base:o.base,quote:o.quote}),i.lotSize.textContent=c.formatCoinValue(a.baseCfg.lotSize/1e8),i.rateStep.textContent=a.quoteCfg.rateStep/1e8,this.baseUnits.forEach((function(t){t.textContent=d.symbol.toUpperCase()})),this.quoteUnits.forEach((function(t){t.textContent=h.symbol.toUpperCase()})),this.balanceWgt.setWallets(l,d.id,h.id),this.setMarketBuyOrderEstimate(),this.refreshActiveOrders(),this.loaded||(this.loaded=!0,J.loaded(),c.animate(250,(function(t){r.main.style.opacity=t}))))}},{key:"handleBookOrderRoute",value:function handleBookOrderRoute(t){if(J.log("book","handleBookOrderRoute:",t),t.host===this.market.dex.host&&t.marketID===this.market.sid){var r=t.payload;r.rate>0&&this.book.add(r),this.addTableOrder(r),this.chart.draw()}}},{key:"handleUnbookOrderRoute",value:function handleUnbookOrderRoute(t){if(J.log("book","handleUnbookOrderRoute:",t),t.host===this.market.dex.host&&t.marketID===this.market.sid){var r=t.payload;this.book.remove(r.token),this.removeTableOrder(r),this.chart.draw()}}},{key:"handleUpdateRemainingRoute",value:function handleUpdateRemainingRoute(t){if(J.log("book","handleUpdateRemainingRoute:",t),t.host===this.market.dex.host&&t.marketID===this.market.sid){var r=t.payload;this.book.updateRemaining(r.token,r.qty),this.updateTableOrder(r),this.chart.draw()}}},{key:"handleEpochOrderRoute",value:function handleEpochOrderRoute(t){if(J.log("book","handleEpochOrderRoute:",t),t.host===this.market.dex.host&&t.marketID===this.market.sid){var r=t.payload;r.rate>0&&this.book.add(r),r.qty>0&&this.addTableOrder(r),this.chart.draw()}}},{key:"showForm",value:(u=markets_asyncToGenerator((function*(t){this.currentForm=t;var r=this.page;c.hide(r.openForm,r.verifyForm,r.walletForm,r.cancelForm),t.style.right="10000px",c.show(r.forms,t);var o=(r.forms.offsetWidth+t.offsetWidth)/2;yield c.animate(500,(function(r){t.style.right="".concat((1-r)*o,"px")}),"easeOutHard"),t.style.right="0px"})),function showForm(t){return u.apply(this,arguments)})},{key:"showOpen",value:(l=markets_asyncToGenerator((function*(t,r){var o=this.page;this.openAsset=t,this.openFunc=r,o.openForm.setAsset(J.assets[t.id]),this.showForm(o.openForm),o.uwAppPass.focus()})),function showOpen(t,r){return l.apply(this,arguments)})},{key:"showVerify",value:function showVerify(){var t=this.page,r=this.parseOrder(),o=J.assets[r.base],a=J.assets[r.quote],i=r.sell?o:a,l=r.sell?a:o;if(r.isLimit)c.show(t.verifyLimit),c.hide(t.verifyMarket),t.vRate.textContent=c.formatCoinValue(r.rate/1e8),t.vQty.textContent=c.formatCoinValue(r.qty/1e8),t.vBase.textContent=o.symbol.toUpperCase(),t.vQuote.textContent=a.symbol.toUpperCase(),t.vSide.textContent=r.sell?"sell":"buy",t.vTotal.textContent=c.formatCoinValue(r.rate/1e8*r.qty/1e8);else{c.hide(t.verifyLimit),c.show(t.verifyMarket),t.vSide.textContent="trade",t.vQty.textContent=c.formatCoinValue(r.qty/1e8),t.vBase.textContent=i.symbol.toUpperCase();var u=this.midGap();if(u){var d=r.sell?r.qty*u:r.qty/u,h=this.market.baseCfg.lotSize,p=r.sell?r.qty/h:d/h;t.vmTotal.textContent=c.formatCoinValue(d/1e8),t.vmAsset.textContent=l.symbol.toUpperCase(),t.vmLots.textContent=p.toFixed(1)}else c.hide(t.verifyMarket)}this.showForm(t.verifyForm)}},{key:"submitCancel",value:(i=markets_asyncToGenerator((function*(){var t=this.page,r=this.cancelData,o=r.order,a={orderID:o.id,pw:t.cancelPass.value};t.cancelPass.value="";var i=yield postJSON("/api/cancel",a);J.loaded(),J.checkResponse(i)&&(c.hide(r.bttn,t.forms),o.cancelling=!0)})),function submitCancel(){return i.apply(this,arguments)})},{key:"showCancel",value:function showCancel(t,r){var o=this.metaOrders[r].order,a=this.page,i=o.qty-o.filled;a.cancelRemain.textContent=c.formatCoinValue(i/1e8);var l=isMarketBuy(o)?this.market.quote.symbol:this.market.base.symbol;a.cancelUnit.textContent=l.toUpperCase(),this.showForm(a.cancelForm),this.cancelData={bttn:c.tmplElement(t,"cancelBttn"),order:o}}},{key:"showCreate",value:function showCreate(t){var r=this.page;this.currentCreate=t,this.walletForm.setAsset(t),this.showForm(r.walletForm),this.walletForm.loadDefaults()}},{key:"stepSubmit",value:function stepSubmit(){var t=this.page,r=this.market;if(c.hide(t.orderErr),this.validateOrder(this.parseOrder())){var o=J.walletMap[r.base.id],a=J.walletMap[r.quote.id];return o?a?void this.showVerify():(t.orderErr.textContent="No ".concat(r.quote.symbol," wallet"),void c.show(t.orderErr)):(t.orderErr.textContent="No ".concat(r.base.symbol," wallet"),void c.show(t.orderErr))}}},{key:"handleFeePayment",value:function handleFeePayment(t){var r=t.dex;r===this.market.dex.host&&(this.market.dex=J.exchanges[r],this.setRegistrationStatusVisibility())}},{key:"handleOrderNote",value:function handleOrderNote(t){var r=t.order,o=this.metaOrders[r.id];if(o){o.order=r;var a=c.tmplElement(o.row,"cancelBttn");"Missed cancel"===t.subject&&c.show(a),r.filled===r.qty&&c.hide(a),updateUserOrderRow(o.row,r)}}},{key:"handleEpochNote",value:function handleEpochNote(t){if(J.log("book","handleEpochNote:",t),t.host===this.market.dex.host&&t.marketID===this.market.sid){this.book&&(this.book.setEpoch(t.epoch),this.chart.draw()),this.clearOrderTableEpochs(t.epoch);for(var r=0,o=Object.values(this.metaOrders);r<o.length;r++){var a=o[r],i=a.order,l=t.epoch>i.epoch,u=c.tmplElement(a.row,"status");switch(!0){case 1===i.type&&1===i.status&&l:u.textContent=0===i.tif?"executed":"booked",i.status=0===i.tif?3:2;break;case 2===i.type&&1===i.status:u.textContent="executed",i.status=3}}}}},{key:"handleBalanceNote",value:function handleBalanceNote(t){this.balanceWgt.updateAsset(t.assetID)}},{key:"submitOrder",value:(a=markets_asyncToGenerator((function*(){var t=this.page,r=this.market;c.hide(t.forms);var o=this.parseOrder(),a=t.vPass.value;t.vPass.value="";var i={order:o,pw:a};if(this.validateOrder(o)){var l=yield postJSON("/api/trade",i);if(J.loaded(),J.checkResponse(l)){var u=J.walletMap[r.base.id],d=J.walletMap[r.quote.id];yield J.fetchUser(),u.open&&d.open||(this.balanceWgt.updateAsset(r.base.id),this.balanceWgt.updateAsset(r.quote.id)),this.refreshActiveOrders()}}})),function submitOrder(){return a.apply(this,arguments)})},{key:"createWallet",value:(o=markets_asyncToGenerator((function*(){var t=(yield J.fetchUser()).assets[this.currentCreate.id];c.hide(this.page.forms),this.balanceWgt.updateAsset(t.id),this.resolveOrderFormVisibility()})),function createWallet(){return o.apply(this,arguments)})},{key:"walletUnlocked",value:(r=markets_asyncToGenerator((function*(){c.hide(this.page.forms),yield J.fetchUser(),this.balanceWgt.updateAsset(this.openAsset.id)})),function walletUnlocked(){return r.apply(this,arguments)})},{key:"lotChanged",value:function lotChanged(){var t=this.page,r=parseInt(t.lotField.value);if(r<=0)return t.lotField.value=0,void(t.qtyField.value="");var o=this.market.baseCfg.lotSize;t.lotField.value=r,t.qtyField.value=r*o/1e8,this.previewOrder(!0)}},{key:"quantityChanged",value:function quantityChanged(t){var r=this.page,o=this.parseOrder();if(o.qty<=0)return r.lotField.value=0,void(r.qtyField.value="");var a=this.market.baseCfg.lotSize,i=Math.floor(o.qty/a),l=i*a;r.lotField.value=i,(o.isLimit||o.sell)&&(t&&(r.qtyField.value=l/1e8),this.previewOrder(!0))}},{key:"marketBuyChanged",value:function marketBuyChanged(){var t=this.page,r=asAtoms(t.mktBuyField.value),o=this.midGap();if(!o||!r)return t.mktBuyLots.textContent="0",void(t.mktBuyScore.textContent="0");var a=this.market.baseCfg.lotSize,i=r/o;t.mktBuyLots.textContent=(i/a).toFixed(1),t.mktBuyScore.textContent=c.formatCoinValue(i/1e8)}},{key:"rateFieldChanged",value:function rateFieldChanged(){var t=this.parseOrder();if(t.rate<=0)this.page.rateField.value=0;else{var r=this.market.quoteCfg.rateStep,o=t.rate-t.rate%r;this.page.rateField.value=o/1e8,this.previewOrder(!0)}}},{key:"loadTable",value:function loadTable(){this.loadTableSide(!0),this.loadTableSide(!1)}},{key:"loadTableSide",value:function loadTableSide(t){var r=this,o=t?this.book.sells:this.book.buys,a=t?this.page.sellRows:this.page.buyRows,i=t?"sellcolor":"buycolor";c.empty(a),o&&o.length&&o.forEach((function(t){a.appendChild(r.orderTableRow(t,i))}))}},{key:"addTableOrder",value:function addTableOrder(t){var r=t.sell?this.page.sellRows:this.page.buyRows,o=t.sell?"sellcolor":"buycolor",a=r.firstChild;if(0===t.rate)return a&&0===a.order.rate||(a=this.orderTableRow(t,o),r.insertBefore(a,r.firstChild)),void a.addQty(t.qty);a&&0===a.order.rate&&(a=a.nextSibling);for(var i=this.orderTableRow(t,o);a;){if(t.rate<a.order.rate===t.sell)return void r.insertBefore(i,a);a=a.nextSibling}r.appendChild(i)}},{key:"removeTableOrder",value:function removeTableOrder(t){for(var r=t.token,o=0,a=[this.page.sellRows,this.page.buyRows];o<a.length;o++)for(var i=a[o],l=0,c=Array.from(i.children);l<c.length;l++){var u=c[l];if(u.order.token===r)return void u.remove()}}},{key:"updateTableOrder",value:function updateTableOrder(t){for(var r=t.token,o=0,a=[this.page.sellRows,this.page.buyRows];o<a.length;o++)for(var i=a[o],l=0,c=Array.from(i.children);l<c.length;l++){var u=c[l];if(u.order.token===r)return void(u.querySelector("[data-type=qty]").innerText=t.qty.toFixed(8))}}},{key:"clearOrderTableEpochs",value:function clearOrderTableEpochs(t){this.clearOrderTableEpochSide(this.page.sellRows),this.clearOrderTableEpochSide(this.page.buyRows)}},{key:"clearOrderTableEpochSide",value:function clearOrderTableEpochSide(t,r){for(var o=0,a=Array.from(t.children);o<a.length;o++){var i=a[o];i.order.epoch&&i.order.epoch!==r&&i.remove()}}},{key:"orderTableRow",value:function orderTableRow(t,r){var o=this,a=this.page.rowTemplate.cloneNode(!0);a.qty=t.qty,a.order=t;var i,l=t.rate;return Q(a,"click",(function(){o.reportPrice(l)})),a.querySelectorAll("td").forEach((function(o){switch(o.dataset.type){case"qty":i=o,o.innerText=t.qty.toFixed(8);break;case"rate":0===t.rate?o.innerText="market":(o.innerText=t.rate.toFixed(8),o.classList.add(r));break;case"epoch":t.epoch&&o.appendChild(Y.cloneNode())}})),a.addQty=function(t){a.qty+=t,i.innerText=a.qty.toFixed(8)},a}},{key:"filterMarkets",value:function filterMarkets(){var t=this.page.marketSearch.value,r=t?function(r){return r.name.includes(t)}:function(){return!0};this.marketList.setFilter(r)}},{key:"unload",value:function unload(){$.request("unmarket",{}),$.deregisterRoute("book"),$.deregisterRoute("bookupdate"),$.deregisterRoute("epoch_order"),$.deregisterRoute("book_order"),$.deregisterRoute("unbook_order"),this.chart.unattach(),clearInterval(this.secondTicker)}}]),MarketsPage}(k),ee=function(){function MarketList(t){markets_classCallCheck(this,MarketList),this.selected=null;var r=c.tmplElement(t,"xc");cleanTemplates(r),this.xcSections=[];for(var o=0,a=Object.values(J.user.exchanges);o<a.length;o++){var i=a[o];this.xcSections.push(new te(r,i))}var l,u=markets_createForOfIteratorHelper(this.sortedSections());try{for(u.s();!(l=u.n()).done;){var d=l.value;t.appendChild(d.box)}}catch(t){u.e(t)}finally{u.f()}}return markets_createClass(MarketList,[{key:"sortedSections",value:function sortedSections(){return markets_toConsumableArray(this.xcSections).sort((function(t,r){return t.host<r.host?-1:1}))}},{key:"xcSection",value:function xcSection(t){var r,o=markets_createForOfIteratorHelper(this.xcSections);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.host===t)return a}}catch(t){o.e(t)}finally{o.f()}return null}},{key:"exists",value:function exists(t,r,o){var a=this.xcSection(t);if(!a)return!1;var i,l=markets_createForOfIteratorHelper(a.marketRows);try{for(l.s();!(i=l.n()).done;){var c=i.value;if(c.baseID===r&&c.quoteID===o)return!0}}catch(t){l.e(t)}finally{l.f()}return!1}},{key:"first",value:function first(){var t=this.sortedSections()[0],r=t.first();return makeMarket(t.host,r.baseID,r.quoteID)}},{key:"select",value:function select(t,r,o){this.selected&&this.selected.row.classList.remove("selected"),this.selected=this.xcSection(t).marketRow(r,o),this.selected.row.classList.add("selected")}},{key:"setConnectionStatus",value:function setConnectionStatus(t){this.xcSection(t.host).setConnected(t.connected)}},{key:"setFilter",value:function setFilter(t){var r,o=markets_createForOfIteratorHelper(this.xcSections);try{for(o.s();!(r=o.n()).done;){r.value.setFilter(t)}}catch(t){o.e(t)}finally{o.f()}}}]),MarketList}(),te=function(){function ExchangeSection(t,r){markets_classCallCheck(this,ExchangeSection),this.dex=r,this.host=r.host;var o=t.cloneNode(!0);this.box=o;var a=c.tmplElement(o,"header");this.disconnectedIcon=c.tmplElement(a,"disconnected"),r.connected&&c.hide(this.disconnectedIcon),a.append(r.host),this.marketRows=[],this.rows=c.tmplElement(o,"mkts");var i=c.tmplElement(this.rows,"mktrow");this.rows.removeChild(i);for(var l=0,u=Object.values(r.markets);l<u.length;l++){var d=u[l];this.marketRows.push(new re(i,d))}var h,p=markets_createForOfIteratorHelper(this.sortedMarkets());try{for(p.s();!(h=p.n()).done;){var m=h.value;this.rows.appendChild(m.row)}}catch(t){p.e(t)}finally{p.f()}}return markets_createClass(ExchangeSection,[{key:"sortedMarkets",value:function sortedMarkets(){return markets_toConsumableArray(this.marketRows).sort((function(t,r){return t.name<r.name?-1:1}))}},{key:"first",value:function first(){return this.sortedMarkets()[0]}},{key:"marketRow",value:function marketRow(t,r){var o,a=markets_createForOfIteratorHelper(this.marketRows);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(i.baseID===t&&i.quoteID===r)return i}}catch(t){a.e(t)}finally{a.f()}return null}},{key:"setConnected",value:function setConnected(t){t?c.hide(this.disconnectedIcon):c.show(this.disconnectedIcon)}},{key:"setFilter",value:function setFilter(t){var r,o=markets_createForOfIteratorHelper(this.marketRows);try{for(o.s();!(r=o.n()).done;){var a=r.value;t(a)?c.show(a.row):c.hide(a.row)}}catch(t){o.e(t)}finally{o.f()}}}]),ExchangeSection}(),re=function MarketRow(t,r){markets_classCallCheck(this,MarketRow),this.name=r.name,this.baseID=r.baseid,this.quoteID=r.quoteid;var o=t.cloneNode(!0);this.row=o,c.tmplElement(o,"baseicon").src=c.logoPath(r.basesymbol),c.tmplElement(o,"quoteicon").src=c.logoPath(r.quotesymbol),o.append("".concat(r.basesymbol.toUpperCase(),"-").concat(r.quotesymbol.toUpperCase()))},ne=function(){function BalanceWidget(t){markets_classCallCheck(this,BalanceWidget);var r=c.parsePage(t,["baseAvail","quoteAvail","baseNewWalletRow","quoteNewWalletRow","baseNewButton","quoteNewButton","baseLocked","quoteLocked","baseImmature","quoteImmature","baseImg","quoteImg","quoteUnsupported","baseUnsupported","baseExpired","quoteExpired","baseConnect","quoteConnect","baseSpinner","quoteSpinner","baseWalletState","quoteWalletState"]);this.base={id:0,cfg:null,logo:r.baseImg,avail:r.baseAvail,newWalletRow:r.baseNewWalletRow,newWalletBttn:r.baseNewButton,locked:r.baseLocked,immature:r.baseImmature,unsupported:r.baseUnsupported,expired:r.baseExpired,connect:r.baseConnect,spinner:r.baseSpinner,iconBox:r.baseWalletState,stateIcons:new d(r.baseWalletState)},this.quote={id:0,cfg:null,logo:r.quoteImg,avail:r.quoteAvail,newWalletRow:r.quoteNewWalletRow,newWalletBttn:r.quoteNewButton,locked:r.quoteLocked,immature:r.quoteImmature,unsupported:r.quoteUnsupported,expired:r.quoteExpired,connect:r.quoteConnect,spinner:r.quoteSpinner,iconBox:r.quoteWalletState,stateIcons:new d(r.quoteWalletState)},this.dex=null}var t;return markets_createClass(BalanceWidget,[{key:"setWallets",value:function setWallets(t,r,o){this.dex=J.user.exchanges[t],this.base.id=r,this.base.cfg=this.dex.assets[r],this.quote.id=o,this.quote.cfg=this.dex.assets[o],this.updateWallet(this.base),this.updateWallet(this.quote)}},{key:"updateWallet",value:function updateWallet(t){var r=J.assets[t.id];if(c.hide(t.newWalletRow,t.avail,t.immature,t.locked,t.expired,t.unsupported,t.connect,t.spinner,t.iconBox),t.logo.src=c.logoPath(t.cfg.symbol),r){c.show(t.iconBox);var o=r.wallet;if(t.stateIcons.readWallet(o),o){var a=o.balance;if(a||o.running){if(!a)return this.fetchBalance(t.id),void c.show(t.spinner);c.show(t.avail,t.immature,t.locked),t.avail.textContent=c.formatCoinValue(a.available/1e8),t.locked.textContent=c.formatCoinValue((a.locked+a.contractlocked)/1e8),t.immature.textContent=c.formatCoinValue(a.immature/1e8),(new Date).getTime()-new Date(a.stamp).getTime()>36e5?(c.show(t.expired),o.running&&this.fetchBalance(t.id)):c.hide(t.expired)}else c.show(t.connect)}else c.show(t.newWalletRow)}else c.show(t.unsupported)}},{key:"updateAsset",value:function updateAsset(t){t===this.base.id?this.updateWallet(this.base):t===this.quote.id&&this.updateWallet(this.quote)}},{key:"fetchBalance",value:(t=markets_asyncToGenerator((function*(t){var r=yield postJSON("/api/balance",{assetID:t});J.checkResponse(r)||console.error("failed to fetch balance for asset ID",t)})),function fetchBalance(r){return t.apply(this,arguments)})}]),BalanceWidget}();function makeMarket(t,r,o){return{host:t,base:r,quote:o}}function marketID(t,r){return"".concat(t,"_").concat(r)}function asAtoms(t){return Math.round(1e8*parseFloat(t))}function swapBttns(t,r){t.classList.remove("selected"),r.classList.add("selected")}function updateDataCol(t,r,o){c.tmplElement(t,r).textContent=o}function updateUserOrderRow(t,r){updateDataCol(t,"type",typeString(r)),updateDataCol(t,"side",sellString(r)),updateDataCol(t,"age",c.timeSince(r.stamp)),updateDataCol(t,"rate",c.formatCoinValue(r.rate/1e8)),updateDataCol(t,"qty",c.formatCoinValue(r.qty/1e8)),updateDataCol(t,"filled","".concat((r.filled/r.qty*100).toFixed(1),"%")),updateDataCol(t,"settled","".concat((settled(r)/r.qty*100).toFixed(1),"%")),updateDataCol(t,"status",statusString(r))}function cleanTemplates(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];r.forEach((function(t){t.remove(),t.removeAttribute("id")}))}function orders_typeof(t){return(orders_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function orders_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function orders_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){orders_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){orders_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function orders_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function orders_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return orders_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return orders_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function orders_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function orders_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function orders_setPrototypeOf(t,r){return(orders_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function orders_createSuper(t){var r=function orders_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=orders_getPrototypeOf(t);if(r){var i=orders_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return orders_possibleConstructorReturn(this,o)}}function orders_possibleConstructorReturn(t,r){return!r||"object"!==orders_typeof(r)&&"function"!=typeof r?function orders_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function orders_getPrototypeOf(t){return(orders_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oe,ae,ie,se=function(t){!function orders_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&orders_setPrototypeOf(t,r)}(OrdersPage,t);var r,o,a,i=orders_createSuper(OrdersPage);function OrdersPage(t,r){var o;!function orders_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OrdersPage),o=i.call(this),K=t,o.main=r,o.offset="",o.loading=!1;var a=o.page=c.parsePage(r,["rowTmpl","tableBody","hostFilter","assetFilter","statusFilter","orderLoader","ordersTable"]);o.orderTmpl=a.rowTmpl,o.orderTmpl.remove();var l=o.filterState={hosts:[],assets:[],statuses:[]},u=new URLSearchParams(window.location.search),d=function readFilter(t,r){var o=u.get(r);if(o&&0!==o.length){var a=o.split(",");o&&(l[r]=a),t.querySelectorAll("input").forEach((function(t){a.indexOf(t.value)>=0&&(t.checked=!0)}))}};d(a.hostFilter,"hosts"),d(a.assetFilter,"assets"),d(a.statusFilter,"statuses");var h=[],p=function monitorFilter(t,r){var a=t.querySelector(".apply-bttn");h.push(a),c.bind(a,"click",(function(){o.submitFilter(),h.forEach((function(t){return c.hide(t)}))})),t.querySelectorAll("input").forEach((function(o){c.bind(o,"change",(function(){!function compareSubFilter(t,r){if(t.length!==r.length)return!1;var o,a=orders_createForOfIteratorHelper(t);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(-1===r.indexOf(i))return!1}}catch(t){a.e(t)}finally{a.f()}return!0}(parseSubFilter(t),l[r])?c.show(a):c.hide(a)}))}))};return p(a.hostFilter,"hosts"),p(a.assetFilter,"assets"),p(a.statusFilter,"statuses"),c.bind(o.main,"scroll",(function(){o.loading||a.ordersTable.offsetHeight-o.main.offsetHeight-o.main.scrollTop<0&&o.nextPage()})),o.submitFilter(),o}return function orders_createClass(t,r,o){return r&&orders_defineProperties(t.prototype,r),o&&orders_defineProperties(t,o),t}(OrdersPage,[{key:"setOrders",value:function setOrders(t){c.empty(this.page.tableBody),this.appendOrders(t)}},{key:"appendOrders",value:function appendOrders(t){var r,o=this,a=this.page.tableBody,i=orders_createForOfIteratorHelper(t);try{var l=function _loop(){var t=r.value,i=o.orderTmpl.cloneNode(!0),l=function set(t,r){c.tmplElement(i,t).textContent=r},m="".concat(t.baseSymbol.toUpperCase(),"-").concat(t.quoteSymbol.toUpperCase());if(l("host","".concat(m," @ ").concat(t.host)),p="",t.sell){var v=[t.baseSymbol,t.quoteSymbol];u=v[0],d=v[1],h=c.formatCoinValue(t.qty/1e8),1===t.type&&(p=c.formatCoinValue(t.qty/1e8*t.rate/1e8))}else{var g=[t.quoteSymbol,t.baseSymbol];u=g[0],d=g[1],2===t.type?h=c.formatCoinValue(t.qty/1e8):(h=c.formatCoinValue(t.qty/1e8*t.rate/1e8),p=c.formatCoinValue(t.qty/1e8))}l("fromQty",h),c.tmplElement(i,"fromLogo").src=c.logoPath(u),l("fromSymbol",u),l("toQty",p),c.tmplElement(i,"toLogo").src=c.logoPath(d),l("toSymbol",d),l("type","".concat(typeString(t)," ").concat(sellString(t))),l("rate",function rateString(t){return 2===t.type?"market":c.formatCoinValue(t.rate/1e8)}(t)),l("status",statusString(t)),l("filled","".concat((t.filled/t.qty*100).toFixed(1),"%")),l("settled","".concat((settled(t)/t.qty*100).toFixed(1),"%"));var b=new Date(t.stamp).toLocaleString();l("time","".concat(c.timeSince(t.stamp)," ago, ").concat(b)),c.tmplElement(i,"link").href="order/".concat(t.id),K.bindInternalNavigation(i),a.appendChild(i)};for(i.s();!(r=i.n()).done;){var u,d,h,p;l()}}catch(t){i.e(t)}finally{i.f()}50===t.length?this.offset=t[t.length-1].id:this.offset=""}},{key:"submitFilter",value:(a=orders_asyncToGenerator((function*(){var t=this.page;this.offset="";var r=this.filterState;r.hosts=parseSubFilter(t.hostFilter),r.assets=parseSubFilter(t.assetFilter),r.statuses=parseSubFilter(t.statusFilter);var o=new URL(window.location),a=new URLSearchParams(o.search);a.delete("offset");var i=function setQuery(t){var o=r[t];0===o.length?a.delete(t):a.set(t,o.join(","))};i("hosts"),i("assets"),i("statuses"),o.search=a.toString(),window.history.replaceState({page:"orders"},"",o),this.setOrders(yield this.fetchOrders())})),function submitFilter(){return a.apply(this,arguments)})},{key:"fetchOrders",value:(o=orders_asyncToGenerator((function*(){K.loading(this.main);var t=yield postJSON("/api/orders",this.currentFilter());return K.loaded(),t.orders})),function fetchOrders(){return o.apply(this,arguments)})},{key:"currentFilter",value:function currentFilter(){var t=this.filterState;return{hosts:t.hosts,assets:t.assets.map((function(t){return parseInt(t)})),statuses:t.statuses.map((function(t){return parseInt(t)})),n:50,offset:this.offset}}},{key:"nextPage",value:(r=orders_asyncToGenerator((function*(){if(""!==this.offset&&!this.loading){this.loading=!0,c.show(this.page.orderLoader);var t=yield this.fetchOrders();this.loading=!1,c.hide(this.page.orderLoader),this.appendOrders(t)}})),function nextPage(){return r.apply(this,arguments)})}]),OrdersPage}(k);function parseSubFilter(t){var r=[];return t.querySelectorAll("input").forEach((function(t){t.checked&&r.push(t.value)})),r}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function order_slicedToArray(t,r){return function order_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function order_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||order_unsupportedIterableToArray(t,r)||function order_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function order_typeof(t){return(order_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function order_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return order_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?order_arrayLikeToArray(t,r):void 0}}function order_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function order_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function order_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){order_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){order_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function order_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function order_setPrototypeOf(t,r){return(order_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,r){return t.__proto__=r,t})(t,r)}function order_createSuper(t){var r=function order_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=order_getPrototypeOf(t);if(r){var i=order_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return order_possibleConstructorReturn(this,o)}}function order_possibleConstructorReturn(t,r){return!r||"object"!==order_typeof(r)&&"function"!=typeof r?function order_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):r}function order_getPrototypeOf(t){return(order_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var le,ce,ue=function(t){!function order_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&order_setPrototypeOf(t,r)}(OrderPage,t);var r,o,a,i=order_createSuper(OrderPage);function OrderPage(t,r){var o;!function order_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OrderPage),o=i.call(this),le=t;var a=r.querySelectorAll("[data-stamp]"),l=parseInt(r.dataset.net);o.orderID=r.dataset.oid,o.order=le.order(o.orderID),o.order||o.fetchOrder();var u=o.page=c.parsePage(r,["cancelBttn","cancelRemain","cancelUnit","cancelForm","forms","cancelSubmit","cancelPass","status"]);u.cancelBttn&&c.bind(u.cancelBttn,"click",(function(){o.showForm(u.cancelForm)})),c.bind(u.forms,"mousedown",(function(t){c.mouseInElement(t,o.currentForm)||(c.hide(u.forms),u.cancelPass.value="")})),bind(u.cancelForm,u.cancelSubmit,order_asyncToGenerator((function*(){o.submitCancel()}))),r.querySelectorAll("[data-explorer-id]").forEach((function(t){var r=de[parseInt(t.dataset.explorerId)];if(r){var o=r[l];o&&(t.classList.remove("plainlink"),t.classList.add("subtlelink"),t.href=o(t.dataset.explorerCoin))}}));var d=function setStamp(){var t,r=function order_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=order_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}(a);try{for(r.s();!(t=r.n()).done;){var o=t.value;o.textContent=c.timeSince(parseInt(o.dataset.stamp))}}catch(t){r.e(t)}finally{r.f()}};return d(),o.secondTicker=setInterval((function(){d()}),1e4),o.notifiers={order:function order(t){o.handleOrderNote(t)}},o}return function order_createClass(t,r,o){return r&&order_defineProperties(t.prototype,r),o&&order_defineProperties(t,o),t}(OrderPage,[{key:"unload",value:function unload(){clearInterval(this.secondTicker)}},{key:"fetchOrder",value:(a=order_asyncToGenerator((function*(){var t=yield postJSON("/api/order",this.orderID);le.checkResponse(t)&&(this.order=t.order)})),function fetchOrder(){return a.apply(this,arguments)})},{key:"showCancel",value:function showCancel(){var t=this.order,r=this.page,o=t.qty-t.filled;r.cancelRemain.textContent=c.formatCoinValue(o/1e8);var a=isMarketBuy(t)?this.market.quote.symbol:this.market.base.symbol;r.cancelUnit.textContent=a.toUpperCase(),this.showForm(r.cancelForm)}},{key:"showForm",value:(o=order_asyncToGenerator((function*(t){this.currentForm=t;var r=this.page;c.hide(r.cancelForm),t.style.right="10000px",c.show(r.forms,t);var o=(r.forms.offsetWidth+t.offsetWidth)/2;yield c.animate(500,(function(r){t.style.right="".concat((1-r)*o,"px")}),"easeOutHard"),t.style.right="0px"})),function showForm(t){return o.apply(this,arguments)})},{key:"submitCancel",value:(r=order_asyncToGenerator((function*(){var t=this.page,r=this.order,o={orderID:r.id,pw:t.cancelPass.value};t.cancelPass.value="",le.loading(t.cancelForm);var a=yield postJSON("/api/cancel",o);le.loaded(),le.checkResponse(a)&&(t.status.textContent="cancelling",c.hide(t.forms),r.cancelling=!0)})),function submitCancel(){return r.apply(this,arguments)})},{key:"handleOrderNote",value:function handleOrderNote(t){var r=t.order,o=this.page.cancelBttn;o&&r.id===this.orderID&&(o&&r.status>2&&c.hide(o),this.page.status.textContent=statusString(r))}}]),OrderPage}(k),de={42:(oe={},_defineProperty(oe,0,(function(t){var r=order_slicedToArray(t.split(":"),2),o=r[0],a=r[1];return"https://explorer.dcrdata.org/tx/".concat(o,"/out/").concat(a)})),_defineProperty(oe,1,(function(t){var r=order_slicedToArray(t.split(":"),2),o=r[0],a=r[1];return"https://testnet.dcrdata.org/tx/".concat(o,"/out/").concat(a)})),oe),0:(ae={},_defineProperty(ae,0,(function(t){return"https://bitaps.com/".concat(t.split(":")[0])})),_defineProperty(ae,1,(function(t){return"https://tbtc.bitaps.com/".concat(t.split(":")[0])})),ae),2:(ie={},_defineProperty(ie,0,(function(t){return"https://ltc.bitaps.com/".concat(t.split(":")[0])})),_defineProperty(ie,1,(function(t){return"https://tltc.bitaps.com/".concat(t.split(":")[0])})),ie)},fe=o(0),he=o.n(fe);function app_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function app_slicedToArray(t,r){return function app_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function app_iterableToArrayLimit(t,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],a=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done)&&(o.push(c.value),!r||o.length!==r);a=!0);}catch(t){i=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return o}(t,r)||app_unsupportedIterableToArray(t,r)||function app_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function app_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),d=u.value}catch(t){return void o(t)}u.done?r(d):Promise.resolve(d).then(a,i)}function app_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){app_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){app_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function app_createForOfIteratorHelper(t,r){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=app_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=t[Symbol.iterator]()},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function app_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return app_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?app_arrayLikeToArray(t,r):void 0}}function app_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function app_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var pe=c.idel,ye=c.bind,me=c.unbind,ve={login:T,register:P,markets:Z,wallets:I,settings:L,orders:se,order:ue},ge=function(){function Application(){var t=this;!function app_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Application),this.notes=[],this.pokes=[],this.user={accounts:{},wallets:{}},this.commitHash=he.a,this.showPopups="1"===b.getCookie("popups"),console.log("Decred DEX Client App, Build",this.commitHash.substring(0,7)),this.loggers=b.fetch("loggers")||{},window.enableLogger=function(r,o){return o?t.loggers[r]=!0:delete t.loggers[r],b.store("loggers",t.loggers),"".concat(r," logger ").concat(o?"enabled":"disabled")},window.log=function(){t.log.apply(t,arguments)};var r=b.fetch("recorders")||[];this.recorders={};var o,a=app_createForOfIteratorHelper(r);try{for(a.s();!(o=a.n()).done;){var i=o.value;console.log("recording",i),this.recorders[i]=[]}}catch(t){a.e(t)}finally{a.f()}window.recordLogger=function(r,o){return o?t.recorders[r]=[]:delete t.recorders[r],b.store("recorders",Object.keys(t.recorders)),"".concat(r," recorder ").concat(o?"enabled":"disabled")},window.dumpLogger=function(r){var o=t.recorders[r];if(!o)return"no recorder for logger ".concat(r);var a=document.createElement("a");a.href="data:application/octet-stream;base64,".concat(window.btoa(JSON.stringify(o,null,4))),a.download="".concat(r,".json"),document.body.appendChild(a),a.click(),setTimeout((function(){document.body.removeChild(a)}),0)}}var t,r,o,a;return function app_createClass(t,r,o){return r&&app_defineProperties(t.prototype,r),o&&app_defineProperties(t,o),t}(Application,[{key:"start",value:(a=app_asyncToGenerator((function*(){var t=this;yield this.fetchUser(),ye(window,"popstate",(function(r){var o=r.state.page;(o||""===o)&&t.loadPage(o,r.state.data,!0)})),this.main=pe(document,"main");var r=this.main.dataset.handler,o=new URL(window.location);handlerFromPath(o.pathname)!==r&&(o.pathname="/".concat(r),o.search="",window.history.replaceState({page:r},"",o)),this.attachHeader(),this.attachCommon(this.header),this.attach();var a=b.fetch("notifications");this.setNotes(a||[]),$.connect(function getSocketURI(){var t="https:"===window.location.protocol?"wss":"ws";return"".concat(t,"://").concat(window.location.host,"/ws")}(),this.reconnected),$.registerRoute("notify",(function(r){t.notify(r)}))})),function start(){return a.apply(this,arguments)})},{key:"reconnected",value:function reconnected(){window.location.reload()}},{key:"fetchUser",value:(o=app_asyncToGenerator((function*(){var t=yield function getJSON(t){return _getJSON.apply(this,arguments)}("/api/user");if(this.checkResponse(t)){this.user=t,this.assets=t.assets,this.exchanges=t.exchanges,this.walletMap={};for(var r=0,o=Object.entries(t.assets);r<o.length;r++){var a=app_slicedToArray(o[r],2),i=a[0],l=a[1];l.wallet&&(this.walletMap[i]=l.wallet)}return this.updateMenuItemsDisplay(),t}})),function fetchUser(){return o.apply(this,arguments)})},{key:"loadPage",value:(r=app_asyncToGenerator((function*(t,r,o){this.tooltip.style.left="-10000px",c.hide(this.page.noteBox,this.page.profileBox);var a=new URL("/".concat(t),window.location.origin),i=handlerFromPath(t),l=yield window.fetch(a);if(!l.ok)return!1;var u=yield l.text(),d=c.noderize(u),h=pe(d,"main"),p=h.dataset.handler;if(!o){var m=p===i?a.toString():"/".concat(p);window.history.pushState({page:t,data:r},p,m)}return document.title=d.title,this.main.replaceWith(h),this.main=h,this.attach(r),!0})),function loadPage(t,o,a){return r.apply(this,arguments)})},{key:"attach",value:function attach(t){var r=this.main.dataset.handler;if(r){this.attachCommon(this.main),this.loadedPage&&this.loadedPage.unload();var o=ve[r];this.loadedPage=o?new o(this,this.main,t):null,this.bindTooltips(this.main)}else console.error("cannot attach to content with no specified handler")}},{key:"bindTooltips",value:function bindTooltips(t){var r=this;t.querySelectorAll("[data-tooltip]").forEach((function(t){ye(t,"mouseenter",(function(){r.tooltip.textContent=t.dataset.tooltip;var o=c.layoutMetrics(t),a=o.centerX-r.tooltip.offsetWidth/2;a<0&&(a=5),a+r.tooltip.offsetWidth>document.body.offsetWidth&&(a=document.body.offsetWidth-r.tooltip.offsetWidth-5),r.tooltip.style.left="".concat(a,"px"),r.tooltip.style.top="".concat(o.bodyTop-r.tooltip.offsetHeight-5,"px")})),ye(t,"mouseleave",(function(){r.tooltip.style.left="-10000px"}))}))}},{key:"attachHeader",value:function attachHeader(){var t=this;this.header=pe(document.body,"header"),this.popupNotes=pe(document.body,"popupNotes"),this.popupTmpl=c.tmplElement(this.popupNotes,"note"),this.popupTmpl.remove(),this.tooltip=pe(document.body,"tooltip");var r=this.page=c.parsePage(this.header,["noteIndicator","noteList","noteTmpl","marketsMenuEntry","walletsMenuEntry","noteMenuEntry","loader","profileMenuEntry","profileIndicator","profileSignout","innerNoteIcon","innerProfileIcon","noteBox","profileBox","pokeCat","noteCat","pokeBox","pokeList","pokeTmpl"]);delete r.noteTmpl.id,r.noteTmpl.remove(),delete r.pokeTmpl.id,r.pokeTmpl.remove(),r.loader.remove(),r.loader.style.backgroundColor="rgba(0, 0, 0, 0.5)",c.show(r.loader),ye(r.noteMenuEntry,"click",app_asyncToGenerator((function*(){c.hide(r.pokeList),c.show(r.noteList),t.ackNotes(),r.noteCat.classList.add("active"),r.pokeCat.classList.remove("active"),t.showDropdown(r.noteMenuEntry,r.noteBox),c.hide(r.noteIndicator);var o,a=app_createForOfIteratorHelper(t.notes);try{for(a.s();!(o=a.n()).done;){var i=o.value;i.acked&&i.el.classList.remove("firstview")}}catch(t){a.e(t)}finally{a.f()}t.setNoteTimes(r.noteList),t.setNoteTimes(r.pokeList),t.storeNotes()}))),ye(r.profileMenuEntry,"click",(function(){t.showDropdown(r.profileMenuEntry,r.profileBox)})),ye(r.innerNoteIcon,"click",(function(){c.hide(r.noteBox)})),ye(r.innerProfileIcon,"click",(function(){c.hide(r.profileBox)})),ye(r.profileSignout,"click",function(){var r=app_asyncToGenerator((function*(r){return yield t.signOut()}));return function(t){return r.apply(this,arguments)}}()),ye(r.pokeCat,"click",(function(){t.setNoteTimes(r.pokeList),r.pokeCat.classList.add("active"),r.noteCat.classList.remove("active"),c.hide(r.noteList),c.show(r.pokeList),t.ackNotes()})),ye(r.noteCat,"click",(function(){t.setNoteTimes(r.noteList),r.noteCat.classList.add("active"),r.pokeCat.classList.remove("active"),c.hide(r.pokeList),c.show(r.noteList),t.ackNotes()}))}},{key:"showDropdown",value:function showDropdown(t,r){var o=this,a=t.getBoundingClientRect();c.hide(this.page.noteBox,this.page.profileBox),c.show(r),r.style.right="".concat(window.innerWidth-a.left-a.width+11,"px"),r.style.top="".concat(a.top-9,"px");ye(document,"click",(function hide(t){c.mouseInElement(t,r)||(c.hide(r),me(document,"click",hide),r===o.page.noteBox&&c.isDisplayed(o.page.noteList)&&o.ackNotes())}))}},{key:"ackNotes",value:function ackNotes(){var t,r=[],o=app_createForOfIteratorHelper(this.notes);try{for(o.s();!(t=o.n()).done;){var a=t.value;a.acked?a.el.classList.remove("firstview"):(a.acked=!0,a.id&&a.severity>2&&r.push(a.id))}}catch(t){o.e(t)}finally{o.f()}r.length&&$.request("acknotes",r),c.hide(this.page.noteIndicator)}},{key:"setNoteTimes",value:function setNoteTimes(t){for(var r=0,o=Array.from(t.children);r<o.length;r++){var a=o[r];a.querySelector("span.note-time").textContent=c.timeSince(a.note.stamp)}}},{key:"bindInternalNavigation",value:function bindInternalNavigation(t){var r=this,o=new URL(window.location);t.querySelectorAll("a").forEach((function(t){if(t.href){var a=new URL(t.href);if(a.origin===o.origin){var i=a.pathname.substring(1),l={};a.search&&a.searchParams.forEach((function(t,r){l[r]=t})),c.bind(t,"click",(function(t){t.preventDefault(),r.loadPage(i,l)}))}}}))}},{key:"storeNotes",value:function storeNotes(){b.store("notifications",this.notes.map((function(t){return{subject:t.subject,details:t.details,severity:t.severity,stamp:t.stamp,id:t.id,acked:t.acked}})))}},{key:"updateMenuItemsDisplay",value:function updateMenuItemsDisplay(){var t=this.page;t&&(this.user.authed?(c.show(t.noteMenuEntry,t.walletsMenuEntry,t.profileMenuEntry),Object.keys(this.user.exchanges).length>0?c.show(t.marketsMenuEntry):c.hide(t.marketsMenuEntry)):c.hide(t.noteMenuEntry,t.walletsMenuEntry,t.marketsMenuEntry,t.profileMenuEntry))}},{key:"attachCommon",value:function attachCommon(t){this.bindInternalNavigation(t)}},{key:"updateExchangeRegistration",value:function updateExchangeRegistration(t,r,o){var a=this.exchanges[t];a.confs=r?null:o}},{key:"handleFeePaymentNote",value:function handleFeePaymentNote(t){switch(t.subject){case"regupdate":this.updateExchangeRegistration(t.dex,!1,t.confirmations);break;case"Account registered":this.updateExchangeRegistration(t.dex,!0)}}},{key:"setNotes",value:function setNotes(t){this.log("notes","setNotes",t),this.notes=[],c.empty(this.page.noteList);for(var r=0;r<t.length;r++)this.prependNoteElement(t[r],!0);this.storeNotes()}},{key:"notify",value:function notify(t){switch(this.log("notes","notify",t),t.type){case"order":var r=t.order,o=this.user.exchanges[r.host].markets[r.market];if(o.orders)for(var a in o.orders)if(o.orders[a].id===r.id){o.orders[a]=r;break}break;case"balance":var i=this.user.assets[t.assetID].wallet;i&&(i.balance=t.balance);break;case"feepayment":this.handleFeePaymentNote(t);break;case"walletstate":case"walletconfig":var l=t.wallet;this.assets[l.assetID].wallet=l,this.walletMap[l.assetID]=l,this.main.querySelectorAll('[data-balance-target="'.concat(l.assetID,'"]')).forEach((function(t){t.textContent=(l.balance.available/1e8).toFixed(8)}))}if(this.loadedPage&&this.loadedPage.notify(t),!(t.severity<2)){if(this.showPopups){var u=this.popupTmpl.cloneNode(!0);c.tmplElement(u,"text").textContent="".concat(t.subject,": ").concat(t.details);var d=c.tmplElement(u,"indicator");2===t.severity?c.hide(d):setSeverityClass(d,t.severity);var h=this.popupNotes;for(h.appendChild(u);h.children.length>5;)h.removeChild(h.firstChild);setTimeout(app_asyncToGenerator((function*(){yield c.animate(500,(function(t){u.style.opacity=1-t})),u.remove()})),6e3)}2===t.severity?this.prependPokeElement(t):this.prependNoteElement(t)}}},{key:"log",value:function log(t){for(var r,o=arguments.length,a=new Array(o>1?o-1:0),i=1;i<o;i++)a[i-1]=arguments[i];this.loggers[t]&&(r=console).log.apply(r,["".concat(nowString(),"[").concat(t,"]:")].concat(a)),this.recorders[t]&&this.recorders[t].push({time:nowString(),msg:a})}},{key:"prependPokeElement",value:function prependPokeElement(t){for(this.pokes.push(t);this.pokes.length>100;)this.pokes.shift();var r=this.makePoke(t);this.prependListElement(this.page.pokeList,t,r)}},{key:"prependNoteElement",value:function prependNoteElement(t,r){for(this.notes.push(t);this.notes.length>100;)this.notes.shift();var o=this.page.noteList,a=this.makeNote(t);if(this.prependListElement(o,t,a),r||this.storeNotes(),!(0===this.notes.length||c.isDisplayed(this.page.noteBox)&&c.isDisplayed(o))){var i=0,l=this.notes.reduce((function(t,r){return r.acked||i++,!r.acked&&r.severity>t?r.severity:t}),0),u=this.page.noteIndicator;setSeverityClass(u,l),i?(u.textContent=i>99?"".concat(99,"+"):i,c.show(u)):c.hide(u)}}},{key:"prependListElement",value:function prependListElement(t,r,o){for(r.el=o,o.note=r,t.prepend(o);t.children.length>100;)t.removeChild(t.lastChild);this.setNoteTimes(t)}},{key:"makeNote",value:function makeNote(t){var r=this.page.noteTmpl.cloneNode(!0);if(t.severity>2){var o=3===t.severity?"good":4===t.severity?"warn":"bad";r.querySelector("div.note-indicator").classList.add(o)}return r.querySelector("div.note-subject").textContent=t.subject,r.querySelector("div.note-details").textContent=t.details,r}},{key:"makePoke",value:function makePoke(t){var r=this.page.pokeTmpl.cloneNode(!0),o=new Date(t.stamp);return c.tmplElement(r,"dateTime").textContent="".concat(o.toLocaleDateString(),", ").concat(o.toLocaleTimeString()),c.tmplElement(r,"details").textContent="".concat(t.subject,": ").concat(t.details),r}},{key:"loading",value:function loading(t){t.appendChild(this.page.loader)}},{key:"loaded",value:function loaded(){this.page.loader.remove()}},{key:"orders",value:function orders(t,r){var o=this.user.exchanges[t].markets[r].orders;return o||(o=[],this.user.exchanges[t].markets[r].orders=o),o}},{key:"order",value:function order(t){for(var r=0,o=Object.values(this.user.exchanges);r<o.length;r++)for(var a=o[r],i=0,l=Object.values(a.markets);i<l.length;i++){var c=l[i];if(c.orders){var u,d=app_createForOfIteratorHelper(c.orders);try{for(d.s();!(u=d.n()).done;){var h=u.value;if(h.id===t)return h}}catch(t){d.e(t)}finally{d.f()}}}}},{key:"checkResponse",value:function checkResponse(t,r){return!(!t.requestSuccessful||!t.ok)||(this.user.inited&&!r&&this.notify(make("API error",t.msg,5)),!1)}},{key:"signOut",value:(t=app_asyncToGenerator((function*(){var t=yield postJSON("/api/logout");this.checkResponse(t)?(b.clearAllStore(),b.removeAuthCK(),window.location.href="/login"):c.hide(this.page.profileBox)})),function signOut(){return t.apply(this,arguments)})}]),Application}();var be=(app_defineProperty(ce={},3,"good"),app_defineProperty(ce,5,"bad"),app_defineProperty(ce,4,"warn"),ce);function handlerFromPath(t){return t.replace(/^\//,"").split("/")[0].split("?")[0].split("#")[0]}function nowString(){var t=new Date,r=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),a=t.getSeconds().toString().padStart(2,"0"),i=t.getMilliseconds().toString().padStart(3,"0");return"".concat(r,":").concat(o,":").concat(a,".").concat(i)}function setSeverityClass(t,r){t.classList.remove("bad","warn","good"),t.classList.add(be[r])}o(1);(new ge).start()}]);
//# sourceMappingURL=entry.js.map