(()=>{"use strict";function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}var a=new window.DOMParser,s=Object.values({0:"btc",42:"dcr",2:"ltc",22:"mona",28:"vtc",3:"doge",145:"bch"}),l={minimumSignificantDigits:4,maximumSignificantDigits:8,minimumFractionDigits:8,maximumFractionDigits:8},c=function(){function t(){r(this,t)}var o,c;return i(t,null,[{key:"idel",value:function(e,t){return e.querySelector("#".concat(t))}},{key:"bind",value:function(e,t,n){e.addEventListener(t,n)}},{key:"unbind",value:function(e,t,n){e.removeEventListener(t,n)}},{key:"noderize",value:function(e){return a.parseFromString(e,"text/html")}},{key:"mouseInElement",value:function(e,t){var n=t.getBoundingClientRect();return e.pageX>=n.left&&e.pageX<=n.right&&e.pageY>=n.top&&e.pageY<=n.bottom}},{key:"layoutMetrics",value:function(e){var t=e.getBoundingClientRect(),n=document.documentElement,r=t.top+n.scrollTop,o=t.left+n.scrollLeft,i=e.offsetWidth,a=e.offsetHeight;return{bodyTop:r,bodyLeft:o,width:i,height:a,centerX:o+i/2,centerY:r+a/2}}},{key:"empty",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"hide",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,o=t;r<o.length;r++){var i=o[r];i.classList.add("d-hide")}}},{key:"show",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,o=t;r<o.length;r++){var i=o[r];i.classList.remove("d-hide")}}},{key:"isHidden",value:function(e){return e.classList.contains("d-hide")}},{key:"isDisplayed",value:function(e){return!e.classList.contains("d-hide")}},{key:"animate",value:(o=function*(e,t,n){for(var r=n?u[n]:u.linear,o=(new Date).getTime(),i=o+e,a=i-o,s=o;s<i;)t(r((s-o)/a)),yield d(33.333333333333336),s=(new Date).getTime();t(1)},c=function(){var e=this,t=arguments;return new Promise((function(r,i){var a=o.apply(e,t);function s(e){n(a,r,i,s,l,"next",e)}function l(e){n(a,r,i,s,l,"throw",e)}s(void 0)}))},function(e,t,n){return c.apply(this,arguments)})},{key:"parsePage",value:function(e,n){var r={};return n.forEach((function(n){var o;r[n]=(o=n,t.idel(e,o))})),r}},{key:"formatCoinValue",value:function(t){var n=e(t.toLocaleString("en-us",l).split("."),2),r=n[0],o=n[1];return o?"00000000"===(o=o.substring(0,8))?r:"".concat(r,".").concat(o.replace(/,+$/,"")):r}},{key:"logoPath",value:function(e){return-1===s.indexOf(e)&&(e=e.substring(0,1)),"/img/coins/".concat(e,".png")}},{key:"tmplElement",value:function(e,t){return e.querySelector('[data-tmpl="'.concat(t,'"]'))}},{key:"timeSince",value:function(t){var n,r,o,i,a,s,l=Math.floor((new Date).getTime()-t),c="",u=0,h=function(e,t){return(e>0||u>0)&&u++,e>0&&(c+="".concat(e," ").concat(t," ")),u>=2},d=e(g(l,f),2);if(n=d[0],l=d[1],h(n,"y"))return c;var b=e(g(l,p),2);if(r=b[0],l=b[1],h(r,"mo"))return c;var w=e(g(l,m),2);if(o=w[0],l=w[1],h(o,"d"))return c;var k=e(g(l,y),2);if(i=k[0],l=k[1],h(i,"h"))return c;var x=e(g(l,v),2);if(a=x[0],l=x[1],h(a,"m"))return c;var S=e(g(l,1e3),2);return s=S[0],l=S[1],h(s,"s"),c||"0 s"}},{key:"disableMouseWheel",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,o=t;r<o.length;r++){var i=o[r];i.addEventListener("wheel",(function(e){e.preventDefault()}))}}}]),t}(),u={linear:function(e){return e},easeIn:function(e){return e*e},easeOut:function(e){return e*(2-e)},easeInHard:function(e){return e*e*e},easeOutHard:function(e){return--e*e*e+1}},h=function(){function e(t){r(this,e);var n=function(e){return t.querySelector("[data-state=".concat(e,"]"))};this.icons={},this.icons.sleeping=n("sleeping"),this.icons.locked=n("locked"),this.icons.unlocked=n("unlocked"),this.icons.nowallet=n("nowallet"),this.icons.syncing=n("syncing"),this.status=n("status")}return i(e,[{key:"sleeping",value:function(){var e=this.icons;c.hide(e.locked,e.unlocked,e.nowallet,e.syncing),c.show(e.sleeping),this.status&&(this.status.textContent="off")}},{key:"locked",value:function(){var e=this.icons;c.hide(e.unlocked,e.nowallet,e.sleeping),c.show(e.locked),this.status&&(this.status.textContent="locked")}},{key:"unlocked",value:function(){var e=this.icons;c.hide(e.locked,e.nowallet,e.sleeping),c.show(e.unlocked),this.status&&(this.status.textContent="ready")}},{key:"nowallet",value:function(){var e=this.icons;c.hide(e.locked,e.unlocked,e.sleeping,e.syncing),c.show(e.nowallet),this.status&&(this.status.textContent="no wallet")}},{key:"setSyncing",value:function(e){var t=this.icons.syncing;e&&e.running?e.synced?c.hide(t):(c.show(t),t.dataset.tooltip="wallet is ".concat((100*e.syncProgress).toFixed(1),"% synced")):c.hide(t)}},{key:"readWallet",value:function(e){switch(this.setSyncing(e),!0){case!e:this.nowallet();break;case!e.running:this.sleeping();break;case!e.open:this.locked();break;case e.open:this.unlocked();break;default:console.error("wallet in unknown state",e)}}}]),e}();function d(e){return new Promise((function(t){return setTimeout(t,e)}))}var f=31536e6,p=2592e6,m=864e5,y=36e5,v=6e4;function g(e,t){var n=Math.floor(e/t);return[n,e-n*t]}function b(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x="darkMode",S="popups",C=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"setCookie",value:function(e,t){var n=new Date;n.setTime(n.getTime()+31536e7);var r="expires="+n.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"}},{key:"getCookie",value:function(e){var t,n,r,o=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=b(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(document.cookie.split(";"));try{for(o.s();!(t=o.n()).done;){var i=(n=t.value.split("="),r=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(n,r)||b(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],s=i[1];if(a.trim()===e)return s}}catch(e){o.e(e)}finally{o.f()}return null}},{key:"dark",value:function(e){this.setCookie(x,e?"1":"0"),e?document.body.classList.add("dark"):document.body.classList.remove("dark")}},{key:"isDark",value:function(){return document.cookie.split(";").filter((function(e){return e.includes("".concat(x,"=1"))})).length}},{key:"store",value:function(e,t){window.localStorage.setItem(e,JSON.stringify(t))}},{key:"clearAllStore",value:function(){window.localStorage.clear()}},{key:"removeAuthCK",value:function(){document.cookie="".concat("dexauth","=;expires=Thu, 01 Jan 1970 00:00:01 GMT;")}},{key:"fetch",value:function(e){var t=window.localStorage.getItem(e);return null!==t?JSON.parse(t):null}}],null&&k(t.prototype,null),n&&k(t,n),e}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}null===C.getCookie(x)&&C.setCookie(x,"1"),null===C.getCookie(S)&&C.setCookie(S,"1");var E,O=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"notify",value:function(e){this.notifiers&&this.notifiers[e.type]&&this.notifiers[e.type](e)}},{key:"unload",value:function(){}}])&&A(t.prototype,n),e}();function P(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){P(i,r,o,a,s,"next",e)}function s(e){P(i,r,o,a,s,"throw",e)}a(void 0)}))}}function R(e,t,n){return L.apply(this,arguments)}function L(){return(L=F((function*(e,t,n){try{var r=yield window.fetch(t,{method:e,headers:new window.Headers({"content-type":"application/json"}),body:n});if(200!==r.status)throw r;var o=yield r.json();return o.requestSuccessful=!0,o}catch(r){return r.requestSuccessful=!1,r.msg=yield r.text(),r}}))).apply(this,arguments)}function B(e,t){return q.apply(this,arguments)}function q(){return(q=F((function*(e,t){return R("POST",e,JSON.stringify(t))}))).apply(this,arguments)}function T(){return(T=F((function*(e){return R("GET",e)}))).apply(this,arguments)}function I(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=W(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function M(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||W(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function N(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){D(i,r,o,a,s,"next",e)}function s(e){D(i,r,o,a,s,"throw",e)}a(void 0)}))}}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t,n){return t&&U(e.prototype,t),n&&U(e,n),e}var _=function(){function e(t,n,r){var o=this;z(this,e),this.form=n,this.currentAsset=null;var i=this.fields=c.parsePage(n,["nwAssetLogo","nwAssetName","newWalletPass","nwAppPass","walletSettings","selectCfgFile","cfgFile","submitAdd","newWalletErr"]);this.subform=new H(t,i.walletSettings,!0),X(n,i.submitAdd,N((function*(){if(""===i.nwAppPass.value)return i.newWalletErr.textContent="app password cannot be empty",void c.show(i.newWalletErr);c.hide(i.newWalletErr);var e={assetID:parseInt(o.currentAsset.id),pass:i.newWalletPass.value||"",config:o.subform.map(),appPass:i.nwAppPass.value};i.nwAppPass.value="";var t=E.loading(n),a=yield B("/api/newwallet",e);t(),E.checkResponse(a)?(i.newWalletPass.value="",r()):o.setError(a.msg)})))}var t,n,r;return V(e,[{key:"setAsset",value:(r=N((function*(e){var t=this.fields;this.currentAsset&&this.currentAsset.id===e.id||(this.currentAsset=e,t.nwAssetLogo.src=c.logoPath(e.symbol),t.nwAssetName.textContent=e.info.name,t.newWalletPass.value="",this.subform.update(e.info),c.hide(t.newWalletErr))})),function(e){return r.apply(this,arguments)})},{key:"setError",value:(n=N((function*(e){this.fields.newWalletErr.textContent=e,c.show(this.fields.newWalletErr)})),function(e){return n.apply(this,arguments)})},{key:"loadDefaults",value:(t=N((function*(){var e=E.loading(this.form),t=yield B("/api/defaultwalletcfg",{assetID:this.currentAsset.id});e(),E.checkResponse(t)?this.subform.setLoadedConfig(t.config):this.setError(t.msg)})),function(){return t.apply(this,arguments)})}]),e}(),H=function(){function e(t,n,r){var o=this;z(this,e),E=t,this.form=n,this.configElements={},this.configOpts=[],this.sectionize=r,this.allSettings=c.tmplElement(n,"allSettings"),this.dynamicOpts=c.tmplElement(n,"dynamicOpts"),this.textInputTmpl=c.tmplElement(n,"textInput"),this.textInputTmpl.remove(),this.checkboxTmpl=c.tmplElement(n,"checkbox"),this.checkboxTmpl.remove(),this.fileSelector=c.tmplElement(n,"fileSelector"),this.fileInput=c.tmplElement(n,"fileInput"),this.errMsg=c.tmplElement(n,"errMsg"),this.showOther=c.tmplElement(n,"showOther"),this.showIcon=c.tmplElement(n,"showIcon"),this.hideIcon=c.tmplElement(n,"hideIcon"),this.showHideMsg=c.tmplElement(n,"showHideMsg"),this.otherSettings=c.tmplElement(n,"otherSettings"),this.loadedSettingsMsg=c.tmplElement(n,"loadedSettingsMsg"),this.loadedSettings=c.tmplElement(n,"loadedSettings"),this.defaultSettingsMsg=c.tmplElement(n,"defaultSettingsMsg"),this.defaultSettings=c.tmplElement(n,"defaultSettings"),r||c.hide(this.showOther),c.bind(this.fileSelector,"click",(function(){return o.fileInput.click()})),c.bind(this.fileInput,"change",N((function*(){return o.fileInputChanged()}))),c.bind(this.showOther,"click",(function(){o.setOtherSettingsViz(o.hideIcon.classList.contains("d-hide"))}))}var t;return V(e,[{key:"fileInputChanged",value:(t=N((function*(){var e;if(this.fileInput.value){var t=E.loading(this.form),n=yield this.fileInput.files[0].text();if(n){var r=yield B("/api/parseconfig",{configtext:n});if(t(),!E.checkResponse(r))return this.errMsg.textContent=r.msg,void c.show(this.errMsg);if(0!==Object.keys(r.map).length){(e=this.dynamicOpts).append.apply(e,M(this.setConfig(r.map))),this.reorder(this.dynamicOpts);var o=[this.loadedSettings.children.length,this.defaultSettings.children.length],i=o[0],a=o[1];0===i&&c.hide(this.loadedSettings,this.loadedSettingsMsg),0===a&&c.hide(this.defaultSettings,this.defaultSettingsMsg),i+a===0&&c.hide(this.showOther,this.otherSettings)}}}})),function(){return t.apply(this,arguments)})},{key:"update",value:function(e){var t=this;this.configElements={},this.configOpts=e.configopts,c.empty(this.dynamicOpts,this.otherSettings),this.setOtherSettingsViz(!1),c.hide(this.loadedSettingsMsg,this.loadedSettings,this.defaultSettingsMsg,this.defaultSettings,this.errMsg);var n,r=[],o=function(e,n){var r="wcfg-"+n.key,o=n.isboolean?t.checkboxTmpl.cloneNode(!0):t.textInputTmpl.cloneNode(!0);t.configElements[n.key]=o;var i=o.querySelector("input");i.id=r,i.configOpt=n;var a=o.querySelector("label");a.htmlFor=r,a.prepend(n.displayname),e.appendChild(o),n.noecho&&(i.type="password"),n.description&&(a.dataset.tooltip=n.description),n.isboolean?i.checked=n.default:i.value=null!==n.default?n.default:""},i=I(this.configOpts);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.sectionize&&null!==a.default?r.push(a):o(this.dynamicOpts,a)}}catch(e){i.e(e)}finally{i.f()}if(r.length){var s,l=I(r);try{for(l.s();!(s=l.n()).done;){var u=s.value;o(this.defaultSettings,u)}}catch(e){l.e(e)}finally{l.f()}c.show(this.showOther,this.defaultSettingsMsg,this.defaultSettings)}else c.hide(this.showOther);E.bindTooltips(this.allSettings)}},{key:"setOtherSettingsViz",value:function(e){if(e)return c.hide(this.showIcon),c.show(this.hideIcon,this.otherSettings),void(this.showHideMsg.textContent="hide additional settings");c.hide(this.hideIcon,this.otherSettings),c.show(this.showIcon),this.showHideMsg.textContent="show additional settings"}},{key:"setConfig",value:function(e){var t=this,n=[];return this.allSettings.querySelectorAll("input").forEach((function(r){var o,i=r.configOpt.key,a=e[i];void 0!==a&&(n.push(t.configElements[i]),r.configOpt.isboolean?r.checked="1"===(o=a)||"true"===o.toLowerCase():r.value=a)})),n}},{key:"setLoadedConfig",value:function(e){var t,n=this.setConfig(e);this.sectionize&&0!==n.length&&((t=this.loadedSettings).append.apply(t,M(n)),this.reorder(this.loadedSettings),c.show(this.loadedSettings,this.loadedSettingsMsg),0===this.defaultSettings.children.length&&c.hide(this.defaultSettings,this.defaultSettingsMsg))}},{key:"map",value:function(){var e={};return this.allSettings.querySelectorAll("input").forEach((function(t){t.configOpt.isboolean&&t.configOpt.key?e[t.configOpt.key]=t.checked?"1":"0":t.value&&(e[t.configOpt.key]=t.value)})),e}},{key:"reorder",value:function(e){var t=this,n={};e.querySelectorAll("input").forEach((function(e){var r=e.configOpt.key;n[r]=t.configElements[r]}));var r,o=I(this.configOpts);try{for(o.s();!(r=o.n()).done;){var i=r.value,a=n[i.key];a&&e.append(a)}}catch(e){o.e(e)}finally{o.f()}}}]),e}();function Q(e,t,n){var r,o=c.parsePage(t,["uwAssetLogo","uwAssetName","uwAppPass","submitUnlock","unlockErr"]);t.setAsset=function(e){r=e,o.uwAssetLogo.src=c.logoPath(e.symbol),o.uwAssetName.textContent=e.info.name,o.uwAppPass.value=""},X(t,o.submitUnlock,N((function*(){if(""===o.uwAppPass.value)return o.unlockErr.textContent="app password cannot be empty",void c.show(o.unlockErr);c.hide(o.unlockErr);var i={assetID:parseInt(r.id),pass:o.uwAppPass.value};o.uwAppPass.value="";var a=e.loading(t),s=yield B("/api/openwallet",i);if(a(),!e.checkResponse(s))return o.unlockErr.textContent=s.msg,void c.show(o.unlockErr);n()})))}function X(e,t,n){var r=function(e){e.preventDefault&&e.preventDefault(),n(e)};c.bind(t,"click",r),c.bind(e,"submit",r)}function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){$(i,r,o,a,s,"next",e)}function s(e){$(i,r,o,a,s,"throw",e)}a(void 0)}))}}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var te,ne,re=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(f,e);var t,n,r,o,i,a,s,l,u,h,d=(u=f,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ee(u);if(h){var n=ee(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Z(this,e)});function f(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),n=d.call(this),te=e,n.body=t,n.notifiers={};var r=n.page=c.parsePage(t,["appPWForm","appPW","appPWAgain","appPWSubmit","appPWErrMsg","newWalletForm","unlockWalletForm","dexAddrForm","dexAddr","certFile","selectedCert","removeCert","addCert","submitDEXAddr","dexAddrErr","dexCertFile","dexNeedCert","dexShowMore","confirmRegForm","feeDisplay","dexDCRLotSize","appPass","submitConfirm","regErr","dexCertBox"]);return t.querySelectorAll(".form-closer").forEach((function(e){return c.hide(e)})),X(r.appPWForm,r.appPWSubmit,(function(){return n.setAppPass()})),n.walletForm=new _(te,r.newWalletForm,(function(){n.changeForm(r.newWalletForm,r.dexAddrForm)})),Q(te,r.unlockWalletForm,(function(){n.changeForm(r.unlockWalletForm,r.dexAddrForm)})),n.defaultTLSText="none selected",r.selectedCert.textContent=n.defaultTLSText,c.bind(r.certFile,"change",(function(){return n.readCert()})),c.bind(r.removeCert,"click",(function(){return n.resetCert()})),c.bind(r.addCert,"click",(function(){return r.certFile.click()})),X(r.dexAddrForm,r.submitDEXAddr,(function(){return n.checkDEX()})),c.bind(r.dexShowMore,"click",(function(){c.hide(r.dexShowMore),c.show(r.dexCertBox)})),X(r.confirmRegForm,r.submitConfirm,(function(){return n.registerDEX()})),te.user.authed&&n.auth(),n}return t=f,(n=[{key:"auth",value:(l=J((function*(){yield te.fetchUser(),this.walletForm.setAsset(te.assets[42]),this.page.unlockWalletForm.setAsset(te.assets[42]),this.walletForm.loadDefaults()})),function(){return l.apply(this,arguments)})},{key:"changeForm",value:(s=J((function*(e,t){var n=this.body.offsetWidth/2;yield c.animate(300,(function(t){e.style.right="".concat(t*n,"px")}),"easeInHard"),c.hide(e),e.style.right="0",t.style.right=-n,c.show(t),t.querySelector("input").focus(),yield c.animate(300,(function(e){t.style.right="".concat(e*n-n,"px")}),"easeOutHard"),t.style.right="0"})),function(e,t){return s.apply(this,arguments)})},{key:"setAppPass",value:(a=J((function*(){var e=this.page;c.hide(e.appPWErrMsg);var t=e.appPW.value,n=e.appPWAgain.value;if(""===t)return e.appPWErrMsg.textContent="password cannot be empty",void c.show(e.appPWErrMsg);if(t!==n)return e.appPWErrMsg.textContent="passwords do not match",void c.show(e.appPWErrMsg);te.setNotes([]),e.appPW.value="",e.appPWAgain.value="";var r=te.loading(e.appPWForm),o=yield B("/api/init",{pass:t});if(r(),!te.checkResponse(o))return e.appErrMsg.textContent=o.msg,void c.show(e.appErrMsg);this.auth(),te.updateMenuItemsDisplay(),this.changeForm(e.appPWForm,e.newWalletForm)})),function(){return a.apply(this,arguments)})},{key:"checkDEX",value:(i=J((function*(){var e=this.page;c.hide(e.dexAddrErr);var t=e.dexAddr.value;if(""===t)return e.dexAddrErr.textContent="DEX address cannot be empty",void c.show(e.dexAddrErr);var n="";e.certFile.value&&(n=yield e.certFile.files[0].text());var r=te.loading(e.dexAddrForm),o=yield B("/api/getdexinfo",{addr:t,cert:n});if(r(),te.checkResponse(o,!0)){this.fee=o.xc.feeAsset.amount,e.feeDisplay.textContent=c.formatCoinValue(this.fee/1e8);var i=o.xc.assets[42];i&&(e.dexDCRLotSize.textContent=c.formatCoinValue(i.lotSize/1e8)),yield this.changeForm(e.dexAddrForm,e.confirmRegForm)}else"certificate required"===o.msg?(c.hide(e.dexShowMore),c.show(e.dexCertBox,e.dexNeedCert)):(e.dexAddrErr.textContent=o.msg,c.show(e.dexAddrErr))})),function(){return i.apply(this,arguments)})},{key:"registerDEX",value:(o=J((function*(){var e=this.page;c.hide(e.regErr);var t="";e.certFile.value&&(t=yield e.certFile.files[0].text());var n={addr:e.dexAddr.value,pass:e.appPass.value,fee:this.fee,cert:t};e.appPass.value="";var r=te.loading(e.confirmRegForm),o=yield B("/api/register",n);if(r(),!te.checkResponse(o))return e.regErr.textContent=o.msg,void c.show(e.regErr);yield te.fetchUser(),te.loadPage("markets")})),function(){return o.apply(this,arguments)})},{key:"readCert",value:(r=J((function*(){var e=this.page,t=e.certFile.files;t.length&&(e.selectedCert.textContent=t[0].name,c.show(e.removeCert),c.hide(e.addCert))})),function(){return r.apply(this,arguments)})},{key:"resetCert",value:function(){var e=this.page;e.certFile.value="",e.selectedCert.textContent=this.defaultTLSText,c.hide(e.removeCert),c.show(e.addCert)}}])&&Y(t.prototype,n),f}(O);function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(l,e);var t,n,r,o,i,a,s=(i=l,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ce(i);if(a){var n=ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return le(this,e)});function l(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=s.call(this),ne=e;var r=n.page=c.parsePage(t,["submit","errMsg","loginForm","pw"]);return X(r.loginForm,r.submit,(function(){n.login()})),r.pw.focus(),n}return t=l,(n=[{key:"login",value:(r=function*(e){var t=this.page;c.hide(t.errMsg);var n=t.pw.value;if(t.pw.value="",""===n)return t.errMsg.textContent="password cannot be empty",void c.show(t.errMsg);var r=ne.loading(t.loginForm),o=yield B("/api/login",{pass:n});if(r(),!ne.checkResponse(o))return t.errMsg.textContent=o.msg,void c.show(t.errMsg);o.notes&&o.notes.reverse(),ne.setNotes(o.notes||[]),yield ne.fetchUser(),ne.loadPage("markets")},o=function(){var e=this,t=arguments;return new Promise((function(n,o){var i=r.apply(e,t);function a(e){ie(i,n,o,a,s,"next",e)}function s(e){ie(i,n,o,a,s,"throw",e)}a(void 0)}))},function(e){return o.apply(this,arguments)})}])&&ae(t.prototype,n),l}(O);function he(e,t,n){return{subject:e,details:t,severity:n,stamp:(new Date).getTime()}}function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){fe(i,r,o,a,s,"next",e)}function s(e){fe(i,r,o,a,s,"throw",e)}a(void 0)}))}}function me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||ye(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(e,t){if(e){if("string"==typeof e)return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(e,t):void 0}}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function we(e,t){return!t||"object"!==de(t)&&"function"!=typeof t?ke(e):t}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Se,Ce=c.bind,Ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(S,e);var t,n,r,o,i,a,s,l,u,d,f,p,m,y,v,g,b,w,k,x=(w=S,k=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=xe(w);if(k){var n=xe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return we(this,e)});function S(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,S),n=x.call(this),Se=e,n.body=t;var r,o,i=n.page=c.parsePage(t,["rightBox","assetArrow","balanceArrow","statusArrow","walletTable","markets","dexTitle","marketsBox","oneMarket","marketsFor","marketsCard","walletForm","openForm","walletReconfig","recfgAssetLogo","recfgAssetName","reconfigInputs","submitReconfig","reconfigErr","appPW","showChangePW","changePW","switchPWMsg","hideIcon","showIcon","newPW","deposit","depositName","depositAddress","newDepAddrBttn","depositErr","depositLogo","withdrawForm","withdrawLogo","withdrawName","withdrawAddr","withdrawAmt","withdrawAvail","submitWithdraw","withdrawUnit","withdrawPW","withdrawErr"]),a=function(e,t){return e.querySelector("[data-action=".concat(t,"]"))},s=n.rowInfos={},l=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=ye(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(i.walletTable.querySelectorAll("tr"));try{for(l.s();!(o=l.n()).done;){var u=o.value,d=parseInt(u.dataset.assetID),f=s[d]={};r||(r=f),f.assetID=d,f.tr=u,f.symbol=u.dataset.symbol,f.name=u.dataset.name,f.stateIcons=new h(u),f.actions={connect:a(u,"connect"),unlock:a(u,"unlock"),withdraw:a(u,"withdraw"),deposit:a(u,"deposit"),create:a(u,"create"),lock:a(u,"lock"),settings:a(u,"settings")}}}catch(e){l.e(e)}finally{l.f()}i.dexTitle.removeAttribute("id"),i.dexTitle.remove(),i.oneMarket.removeAttribute("id"),i.oneMarket.remove(),i.markets.removeAttribute("id"),i.markets.remove(),n.displayed=null,n.animation=null,n.openAsset=null,n.walletAsset=null,n.reconfigAsset=null,n.walletForm=new _(Se,i.walletForm,(function(){n.createWalletSuccess()})),n.walletReconfig=new H(Se,i.reconfigInputs,!1),Q(Se,i.openForm,(function(){n.openWalletSuccess()})),X(i.withdrawForm,i.submitWithdraw,(function(){n.withdraw()})),X(i.walletReconfig,i.submitReconfig,(function(){return n.reconfig()}));for(var p=function(){var e=y[m];Ce(e.tr,"click",(function(){n.showMarkets(e.assetID)}))},m=0,y=Object.values(s);m<y.length;m++)p();i.rightBox.querySelectorAll(".form-closer").forEach((function(e){c.bind(e,"click",(function(){n.showMarkets(n.lastFormAsset)}))})),n.keyup=function(e){"Escape"===e.key&&n.showMarkets(n.lastFormAsset)},Ce(document,"keyup",n.keyup);for(var v=function(){var e=me(b[g],2),t=e[0],r=e[1],o=parseInt(t),i=r.actions,a=function(e,t){e.stopPropagation(),t(o,r)};Ce(i.connect,"click",(function(e){a(e,n.doConnect.bind(ke(n)))})),Ce(i.withdraw,"click",(function(e){a(e,n.showWithdraw.bind(ke(n)))})),Ce(i.deposit,"click",(function(e){a(e,n.showDeposit.bind(ke(n)))})),Ce(i.create,"click",(function(e){a(e,n.showNewWallet.bind(ke(n)))})),Ce(i.unlock,"click",(function(e){a(e,n.showOpen.bind(ke(n)))})),Ce(i.lock,"click",function(){var e=pe((function*(e){a(e,n.lock.bind(ke(n)))}));return function(t){return e.apply(this,arguments)}}()),Ce(i.settings,"click",(function(e){a(e,n.showReconfig.bind(ke(n)))}))},g=0,b=Object.entries(s);g<b.length;g++)v();return Ce(i.newDepAddrBttn,"click",pe((function*(){n.newDepositAddress()}))),Ce(i.withdrawAvail,"click",(function(){i.withdrawAmt.value=i.withdrawAvail.textContent})),Ce(i.showChangePW,"click",(function(){n.changeWalletPW=!n.changeWalletPW,n.setPWSettingViz(n.changeWalletPW)})),r?(n.showMarkets(r.assetID),n.notifiers={balance:function(e){n.handleBalanceNote(e)},walletstate:function(e){n.handleWalletStateNote(e)},walletconfig:function(e){n.handleWalletStateNote(e)}},n):we(n)}return t=S,(n=[{key:"setPWSettingViz",value:function(e){if(e)return c.hide(this.page.showIcon),c.show(this.page.hideIcon,this.page.changePW),void(this.page.switchPWMsg.textContent="keep current wallet password");c.hide(this.page.hideIcon,this.page.changePW),c.show(this.page.showIcon),this.page.switchPWMsg.textContent="set a new wallet password"}},{key:"hideBox",value:(b=pe((function*(){this.animation&&(yield this.animation),this.displayed&&c.hide(this.displayed)})),function(){return b.apply(this,arguments)})},{key:"showBox",value:(g=pe((function*(e,t){e.style.opacity="0",c.show(e),t&&t.focus(),yield c.animate(300,(function(t){e.style.opacity="".concat(t)}),"easeOut"),e.style.opacity="1",this.displayed=e})),function(e,t){return g.apply(this,arguments)})},{key:"showMarkets",value:(v=pe((function*(e){var t=this.page,n=t.marketsBox,r=t.marketsCard,o=this.rowInfos[e];yield this.hideBox(),c.empty(r),t.marketsFor.textContent=o.name;for(var i=0,a=Object.entries(Se.user.exchanges);i<a.length;i++){for(var s=me(a[i],2),l=s[0],u=s[1],h=0,d=0,f=Object.values(u.markets);d<f.length;d++){var p=f[d];p.baseid!==e&&p.quoteid!==e||h++}if(0!==h){var m=t.dexTitle.cloneNode(!0);m.textContent=l,r.appendChild(m);var y=t.markets.cloneNode(!0);r.appendChild(y);for(var v=function(){var n=b[g];if(n.baseid!==e&&n.quoteid!==e)return"continue";var r=t.oneMarket.cloneNode(!0);r.querySelector("span").textContent=Ee(n);var o=n.basesymbol;n.baseid===e&&(o=n.quotesymbol),r.querySelector("img").src=c.logoPath(o);var i={host:l,base:n.baseid,quote:n.quoteid};Ce(r,"click",(function(){Se.loadPage("markets",i)})),y.appendChild(r)},g=0,b=Object.values(u.markets);g<b.length;g++)v()}}this.animation=this.showBox(n)})),function(e){return v.apply(this,arguments)})},{key:"showNewWallet",value:(y=pe((function*(e){var t=this.page.walletForm,n=Se.assets[e];yield this.hideBox(),this.walletAsset=this.lastFormAsset=e,this.walletForm.setAsset(n),this.animation=this.showBox(t),yield this.walletForm.loadDefaults()})),function(e){return y.apply(this,arguments)})},{key:"showOpen",value:(m=pe((function*(e){var t=this.page;this.openAsset=this.lastFormAsset=e,yield this.hideBox(),t.openForm.setAsset(Se.assets[e]),this.animation=this.showBox(t.openForm,t.walletPass)})),function(e){return m.apply(this,arguments)})},{key:"showReconfig",value:(p=pe((function*(e){var t=this.page;c.hide(t.reconfigErr),this.changeWalletPW=!1,this.setPWSettingViz(this.changeWalletPW);var n=Se.assets[e];this.walletReconfig.update(n.info),t.recfgAssetLogo.src=c.logoPath(n.symbol),t.recfgAssetName.textContent=n.info.name,this.reconfigAsset=this.lastFormAsset=e,yield this.hideBox(),this.animation=this.showBox(t.walletReconfig);var r=Se.loading(t.walletReconfig),o=yield B("/api/walletsettings",{assetID:e});if(r(),!Se.checkResponse(o,!0))return t.reconfigErr.textContent=o.msg,void c.show(t.reconfigErr);this.walletReconfig.setConfig(o.map)})),function(e){return p.apply(this,arguments)})},{key:"showDeposit",value:(f=pe((function*(e){var t=this.page;c.hide(t.depositErr);var n=t.deposit,r=Se.assets[e];t.depositLogo.src=c.logoPath(r.symbol);var o=Se.walletMap[e];this.depositAsset=this.lastFormAsset=e,o?(yield this.hideBox(),t.depositName.textContent=r.info.name,t.depositAddress.textContent=o.address,this.animation=this.showBox(n)):Se.notify(he("No wallet found for ".concat(r.info.name),"Cannot retrieve deposit address.",5))})),function(e){return f.apply(this,arguments)})},{key:"newDepositAddress",value:(d=pe((function*(){var e=this.page;c.hide(e.depositErr);var t=Se.loading(e.deposit),n=yield B("/api/depositaddress",{assetID:this.depositAsset});if(t(),!Se.checkResponse(n,!0))return e.depositErr.textContent=n.msg,void c.show(e.depositErr);e.depositAddress.textContent=n.address})),function(){return d.apply(this,arguments)})},{key:"showWithdraw",value:(u=pe((function*(e){var t=this.page,n=t.withdrawForm,r=Se.assets[e],o=Se.walletMap[e];o||Se.notify(he("No wallet found for ".concat(r.info.name),"Cannot withdraw.",5)),yield this.hideBox(),t.withdrawAddr.value="",t.withdrawAmt.value="",t.withdrawAvail.textContent=(o.balance.available/1e8).toFixed(8),t.withdrawLogo.src=c.logoPath(r.symbol),t.withdrawName.textContent=r.info.name,n.dataset.assetID=this.lastFormAsset=e,this.animation=this.showBox(n,t.walletPass)})),function(e){return u.apply(this,arguments)})},{key:"doConnect",value:(l=pe((function*(e){var t=Se.loading(this.body),n=yield B("/api/connectwallet",{assetID:e});if(t(),Se.checkResponse(n)){var r=this.rowInfos[e];c.hide(r.actions.connect)}})),function(e){return l.apply(this,arguments)})},{key:"createWalletSuccess",value:(s=pe((function*(){var e=this.rowInfos[this.walletAsset];this.showMarkets(e.assetID);var t=e.actions;c.hide(t.create),c.show(t.withdraw,t.deposit,t.settings),yield Se.fetchUser(),Se.walletMap[e.assetID].encrypted&&c.show(t.lock)})),function(){return s.apply(this,arguments)})},{key:"openWalletSuccess",value:(a=pe((function*(){var e=this.rowInfos[this.openAsset],t=e.actions;c.show(t.withdraw,t.deposit),c.hide(t.unlock,t.connect),Se.walletMap[e.assetID].encrypted&&c.show(t.lock),this.showMarkets(this.openAsset)})),function(){return a.apply(this,arguments)})},{key:"withdraw",value:(i=pe((function*(){var e=this.page;c.hide(e.withdrawErr);var t=parseInt(e.withdrawForm.dataset.assetID),n={assetID:t,address:e.withdrawAddr.value,value:parseInt(Math.round(1e8*e.withdrawAmt.value)),pw:e.withdrawPW.value},r=Se.loading(e.withdrawForm),o=yield B("/api/withdraw",n);if(r(),!Se.checkResponse(o,!0))return e.withdrawErr.textContent=o.msg,void c.show(e.withdrawErr);this.showMarkets(t)})),function(){return i.apply(this,arguments)})},{key:"reconfig",value:(o=pe((function*(){var e=this.page;if(c.hide(e.reconfigErr),!e.appPW.value)return e.reconfigErr.textContent="app password cannot be empty",void c.show(e.reconfigErr);var t=Se.loading(e.walletReconfig),n={assetID:this.reconfigAsset,config:this.walletReconfig.map(),appPW:e.appPW.value};this.changeWalletPW&&(n.newWalletPW=e.newPW.value);var r=yield B("/api/reconfigurewallet",n);if(e.appPW.value="",e.newPW.value="",t(),!Se.checkResponse(r,!0))return e.reconfigErr.textContent=r.msg,void c.show(e.reconfigErr);this.showMarkets(this.reconfigAsset)})),function(){return o.apply(this,arguments)})},{key:"lock",value:(r=pe((function*(e,t){var n=this.page,r=Se.loading(n.walletForm),o=yield B("/api/closewallet",{assetID:e});if(r(),Se.checkResponse(o)){var i=t.actions;c.hide(i.withdraw,i.lock,i.deposit),c.show(i.unlock)}})),function(e,t){return r.apply(this,arguments)})},{key:"handleBalanceNote",value:function(e){this.page.walletTable.querySelector('[data-balance-target="'.concat(e.assetID,'"]')).textContent=(e.balance.available/1e8).toFixed(8)}},{key:"handleWalletStateNote",value:function(e){this.rowInfos[e.wallet.assetID].stateIcons.readWallet(e.wallet)}},{key:"unload",value:function(){c.unbind(document,"keyup",this.keyup)}}])&&ge(t.prototype,n),S}(O);function Ee(e){return"".concat(e.basesymbol.toUpperCase(),"-").concat(e.quotesymbol.toUpperCase())}function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pe(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function Fe(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Pe(i,r,o,a,s,"next",e)}function s(e){Pe(i,r,o,a,s,"throw",e)}a(void 0)}))}}function Re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Le(e,t){return(Le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Te,Ie=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Le(e,t)}(b,e);var t,n,r,o,i,a,s,l,u,h,d,f,p,m,y,v,g=(y=b,v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qe(y);if(v){var n=qe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Be(this,e)});function b(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),n=g.call(this),Te=e,n.body=t;var r=n.page=c.parsePage(t,["darkMode","commitHash","addADex","dexAddrForm","dexAddr","certFile","selectedCert","removeCert","addCert","submitDEXAddr","dexAddrErr","forms","confirmRegForm","feeDisplay","dexDCRLotSize","appPass","submitConfirm","regErr","exchanges","authorizeAccountExportForm","exportAccountAppPass","authorizeExportAccountConfirm","exportAccountHost","exportAccountErr","importAccount","authorizeAccountImportForm","authorizeImportAccountConfirm","importAccountAppPass","accountFile","selectedAccount","removeAccount","addAccount","importAccountErr","disableAccount","disableAccountForm","disableAccountConfirm","disableAccountAppPW","disableAccountHost","disableAccountErr","changeAppPW","changeAppPWForm","appPW","newAppPW","confirmNewPW","submitNewPW","changePWErrMsg","showPokes"]);c.bind(r.darkMode,"click",(function(){C.dark(r.darkMode.checked),r.darkMode.checked?document.body.classList.add("dark"):document.body.classList.remove("dark")})),c.bind(r.showPokes,"click",(function(){var e=r.showPokes.checked;C.setCookie("popups",e?"1":"0"),Te.showPopups=e})),r.commitHash.textContent=Te.commitHash.substring(0,7),c.bind(r.addADex,"click",(function(){return n.showForm(r.dexAddrForm)})),c.bind(r.certFile,"change",(function(){return n.onCertFileChange()})),c.bind(r.removeCert,"click",(function(){return n.clearCertFile()})),c.bind(r.addCert,"click",(function(){return n.page.certFile.click()})),X(r.dexAddrForm,r.submitDEXAddr,(function(){return n.verifyDEX()})),X(r.confirmRegForm,r.submitConfirm,(function(){return n.registerDEX()})),X(r.authorizeAccountExportForm,r.authorizeExportAccountConfirm,(function(){return n.exportAccount()})),X(r.disableAccountForm,r.disableAccountConfirm,(function(){return n.disableAccount()}));var o=r.exchanges;if(void 0!==Te.user.exchanges)for(var i=function(){var e=s[a],t=c.tmplElement(o,"exportAccount-".concat(e));c.bind(t,"click",(function(){return n.prepareAccountExport(e,r.authorizeAccountExportForm)}));var i=c.tmplElement(o,"disableAccount-".concat(e));c.bind(i,"click",(function(){return n.prepareAccountDisable(e,r.disableAccountForm)}))},a=0,s=Object.keys(Te.user.exchanges);a<s.length;a++)i();c.bind(r.importAccount,"click",(function(){return n.prepareAccountImport(r.authorizeAccountImportForm)})),X(r.authorizeAccountImportForm,r.authorizeImportAccountConfirm,(function(){return n.importAccount()})),c.bind(r.changeAppPW,"click",(function(){return n.showForm(r.changeAppPWForm)})),X(r.changeAppPWForm,r.submitNewPW,(function(){return n.changeAppPW()})),c.bind(r.accountFile,"change",(function(){return n.onAccountFileChange()})),c.bind(r.removeAccount,"click",(function(){return n.clearAccountFile()})),c.bind(r.addAccount,"click",(function(){return n.page.accountFile.click()}));var l=function(){c.hide(r.forms),r.appPass.value=""};return c.bind(r.forms,"mousedown",(function(e){c.mouseInElement(e,n.currentForm)||l()})),n.keyup=function(e){"Escape"===e.key&&l()},c.bind(document,"keyup",n.keyup),r.forms.querySelectorAll(".form-closer").forEach((function(e){c.bind(e,"click",(function(){l()}))})),n}return t=b,(n=[{key:"prepareAccountExport",value:(m=Fe((function*(e,t){var n=this.page;n.exportAccountHost.textContent=e,n.exportAccountErr.textContent="",this.showForm(t)})),function(e,t){return m.apply(this,arguments)})},{key:"prepareAccountDisable",value:(p=Fe((function*(e,t){var n=this.page;n.disableAccountHost.textContent=e,n.disableAccountErr.textContent="",this.showForm(t)})),function(e,t){return p.apply(this,arguments)})},{key:"exportAccount",value:(f=Fe((function*(){var e=this.page,t=e.exportAccountAppPass.value,n=e.exportAccountHost.textContent;e.exportAccountAppPass.value="";var r={pw:t,host:n},o=Te.loading(this.body),i=yield B("/api/exportaccount",r);if(o(),!Te.checkResponse(i))return e.exportAccountErr.textContent=i.msg,void c.show(e.exportAccountErr);var a=JSON.parse(JSON.stringify(i.account)),s=document.createElement("a");s.setAttribute("download","dcrAccount-"+n+".json"),s.setAttribute("href","data:text/json,"+JSON.stringify(a,null,2)),s.click(),c.hide(e.forms)})),function(){return f.apply(this,arguments)})},{key:"disableAccount",value:(d=Fe((function*(){var e=this.page,t=e.disableAccountAppPW.value,n=e.disableAccountHost.textContent;e.disableAccountAppPW.value="";var r={pw:t,host:n},o=Te.loading(this.body),i=yield B("/api/disableaccount",r);if(o(),!Te.checkResponse(i,!0))return e.disableAccountErr.textContent=i.msg,void c.show(e.disableAccountErr);c.hide(e.forms),window.location.reload()})),function(){return d.apply(this,arguments)})},{key:"onAccountFileChange",value:(h=Fe((function*(){var e=this.page,t=e.accountFile.files;t.length&&(e.selectedAccount.textContent=t[0].name,c.show(e.removeAccount),c.hide(e.addAccount))})),function(){return h.apply(this,arguments)})},{key:"clearAccountFile",value:function(){var e=this.page;e.accountFile.value="",e.selectedAccount.textContent=this.defaultTLSText,c.hide(e.removeAccount),c.show(e.addAccount)}},{key:"prepareAccountImport",value:(u=Fe((function*(e){this.page.importAccountErr.textContent="",this.showForm(e)})),function(e){return u.apply(this,arguments)})},{key:"importAccount",value:(l=Fe((function*(){var e=this.page,t=e.importAccountAppPass.value;e.importAccountAppPass.value="";var n,r="";e.accountFile.value&&(r=yield e.accountFile.files[0].text());try{n=JSON.parse(r)}catch(t){return e.importAccountErr.textContent=t.message,void c.show(e.importAccountErr)}if(void 0===n)return e.importAccountErr.textContent="Account undefined.",void c.show(e.importAccountErr);var o={pw:t,account:n},i=Te.loading(this.body),a=yield B("/api/importaccount",o);if(i(),!Te.checkResponse(a))return e.importAccountErr.textContent=a.msg,void c.show(e.importAccountErr);var s=yield B("/api/login",{pass:t});if(!Te.checkResponse(s))return e.importAccountErr.textContent=s.msg,void c.show(e.importAccountErr);yield Te.fetchUser(),c.hide(e.forms),window.location.reload()})),function(){return l.apply(this,arguments)})},{key:"showForm",value:(s=Fe((function*(e){var t=this.page;this.currentForm=e,c.hide(t.dexAddrForm,t.confirmRegForm,t.authorizeAccountExportForm,t.authorizeAccountImportForm,t.disableAccountForm,t.changeAppPWForm),e.style.right="10000px",c.show(t.forms,e);var n=(t.forms.offsetWidth+e.offsetWidth)/2;yield c.animate(300,(function(t){e.style.right="".concat((1-t)*n,"px")}),"easeOutHard"),e.style.right="0"})),function(e){return s.apply(this,arguments)})},{key:"onCertFileChange",value:(a=Fe((function*(){var e=this.page,t=e.certFile.files;t.length&&(e.selectedCert.textContent=t[0].name,c.show(e.removeCert),c.hide(e.addCert))})),function(){return a.apply(this,arguments)})},{key:"clearCertFile",value:function(){var e=this.page;e.certFile.value="",e.selectedCert.textContent=this.defaultTLSText,c.hide(e.removeCert),c.show(e.addCert)}},{key:"verifyDEX",value:(i=Fe((function*(){var e=this.page;c.hide(e.dexAddrErr);var t=e.dexAddr.value;if(""===t)return e.dexAddrErr.textContent="URL cannot be empty",void c.show(e.dexAddrErr);var n="";e.certFile.value&&(n=yield e.certFile.files[0].text());var r=Te.loading(e.dexAddrForm),o=yield B("/api/getdexinfo",{addr:t,cert:n});if(r(),!Te.checkResponse(o))return e.dexAddrErr.textContent=o.msg,void c.show(e.dexAddrErr);this.fee=o.xc.feeAsset.amount,e.feeDisplay.textContent=c.formatCoinValue(this.fee/1e8);var i=o.xc.assets[42];i&&(e.dexDCRLotSize.textContent=c.formatCoinValue(i.lotSize/1e8)),yield this.showForm(e.confirmRegForm)})),function(){return i.apply(this,arguments)})},{key:"registerDEX",value:(o=Fe((function*(){var e=this.page;c.hide(e.regErr);var t="";e.certFile.value&&(t=yield e.certFile.files[0].text());var n={addr:e.dexAddr.value,pass:e.appPass.value,fee:this.fee,cert:t};e.appPass.value="";var r=Te.loading(e.confirmRegForm),o=yield B("/api/register",n);if(!Te.checkResponse(o))return e.regErr.textContent=o.msg,c.show(e.regErr),void r();e.dexAddr.value="",this.clearCertFile(),c.hide(e.forms),yield Te.fetchUser(),r(),window.location.reload()})),function(){return o.apply(this,arguments)})},{key:"changeAppPW",value:(r=Fe((function*(){var e=this.page;c.hide(e.changePWErrMsg);var t=function(){e.appPW.value="",e.newAppPW.value="",e.confirmNewPW.value=""};if(!e.appPW.value||!e.newAppPW.value||!e.confirmNewPW.value)return e.changePWErrMsg.textContent="app password cannot be empty",c.show(e.changePWErrMsg),void t();if(e.newAppPW.value!==e.confirmNewPW.value)return e.changePWErrMsg.textContent="password confirmation doesn't match",c.show(e.changePWErrMsg),void t();var n=Te.loading(e.changeAppPW),r={appPW:e.appPW.value,newAppPW:e.newAppPW.value};t();var o=yield B("/api/changeapppass",r);if(n(),!Te.checkResponse(o,!0))return e.changePWErrMsg.textContent=o.msg,void c.show(e.changePWErrMsg);c.hide(e.forms)})),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){c.unbind(document,"keyup",this.keyup)}}])&&Re(t.prototype,n),b}(O);function Me(e,t){if(e){if("string"==typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(e,t):void 0}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var De=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.base=t.base,this.baseSymbol=n,this.quote=t.quote,this.quoteSymbol=r,this.buys=t.book.buys||[],this.sells=t.book.sells||[]}var t,n;return t=e,(n=[{key:"add",value:function(e){var t=e.sell?this.sells:this.buys;t.splice(function(e,t,n){for(var r in e)if(e[r].rate<t===n)return r;return e.length}(t,e.rate,!e.sell),0,e)}},{key:"remove",value:function(e){this.removeFromSide(this.sells,e)||this.removeFromSide(this.buys,e)}},{key:"removeFromSide",value:function(e,t){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||Me(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.findOrder(e,t),2),r=n[0],o=n[1];return!!r&&(e.splice(o,1),!0)}},{key:"findOrder",value:function(e,t){for(var n in e)if(e[n].token===t)return[e[n],n];return[null,-1]}},{key:"updateRemaining",value:function(e,t){this.updateRemainingSide(this.sells,e,t)||this.updateRemainingSide(this.buys,e,t)}},{key:"updateRemainingSide",value:function(e,t,n){var r=this.findOrder(e,t)[0];return!!r&&(r.qty=n,!0)}},{key:"setEpoch",value:function(e){var t=function(t){return void 0===t.epoch||0===t.epoch||t.epoch===e};this.sells=this.sells.filter(t),this.buys=this.buys.filter(t)}},{key:"empty",value:function(){return!this.sells.length&&!this.buys.length}},{key:"count",value:function(){return this.sells.length+this.buys.length}},{key:"bestGapOrder",value:function(e){var t,n=null,r=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Me(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(!o.epoch)return o;n||(n=o)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"bestGapBuy",value:function(){return this.bestGapOrder(this.buys)}},{key:"bestGapSell",value:function(){return this.bestGapOrder(this.sells)}}])&&je(t.prototype,n),e}();function Ne(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ve(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function ze(e){return function(e){if(Array.isArray(e))return _e(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Ve(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||Ve(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){if(e){if("string"==typeof e)return _e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_e(e,t):void 0}}function _e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function He(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xe(e,t,n){return t&&Qe(e.prototype,t),n&&Qe(e,n),e}var Ge=c.bind,$e=c.unbind,Je=2*Math.PI,Ye=String.fromCharCode(59914),Ke=String.fromCharCode(59915),Ze={axisLabel:"#b1b1b1",gridBorder:"#3a3a3a",gridLines:"#2a2a2a",gapLine:"#6b6b6b",value:"#9a9a9a",zoom:"#5b5b5b",zoomHover:"#aaa",sellLine:"#ae3333",buyLine:"#05a35a",sellFill:"#591a1a",buyFill:"#02572f",crosshairs:"#888",legendFill:"black",legendText:"#d5d5d5"},et={axisLabel:"#1b1b1b",gridBorder:"#3a3a3a",gridLines:"#dadada",gapLine:"#595959",value:"#4d4d4d",zoom:"#777",zoomHover:"#333",sellLine:"#99302b",buyLine:"#207a46",sellFill:"#bd5959",buyFill:"#4cad75",crosshairs:"#595959",legendFill:"#e6e6e6",legendText:"#1b1b1b"},tt=function(){function e(t,n,r){var o=this;He(this,e),this.theme=C.isDark()?Ze:et,this.canvas=document.createElement("canvas"),this.parent=t,this.reporters=n,this.ctx=this.canvas.getContext("2d"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.book=null,this.dataExtents=null,this.zoomLevel=r,this.lotSize=null,this.rateStep=null,this.lines=[],this.markers={buys:[],sells:[]},t.appendChild(this.canvas),this.mousePos=null,Ge(this.canvas,"mousemove",(function(e){o.mousePos={x:e.clientX-o.rect.left,y:e.clientY-o.rect.y},o.draw()})),Ge(this.canvas,"mouseleave",(function(){o.mousePos=null,o.draw()})),this.wheelLimiter=null,this.wheeled=function(){o.wheelLimiter=setTimeout((function(){o.wheelLimiter=null}),100)},Ge(this.canvas,"wheel",(function(e){o.wheel(e)})),this.resize=function(e){o.resize_(e)},Ge(window,"resize",(function(){o.resize(t.clientHeight)})),Ge(this.canvas,"click",(function(e){o.click(e)})),this.resize(t.clientHeight)}return Xe(e,[{key:"unattach",value:function(){$e(window,"resize",this.resize)}},{key:"resize_",value:function(e){this.canvas.width=this.parent.clientWidth,this.canvas.height=e-20;var t=new nt(40,this.canvas.width,10,this.canvas.height-30),n=new nt(40,this.canvas.width,this.canvas.height-30,this.canvas.height),r=new nt(0,40,10,this.canvas.height-30);this.plotRegion=new rt(this.ctx,t),this.xRegion=new rt(this.ctx,n),this.yRegion=new rt(this.ctx,r),this.zoomInBttn=new rt(this.ctx,new nt(0,0,0,0)),this.zoomOutBttn=new rt(this.ctx,new nt(0,0,0,0)),this.rect=this.canvas.getBoundingClientRect(),this.book&&this.draw()}},{key:"wheel",value:function(e){this.zoom(e.deltaY<0),e.preventDefault()}},{key:"zoom",value:function(e){var t;this.zoomLevel&&(this.wheelLimiter||this.book.buys&&this.book.sells&&(this.wheeled(),this.zoomLevel*=e?2/3:1.5,this.zoomLevel=(2,(t=this.zoomLevel)<.005?.005:t>2?2:t),this.draw(),this.reporters.zoom(this.zoomLevel)))}},{key:"click",value:function(e){if(this.dataExtents){var t=e.clientX-this.rect.left,n=e.clientY-this.rect.y;if(this.zoomInBttn.contains(t,n))this.zoom(!0);else if(this.zoomOutBttn.contains(t,n))this.zoom(!1);else{var r=this.plotRegion.translator(this.dataExtents);this.reporters.click(r.unx(t))}}}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"set",value:function(e,t,n){if(this.book=e,this.lotSize=t/1e8,this.rateStep=n/1e8,this.baseTicker=e.baseSymbol.toUpperCase(),this.quoteTicker=e.quoteSymbol.toUpperCase(),!this.zoomLevel){var r=Ue(this.gap(),2),o=r[0],i=r[1],a=Math.max(i/o*5,.05);this.zoomLevel=Math.min(a,2)}this.draw()}},{key:"draw",value:function(){var e=this;if(this.book){this.clear(),this.ctx.textAlign="center",this.ctx.textBaseline="middle";var t=this.mousePos,n=this.book.buys,r=this.book.sells,o=Ue(this.gap(),2),i=o[0],a=o[1],s=this.zoomLevel*i/2,l=i+s,c=i-s,u=ze(this.markers.buys),h=ze(this.markers.sells);u.sort((function(e,t){return t.rate-e.rate})),h.sort((function(e,t){return e.rate-t.rate}));for(var d=[],f=[],p=[],m=[],y=[],v={buyBase:0,buyQuote:0,sellBase:0,sellQuote:0},g=0,b=0,w=0;w<n.length;w++){var k=n[w];if(b+=k.qty,k.rate>=c&&p.push([k.rate,b]),!k.epoch)for(g+=k.qty,f.push([k.rate,g]),v.buyBase+=k.qty,v.buyQuote+=k.qty*k.rate;u.length&&ct(u[0].rate,k.rate);){var x=u.shift();d.push({rate:x.rate,qty:k.epoch?b:g,sell:k.sell,active:x.active})}}var S=f.length?it(f)[1]:0;f.push([c,S]);var C=p.length?it(p)[1]:0;p.push([c,C]),b=g=0;for(var A=0;A<r.length;A++){var E=r[A];if(b+=E.qty,E.rate<=l&&y.push([E.rate,b]),!E.epoch)for(g+=E.qty,m.push([E.rate,g]),v.sellBase+=E.qty,v.sellQuote+=E.qty*E.rate;h.length&&ct(h[0].rate,E.rate);){var O=h.shift();d.push({rate:O.rate,qty:E.epoch?b:g,sell:E.sell,active:O.active})}}var P=m.length?it(m)[1]:0;m.push([l,P]);var F=y.length?it(y)[1]:0;y.push([l,F]);var R=this.xRegion.extents.y.min,L=(R+30)/R,B=(F&&C?Math.max(C,F):F||C||1)*L,q=new nt(c,l,0,B);this.dataExtents=q;var T=this.ctx;T.font="12px 'sans', sans-serif",T.fillStyle=this.theme.axisLabel;var I=ot(T,this.plotRegion.height(),q.y.min,q.y.max,50,this.lotSize,this.book.baseSymbol),M=1.5*I.widest;this.yRegion.extents.x.max=M,this.plotRegion.extents.x.min=M,this.xRegion.extents.x.min=M;var W,j=ot(T,this.plotRegion.width(),q.x.min,q.x.max,100,this.rateStep,"".concat(this.book.quoteSymbol,"/").concat(this.book.baseSymbol));T.lineWidth=1,this.plotRegion.plot(q,(function(n,r){n.strokeStyle=e.theme.gridBorder;var o=q.x,s=q.y;n.beginPath(),r.dataCoords((function(){n.moveTo(o.min,s.min),n.lineTo(o.min,s.max),n.lineTo(o.max,s.max),n.lineTo(o.max,s.min),n.lineTo(o.min,s.min)})),n.stroke(),n.strokeStyle=e.theme.gridLines,j.lbls.forEach((function(e){at(n,r.x(e.val),r.y(0),r.x(e.val),r.y(s.max))})),I.lbls.forEach((function(e){at(n,r.x(o.min),r.y(e.val),r.x(o.max),r.y(e.val))})),n.lineWidth=2.5,n.strokeStyle=e.theme.gapLine,at(n,r.x(i),r.y(0),r.x(i),r.y(.3*s.max)),n.font="30px 'demi-sans', sans-serif",n.fillStyle=e.theme.value;var u=.5*s.max;n.fillText(lt(i),r.x(i),r.y(u)),n.font="12px 'sans', sans-serif",n.fillText("".concat((a/i*100).toFixed(2),"% spread"),r.x(i),r.y(u)+24);var h=e.plotRegion.extents.midX,p=r.y(.9*B),y=q.xRange/i*100,v="".concat(y.toFixed(1),"%"),g=n.measureText(v).width;n.font="13px 'sans', sans-serif",n.fillText(v,h,p+1);var b=h-g/2-10-20,w=p-10;e.zoomOutBttn.setExtents(b,b+20,w,w+20);var k=t&&e.zoomOutBttn.contains(t.x,t.y);e.zoomOutBttn.plot(new nt(0,1,0,1),(function(t,n){t.font="12px 'icomoon'",t.fillStyle=e.theme.zoom,k&&(t.fillStyle=e.theme.zoomHover,t.font="13px 'icomoon'"),t.fillText(Ke,e.zoomOutBttn.extents.midX,e.zoomOutBttn.extents.midY)})),b=h+g/2+10,e.zoomInBttn.setExtents(b,b+20,w,w+20),k=t&&e.zoomInBttn.contains(t.x,t.y),e.zoomInBttn.plot(new nt(0,1,0,1),(function(t,n){t.font="12px 'icomoon'",t.fillStyle=e.theme.zoom,k&&(t.fillStyle=e.theme.zoomHover,t.font="14px 'icomoon'"),t.fillText(Ye,e.zoomInBttn.extents.midX,e.zoomInBttn.extents.midY)}));var x,S=function(e,t){e>l||e<c||(n.save(),n.setLineDash([3,5]),n.lineWidth=1.5,n.strokeStyle=t,at(n,r.x(e),r.y(0),r.x(e),r.y(B)),n.restore())},C=Ne(e.lines||[]);try{for(C.s();!(x=C.n()).done;){var A=x.value;S(A.rate,A.color)}}catch(e){C.e(e)}finally{C.f()}var E,O=.005*(l-c),P=[],F=Ne(d||[]);try{for(F.s();!(E=F.n()).done;){var R=E.value,L=t&&ut(R.rate,r.unx(t.x),O);L&&P.push(R.rate),n.save(),n.lineWidth=L||R.active?5:3,n.strokeStyle=R.sell?e.theme.sellLine:e.theme.buyLine,n.fillStyle=R.sell?e.theme.sellFill:e.theme.buyFill;var T=L||R.active?10:8;n.beginPath();var D={x:r.x(R.rate),y:r.y(R.qty)-8},N=D.y-Math.sqrt(3)*T/2;n.moveTo(D.x,D.y),n.lineTo(D.x-T/2,N),n.lineTo(D.x+T/2,N),n.closePath(),n.stroke(),n.fill(),n.restore()}}catch(e){F.e(e)}finally{F.f()}if(t&&e.plotRegion.contains(t.x,t.y)){var z=r.unx(t.x),U=m,V=function(e){return e>=z},_=e.theme.sellLine;z<i&&(U=f,V=function(e){return e<=z},_=e.theme.buyLine);for(var H=U[0],Q=0;Q<U.length;Q++){var X=U[Q];if(V(X[0]))break;H=X}S(z,e.theme.crosshairs),W={rate:z,depth:H[1],dotColor:_,yAxisWidth:M,hoverMarkers:P}}})),this.yRegion.plot(new nt(0,1,0,B),(function(t,n){var r=B/2,o=0,i=r;I.lbls.forEach((function(e){t.fillText(e.txt,n.x(.5),n.y(e.val)),r>=o&&r<e.val&&(i=(o+e.val)/2),o=e.val})),t.fillText(e.baseTicker,n.x(.5),n.y(i))}),!0),this.xRegion.plot(new nt(c,l,0,1),(function(t,n){var r=(l+c)/2,o=c,i=r;j.lbls.forEach((function(e){t.fillText(e.txt,n.x(e.val),n.y(.5)),r>=o&&r<e.val&&(i=(o+e.val)/2),o=e.val})),t.font="11px 'sans', sans-serif",t.fillText("".concat(e.quoteTicker,"/"),n.x(i),n.y(.63)),t.fillText(e.baseTicker,n.x(i),n.y(.23))}),!0),this.ctx.lineWidth=1.5,T.setLineDash([3,3]),T.fillStyle=this.theme.sellFill,T.strokeStyle=this.theme.sellLine,this.drawDepth(y),T.fillStyle=this.theme.buyFill,T.strokeStyle=this.theme.buyLine,this.drawDepth(p),this.ctx.lineWidth=2.5,T.setLineDash([]),T.fillStyle=this.theme.sellFill,T.strokeStyle=this.theme.sellLine,this.drawDepth(m),T.fillStyle=this.theme.buyFill,T.strokeStyle=this.theme.buyLine,this.drawDepth(f),W&&this.plotRegion.plot(q,(function(e,t){!function(e,t,n,r,o){e.fillStyle=r,e.beginPath(),e.arc(t,n,5,0,Je),e.fill()}(e,t.x(W.rate),t.y(W.depth),W.dotColor)})),this.reporters.volume(v),this.reporters.mouse(W)}}},{key:"drawDepth",value:function(e){var t,n=e[0],r=n[1];this.plotRegion.plot(this.dataExtents,(function(o,i){i.dataCoords((function(){o.beginPath(),o.moveTo(n[0],n[1]);for(var i=0;i<e.length;i++)t=e[i][0],o.lineTo(t,r),r=e[i][1],o.lineTo(t,r)})),o.stroke(),i.dataCoords((function(){o.lineTo(t,0),o.lineTo(n[0],0)})),o.closePath(),o.globalAlpha=.25,o.fill()}))}},{key:"gap",value:function(){var e=[this.book.bestGapBuy(),this.book.bestGapSell()],t=e[0],n=e[1];return t?n?[(n.rate+t.rate)/2,n.rate-t.rate]:[t.rate,0]:n?[n.rate,0]:[1,0]}},{key:"setLines",value:function(e){this.lines=e}},{key:"setMarkers",value:function(e){this.markers=e}}]),e}(),nt=function(){function e(t,n,r,o){He(this,e),this.setExtents(t,n,r,o)}return Xe(e,[{key:"setExtents",value:function(e,t,n,r){this.x={min:e,max:t},this.y={min:n,max:r}}},{key:"xRange",get:function(){return this.x.max-this.x.min}},{key:"midX",get:function(){return(this.x.max+this.x.min)/2}},{key:"yRange",get:function(){return this.y.max-this.y.min}},{key:"midY",get:function(){return(this.y.max+this.y.min)/2}}]),e}(),rt=function(){function e(t,n){He(this,e),this.context=t,this.extents=n}return Xe(e,[{key:"setExtents",value:function(e,t,n,r){this.extents.setExtents(e,t,n,r)}},{key:"width",value:function(){return this.extents.xRange}},{key:"height",value:function(){return this.extents.yRange}},{key:"contains",value:function(e,t){var n=this.extents;return e<n.x.max&&e>n.x.min&&t<n.y.max&&t>n.y.min}},{key:"translator",value:function(e){var t=this.extents,n=e.x.min,r=e.y.min,o=e.yRange,i=e.xRange,a=t.x.min,s=t.x.max-a,l=t.y.max,c=l-t.y.min,u=s/i,h=c/o;return{x:function(e){return(e-n)*u+a},y:function(e){return l-(e-r)*h},unx:function(e){return(e-a)/u+n},uny:function(e){return r-(e-l)/h}}}},{key:"clear",value:function(){var e=this.extents;this.ctx.clearRect(e.x.min,e.y.min,e.xRange,e.yRange)}},{key:"plot",value:function(e,t,n){var r=this.context,o=this.extents;r.save(),n||(r.beginPath(),r.rect(o.x.min,o.y.min,o.xRange,o.yRange),r.clip());var i=this.translator(e),a=e.yRange,s=o.xRange/e.xRange,l=o.yRange/a,c=e.x.min,u=e.y.min,h=o.x.min+c-c*s,d=-o.y.min-(a-u)*l;i.dataCoords=function(e){r.save(),r.transform(1,0,0,-1,-c,u),r.transform(s,0,0,l,h,d),e(),r.restore()},t(this.context,i),r.restore()}}]),e}();function ot(e,t,n,r,o,i,a){for(var s=(r-n)/(t/o),l=s+i-s%i,c=n+l-n%l,u=Math.max(Math.abs(r),Math.abs(n)),h=Math.round(Math.log10(u/l))+2,d=[],f=0;c<r;){var p=lt(c=Number(c.toPrecision(h)));f=Math.max(f,e.measureText(p).width),d.push({val:c,txt:p}),c+=l}var m=e.measureText(a).width;return m>f&&(f=m),{widest:f,lbls:d}}function it(e){return e[e.length-1]}function at(e,t,n,r,o,i){e.beginPath(),e.moveTo(t,n),e.lineTo(r,o),i||e.stroke()}var st={minimumSignificantDigits:4,maximumSignificantDigits:5};function lt(e){return e.toLocaleString("en-us",st)}function ct(e,t){return ut(e,t,1e-8)}function ut(e,t,n){return Math.abs(e-t)<Math.abs(n)}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dt(e){return e.sell?"sell":"buy"}function ft(e){return 1===e.type?0===e.tif?"limit (i)":"limit":"market"}function pt(e){return 2===e.type&&!e.sell}function mt(e){var t=function(e){if(!e.matches)return!1;var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e.matches);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!r.revoked&&r.status<3)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}(e);switch(e.status){case 0:return"unknown";case 1:return"epoch";case 2:return e.cancelling?"cancelling":"booked";case 3:return t?"settling":"executed";case 4:return t?"canceled/settling":"canceled";case 5:return t?"revoked/settling":"revoked"}}function yt(e){if(!e.matches)return 0;var t=pt(e)?function(e){return e.qty*e.rate*1e-8}:function(e){return e.qty};return e.matches.reduce((function(e,n){return n.isCancel?e:0===n.side&&n.status>=3||1===n.side&&n.status>=4?e+t(n):e}),0)}function vt(e,t){if(e){if("string"==typeof e)return gt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(e,t):void 0}}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wt(e,t,n){if(e||!t.error){if(void 0!==n[e])for(var r=0;r<n[e].length;r++)n[e][r](t)}else{var o=t.error;console.error("websocket error (code ".concat(o.code,"): ").concat(o.message))}}var kt=0;const xt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uri=void 0,this.connection=void 0,this.handlers={},this.queue=[],this.maxQlength=5}var t,n;return t=e,(n=[{key:"registerRoute",value:function(e,t){this.handlers[e]=this.handlers[e]||[],this.handlers[e].push(t)}},{key:"deregisterRoute",value:function(e){this.handlers[e]=[]}},{key:"request",value:function(e,t){if(this.connection&&this.connection.readyState===window.WebSocket.OPEN){kt++;var n=JSON.stringify({route:e,type:1,id:kt,payload:t});window.log("ws","sending",n),this.connection.send(n)}else{for(;this.queue.length>this.maxQlength-1;)this.queue.shift();this.queue.push([e,t])}}},{key:"close",value:function(e){window.log("ws","close, reason:",e,this.handlers),this.handlers={},this.connection.close()}},{key:"connect",value:function(e,t){var n=this;this.uri=e,this.reloader=t;var r=0;!function o(){window.log("ws","connecting to ".concat(e));var i=n.connection=new window.WebSocket(e),a=setTimeout((function(){i.close()}),500);i.onmessage=function(e){var t=JSON.parse(e.data);wt(t.route,t.payload,n.handlers)},i.onclose=function(e){window.log("ws","onclose"),clearTimeout(a),i=n.connection=null,wt("close",null,n.handlers),r++;var t=Math.min(Math.pow(1.25,r),10);console.error("websocket disconnected (".concat(e.code,"), trying again in ").concat(t.toFixed(1)," seconds")),setTimeout((function(){o()}),1e3*t)},i.onopen=function(){window.log("ws","onopen"),clearTimeout(a),r>0&&(r=0,t()),wt("open",null,n.handlers);var e=n.queue;n.queue=[];var o,i,s,l=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=vt(e))){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e);try{for(l.s();!(o=l.n()).done;){var c=(i=o.value,s=2,function(e){if(Array.isArray(e))return e}(i)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(i,s)||vt(i,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],h=c[1];n.request(u,h)}}catch(e){l.e(e)}finally{l.f()}},i.onerror=function(e){window.log("ws","onerror:",e),wt("error",e,n.handlers)}}()}}])&&bt(t.prototype,n),e}());function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e){return function(e){if(Array.isArray(e))return Lt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Rt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ot(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function Pt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ot(i,r,o,a,s,"next",e)}function s(e){Ot(i,r,o,a,s,"throw",e)}a(void 0)}))}}function Ft(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Rt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Rt(e,t){if(e){if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lt(e,t):void 0}}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tt(e,t,n){return t&&qt(e.prototype,t),n&&qt(e,n),e}function It(e,t){return(It=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Mt(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wt(e){return(Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var jt,Dt=c.bind,Nt="book",zt="book_order",Ut="unbook_order",Vt="epoch_order",_t="selectedMarket",Ht="chartRatio",Qt="depthZoom",Xt=document.createElement("span");Xt.classList.add("ico-check");var Gt,$t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&It(e,t)}(f,e);var t,n,r,o,i,a,s,l,u,h,d=(u=f,h=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Wt(u);if(h){var n=Wt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Mt(this,e)});function f(e,t,n){var r;Bt(this,f),r=d.call(this),jt=e;var o=r.page=c.parsePage(t,["marketLoader","marketList","rowTemplate","buyRows","sellRows","marketSearch","rightSide","registrationStatus","regStatusTitle","regStatusMessage","regStatusConfsDisplay","regStatusDex","confReq","orderForm","priceBox","buyBttn","sellBttn","limitBttn","marketBttn","tifBox","submitBttn","qtyField","rateField","orderErr","baseWalletIcons","quoteWalletIcons","lotSize","rateStep","lotField","tifNow","mktBuyBox","mktBuyLots","mktBuyField","minMktBuy","qtyBox","loaderMsg","balanceTable","orderPreview","forms","openForm","uwAppPass","verifyForm","vHeader","vSideHeader","vSide","vQty","vBase","vRate","vTotal","vQuote","vPass","vSideSubmit","vBaseSubmit","vSubmit","verifyLimit","verifyMarket","vmTotal","vmAsset","vmLots","mktBuyScore","walletForm","liveTemplate","liveList","liveTable","cancelForm","cancelRemain","cancelUnit","cancelPass","cancelSubmit","marketChart","chartResizer","sellBookedBase","sellBookedQuote","buyBookedBase","buyBookedQuote","hoverData","hoverPrice","hoverVolume","chartLegend","chartErrMsg","maxOrd","maxLbl","maxFromLots","maxFromAmt","maxFromTicker","maxToAmt","maxToTicker","maxAboveZero","maxLotBox","maxFromLotsLbl","maxBox"]);r.main=t,r.loaded=jt.loading(r.main.parentElement),r.maxLoaded=null,r.market=null,r.registrationStatus={},r.currentForm=null,r.openAsset=null,r.openFunc=null,r.currentCreate=null,r.preorderTimer=null,r.book=null,r.cancelData=null,r.metaOrders={},r.depthLines={hover:[],input:[]},r.activeMarkerRate=null,r.hovers=[],r.ordersSortKey="stamp",r.ordersSortDirection=1;var i={click:function(e){r.reportClick(e)},volume:function(e){r.reportVolume(e)},mouse:function(e){r.reportMousePosition(e)},zoom:function(e){r.reportZoom(e)}};r.chart=new tt(o.marketChart,i,C.fetch(Qt));var a=r.balanceWgt=new Zt(o.balanceTable),s=a.base.stateIcons.icons,l=a.quote.stateIcons.icons;Dt(a.base.connect,"click",(function(){r.showOpen(r.market.base,r.walletUnlocked)})),Dt(a.quote.connect,"click",(function(){r.showOpen(r.market.quote,r.walletUnlocked)})),Dt(a.base.expired,"click",(function(){r.showOpen(r.market.base,r.walletUnlocked)})),Dt(a.quote.expired,"click",(function(){r.showOpen(r.market.quote,r.walletUnlocked)})),Dt(s.sleeping,"click",(function(){r.showOpen(r.market.base,r.walletUnlocked)})),Dt(l.sleeping,"click",(function(){r.showOpen(r.market.quote,r.walletUnlocked)})),Dt(s.locked,"click",(function(){r.showOpen(r.market.base,r.walletUnlocked)})),Dt(l.locked,"click",(function(){r.showOpen(r.market.quote,r.walletUnlocked)})),Dt(a.base.newWalletBttn,"click",(function(){r.showCreate(r.market.base)})),Dt(a.quote.newWalletBttn,"click",(function(){r.showCreate(r.market.quote)})),sn(o.rowTemplate,o.liveTemplate),r.marketList=new Jt(o.marketList);var u,h=Ft(r.marketList.xcSections);try{var p=function(){var e,t=u.value,n=Ft(t.marketRows);try{var o=function(){var n=e.value;Dt(n.row,"click",(function(){r.setMarket(t.host,n.baseID,n.quoteID)}))};for(n.s();!(e=n.n()).done;)o()}catch(e){n.e(e)}finally{n.f()}};for(h.s();!(u=h.n()).done;)p()}catch(e){h.e(e)}finally{h.f()}r.quoteUnits=t.querySelectorAll("[data-unit=quote]"),r.baseUnits=t.querySelectorAll("[data-unit=base]"),Dt(o.buyBttn,"click",(function(){rn(o.sellBttn,o.buyBttn),o.submitBttn.classList.remove("sellred"),o.submitBttn.classList.add("buygreen"),o.maxLbl.textContent="Buy",r.setOrderBttnText(),r.setOrderVisibility(),r.drawChartLines()})),Dt(o.sellBttn,"click",(function(){rn(o.buyBttn,o.sellBttn),o.submitBttn.classList.add("sellred"),o.submitBttn.classList.remove("buygreen"),o.maxLbl.textContent="Sell",r.setOrderBttnText(),r.setOrderVisibility(),r.drawChartLines()})),Dt(o.limitBttn,"click",(function(){rn(o.marketBttn,o.limitBttn),r.setOrderVisibility(),o.rateField.value&&(r.depthLines.input=[{rate:o.rateField.value,color:r.isSell()?r.chart.theme.sellLine:r.chart.theme.buyLine}],r.drawChartLines())})),Dt(o.marketBttn,"click",(function(){rn(o.limitBttn,o.marketBttn),r.setOrderVisibility(),r.setMarketBuyOrderEstimate(),r.depthLines.input=[],r.drawChartLines()})),Dt(o.maxOrd,"click",(function(){r.isSell()?o.lotField.value=r.market.maxSell.swap.lots:o.lotField.value=r.market.maxBuys[r.adjustedRate()].swap.lots,r.lotChanged()})),c.disableMouseWheel(o.rateField,o.lotField,o.qtyField,o.mktBuyField),xt.registerRoute(Nt,(function(e){r.handleBookRoute(e)})),xt.registerRoute(zt,(function(e){r.handleBookOrderRoute(e)})),xt.registerRoute(Ut,(function(e){r.handleUnbookOrderRoute(e)})),xt.registerRoute("update_remaining",(function(e){r.handleUpdateRemainingRoute(e)})),xt.registerRoute(Vt,(function(e){r.handleEpochOrderRoute(e)})),Q(jt,o.openForm,Pt((function*(){r.openFunc()}))),r.walletForm=new _(jt,o.walletForm,Pt((function*(){r.createWallet()}))),X(o.orderForm,o.submitBttn,Pt((function*(){r.stepSubmit()}))),X(o.verifyForm,o.vSubmit,Pt((function*(){r.submitOrder()}))),X(o.cancelForm,o.cancelSubmit,Pt((function*(){r.submitCancel()}))),o.liveTable.querySelectorAll("[data-ordercol]").forEach((function(e){return Dt(e,"click",(function(){return m(e.dataset.ordercol)}))}));var m=function(e){y(),r.ordersSortKey===e?r.ordersSortDirection*=-1:(r.ordersSortKey=e,r.ordersSortDirection=1),r.refreshActiveOrders(),v()},y=function(){o.liveTable.querySelectorAll("[data-ordercol]").forEach((function(e){return e.classList.remove("sorted-asc","sorted-dsc")}))},v=function(){var e=r.ordersSortKey,t=1===r.ordersSortDirection?"sorted-asc":"sorted-dsc";o.liveTable.querySelector("[data-ordercol=".concat(e,"]")).classList.add(t)};v();var g=function(){c.hide(o.forms),o.vPass.value="",o.cancelPass.value=""};Dt(o.forms,"mousedown",(function(e){c.mouseInElement(e,r.currentForm)||g()})),r.keyup=function(e){"Escape"===e.key&&g()},Dt(document,"keyup",r.keyup),o.forms.querySelectorAll(".form-closer").forEach((function(e){c.bind(e,"click",(function(){g()}))})),Dt(o.lotField,"change",(function(){r.lotChanged()})),Dt(o.lotField,"keyup",(function(){r.lotChanged()})),Dt(o.qtyField,"change",(function(){r.quantityChanged(!0)})),Dt(o.qtyField,"keyup",(function(){r.quantityChanged(!1)})),Dt(o.mktBuyField,"change",(function(){r.marketBuyChanged()})),Dt(o.mktBuyField,"keyup",(function(){r.marketBuyChanged()})),Dt(o.rateField,"change",(function(){r.rateFieldChanged()})),Dt(o.rateField,"keyup",(function(){r.previewQuoteAmt(!0)})),Dt(o.marketSearch,"change",(function(){r.filterMarkets()})),Dt(o.marketSearch,"keyup",(function(){r.filterMarkets()}));var b=function(){r.depthLines.hover=[],r.drawChartLines()};Dt(o.buyRows,"mouseleave",b),Dt(o.sellRows,"mouseleave",b),Dt(o.liveList,"mouseleave",(function(){r.activeMarkerRate=null,r.setMarkers()}));var w,k=function(e){e>.7?e=.7:e<.25&&(e=.25);var t=e*(r.main.clientHeight-jt.header.offsetHeight);o.marketChart.style.height="".concat(t,"px"),r.chart.resize(t)},x=C.fetch(Ht);return x&&k(x),Dt(o.chartResizer,"mousedown",(function(e){if(0===e.button){var t;e.preventDefault();var n=function(e){e.preventDefault();var n=o.rightSide.getBoundingClientRect(),r=n.bottom-n.top;t=(e.pageY-n.top)/r,k(t)};Dt(document,"mousemove",n),Dt(document,"mouseup",(function(){t&&C.store(Ht,t),c.unbind(document,"mousemove",n)}))}})),r.notifiers={order:function(e){r.handleOrderNote(e)},epoch:function(e){r.handleEpochNote(e)},conn:function(e){r.handleConnNote(e)},balance:function(e){r.handleBalanceNote(e)},feepayment:function(e){r.handleFeePayment(e)},walletstate:function(e){r.handleWalletStateNote(e)}},(w=n&&n.host&&void 0!==n.base&&void 0!==n.quote?en(n.host,parseInt(n.base),parseInt(n.quote)):C.fetch(_t))&&r.marketList.exists(w.host,w.base,w.quote)||(w=r.marketList.first()),r.setMarket(w.host,w.base,w.quote),r.secondTicker=setInterval((function(){for(var e=0,t=Object.values(r.metaOrders);e<t.length;e++){var n=t[e];c.tmplElement(n.row,"age").textContent=c.timeSince(n.order.stamp)}}),1e3),r.setRegistrationStatusVisibility(),r.setBalanceVisibility(),r}return Tt(f,[{key:"isSell",value:function(){return this.page.sellBttn.classList.contains("selected")}},{key:"isLimit",value:function(){return this.page.limitBttn.classList.contains("selected")}},{key:"hasFeePending",value:function(){var e=this.market.dex;return"number"==typeof e.confs&&e.confs<e.confsrequired}},{key:"assetsAreSupported",value:function(){var e=[this.market.base,this.market.quote];return e[0]&&e[1]}},{key:"setOrderVisibility",value:function(){var e=this.page;this.isLimit()?(c.show(e.priceBox,e.tifBox,e.qtyBox,e.maxBox),c.hide(e.mktBuyBox),this.previewQuoteAmt(!0)):(c.hide(e.tifBox,e.maxBox,e.priceBox),this.isSell()?(c.hide(e.mktBuyBox),c.show(e.qtyBox),this.previewQuoteAmt(!0)):(c.show(e.mktBuyBox),c.hide(e.qtyBox),this.previewQuoteAmt(!1)))}},{key:"resolveOrderFormVisibility",value:function(){var e=this.page,t=!this.hasFeePending(),n=this.assetsAreSupported(),r=this.market.base,o=this.market.quote,i=r&&jt.assets[r.id].wallet&&o&&jt.assets[o.id].wallet;t&&n&&i?c.show(e.orderForm):c.hide(e.orderForm)}},{key:"setLoaderMsgVisibility",value:function(){var e=this.page,t=this.market,n=t.base,r=t.quote;if(this.assetsAreSupported())c.hide(e.loaderMsg);else{var o=!n&&this.market.baseCfg.symbol||!r&&this.market.quoteCfg.symbol;e.loaderMsg.textContent="".concat(o.toUpperCase()," is not supported"),c.show(e.loaderMsg)}}},{key:"setRegistrationStatusView",value:function(e,t,n){var r=this.page;r.regStatusTitle.textContent=e,r.regStatusConfsDisplay.textContent=t,r.registrationStatus.classList.remove("completed","error","waiting"),r.registrationStatus.classList.add(n)}},{key:"updateRegistrationStatusView",value:function(e,t,n,r){var o=this.page;if(o.confReq.textContent=n,o.regStatusDex.textContent=e,t)this.setRegistrationStatusView("Registration fee payment successful!","","completed");else{var i="".concat(r," / ").concat(n);this.setRegistrationStatusView("Waiting for confirmations...",i,"waiting")}}},{key:"setRegistrationStatusVisibility",value:function(){var e=this,t=this.page,n=this.market.dex,r=n.confs,o=n.confsrequired,i=this.hasFeePending();if(n.connected)if(this.updateRegistrationStatusView(n.host,!i,o,r),i)c.show(t.registrationStatus);else{var a=function(){c.hide(t.registrationStatus),e.resolveOrderFormVisibility()};if(c.isHidden(t.orderForm))return void setTimeout(a,5e3);a()}}},{key:"setOrderBttnText",value:function(){this.isSell()?this.page.submitBttn.textContent="Place order to sell ".concat(this.market.base.symbol.toUpperCase()):this.page.submitBttn.textContent="Place order to buy  ".concat(this.market.base.symbol.toUpperCase())}},{key:"setMarket",value:(l=Pt((function*(e,t,n){var r=jt.user.exchanges[e];if(!r.connected)return this.market={dex:r},this.page.chartErrMsg.textContent="Connection to dex server failed. You can close dexc and try again later or wait for it to reconnect.",c.show(this.page.chartErrMsg),this.loaded(),this.main.style.opacity=1,void c.hide(this.page.marketLoader);var o=r.assets[t],i=r.assets[n];c.hide(this.page.maxOrd,this.page.chartErrMsg),this.preorderTimer&&(window.clearTimeout(this.preorderTimer),this.preorderTimer=null),this.market={dex:r,sid:tn(o.symbol,i.symbol),base:jt.assets[t],quote:jt.assets[n],baseCfg:r.assets[t],quoteCfg:r.assets[n],maxSell:null,maxBuys:{}},this.page.marketLoader.classList.remove("d-none"),xt.request("loadmarket",en(e,t,n)),this.setLoaderMsgVisibility(),this.setRegistrationStatusVisibility(),this.resolveOrderFormVisibility(),this.setOrderBttnText()})),function(e,t,n){return l.apply(this,arguments)})},{key:"reportClick",value:function(e){this.page.rateField.value=e.toFixed(8),this.rateFieldChanged()}},{key:"reportVolume",value:function(e){var t=this.page;t.sellBookedBase.textContent=c.formatCoinValue(e.sellBase),t.sellBookedQuote.textContent=c.formatCoinValue(e.sellQuote),t.buyBookedBase.textContent=c.formatCoinValue(e.buyBase),t.buyBookedQuote.textContent=c.formatCoinValue(e.buyQuote)}},{key:"reportMousePosition",value:function(e){for(;this.hovers.length;)this.hovers.shift().classList.remove("hover");var t=this.page;if(e){for(var n=e.hoverMarkers.map((function(e){return Math.round(1e8*e)})),r=0,o=Object.values(this.metaOrders);r<o.length;r++){var i=o[r],a=[i.row,i.order],s=a[0],l=a[1];2===l.status&&n.indexOf(l.rate)>-1&&(s.classList.add("hover"),this.hovers.push(s))}t.hoverPrice.textContent=c.formatCoinValue(e.rate),t.hoverVolume.textContent=c.formatCoinValue(e.depth),t.hoverVolume.style.color=e.dotColor,t.chartLegend.style.left="".concat(e.yAxisWidth,"px"),c.show(t.hoverData)}else c.hide(t.hoverData)}},{key:"reportZoom",value:function(e){C.store(Qt,e)}},{key:"parseOrder",value:function(){var e=this.page,t=e.qtyField,n=this.isLimit(),r=this.isSell(),o=this.market;return n||r||(t=e.mktBuyField),{host:o.dex.host,isLimit:n,sell:r,base:o.base.id,quote:o.quote.id,qty:nn(t.value),rate:nn(e.rateField.value),tifnow:e.tifNow.checked}}},{key:"previewQuoteAmt",value:function(e){var t=this.page,n=this.parseOrder();if(t.orderErr.textContent="",n.rate&&(n.sell?this.preSell():this.preBuy()),this.depthLines.input=[],n.rate&&this.isLimit()&&(this.depthLines.input=[{rate:n.rate/1e8,color:n.sell?this.chart.theme.sellLine:this.chart.theme.buyLine}]),this.drawChartLines(),!e||!n.rate||!n.qty)return t.orderPreview.textContent="",void this.drawChartLines();var r=jt.assets[n.quote],o=c.formatCoinValue(n.rate/1e8*n.qty/1e8);t.orderPreview.textContent="Total: ".concat(o," ").concat(r.symbol.toUpperCase())}},{key:"preSell",value:function(){var e=this,t=this.market,n=jt.assets[t.base.id].wallet;n.available<t.baseCfg.lotSize?this.setMaxOrder(0,this.adjustedRate()/1e8):t.maxSell?this.setMaxOrder(t.maxSell.swap,this.adjustedRate()/1e8):this.schedulePreOrder("/api/maxsell",{},0,(function(r){t.maxSell=r.maxSell,t.sellBalance=n.balance.available,e.setMaxOrder(r.maxSell.swap,e.adjustedRate()/1e8)}))}},{key:"preBuy",value:function(){var e=this,t=this.market,n=this.adjustedRate(),r=jt.assets[t.quote.id].wallet,o=t.baseCfg.lotSize*(n/1e8);if(r.balance.available<o)this.setMaxOrder(0,1e8/n);else if(t.maxBuys[n])this.setMaxOrder(t.maxBuys[n].swap,1e8/n);else{var i=t.maxBuys?1e3:0;this.schedulePreOrder("/api/maxbuy",{rate:n},i,(function(r){t.maxBuys[n]=r.maxBuy,t.buyBalance=jt.assets[t.quote.id].wallet.balance.available,e.setMaxOrder(r.maxBuy.swap,1e8/n)}))}}},{key:"schedulePreOrder",value:function(e,t,n,r){var o=this,i=this.page;this.maxLoaded||(this.maxLoaded=jt.loading(i.maxOrd));var a=[this.market.base.id,this.market.quote.id],s=a[0],l=a[1],u=[jt.assets[s].wallet,jt.assets[l].wallet],h=u[0],d=u[1];h&&h.running&&d&&d.running&&(this.preorderTimer&&window.clearTimeout(this.preorderTimer),c.show(i.maxOrd,i.maxLotBox),c.hide(i.maxAboveZero),i.maxFromLots.textContent="calculating...",i.maxFromLotsLbl.textContent="",this.preorderTimer=window.setTimeout(Pt((function*(){o.preorderTimer=null;var n=yield B(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){Et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({host:o.market.dex.host,base:s,quote:l},t));if(!o.preorderTimer){if(o.maxLoaded(),o.maxLoaded=null,!jt.checkResponse(n,!0))return console.warn("max order estimate not available:",n),void(i.maxFromLots.textContent="estimate unavailable");r(n)}})),n))}},{key:"setMaxOrder",value:function(e,t){var n=this.page;c.show(n.maxOrd,n.maxLotBox,n.maxAboveZero);var r=this.isSell();n.maxFromLots.textContent=e.lots.toString(),n.maxFromLotsLbl.textContent=1===e.lots?"lot":"lots",0!==e.lots?(n.maxFromAmt.textContent=c.formatCoinValue(e.value/1e8),n.maxFromTicker.textContent=r?this.market.base.symbol:this.market.quote.symbol.toUpperCase(),n.maxToAmt.textContent=c.formatCoinValue(e.value/1e8*t),n.maxToTicker.textContent=r?this.market.quote.symbol:this.market.base.symbol.toUpperCase()):c.hide(n.maxAboveZero)}},{key:"validateOrder",value:function(e){var t=this.page;return e.isLimit&&!e.rate?(c.show(t.orderErr),t.orderErr.textContent="zero rate not allowed",!1):!!e.qty||(c.show(t.orderErr),t.orderErr.textContent="zero quantity not allowed",!1)}},{key:"handleBook",value:function(e){var t=[this.market.baseCfg,this.market.quoteCfg],n=t[0],r=t[1];this.book=new De(e,n.symbol,r.symbol),this.loadTable();var o,i=Ft(e.book.epoch||[]);try{for(i.s();!(o=i.n()).done;){var a=o.value;a.rate>0&&this.book.add(a),this.addTableOrder(a)}}catch(e){i.e(e)}finally{i.f()}if(!this.book)return this.chart.clear(),c.empty(this.page.buyRows),void c.empty(this.page.sellRows);this.chart.set(this.book,n.lotSize,r.rateStep)}},{key:"midGap",value:function(){var e=this.book;if(e)return e.buys&&e.buys.length?e.sells&&e.sells.length?(e.buys[0].rate+e.sells[0].rate)/2:e.buys[0].rate:e.sells&&e.sells.length?e.sells[0].rate:null}},{key:"setMarketBuyOrderEstimate",value:function(){var e=this.market,t=e.baseCfg.lotSize,n=jt.user.exchanges[e.dex.host].markets[e.sid].buybuffer,r=this.midGap();r&&(this.page.minMktBuy.textContent=c.formatCoinValue(t*n*r/1e8))}},{key:"ordersSortCompare",value:function(){var e=this;switch(this.ordersSortKey){case"stamp":return function(t,n){return e.ordersSortDirection*(n.stamp-t.stamp)};case"rate":return function(t,n){return e.ordersSortDirection*(t.rate-n.rate)};case"qty":return function(t,n){return e.ordersSortDirection*(t.qty-n.qty)};case"type":return function(t,n){return e.ordersSortDirection*ft(t).localeCompare(ft(n))};case"sell":return function(t,n){return e.ordersSortDirection*dt(t).localeCompare(dt(n))};case"status":return function(t,n){return e.ordersSortDirection*mt(t).localeCompare(mt(n))};case"settled":return function(t,n){return e.ordersSortDirection*(100*yt(t)/t.qty-100*yt(n)/n.qty)};case"filled":return function(t,n){return e.ordersSortDirection*(100*t.filled/t.qty-100*n.filled/n.qty)}}}},{key:"refreshActiveOrders",value:function(){var e=this,t=this.page,n=this.metaOrders,r=this.market;for(var o in n)delete n[o];var i=jt.orders(r.dex.host,tn(r.baseCfg.symbol,r.quoteCfg.symbol)),a=this.ordersSortCompare();i.sort(a),c.empty(t.liveList);var s,l=Ft(i);try{var u=function(){var r=s.value,o=t.liveTemplate.cloneNode(!0);if(n[r.id]={row:o,order:r},c.bind(o,"mouseenter",(function(t){e.activeMarkerRate=r.rate,e.setMarkers()})),an(o,r),1===r.type&&1===r.tif&&r.status<3){var i=c.tmplElement(o,"cancelBttn");c.show(i),Dt(i,"click",(function(t){t.stopPropagation(),e.showCancel(o,r.id)}))}c.tmplElement(o,"side").classList.add(r.sell?"sellcolor":"buycolor"),c.tmplElement(o,"link").href="order/".concat(r.id),jt.bindInternalNavigation(o),t.liveList.appendChild(o),jt.bindTooltips(o)};for(l.s();!(s=l.n()).done;)u()}catch(e){l.e(e)}finally{l.f()}this.setMarkers()}},{key:"setMarkers",value:function(){for(var e={buys:[],sells:[]},t=0,n=Object.values(this.metaOrders);t<n.length;t++){var r=n[t].order;r.rate&&2===r.status&&(r.sell?e.sells.push({rate:r.rate/1e8,active:r.rate===this.activeMarkerRate}):e.buys.push({rate:r.rate/1e8,active:r.rate===this.activeMarkerRate}))}this.chart.setMarkers(e),this.book&&this.chart.draw()}},{key:"handleBookRoute",value:function(e){var t=this;jt.log("book","handleBookRoute:",e);var n=e.payload,r=this.market,o=this.page,i=r.dex.host,a=[r.baseCfg,r.quoteCfg],s=a[0],l=a[1];n.base===s.id&&n.quote===l.id&&(this.refreshActiveOrders(),this.handleBook(n),o.marketLoader.classList.add("d-none"),this.marketList.select(i,s.id,l.id),C.store(_t,{host:e.host,base:n.base,quote:n.quote}),o.lotSize.textContent=c.formatCoinValue(r.baseCfg.lotSize/1e8),o.rateStep.textContent=r.quoteCfg.rateStep/1e8,this.baseUnits.forEach((function(e){e.textContent=s.symbol.toUpperCase()})),this.quoteUnits.forEach((function(e){e.textContent=l.symbol.toUpperCase()})),this.balanceWgt.setWallets(i,s.id,l.id),this.setMarketBuyOrderEstimate(),this.refreshActiveOrders(),this.loaded&&(this.loaded(),this.loaded=null,c.animate(250,(function(e){t.main.style.opacity=e}))))}},{key:"handleBookOrderRoute",value:function(e){if(jt.log("book","handleBookOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;t.rate>0&&this.book.add(t),this.addTableOrder(t),this.chart.draw()}}},{key:"handleUnbookOrderRoute",value:function(e){if(jt.log("book","handleUnbookOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;this.book.remove(t.token),this.removeTableOrder(t),this.chart.draw()}}},{key:"handleUpdateRemainingRoute",value:function(e){if(jt.log("book","handleUpdateRemainingRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;this.book.updateRemaining(t.token,t.qty),this.updateTableOrder(t),this.chart.draw()}}},{key:"handleEpochOrderRoute",value:function(e){if(jt.log("book","handleEpochOrderRoute:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){var t=e.payload;t.rate>0&&this.book.add(t),t.qty>0&&this.addTableOrder(t),this.chart.draw()}}},{key:"showForm",value:(s=Pt((function*(e){this.currentForm=e;var t=this.page;c.hide(t.openForm,t.verifyForm,t.walletForm,t.cancelForm),e.style.right="10000px",c.show(t.forms,e);var n=(t.forms.offsetWidth+e.offsetWidth)/2;yield c.animate(500,(function(t){e.style.right="".concat((1-t)*n,"px")}),"easeOutHard"),e.style.right="0"})),function(e){return s.apply(this,arguments)})},{key:"showOpen",value:(a=Pt((function*(e,t){var n=this.page;this.openAsset=e,this.openFunc=t,n.openForm.setAsset(jt.assets[e.id]),this.showForm(n.openForm),n.uwAppPass.focus()})),function(e,t){return a.apply(this,arguments)})},{key:"showVerify",value:function(){var e=this.page,t=this.parseOrder(),n=t.sell,r=jt.assets[t.base],o=jt.assets[t.quote],i=n?o:r,a=n?r:o;if(e.vQty.textContent=c.formatCoinValue(t.qty/1e8),e.vSideHeader.textContent=n?"Sell":"Buy",e.vSideSubmit.textContent=e.vSideHeader.textContent,e.vBaseSubmit.textContent=r.symbol.toUpperCase(),t.isLimit)c.show(e.verifyLimit),c.hide(e.verifyMarket),e.vRate.textContent=c.formatCoinValue(t.rate/1e8),e.vQuote.textContent=o.symbol.toUpperCase(),e.vTotal.textContent=c.formatCoinValue(t.rate/1e8*t.qty/1e8),e.vBase.textContent=r.symbol.toUpperCase(),e.vSide.textContent=n?"sell":"buy";else{c.hide(e.verifyLimit),c.show(e.verifyMarket),e.vSide.textContent="trade",e.vBase.textContent=a.symbol.toUpperCase();var s=this.midGap();if(s){var l=t.sell?t.qty*s:t.qty/s,u=this.market.baseCfg.lotSize,h=t.sell?t.qty/u:l/u;e.vmTotal.textContent=c.formatCoinValue(l/1e8),e.vmAsset.textContent=i.symbol.toUpperCase(),e.vmLots.textContent=h.toFixed(1)}else c.hide(e.verifyMarket)}var d="buygreen",f="sellred";n?(e.vHeader.classList.add(f),e.vHeader.classList.remove(d),e.vSubmit.classList.add(f),e.vSubmit.classList.remove(d)):(e.vHeader.classList.add(d),e.vHeader.classList.remove(f),e.vSubmit.classList.add(d),e.vSubmit.classList.remove(f)),this.showForm(e.verifyForm),e.vPass.focus()}},{key:"submitCancel",value:(i=Pt((function*(){var e=this.page,t=this.cancelData,n=t.order,r={orderID:n.id,pw:e.cancelPass.value};e.cancelPass.value="";var o=yield B("/api/cancel",r);jt.checkResponse(o)&&(c.hide(t.bttn,e.forms),n.cancelling=!0)})),function(){return i.apply(this,arguments)})},{key:"showCancel",value:function(e,t){var n=this.metaOrders[t].order,r=this.page,o=n.qty-n.filled;r.cancelRemain.textContent=c.formatCoinValue(o/1e8);var i=pt(n)?this.market.quote.symbol:this.market.base.symbol;r.cancelUnit.textContent=i.toUpperCase(),this.showForm(r.cancelForm),r.cancelPass.focus(),this.cancelData={bttn:c.tmplElement(e,"cancelBttn"),order:n}}},{key:"showCreate",value:function(e){var t=this.page;this.currentCreate=e,this.walletForm.setAsset(e),this.showForm(t.walletForm),this.walletForm.loadDefaults()}},{key:"stepSubmit",value:function(){var e=this.page,t=this.market;if(c.hide(e.orderErr),this.validateOrder(this.parseOrder())){var n=jt.walletMap[t.base.id],r=jt.walletMap[t.quote.id];return n?r?void this.showVerify():(e.orderErr.textContent="No ".concat(t.quote.symbol," wallet"),void c.show(e.orderErr)):(e.orderErr.textContent="No ".concat(t.base.symbol," wallet"),void c.show(e.orderErr))}}},{key:"handleWalletStateNote",value:function(e){this.balanceWgt.updateAsset(e.wallet.assetID)}},{key:"handleFeePayment",value:function(e){var t=e.dex;t===this.market.dex.host&&(this.market.dex=jt.exchanges[t],this.setRegistrationStatusVisibility())}},{key:"handleOrderNote",value:function(e){var t=e.order,n=this.metaOrders[t.id];if(!n)return this.refreshActiveOrders();var r=n.status;n.order=t;var o=c.tmplElement(n.row,"cancelBttn");"Missed cancel"===e.subject&&c.show(o),t.filled===t.qty&&c.hide(o),an(n.row,t),(1===r&&2===t.status||2===r&&t.status>2)&&this.setMarkers()}},{key:"handleEpochNote",value:function(e){if(jt.log("book","handleEpochNote:",e),e.host===this.market.dex.host&&e.marketID===this.market.sid){this.book&&(this.book.setEpoch(e.epoch),this.chart.draw()),this.clearOrderTableEpochs(e.epoch);for(var t=0,n=Object.values(this.metaOrders);t<n.length;t++){var r=n[t],o=r.order,i=e.epoch>o.epoch,a=c.tmplElement(r.row,"status");switch(!0){case 1===o.type&&1===o.status&&i:a.textContent=0===o.tif?"executed":"booked",o.status=0===o.tif?3:2;break;case 2===o.type&&1===o.status:a.textContent="executed",o.status=3}}}}},{key:"setBalanceVisibility",value:function(){this.market.dex.connected?(c.show(this.page.balanceTable),c.show(this.page.orderForm)):(c.hide(this.page.balanceTable),c.hide(this.page.orderForm))}},{key:"handleBalanceNote",value:function(e){if(this.setBalanceVisibility(),this.market.dex.connected){this.balanceWgt.updateAsset(e.assetID);var t=this.market,n=e.balance.available;switch(e.assetID){case t.base.id:if(!t.maxSell)break;"number"==typeof t.sellBalance&&t.sellBalance!==n&&(t.maxSell=null),this.isSell()&&this.preSell();break;case t.quote.id:if(!Object.keys(t.maxBuys).length)break;"number"==typeof t.buyBalance&&t.buyBalance!==n&&(t.maxBuys={}),this.isSell()||this.preBuy()}}}},{key:"submitOrder",value:(o=Pt((function*(){var e=this.page,t=this.market;c.hide(e.forms);var n=this.parseOrder(),r=e.vPass.value;e.vPass.value="";var o={order:n,pw:r};if(this.validateOrder(n)){var i=yield B("/api/trade",o);if(jt.checkResponse(i)){var a=jt.walletMap[t.base.id],s=jt.walletMap[t.quote.id];a.open&&s.open||(this.balanceWgt.updateAsset(t.base.id),this.balanceWgt.updateAsset(t.quote.id)),this.refreshActiveOrders(),this.chart.draw()}}})),function(){return o.apply(this,arguments)})},{key:"createWallet",value:(r=Pt((function*(){var e=(yield jt.fetchUser()).assets[this.currentCreate.id];c.hide(this.page.forms),this.balanceWgt.updateAsset(e.id),this.resolveOrderFormVisibility()})),function(){return r.apply(this,arguments)})},{key:"walletUnlocked",value:(n=Pt((function*(){c.hide(this.page.forms),this.balanceWgt.updateAsset(this.openAsset.id)})),function(){return n.apply(this,arguments)})},{key:"lotChanged",value:function(){var e=this.page,t=parseInt(e.lotField.value);if(t<=0)return e.lotField.value=0,void(e.qtyField.value="");var n=this.market.baseCfg.lotSize;e.lotField.value=t,e.qtyField.value=t*n/1e8,this.previewQuoteAmt(!0)}},{key:"quantityChanged",value:function(e){var t=this.page,n=this.parseOrder();if(n.qty<=0)return t.lotField.value=0,void(t.qtyField.value="");var r=this.market.baseCfg.lotSize,o=Math.floor(n.qty/r),i=o*r;t.lotField.value=o,(n.isLimit||n.sell)&&(e&&(t.qtyField.value=i/1e8),this.previewQuoteAmt(!0))}},{key:"marketBuyChanged",value:function(){var e=this.page,t=nn(e.mktBuyField.value),n=this.midGap();if(!n||!t)return e.mktBuyLots.textContent="0",void(e.mktBuyScore.textContent="0");var r=this.market.baseCfg.lotSize,o=t/n;e.mktBuyLots.textContent=(o/r).toFixed(1),e.mktBuyScore.textContent=c.formatCoinValue(o/1e8)}},{key:"rateFieldChanged",value:function(){var e=this.parseOrder();if(e.rate<=0)return this.depthLines.input=[],this.drawChartLines(),void(this.page.rateField.value=0);var t=this.adjustedRate()/1e8;this.page.rateField.value=t,this.depthLines.input=[{rate:t,color:e.sell?this.chart.theme.sellLine:this.chart.theme.buyLine}],this.drawChartLines(),this.previewQuoteAmt(!0)}},{key:"adjustedRate",value:function(){var e=this.page.rateField.value;if(!e)return null;var t=nn(e);return t-t%this.market.quoteCfg.rateStep}},{key:"loadTable",value:function(){this.loadTableSide(!0),this.loadTableSide(!1)}},{key:"loadTableSide",value:function(e){var t=this,n=e?this.book.sells:this.book.buys,r=e?this.page.sellRows:this.page.buyRows,o=e?"sellcolor":"buycolor";c.empty(r),n&&n.length&&n.forEach((function(e){r.appendChild(t.orderTableRow(e,o))}))}},{key:"addTableOrder",value:function(e){var t=e.sell?this.page.sellRows:this.page.buyRows,n=e.sell?"sellcolor":"buycolor",r=t.firstChild;if(0===e.rate)return r&&0===r.order.rate||(r=this.orderTableRow(e,n),t.insertBefore(r,t.firstChild)),void r.addQty(e.qty);r&&0===r.order.rate&&(r=r.nextSibling);for(var o=this.orderTableRow(e,n);r;){if(e.rate<r.order.rate===e.sell)return void t.insertBefore(o,r);r=r.nextSibling}t.appendChild(o)}},{key:"removeTableOrder",value:function(e){for(var t=e.token,n=0,r=[this.page.sellRows,this.page.buyRows];n<r.length;n++)for(var o=r[n],i=0,a=Array.from(o.children);i<a.length;i++){var s=a[i];if(s.order.token===t)return void s.remove()}}},{key:"updateTableOrder",value:function(e){for(var t=e.token,n=0,r=[this.page.sellRows,this.page.buyRows];n<r.length;n++)for(var o=r[n],i=0,a=Array.from(o.children);i<a.length;i++){var s=a[i];if(s.order.token===t)return void(s.querySelector("[data-type=qty]").innerText=e.qty.toFixed(8))}}},{key:"clearOrderTableEpochs",value:function(e){this.clearOrderTableEpochSide(this.page.sellRows),this.clearOrderTableEpochSide(this.page.buyRows)}},{key:"clearOrderTableEpochSide",value:function(e,t){for(var n=0,r=Array.from(e.children);n<r.length;n++){var o=r[n];o.order.epoch&&o.order.epoch!==t&&o.remove()}}},{key:"orderTableRow",value:function(e,t){var n=this,r=this.page.rowTemplate.cloneNode(!0);r.qty=e.qty,r.order=e;var o,i=e.rate;return Dt(r,"click",(function(){n.reportClick(i)})),r.querySelectorAll("td").forEach((function(i){switch(i.dataset.type){case"qty":o=i,i.innerText=e.qty.toFixed(8);break;case"rate":0===e.rate?i.innerText="market":(i.innerText=e.rate.toFixed(8),i.classList.add(t),c.bind(r,"mouseenter",(function(t){var r=n.chart;n.depthLines.hover=[{rate:e.rate,color:e.sell?r.theme.sellLine:r.theme.buyLine}],n.drawChartLines()})));break;case"epoch":e.epoch&&i.appendChild(Xt.cloneNode())}})),r.addQty=function(e){r.qty+=e,o.innerText=r.qty.toFixed(8)},r}},{key:"handleConnNote",value:(t=Pt((function*(e){this.marketList.setConnectionStatus(e),e.connected&&(yield jt.fetchUser(),jt.loadPage("markets"))})),function(e){return t.apply(this,arguments)})},{key:"filterMarkets",value:function(){var e=this.page.marketSearch.value,t=e?function(t){return t.name.includes(e)}:function(){return!0};this.marketList.setFilter(t)}},{key:"drawChartLines",value:function(){this.chart.setLines([].concat(Ct(this.depthLines.hover),Ct(this.depthLines.input))),this.chart.draw()}},{key:"unload",value:function(){xt.request("unmarket",{}),xt.deregisterRoute(Nt),xt.deregisterRoute("bookupdate"),xt.deregisterRoute(Vt),xt.deregisterRoute(zt),xt.deregisterRoute(Ut),this.chart.unattach(),c.unbind(document,"keyup",this.keyup),clearInterval(this.secondTicker)}}]),f}(O),Jt=function(){function e(t){Bt(this,e),this.selected=null;var n=c.tmplElement(t,"xc");sn(n),this.xcSections=[];for(var r=0,o=Object.values(jt.user.exchanges);r<o.length;r++){var i=o[r];this.xcSections.push(new Yt(n,i))}var a,s=Ft(this.sortedSections());try{for(s.s();!(a=s.n()).done;){var l=a.value;t.appendChild(l.box)}}catch(e){s.e(e)}finally{s.f()}}return Tt(e,[{key:"sortedSections",value:function(){return Ct(this.xcSections).sort((function(e,t){return e.host<t.host?-1:1}))}},{key:"xcSection",value:function(e){var t,n=Ft(this.xcSections);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.host===e)return r}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"exists",value:function(e,t,n){var r=this.xcSection(e);if(!r)return!1;var o,i=Ft(r.marketRows);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(a.baseID===t&&a.quoteID===n)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"first",value:function(){var e=this.sortedSections()[0],t=e.first();return t?en(e.host,t.baseID,t.quoteID):en(e.host)}},{key:"select",value:function(e,t,n){this.selected&&this.selected.row.classList.remove("selected"),this.selected=this.xcSection(e).marketRow(t,n),this.selected.row.classList.add("selected")}},{key:"setConnectionStatus",value:function(e){this.xcSection(e.host).setConnected(e.connected)}},{key:"setFilter",value:function(e){var t,n=Ft(this.xcSections);try{for(n.s();!(t=n.n()).done;)t.value.setFilter(e)}catch(e){n.e(e)}finally{n.f()}}}]),e}(),Yt=function(){function e(t,n){Bt(this,e),this.dex=n,this.host=n.host;var r=t.cloneNode(!0);this.box=r;var o=c.tmplElement(r,"header");this.disconnectedIcon=c.tmplElement(o,"disconnected"),n.connected&&c.hide(this.disconnectedIcon),o.append(n.host),this.marketRows=[],this.rows=c.tmplElement(r,"mkts");var i=c.tmplElement(this.rows,"mktrow");if(this.rows.removeChild(i),n.markets){for(var a=0,s=Object.values(n.markets);a<s.length;a++){var l=s[a];this.marketRows.push(new Kt(i,l))}var u,h=Ft(this.sortedMarkets());try{for(h.s();!(u=h.n()).done;){var d=u.value;this.rows.appendChild(d.row)}}catch(e){h.e(e)}finally{h.f()}}}return Tt(e,[{key:"sortedMarkets",value:function(){return Ct(this.marketRows).sort((function(e,t){return e.name<t.name?-1:1}))}},{key:"first",value:function(){return this.sortedMarkets()[0]}},{key:"marketRow",value:function(e,t){var n,r=Ft(this.marketRows);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o.baseID===e&&o.quoteID===t)return o}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"setConnected",value:function(e){e?c.hide(this.disconnectedIcon):c.show(this.disconnectedIcon)}},{key:"setFilter",value:function(e){var t,n=Ft(this.marketRows);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r)?c.show(r.row):c.hide(r.row)}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),Kt=function e(t,n){Bt(this,e),this.name=n.name,this.baseID=n.baseid,this.quoteID=n.quoteid;var r=t.cloneNode(!0);this.row=r,c.tmplElement(r,"baseicon").src=c.logoPath(n.basesymbol),c.tmplElement(r,"quoteicon").src=c.logoPath(n.quotesymbol),r.append("".concat(n.basesymbol.toUpperCase(),"-").concat(n.quotesymbol.toUpperCase()))},Zt=function(){function e(t){Bt(this,e);var n=c.parsePage(t,["baseAvail","quoteAvail","baseNewWalletRow","quoteNewWalletRow","baseNewButton","quoteNewButton","baseLocked","quoteLocked","baseImmature","quoteImmature","baseImg","quoteImg","quoteUnsupported","baseUnsupported","baseExpired","quoteExpired","baseConnect","quoteConnect","baseSpinner","quoteSpinner","baseWalletState","quoteWalletState"]);this.base={id:0,cfg:null,logo:n.baseImg,avail:n.baseAvail,newWalletRow:n.baseNewWalletRow,newWalletBttn:n.baseNewButton,locked:n.baseLocked,immature:n.baseImmature,unsupported:n.baseUnsupported,expired:n.baseExpired,connect:n.baseConnect,spinner:n.baseSpinner,iconBox:n.baseWalletState,stateIcons:new h(n.baseWalletState)},this.quote={id:0,cfg:null,logo:n.quoteImg,avail:n.quoteAvail,newWalletRow:n.quoteNewWalletRow,newWalletBttn:n.quoteNewButton,locked:n.quoteLocked,immature:n.quoteImmature,unsupported:n.quoteUnsupported,expired:n.quoteExpired,connect:n.quoteConnect,spinner:n.quoteSpinner,iconBox:n.quoteWalletState,stateIcons:new h(n.quoteWalletState)},this.dex=null}var t;return Tt(e,[{key:"setWallets",value:function(e,t,n){this.dex=jt.user.exchanges[e],this.base.id=t,this.base.cfg=this.dex.assets[t],this.quote.id=n,this.quote.cfg=this.dex.assets[n],this.updateWallet(this.base),this.updateWallet(this.quote)}},{key:"updateWallet",value:function(e){var t=jt.assets[e.id];if(c.hide(e.newWalletRow,e.avail,e.immature,e.locked,e.expired,e.unsupported,e.connect,e.spinner,e.iconBox),e.logo.src=c.logoPath(e.cfg.symbol),t){c.show(e.iconBox);var n=t.wallet;if(e.stateIcons.readWallet(n),n){var r=n.balance;if(r||n.running){if(!r)return this.fetchBalance(e.id),void c.show(e.spinner);c.show(e.avail,e.immature,e.locked),e.avail.textContent=c.formatCoinValue(r.available/1e8),e.locked.textContent=c.formatCoinValue((r.locked+r.contractlocked)/1e8),e.immature.textContent=c.formatCoinValue(r.immature/1e8),(new Date).getTime()-new Date(r.stamp).getTime()>36e5?(c.show(e.expired),n.running&&this.fetchBalance(e.id)):c.hide(e.expired)}else c.show(e.connect)}else c.show(e.newWalletRow)}else c.show(e.unsupported)}},{key:"updateAsset",value:function(e){e===this.base.id?this.updateWallet(this.base):e===this.quote.id&&this.updateWallet(this.quote)}},{key:"fetchBalance",value:(t=Pt((function*(e){var t=yield B("/api/balance",{assetID:e});jt.checkResponse(t)||console.error("failed to fetch balance for asset ID",e)})),function(e){return t.apply(this,arguments)})}]),e}();function en(e,t,n){return{host:e,base:t,quote:n}}function tn(e,t){return"".concat(e,"_").concat(t)}function nn(e){return Math.round(1e8*parseFloat(e))}function rn(e,t){e.classList.remove("selected"),t.classList.add("selected")}function on(e,t,n){c.tmplElement(e,t).textContent=n}function an(e,t){on(e,"type",ft(t)),on(e,"side",dt(t)),on(e,"age",c.timeSince(t.stamp)),on(e,"rate",c.formatCoinValue(t.rate/1e8)),on(e,"qty",c.formatCoinValue(t.qty/1e8)),on(e,"filled","".concat((t.filled/t.qty*100).toFixed(1),"%")),on(e,"settled","".concat((yt(t)/t.qty*100).toFixed(1),"%")),on(e,"status",mt(t))}function sn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){e.remove(),e.removeAttribute("id")}))}function ln(e){return(ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cn(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function un(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){cn(i,r,o,a,s,"next",e)}function s(e){cn(i,r,o,a,s,"throw",e)}a(void 0)}))}}function hn(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return dn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pn(e,t){return(pn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e,t){return!t||"object"!==ln(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vn,gn,bn,wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pn(e,t)}(u,e);var t,n,r,o,i,a,s,l=(a=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=yn(a);if(s){var n=yn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return mn(this,e)});function u(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),n=l.call(this),Gt=e,n.main=t,n.offset="",n.loading=!1;var r=n.page=c.parsePage(t,["rowTmpl","tableBody","hostFilter","assetFilter","statusFilter","orderLoader","ordersTable"]);n.orderTmpl=r.rowTmpl,n.orderTmpl.remove();var o=n.filterState={hosts:[],assets:[],statuses:[]},i=new URLSearchParams(window.location.search),a=function(e,t){var n=i.get(t);if(n&&0!==n.length){var r=n.split(",");n&&(o[t]=r),e.querySelectorAll("input").forEach((function(e){r.indexOf(e.value)>=0&&(e.checked=!0)}))}};a(r.hostFilter,"hosts"),a(r.assetFilter,"assets"),a(r.statusFilter,"statuses");var s=[],h=function(e,t){var r=e.querySelector(".apply-bttn");s.push(r),c.bind(r,"click",(function(){n.submitFilter(),s.forEach((function(e){return c.hide(e)}))})),e.querySelectorAll("input").forEach((function(n){c.bind(n,"change",(function(){!function(e,t){if(e.length!==t.length)return!1;var n,r=hn(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(-1===t.indexOf(o))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(kn(e),o[t])?c.show(r):c.hide(r)}))}))};return h(r.hostFilter,"hosts"),h(r.assetFilter,"assets"),h(r.statusFilter,"statuses"),c.bind(n.main,"scroll",(function(){n.loading||r.ordersTable.offsetHeight-n.main.offsetHeight-n.main.scrollTop<0&&n.nextPage()})),n.submitFilter(),n}return t=u,(n=[{key:"setOrders",value:function(e){c.empty(this.page.tableBody),this.appendOrders(e)}},{key:"appendOrders",value:function(e){var t,n=this,r=this.page.tableBody,o=hn(e);try{var i=function(){var e=t.value,o=n.orderTmpl.cloneNode(!0),i=function(e,t){c.tmplElement(o,e).textContent=t},a="".concat(e.baseSymbol.toUpperCase(),"-").concat(e.quoteSymbol.toUpperCase());i("host","".concat(a," @ ").concat(e.host));var s=void 0,l=void 0,u=void 0,h="";if(e.sell){var d=[e.baseSymbol,e.quoteSymbol];s=d[0],l=d[1],u=c.formatCoinValue(e.qty/1e8),1===e.type&&(h=c.formatCoinValue(e.qty/1e8*e.rate/1e8))}else{var f=[e.quoteSymbol,e.baseSymbol];s=f[0],l=f[1],2===e.type?u=c.formatCoinValue(e.qty/1e8):(u=c.formatCoinValue(e.qty/1e8*e.rate/1e8),h=c.formatCoinValue(e.qty/1e8))}i("fromQty",u),c.tmplElement(o,"fromLogo").src=c.logoPath(s),i("fromSymbol",s),i("toQty",h),c.tmplElement(o,"toLogo").src=c.logoPath(l),i("toSymbol",l),i("type","".concat(ft(e)," ").concat(dt(e))),i("rate",function(e){return 2===e.type?"market":c.formatCoinValue(e.rate/1e8)}(e)),i("status",mt(e)),i("filled","".concat((e.filled/e.qty*100).toFixed(1),"%")),i("settled","".concat((yt(e)/e.qty*100).toFixed(1),"%"));var p=new Date(e.stamp).toLocaleString();i("time","".concat(c.timeSince(e.stamp)," ago, ").concat(p)),c.tmplElement(o,"link").href="order/".concat(e.id),Gt.bindInternalNavigation(o),r.appendChild(o)};for(o.s();!(t=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}50===e.length?this.offset=e[e.length-1].id:this.offset=""}},{key:"submitFilter",value:(i=un((function*(){var e=this.page;this.offset="";var t=this.filterState;t.hosts=kn(e.hostFilter),t.assets=kn(e.assetFilter),t.statuses=kn(e.statusFilter);var n=new URL(window.location),r=new URLSearchParams(n.search);r.delete("offset");var o=function(e){var n=t[e];0===n.length?r.delete(e):r.set(e,n.join(","))};o("hosts"),o("assets"),o("statuses"),n.search=r.toString(),window.history.replaceState({page:"orders"},"",n),this.setOrders(yield this.fetchOrders())})),function(){return i.apply(this,arguments)})},{key:"fetchOrders",value:(o=un((function*(){var e=Gt.loading(this.main),t=yield B("/api/orders",this.currentFilter());return e(),t.orders})),function(){return o.apply(this,arguments)})},{key:"currentFilter",value:function(){var e=this.filterState;return{hosts:e.hosts,assets:e.assets.map((function(e){return parseInt(e)})),statuses:e.statuses.map((function(e){return parseInt(e)})),n:50,offset:this.offset}}},{key:"nextPage",value:(r=un((function*(){if(""!==this.offset&&!this.loading){this.loading=!0,c.show(this.page.orderLoader);var e=yield this.fetchOrders();this.loading=!1,c.hide(this.page.orderLoader),this.appendOrders(e)}})),function(){return r.apply(this,arguments)})}])&&fn(t.prototype,n),u}(O);function kn(e){var t=[];return e.querySelectorAll("input").forEach((function(e){e.checked&&t.push(e.value)})),t}function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||En(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function An(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=En(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function En(e,t){if(e){if("string"==typeof e)return On(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?On(e,t):void 0}}function On(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pn(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function Fn(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Pn(i,r,o,a,s,"next",e)}function s(e){Pn(i,r,o,a,s,"throw",e)}a(void 0)}))}}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ln(e,t){return(Ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bn(e,t){return!t||"object"!==xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qn(e){return(qn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Tn,In,Mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ln(e,t)}(u,e);var t,n,r,o,i,a,s,l=(a=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qn(a);if(s){var n=qn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Bn(this,e)});function u(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),n=l.call(this),Tn=e;var r=t.querySelectorAll("[data-stamp]");In=parseInt(t.dataset.net),n.orderID=t.dataset.oid,n.order=Tn.order(n.orderID),n.order||n.fetchOrder();var o=n.page=c.parsePage(t,["cancelBttn","cancelRemain","cancelUnit","cancelForm","forms","cancelSubmit","cancelPass","status","matchBox","matchesLabel"]);o.cancelBttn&&c.bind(o.cancelBttn,"click",(function(){n.showForm(o.cancelForm)})),c.bind(o.forms,"mousedown",(function(e){c.mouseInElement(e,n.currentForm)||(c.hide(o.forms),o.cancelPass.value="")})),X(o.cancelForm,o.cancelSubmit,Fn((function*(){n.submitCancel()}))),t.querySelectorAll("[data-explorer-id]").forEach((function(e){jn(e)}));var i=function(){var e,t=An(r);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.textContent=c.timeSince(parseInt(n.dataset.stamp))}}catch(e){t.e(e)}finally{t.f()}};return i(),n.secondTicker=setInterval((function(){i()}),1e4),n.notifiers={order:function(e){n.handleOrderNote(e)},match:function(e){n.handleMatchNote(e)}},n}return t=u,(n=[{key:"unload",value:function(){clearInterval(this.secondTicker)}},{key:"fetchOrder",value:(i=Fn((function*(){var e=yield B("/api/order",this.orderID);Tn.checkResponse(e)&&(this.order=e.order)})),function(){return i.apply(this,arguments)})},{key:"showCancel",value:function(){var e=this.order,t=this.page,n=e.qty-e.filled;t.cancelRemain.textContent=c.formatCoinValue(n/1e8);var r=pt(e)?this.market.quote.symbol:this.market.base.symbol;t.cancelUnit.textContent=r.toUpperCase(),this.showForm(t.cancelForm)}},{key:"showForm",value:(o=Fn((function*(e){this.currentForm=e;var t=this.page;c.hide(t.cancelForm),e.style.right="10000px",c.show(t.forms,e);var n=(t.forms.offsetWidth+e.offsetWidth)/2;yield c.animate(500,(function(t){e.style.right="".concat((1-t)*n,"px")}),"easeOutHard"),e.style.right="0px"})),function(e){return o.apply(this,arguments)})},{key:"submitCancel",value:(r=Fn((function*(){var e=this.page,t=this.order,n={orderID:t.id,pw:e.cancelPass.value};e.cancelPass.value="";var r=Tn.loading(e.cancelForm),o=yield B("/api/cancel",n);r(),Tn.checkResponse(o)&&(e.status.textContent="cancelling",c.hide(e.forms),t.cancelling=!0)})),function(){return r.apply(this,arguments)})},{key:"handleOrderNote",value:function(e){var t=e.order,n=this.page.cancelBttn;n&&t.id===this.orderID&&(n&&t.status>2&&c.hide(n),this.page.status.textContent=mt(t));var r,o=An(t.matches||[]);try{for(o.s();!(r=o.n()).done;){var i=r.value;this.processMatch(i)}}catch(e){o.e(e)}finally{o.f()}}},{key:"handleMatchNote",value:function(e){e.orderID===this.orderID&&this.processMatch(e.match)}},{key:"processMatch",value:function(e){for(var t,n=0,r=Array.from(this.page.matchBox.querySelectorAll(".match-card"));n<r.length;n++){var o=r[n];if(o.dataset.matchID===e.matchID){t=o;break}}if(t){var i=function(e,n,r){if(r){c.show(c.tmplElement(t,e));var o=c.tmplElement(t,n);o.textContent=r.stringID,o.dataset.explorerCoin=r.stringID,jn(o)}};i("swap","swapCoin",e.swap),i("counterSwap","counterSwapCoin",e.counterSwap),i("redeem","redeemCoin",e.redeem),i("counterRedeem","counterRedeemCoin",e.counterRedeem),i("refund","refundCoin",e.refund);var a=c.tmplElement(t,"swapMsg"),s=c.tmplElement(t,"counterSwapMsg");!function(e){return 1===e.side&&1===e.status||0===e.side&&2===e.status}(e)?function(e){return 0===e.side&&1===e.status||1===e.side&&2===e.status}(e)?(a.textContent=Wn(e.swap),c.hide(c.tmplElement(t,"counterSwapMsg")),c.show(a)):c.hide(a,s):(s.textContent=Wn(e.counterSwap),c.hide(c.tmplElement(t,"swapMsg")),c.show(s)),c.tmplElement(t,"status").textContent=function(e,t){switch(e){case 0:return"(0 / 4) Newly Matched";case 1:return"(1 / 4) First Swap Sent";case 2:return"(2 / 4) Second Swap Sent";case 3:return 0===t?"Match Complete":"(3 / 4) Maker Redeemed";case 4:return"Match Complete"}return"Unknown Order Status"}(e.status,e.side)}}}])&&Rn(t.prototype,n),u}(O);function Wn(e){return e.confs?"".concat(e.confs.count," / ").concat(e.confs.required," confirmations"):""}function jn(e){var t=Nn[parseInt(e.dataset.explorerId)];if(t){var n=t[In];n&&(e.classList.remove("plainlink"),e.classList.add("subtlelink"),e.href=n(e.dataset.explorerCoin))}}var Dn,Nn={42:(vn={},Sn(vn,0,(function(e){var t=Cn(e.split(":"),2),n=t[0],r=t[1];return"https://explorer.dcrdata.org/tx/".concat(n,"/out/").concat(r)})),Sn(vn,1,(function(e){var t=Cn(e.split(":"),2),n=t[0],r=t[1];return"https://testnet.dcrdata.org/tx/".concat(n,"/out/").concat(r)})),vn),0:(gn={},Sn(gn,0,(function(e){return"https://bitaps.com/".concat(e.split(":")[0])})),Sn(gn,1,(function(e){return"https://tbtc.bitaps.com/".concat(e.split(":")[0])})),gn),2:(bn={},Sn(bn,0,(function(e){return"https://ltc.bitaps.com/".concat(e.split(":")[0])})),Sn(bn,1,(function(e){return"https://tltc.bitaps.com/".concat(e.split(":")[0])})),bn)};function zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Un(e,t,n,r,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,o)}function Vn(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Un(i,r,o,a,s,"next",e)}function s(e){Un(i,r,o,a,s,"throw",e)}a(void 0)}))}}function _n(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Hn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function Hn(e,t){if(e){if("string"==typeof e)return Qn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qn(e,t):void 0}}function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Gn=c.idel,$n=c.bind,Jn=c.unbind,Yn="loggers",Kn="recorders",Zn={login:ue,register:re,markets:$t,wallets:Ae,settings:Ie,orders:wn,order:Mn},er=["register","login","settings"],tr=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.notes=[],this.pokes=[],this.user={accounts:{},wallets:{}},this.commitHash="905349d486d18a25c3a3bdcdaf7a7d572ed49106",this.showPopups="1"===C.getCookie("popups"),console.log("Decred DEX Client App, Build",this.commitHash.substring(0,7)),this.loggers=C.fetch(Yn)||{},window.enableLogger=function(e,n){return n?t.loggers[e]=!0:delete t.loggers[e],C.store(Yn,t.loggers),"".concat(e," logger ").concat(n?"enabled":"disabled")},window.log=function(){t.log.apply(t,arguments)};var n=C.fetch(Kn)||[];this.recorders={};var r,o=_n(n);try{for(o.s();!(r=o.n()).done;){var i=r.value;console.log("recording",i),this.recorders[i]=[]}}catch(e){o.e(e)}finally{o.f()}window.recordLogger=function(e,n){return n?t.recorders[e]=[]:delete t.recorders[e],C.store(Kn,Object.keys(t.recorders)),"".concat(e," recorder ").concat(n?"enabled":"disabled")},window.dumpLogger=function(e){var n=t.recorders[e];if(!n)return"no recorder for logger ".concat(e);var r=document.createElement("a");r.href="data:application/octet-stream;base64,".concat(window.btoa(JSON.stringify(n,null,4))),r.download="".concat(e,".json"),document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r)}),0)}}var t,n,r,o,i,a;return t=e,(n=[{key:"start",value:(a=Vn((function*(){var e=this;$n(window,"popstate",(function(t){var n=t.state.page;(n||""===n)&&e.loadPage(n,t.state.data,!0)})),this.main=Gn(document,"main");var t=this.main.dataset.handler;yield this.fetchUser();var n=new URL(window.location);rr(n.pathname)!==t&&(n.pathname="/".concat(t),n.search="",window.history.replaceState({page:t},"",n)),this.attachHeader(),this.attachCommon(this.header),this.attach();var r,o=C.fetch("notifications");this.setNotes(o||[]),xt.connect((r="https:"===window.location.protocol?"wss":"ws","".concat(r,"://").concat(window.location.host,"/ws")),this.reconnected),xt.registerRoute("notify",(function(t){e.notify(t)}))})),function(){return a.apply(this,arguments)})},{key:"reconnected",value:function(){window.location.reload()}},{key:"fetchUser",value:(i=Vn((function*(){var e,t,n=yield function(e){return T.apply(this,arguments)}("/api/user"),r=er.indexOf(this.main.dataset.handler)>-1;if(this.checkResponse(n,r)){this.user=n,this.assets=n.assets,this.exchanges=n.exchanges,this.walletMap={};for(var o=0,i=Object.entries(n.assets);o<i.length;o++){var a=(e=i[o],t=2,function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}}(e,t)||Hn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=a[0],l=a[1];l.wallet&&(this.walletMap[s]=l.wallet)}return this.updateMenuItemsDisplay(),n}})),function(){return i.apply(this,arguments)})},{key:"loadPage",value:(o=Vn((function*(e,t,n){this.tooltip.style.left="-10000px",c.hide(this.page.noteBox,this.page.profileBox);var r=new URL("/".concat(e),window.location.origin),o=rr(e),i=yield window.fetch(r);if(!i.ok)return!1;var a=yield i.text(),s=c.noderize(a),l=Gn(s,"main"),u=l.dataset.handler;if(!n){var h=u===o?r.toString():"/".concat(u);window.history.pushState({page:e,data:t},u,h)}return document.title=s.title,this.main.replaceWith(l),this.main=l,this.attach(t),!0})),function(e,t,n){return o.apply(this,arguments)})},{key:"attach",value:function(e){var t=this.main.dataset.handler;if(t){this.attachCommon(this.main),this.loadedPage&&this.loadedPage.unload();var n=Zn[t];this.loadedPage=n?new n(this,this.main,e):null,this.bindTooltips(this.main)}else console.error("cannot attach to content with no specified handler")}},{key:"bindTooltips",value:function(e){var t=this;e.querySelectorAll("[data-tooltip]").forEach((function(e){$n(e,"mouseenter",(function(){t.tooltip.textContent=e.dataset.tooltip;var n=c.layoutMetrics(e),r=n.centerX-t.tooltip.offsetWidth/2;r<0&&(r=5),r+t.tooltip.offsetWidth>document.body.offsetWidth&&(r=document.body.offsetWidth-t.tooltip.offsetWidth-5),t.tooltip.style.left="".concat(r,"px"),t.tooltip.style.top="".concat(n.bodyTop-t.tooltip.offsetHeight-5,"px")})),$n(e,"mouseleave",(function(){t.tooltip.style.left="-10000px"}))}))}},{key:"attachHeader",value:function(){var e=this;this.header=Gn(document.body,"header"),this.popupNotes=Gn(document.body,"popupNotes"),this.popupTmpl=c.tmplElement(this.popupNotes,"note"),this.popupTmpl.remove(),this.tooltip=Gn(document.body,"tooltip");var t=this.page=c.parsePage(this.header,["noteIndicator","noteList","noteTmpl","marketsMenuEntry","walletsMenuEntry","noteMenuEntry","loader","profileMenuEntry","profileIndicator","profileSignout","innerNoteIcon","innerProfileIcon","noteBox","profileBox","pokeCat","noteCat","pokeBox","pokeList","pokeTmpl"]);delete t.noteTmpl.id,t.noteTmpl.remove(),delete t.pokeTmpl.id,t.pokeTmpl.remove(),t.loader.remove(),t.loader.style.backgroundColor="rgba(0, 0, 0, 0.5)",c.show(t.loader),$n(t.noteMenuEntry,"click",Vn((function*(){c.hide(t.pokeList),c.show(t.noteList),e.ackNotes(),t.noteCat.classList.add("active"),t.pokeCat.classList.remove("active"),e.showDropdown(t.noteMenuEntry,t.noteBox),c.hide(t.noteIndicator);var n,r=_n(e.notes);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.acked&&o.el.classList.remove("firstview")}}catch(e){r.e(e)}finally{r.f()}e.setNoteTimes(t.noteList),e.setNoteTimes(t.pokeList),e.storeNotes()}))),$n(t.profileMenuEntry,"click",(function(){e.showDropdown(t.profileMenuEntry,t.profileBox)})),$n(t.innerNoteIcon,"click",(function(){c.hide(t.noteBox)})),$n(t.innerProfileIcon,"click",(function(){c.hide(t.profileBox)})),$n(t.profileSignout,"click",function(){var t=Vn((function*(t){return yield e.signOut()}));return function(e){return t.apply(this,arguments)}}()),$n(t.pokeCat,"click",(function(){e.setNoteTimes(t.pokeList),t.pokeCat.classList.add("active"),t.noteCat.classList.remove("active"),c.hide(t.noteList),c.show(t.pokeList),e.ackNotes()})),$n(t.noteCat,"click",(function(){e.setNoteTimes(t.noteList),t.noteCat.classList.add("active"),t.pokeCat.classList.remove("active"),c.hide(t.pokeList),c.show(t.noteList),e.ackNotes()}))}},{key:"showDropdown",value:function(e,t){var n=this,r=e.getBoundingClientRect();c.hide(this.page.noteBox,this.page.profileBox),c.show(t),t.style.right="".concat(window.innerWidth-r.left-r.width+11,"px"),t.style.top="".concat(r.top-9,"px"),$n(document,"click",(function e(r){c.mouseInElement(r,t)||(c.hide(t),Jn(document,"click",e),t===n.page.noteBox&&c.isDisplayed(n.page.noteList)&&n.ackNotes())}))}},{key:"ackNotes",value:function(){var e,t=[],n=_n(this.notes);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.acked?r.el.classList.remove("firstview"):(r.acked=!0,r.id&&r.severity>2&&t.push(r.id))}}catch(e){n.e(e)}finally{n.f()}t.length&&xt.request("acknotes",t),c.hide(this.page.noteIndicator)}},{key:"setNoteTimes",value:function(e){for(var t=0,n=Array.from(e.children);t<n.length;t++){var r=n[t];r.querySelector("span.note-time").textContent=c.timeSince(r.note.stamp)}}},{key:"bindInternalNavigation",value:function(e){var t=this,n=new URL(window.location);e.querySelectorAll("a").forEach((function(e){if(e.href){var r=new URL(e.href);if(r.origin===n.origin){var o=r.pathname.substring(1),i={};r.search&&r.searchParams.forEach((function(e,t){i[t]=e})),c.bind(e,"click",(function(e){e.preventDefault(),t.loadPage(o,i)}))}}}))}},{key:"storeNotes",value:function(){C.store("notifications",this.notes.map((function(e){return{subject:e.subject,details:e.details,severity:e.severity,stamp:e.stamp,id:e.id,acked:e.acked}})))}},{key:"updateMenuItemsDisplay",value:function(){var e=this.page;e&&(this.user.authed?(c.show(e.noteMenuEntry,e.walletsMenuEntry,e.profileMenuEntry),Object.keys(this.user.exchanges).length>0?c.show(e.marketsMenuEntry):c.hide(e.marketsMenuEntry)):c.hide(e.noteMenuEntry,e.walletsMenuEntry,e.marketsMenuEntry,e.profileMenuEntry))}},{key:"attachCommon",value:function(e){this.bindInternalNavigation(e)}},{key:"updateExchangeRegistration",value:function(e,t,n){this.exchanges[e].confs=t?null:n}},{key:"handleFeePaymentNote",value:function(e){switch(e.subject){case"regupdate":this.updateExchangeRegistration(e.dex,!1,e.confirmations);break;case"Account registered":this.updateExchangeRegistration(e.dex,!0)}}},{key:"setNotes",value:function(e){this.log("notes","setNotes",e),this.notes=[],c.empty(this.page.noteList);for(var t=0;t<e.length;t++)this.prependNoteElement(e[t],!0);this.storeNotes()}},{key:"notify",value:function(e){switch(this.log("notes","notify",e),e.type){case"order":var t=e.order,n=this.user.exchanges[t.host].markets[t.market];n.orders?function(e,t){for(var n in e.orders||[])if(e.orders[n].id===t.id)return e.orders[n]=t,!0;return!1}(n,t)||n.orders.push(t):n.orders=[t];break;case"balance":var r=this.user.assets&&this.user.assets[e.assetID].wallet;r&&(r.balance=e.balance);break;case"feepayment":this.handleFeePaymentNote(e);break;case"walletstate":case"walletconfig":if(!this.assets)return;var o=e.wallet;this.assets[o.assetID].wallet=o,this.walletMap[o.assetID]=o,this.main.querySelectorAll('[data-balance-target="'.concat(o.assetID,'"]')).forEach((function(e){e.textContent=(o.balance.available/1e8).toFixed(8)}));break;case"match":var i=this.order(e.orderID);i&&function(e,t){for(var n in e.matches)if(e.matches[n].matchID===t.matchID)return void(e.matches[n]=t);e.matches=e.matches||[],e.matches.push(t)}(i,e.match);break;case"conn":var a=this.user.exchanges[e.host];a&&(a.connected=e.connected)}if(this.loadedPage&&this.loadedPage.notify(e),!(e.severity<2)){if(this.showPopups){var s=this.popupTmpl.cloneNode(!0);c.tmplElement(s,"text").textContent="".concat(e.subject,": ").concat(e.details);var l=c.tmplElement(s,"indicator");2===e.severity?c.hide(l):ir(l,e.severity);var u=this.popupNotes;for(u.appendChild(s);u.children.length>5;)u.removeChild(u.firstChild);setTimeout(Vn((function*(){yield c.animate(500,(function(e){s.style.opacity=1-e})),s.remove()})),6e3)}2===e.severity?this.prependPokeElement(e):this.prependNoteElement(e)}}},{key:"log",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];this.loggers[e]&&(t=console).log.apply(t,["".concat(or(),"[").concat(e,"]:")].concat(r)),this.recorders[e]&&this.recorders[e].push({time:or(),msg:r})}},{key:"prependPokeElement",value:function(e){for(this.pokes.push(e);this.pokes.length>100;)this.pokes.shift();var t=this.makePoke(e);this.prependListElement(this.page.pokeList,e,t)}},{key:"prependNoteElement",value:function(e,t){for(this.notes.push(e);this.notes.length>100;)this.notes.shift();var n=this.page.noteList,r=this.makeNote(e);if(this.prependListElement(n,e,r),t||this.storeNotes(),!(0===this.notes.length||c.isDisplayed(this.page.noteBox)&&c.isDisplayed(n))){var o=0,i=this.notes.reduce((function(e,t){return t.acked||o++,!t.acked&&t.severity>e?t.severity:e}),0),a=this.page.noteIndicator;ir(a,i),o?(a.textContent=o>99?"".concat(99,"+"):o,c.show(a)):c.hide(a)}}},{key:"prependListElement",value:function(e,t,n){for(t.el=n,n.note=t,e.prepend(n);e.children.length>100;)e.removeChild(e.lastChild);this.setNoteTimes(e)}},{key:"makeNote",value:function(e){var t=this.page.noteTmpl.cloneNode(!0);if(e.severity>2){var n=3===e.severity?"good":4===e.severity?"warn":"bad";t.querySelector("div.note-indicator").classList.add(n)}return t.querySelector("div.note-subject").textContent=e.subject,t.querySelector("div.note-details").textContent=e.details,t}},{key:"makePoke",value:function(e){var t=this.page.pokeTmpl.cloneNode(!0),n=new Date(e.stamp);return c.tmplElement(t,"dateTime").textContent="".concat(n.toLocaleDateString(),", ").concat(n.toLocaleTimeString()),c.tmplElement(t,"details").textContent="".concat(e.subject,": ").concat(e.details),t}},{key:"loading",value:function(e){var t=this.page.loader.cloneNode(!0);return e.appendChild(t),function(){t.remove()}}},{key:"orders",value:function(e,t){var n=this.user.exchanges[e].markets[t].orders;return n||(n=[],this.user.exchanges[e].markets[t].orders=n),n}},{key:"order",value:function(e){for(var t=0,n=Object.values(this.user.exchanges);t<n.length;t++)for(var r=n[t],o=0,i=Object.values(r.markets);o<i.length;o++){var a=i[o];if(a.orders){var s,l=_n(a.orders);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(c.id===e)return c}}catch(e){l.e(e)}finally{l.f()}}}}},{key:"checkResponse",value:function(e,t){return!(!e.requestSuccessful||!e.ok)||(this.user.inited&&!t&&this.notify(he("API error",e.msg,5)),!1)}},{key:"signOut",value:(r=Vn((function*(){var e=yield B("/api/logout");this.checkResponse(e)?(C.clearAllStore(),C.removeAuthCK(),window.location.href="/login"):c.hide(this.page.profileBox)})),function(){return r.apply(this,arguments)})}])&&Xn(t.prototype,n),e}(),nr=(zn(Dn={},3,"good"),zn(Dn,5,"bad"),zn(Dn,4,"warn"),Dn);function rr(e){return e.replace(/^\//,"").split("/")[0].split("?")[0].split("#")[0]}function or(){var e=new Date,t=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0"),r=e.getSeconds().toString().padStart(2,"0"),o=e.getMilliseconds().toString().padStart(3,"0");return"".concat(t,":").concat(n,":").concat(r,".").concat(o)}function ir(e,t){e.classList.remove("bad","warn","good"),e.classList.add(nr[t])}(new tr).start()})();
//# sourceMappingURL=entry.js.map